(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{320:function(e,t,o){"use strict";o.r(t);var i,n=o(322),r=o(328),a=o(2),s=o(5),l=o(12),c=o(67),d=o(0),h=o(330),p=o(325),u=(o(848),o(381)),f=(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),g=function(e){function t(t){return e.call(this,t)||this}return f(t,e),t.prototype.render=function(){var e=this,t={cursor:this.props.isClicable?"initial":"pointer"};return n.createElement("span",{className:"hourglass-component-wrapper",style:t,onClick:this.props.onClick},u.a.supportsCssClipPath?n.createElement("span",{className:p("hourglass",{"is-dripping":this.props.isPlaying}),ref:function(t){return e.root=t},"data-for":"hourglass-tooltip"},n.createElement("span",{className:"hourglass-inner"},n.createElement("span",{className:"top-sand",style:{height:this.props.percentage+"%"}}),n.createElement("span",{className:"bottom-sand",style:{height:100-this.props.percentage+"%"}}),n.createElement("span",{className:"bloop"}),n.createElement("span",{className:"bloop-two"}))):this.props.remainingTime?this.generateSimpleTimeDisplay():this.generateHourglassCircle())},t.prototype.generateHourglassCircle=function(){return n.createElement("span",{className:"hourglass-circle",style:{background:"linear-gradient(rgb(255, 255, 255) "+this.props.percentage+"%, #fecb2f "+this.props.percentage+"%)"}})},t.prototype.generateSimpleTimeDisplay=function(){return n.createElement("span",{className:"hourglass-remaining-time-label"},this.props.remainingTime)},t}(n.Component),m=o(6),v=o(68),w=o(18),b=o(112),k=o(110),y=o(440),P=o(55),C=o(46),M=o(421);o.d(t,"FreePreviewManagerClass",function(){return x}),o.d(t,"FreePreviewManager",function(){return F});var N,I=$(window),E=$(document);!function(e){e[e.SignIn=0]="SignIn",e[e.Start=1]="Start",e[e.Expired=2]="Expired"}(N||(N={}));var x=function(){function e(){var e=this;this.previouslyVisibleParagraphs=[],this.hasQueuedUnlocks=!1,this.isPerformingUnlocking=!1,this.handleScrollStop=this.handleScrollStop.bind(this),this.handleModalClose=this.handleModalClose.bind(this),this.handleFreePreviewIconClick=this.handleFreePreviewIconClick.bind(this),this.$freePreviewIcons=$(".free-preview-icon-container"),this.$freePreviewIcons.on("click",this.handleFreePreviewIconClick),E.on("anonymousFreePreviewStartRequested freePreviewRequested",function(){return e.startFreePreviewMode()})}return e.prototype.initialize=function(e,t){var o=this;e&&t&&(this.book!=e||this.bookElement!=t)&&(w.a.lastFreePreviewStartedBookShortName&&w.a.lastFreePreviewStartedBookShortName!=e.shortName&&(w.a.setFreePreviewActive(!1),w.a.lastFreePreviewStartedBookShortName=""),t.isOpen||w.a.isUnlockingWholeContentThroughPointingLink||!s.a.hasScrambledParagraphs()||(this.book=e,this.bookElement=t,Promise.all([C.a.getFreePreviewStatus(this.book.shortName),m.a.isLoggedIn()]).then(function(e){var t=e[0];e[1];null!=o.book&&null!=o.bookElement&&(o.book.remainingPreviewDuration=t.remainingDuration,o.book.previewDuration=t.previewDuration,o.createLockedDocumentFragment(),P.a.isFreePreviewAtBeginningAndNotStarted(o.book)?(M.a.renderFreePreviewMessaging(),m.a.isCurrentlyLoggedIn()&&o.setupFreePreviewIcons()):P.a.isFreePreviewAvailableAndContinuing(o.book)?o.continueFreePreview():P.a.hasFreePreviewExpired(o.book)&&!m.a.isCurrentlyLoggedIn()?M.a.renderFreePreviewMessaging():P.a.isFreePreviewAvailable(o.book)&&M.a.renderFreePreviewMessaging())})))},e.prototype.clean=function(){I.off("scroll scrollstop",this.handleScrollStop),w.a.isFreePreviewActive()&&(this.finishFreePreviewMode(),m.a.isCurrentlyLoggedIn()&&this.sendFreePreviewPausedMessage(),this.isPerformingUnlocking=!1),clearInterval(this.freeTimeTrackerId),this.$freePreviewIcons.removeClass("disable-interaction"),$(document.body).removeClass("free-preview-mode"),this.lockedDocumentFragment=null,this.book=null,this.bookElement=null,this.previouslyVisibleParagraphs=null,this.hasQueuedUnlocks=!1,this.$freePreviewIcons.addClass("hidden")},e.prototype.setupFreePreviewIcons=function(){this.setTooltipMessage(this.book.isOpen?"start free preview":"toggle free preview"),this.$freePreviewIcons.removeClass("hidden"),this.renderFreePreviewIcon()},e.prototype.continueFreePreview=function(){this.startFreePreviewMode(),m.a.isCurrentlyLoggedIn()&&this.setupFreePreviewIcons()},e.prototype.handleFreePreviewIconClick=function(){if(this.book)if(w.a.isFreePreviewActive()&&!this.book.isOpen)this.finishFreePreviewMode(),this.sendFreePreviewPausedMessage(),w.a.lastFreePreviewStartedBookShortName="";else{var e=m.a.isCurrentlyLoggedIn();e&&this.book.remainingPreviewDuration>1?(this.startFreePreviewMode(),Math.abs(this.book.previewDuration-this.book.remainingPreviewDuration)<10&&c.a.showTemporaryNotification("Starting free preview")):this.renderFreePreviewMessage(!this.$freePreviewIcons.is(".selected"),e?N.Expired:N.SignIn)}},e.prototype.createLockedDocumentFragment=function(){this.lockedDocumentFragment=document.createDocumentFragment();var e=document.createElement("div");e.innerHTML=this.bookElement.content,this.lockedDocumentFragment.appendChild(e)},e.prototype.handleScrollStop=function(){var e=this,t=s.a.getVisibleParagraphs(),o=l.a.arrayDifference(t,this.previouslyVisibleParagraphs),i=l.a.arrayDifference(this.previouslyVisibleParagraphs,t);if(this.isPerformingUnlocking)return this.hasQueuedUnlocks=!0,void(0==l.a.arrayIntersection(t,this.previouslyVisibleParagraphs).length&&c.a.showTemporaryNotification("please wait for unlocking"));this.unlockElements(o),a.a.setTimeout(function(){return e.lockElements(i)},5),this.previouslyVisibleParagraphs=t},e.prototype.trackFreeTime=function(){var e=this;clearInterval(this.freeTimeTrackerId),this.renderFreePreviewIcon(),this.book.remainingPreviewDuration>0&&this.setTooltipMessage(l.a.formatTimeInSeconds(parseInt(""+this.book.remainingPreviewDuration))+" remaining"),this.freeTimeTrackerId=setInterval(function(){if(e.book.previewDuration+=.2,e.book.remainingPreviewDuration-=.2,e.renderFreePreviewIcon(),e.book.remainingPreviewDuration<=1)return e.finishFreePreviewMode(),w.a.lastFreePreviewStartedBookShortName="",void E.trigger("freePreviewModeExpired");e.book.remainingPreviewDuration<=60&&e.book.remainingPreviewDuration>=58&&c.a.showTemporaryNotification("one more min of free preview <br> to go for today"),e.book.remainingPreviewDuration<=152&&e.book.remainingPreviewDuration>=150&&e.triggerIsHalfWayThroughFreePreview(),e.setTooltipMessage(l.a.formatTimeInSeconds(parseInt(""+e.book.remainingPreviewDuration))+" remaining")},200)},e.prototype.startFreePreviewMode=function(){var e=this;w.a.isFreePreviewActive()||null!=this.lockedDocumentFragment&&(E.trigger("freePreviewModeActivated",this.book.isOpen),$(document.body).addClass("free-preview-mode"),this.book.isOpen&&this.$freePreviewIcons.addClass("disable-interaction"),w.a.setFreePreviewActive(!0),w.a.lastFreePreviewStartedBookShortName=this.book.shortName,this.sendFreePreviewStartedMessage().then(function(t){t.success&&(I.on("scrollstop",e.handleScrollStop),e.unlockElements(s.a.getVisibleParagraphs()),e.trackFreeTime())}))},e.prototype.finishFreePreviewMode=function(){var e=this;I.off("scroll scrollstop",this.handleScrollStop),c.a.hideNotification();var t=s.a.getVisibleParagraphs();this.lockElements(t),this.lockElements(this.previouslyVisibleParagraphs),clearInterval(this.freeTimeTrackerId),this.book.remainingPreviewDuration<=1&&v.a.isDotd(this.book).then(function(t){e.renderFreePreviewMessage(!0,N.Expired,t)}).catch(function(t){return e.renderFreePreviewMessage(!0,N.Expired)}),this.setTooltipMessage("start free preview"),w.a.setFreePreviewActive(!1),$(document.body).removeClass("free-preview-mode"),this.$freePreviewIcons.removeClass("disable-interaction"),E.trigger("freePreviewModeDeactivated"),this.renderFreePreviewIcon()},e.prototype.unlockElements=function(e){var t=this;if(null!=e&&0!=e.length){c.a.showTemporaryNotification("unlocking ...");var o=e.filter(function(e){return e.classList.contains("scrambled")}),i=$(o);0!=o.length&&(this.isPerformingUnlocking||(this.isPerformingUnlocking=!0,k.a.unlockFragments(this.book,this.bookElement,b.a.FreePreview,"",o.map(function(e){return $(e)}),"",0,{previewDuration:Math.max(this.book.previewDuration,.1),timezone:l.a.getCurrentTimezone()}).then(function(e){if(e&&e.previewDuration&&t.book&&e.previewDuration>t.book.previewDuration){e.previewDuration,t.book.previewDuration;t.book.previewDuration=e.previewDuration,t.book.remainingPreviewDuration=e.remainingPreviewDuration}t.isPerformingUnlocking=!1,i.addClass("temp-unscrambled"),t.hasQueuedUnlocks?(t.handleScrollStop(),t.hasQueuedUnlocks=!1):c.a.hideNotification()}).catch(function(){t.isPerformingUnlocking=!1,c.a.showTemporaryNotification("Error when unlocking"),t.hasQueuedUnlocks&&(t.hasQueuedUnlocks=!1)})))}},e.prototype.lockElements=function(e){if(null!=e&&0!=e.length&&null!=this.lockedDocumentFragment)for(var t=0,o=e;t<o.length;t++){var i=o[t],n=$(i);if(!n.is(".scrambled")&&n.is(".unscrambled")){var r=this.lockedDocumentFragment.querySelector("[refid='"+n.attr("refid")+"']");null!=r&&(n.html(r.innerHTML),n.removeClass("unscrambled"),n.addClass("scrambled"),n.removeClass("temp-unscrambled"))}}},e.prototype.renderFreePreviewIcon=function(){var e=0;null!=this.book&&(e=Math.max(100*this.book.previewDuration/(this.book.previewDuration+this.book.remainingPreviewDuration),0),e=Math.min(e,100)),Number.isNaN(e)&&(e=0);for(var t=0;t<this.$freePreviewIcons.length;t++)r.render(n.createElement(g,{percentage:e,hasPlayPause:P.a.canFreePreviewBePaused(this.book,m.a.isCurrentlyLoggedIn()),isPlaying:w.a.isFreePreviewActive(),remainingTime:l.a.formatTimeInSeconds(parseInt(""+this.book.remainingPreviewDuration))}),this.$freePreviewIcons.get(t))},e.prototype.handleModalClose=function(){this.renderFreePreviewMessage(!1)},e.prototype.renderFreePreviewMessage=function(e,t,o){var i=this;void 0===e&&(e=!0),this.$freePreviewIcons.toggleClass("selected",e);var a,s="",l="",c="",d="no thanks",p="",u="";switch(t){case N.Expired:m.a.isCurrentlyLoggedIn()?(s="your free preview has expired for the day",a="add to cart",c="add-to-cart-button",p="add to wish list &nbsp; <i class='fa fa-heart'/>",u="add-to-wish-list-button",d="",l="Buy this book to continue reading it, use tokens to get whatever part you need, or come back tomorrow for more preview time."):(s="your free preview has expired for this book",a="sign in",c="sign-in-button free-preview-sign-in",d="",l=o?"Sign in to preview for 24h":"Sign in for more preview time");break;case N.Start:s="start your free preview",c="start-preview-button",l=this.book&&this.book.isOpen?"The text will unlock so you can read this liveBook for 24h":"The text will unlock so you can read each liveBook for a total of 5 minutes per day (to pause and resume, click the hourglass in the header).",a="start";break;case N.SignIn:default:s="sign in to unlock the whole book",a="sign in",c="sign-in-button free-preview-sign-in",l="The text will unlock so you can read each liveBook for a total of 5 minutes per day."}r.render(n.createElement(h.b,{isOpen:e,title:s,onClose:this.handleModalClose,onCancelationClicked:this.handleModalClose,onActionClicked:function(){t==N.Expired?m.a.isCurrentlyLoggedIn()&&(i.book&&!i.book.newerEditionId?v.a.requestAddBookToCart(i.book):i.book&&i.book.newerEditionId&&v.a.requestAddNewerEditionToCart(i.book.newerEditionId)):t==N.Start&&i.startFreePreviewMode(),i.renderFreePreviewMessage(!1)},additionalModalHeaderClass:"time-limited-preview-message-header-container",mainContainerClassName:"time-limited-preview-message-container",actionMessageHTML:a,actionButtonAdditionalClass:c,secondayActionMessageHTML:p,secondaryActionButtonAdditionalClass:u,onSecondaryActionClicked:function(){y.a.addCurrentBookToWishList(),i.renderFreePreviewMessage(!1)},isContentVerticalTop:!1,cancelationMessageHTML:d},n.createElement("div",{className:"time-limited-preview-content-container"},n.createElement("em",null,l))),document.getElementById("full-screen-modal"))},e.prototype.setTooltipMessage=function(e){if(window.Foundation){this.$freePreviewIcons.attr("data-title",e),this.$freePreviewIcons.attr("title","");var t=window.Foundation.libs.tooltip.getTip(this.$freePreviewIcons.filter(":visible"));null!=t&&t.length&&t.html(e)}},e.prototype.triggerIsHalfWayThroughFreePreview=function(){clearTimeout(this.halfwayThrottleTimer),this.halfwayThrottleTimer=a.a.setTimeout(function(){$(document).trigger("halfWayThroughFreePreview")},2300)},e.prototype.sendFreePreviewStartedMessage=function(){var e=this;return new Promise(function(t,o){d.a.postToOurBackend(d.a.getAbsoluteUrl("api/userBook/startFreePreview"),function(o){if(o&&o.previewDuration&&e.book&&o.previewDuration>e.book.previewDuration){var i=o.previewDuration-e.book.previewDuration;e.book.previewDuration=o.previewDuration,e.book.remainingPreviewDuration-=i}t(o)},function(e){return o()},{bookShortName:e.book.shortName,timezone:l.a.getCurrentTimezone()},!0)})},e.prototype.sendFreePreviewPausedMessage=function(){d.a.postToOurBackend(d.a.getAbsoluteUrl("api/userBook/pauseFreePreview"),function(e){},function(e){},{bookShortName:this.book.shortName},!0)},e}(),F=new x},330:function(e,t,o){"use strict";o.d(t,"a",function(){return n});var i,n,r=o(322),a=o(376),s=o(325),l=(o(337),i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});!function(e){e[e.standard=0]="standard",e[e.dark=1]="dark",e[e.gold=2]="gold",e[e.green=3]="green",e[e.red=4]="red"}(n||(n={}));var c={backgroundColor:"rgba(0, 0, 0, 0.75)",zIndex:1008,top:0,display:"flex",alignItems:"center",justifyContent:"center",position:"fixed"},d={alignItems:"flex-start"},h={backgroundColor:"rgb(255, 255, 255)",display:"fixed",position:"relative",top:"unset",left:"unset",right:"unset",bottom:"unset",border:"unset",borderRadius:"unset",width:"100%",color:"#3C3C3C",overflow:"visible",padding:"20px 40px"},p={maxWidth:"600px",margin:"0 auto",padding:"0"},u={maxHeight:"90vh",overflow:"auto",maxWidth:"85vw"},f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.render=function(){var e=this,t=Object.assign({},h),o=c,i=Object.assign({},u),s=Object.assign({},p);this.props.isContentVerticalTop&&(o=Object.assign({},o,d)),this.props.isPositionStatic&&(o=Object.assign({},o,{position:"static"})),this.props.dontGoFullWidth&&(t=Object.assign({},t,{width:"auto"})),this.props.hasNoPadding&&(t=Object.assign({},t,{padding:"0"})),this.props.noWidthLimitation&&(i=Object.assign({},i,{maxWidth:"auto"}),s=Object.assign({},s,{maxWidth:"auto"})),this.props.theme==n.dark?t=Object.assign({},t,{backgroundColor:"rgb(51, 51,51)"}):this.props.theme==n.gold?t=Object.assign({},t,{backgroundColor:"rgb(254, 203, 47)"}):this.props.theme==n.green?t=Object.assign({},t,{backgroundColor:"rgb(57, 121, 38)"}):this.props.theme==n.red&&(t=Object.assign({},t,{backgroundColor:"rgb(195, 41, 28)"})),this.props.contentTopOffset&&(t=Object.assign({},t,{top:this.props.contentTopOffset})),this.props.initialOverlayTop&&(o.top=this.props.initialOverlayTop,i.maxHeight="calc("+u.maxHeight+" - "+this.props.initialOverlayTop+")");var l={"dark-theme":this.props.theme==n.dark,"gold-theme":this.props.theme==n.gold,"green-theme":this.props.theme==n.green,"red-theme":this.props.theme==n.red};return this.props.parentElement&&this.props.parentElement!=document.body?r.createElement("div",{className:"ReactModal__Overlay",style:o},r.createElement("div",{style:t},this.generateModalContent(l,s,i))):r.createElement(a,{isOpen:this.props.isOpen,appElement:document.body,style:{overlay:o,content:t},parentSelector:function(){return document.body},onRequestClose:function(){null!=e.props.onClose&&(e.props.onClose instanceof Function?e.props.onClose():console.error&&console.error("onClose is not a function",e.props.onClose,e.props.mainContainerClassName))}},this.generateModalContent(l,s,i))},t.prototype.generateModalContent=function(e,t,o){var i=this;return r.createElement(r.Fragment,null,r.createElement("div",{className:s("modal-header",e,this.props.additionalModalHeaderClass)},r.createElement("div",{className:"modal-back-button-container"},this.props.hasBackButton?r.createElement("div",{className:"modal-header-button",onClick:function(e){return i.props.onBack&&i.props.onBack()}},r.createElement("i",{className:"fa fw fa-chevron-left"})):r.createElement("i",{className:"fa fw fa-chevron-left",style:{opacity:0}})),r.createElement("div",{className:"modal-title-container"},this.props.title&&r.createElement("h3",{dangerouslySetInnerHTML:{__html:this.props.title}}),this.props.subtitle&&r.createElement("span",{style:this.props.subtitleStyle},this.props.subtitle)),r.createElement("div",{className:s("modal-close-button-container",{"no-padding":this.props.hasNoPadding})},r.createElement("div",{className:"modal-header-button",onClick:function(e){return i.props.onClose&&i.props.onClose()}},r.createElement("i",{className:"fa fw fa-times"})))),r.createElement("div",{className:s(this.props.mainContainerClassName,e),style:t},r.createElement("div",{style:o,className:"modal-content-container"},this.props.children,r.createElement("div",null,this.props.actionMessageHTML&&r.createElement("span",{className:s("tokens-button action-button",this.props.actionButtonAdditionalClass),onClick:this.props.onActionClicked,dangerouslySetInnerHTML:{__html:this.props.actionMessageHTML}}),this.props.secondayActionMessageHTML&&r.createElement("span",{className:s("tokens-button action-button",this.props.secondaryActionButtonAdditionalClass),onClick:this.props.onSecondaryActionClicked,dangerouslySetInnerHTML:{__html:this.props.secondayActionMessageHTML}})),this.props.cancelationMessageHTML&&r.createElement("span",{className:"tokens-button cancel-button",onClick:this.props.onCancelationClicked,dangerouslySetInnerHTML:{__html:this.props.cancelationMessageHTML}}))))},t}(r.Component);t.b=f},337:function(e,t,o){var i=o(338);"string"==typeof i&&(i=[[e.i,i,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};o(324)(i,n);i.locals&&(e.exports=i.locals)},338:function(e,t,o){(e.exports=o(323)(!1)).push([e.i,".ReactModal__Overlay{animation:fade-in-black-background 0.1s ease-in-out;font-family:'Lato';position:relative;text-align:left}.ReactModal__Overlay .dark-theme .modal-title-container{color:#fecb2f}.ReactModal__Overlay .dark-theme p{color:white}.ReactModal__Overlay .green-theme{color:white}.ReactModal__Overlay .green-theme .modal-header-button{color:white}.ReactModal__Overlay .green-theme h3,.ReactModal__Overlay .green-theme em,.ReactModal__Overlay .green-theme p{color:white}.ReactModal__Overlay .red-theme{color:white}.ReactModal__Overlay .red-theme .modal-header-button{color:white}.ReactModal__Overlay .red-theme h3,.ReactModal__Overlay .red-theme em,.ReactModal__Overlay .red-theme p{color:white}.ReactModal__Overlay .gold-theme .modal-header-button{color:#c69501}.ReactModal__Overlay .gold-theme h3{font-weight:bold}.ReactModal__Overlay .gold-theme .modal-content-container{margin-top:-1em;overscroll-behavior:none;-ms-scroll-chaining:none}.ReactModal__Overlay .modal-header{display:flex;align-items:center;justify-content:space-between;font-weight:300;line-height:1}.ReactModal__Overlay .modal-header-button{font-size:1em;cursor:pointer;user-select:none;color:#9a9a9a}.ReactModal__Overlay .modal-back-button-container{position:absolute;top:35px;left:20px}.ReactModal__Overlay .modal-close-button-container{position:absolute;top:35px;right:20px;z-index:10}.ReactModal__Overlay .modal-close-button-container.no-padding{top:25px}@media screen and (max-width: 450px){.ReactModal__Overlay .modal-close-button-container.no-padding{top:15px}}.ReactModal__Overlay .modal-title-container{max-width:600px;margin:0 auto}.ReactModal__Overlay h3{font-size:2em;font-weight:300;display:inline-block;margin:0 0.5em 20px 0;color:inherit}.ReactModal__Overlay .modal-title-container{flex:1 auto}.ReactModal__Overlay .cancel-button{float:right}.ReactModal__Overlay .tokens-button{background-color:gray}.ReactModal__Overlay .tokens-button:hover:not(.disabled){background-color:#9a9a9a}.ReactModal__Overlay .tokens-button:active:not(.disabled){background-color:#8d8d8d}.ReactModal__Overlay .tokens-button.action-button{color:white;background-color:#3C67A2}.ReactModal__Overlay .tokens-button.action-button:hover:not(.disabled){background-color:#5280bf}.ReactModal__Overlay .tokens-button.action-button:active:not(.disabled){background-color:#4373b5}@keyframes fade-in-black-background{0%{background-color:rgba(0,0,0,0)}100%{background-color:rgba(0,0,0,0.75)}}\n",""])},381:function(e,t,o){"use strict";var i=function(){function e(){this.isTouch="ontouchstart"in window||navigator.maxTouchPoints>0;try{this.supportsCssClipPath=window&&window.CSS&&window.CSS.supports&&window.CSS.supports("clip-path","polygon(50% 0%, 0% 100%, 100% 100%)")}catch(e){this.supportsCssClipPath=!1}}return e.prototype.isRunningInLivebook=function(){return-1!==document.location.hostname.indexOf("livebook")||-1!==document.title.toLowerCase().indexOf("livebook")},e.prototype.isRunningInLivevideo=function(){return-1!==document.location.hostname.indexOf("livevideo")||-1!==document.title.toLowerCase().indexOf("livevideo")},e.prototype.isRunningInMarketplace=function(){return!this.isRunningInLivebook()&&!this.isRunningInLivevideo()},e.prototype.isMobileWidth=function(){return window.innerWidth<500},e}();t.a=new i},421:function(e,t,o){"use strict";o.d(t,"a",function(){return h});var i=o(0),n=o(68),r=o(6),a=(o(441),o(28)),s=o(2),l=o(18),c=o(55),d=o(5),h=new(function(){function e(){var e=this;this.$headerNotificationContainer=$("#header-notification-container"),this.$headerNotificationContainer.on("click",".free-ebook-sign-in",function(){a.a.requestOpenModal("signin","sign in to read this free ebook","free-ebook-sign-in")}),this.$headerNotificationContainer.on("click",".free-preview-sign-in",function(e){$(e.target).is(".add-dotd-book-to-cart")||a.a.requestOpenModal("signin","sign in to unlock this book","free-preview-sign-in")}),this.$headerNotificationContainer.on("click",".fa-close",function(){e.hideHeaderNotifier(),$(document).trigger("headerNotifierHidden")}),this.$headerNotificationContainer.on("click",".add-dotd-book-to-cart",function(){null!=e.dotdPromoInfo&&n.a.requestAddBookToCartByBookShortName(e.book.shortName,e.dotdPromoInfo.discountCode),e.dotdPromoInfo=null,e.hideHeaderNotifier()}),this.$headerNotificationContainer.on("click",".free-preview-start",function(e){$(e.target).is(".newer-version-link")?document.location=e.target.href:$(document).trigger("freePreviewRequested")}),$(document).on("freePreviewModeActivated freePreviewModeDeactivated",function(){s.a.setTimeout(function(){e.renderFreePreviewMessaging()},16)}),$(document).on("freePreviewModeExpired",function(){r.a.isCurrentlyLoggedIn()&&e.hideHeaderNotifier()})}return e.prototype.setPromotion=function(e){this.dotdPromoInfo=e,this.initialize(this.book,this.bookElement)},e.prototype.initialize=function(e,t){var o=this;if(this.book=e,this.bookElement=t,null!=e||null!=t){if(e.latestMeapVersion!=t.meapVersion)return this.$headerNotificationContainer.html('<a href="'+i.a.getBookElementUrl(this.book.slug,this.bookElement.shortName)+"\"> Newer version available! <span class='action-label'>Access the latest version</span></a>"),void this.showHeaderNotifier();n.a.getNewestEditionProduct(e).then(function(t){null!=t&&t.newestEditionProduct&&t.newestEditionProduct.slug&&(e.newerEditionId=t.newestEditionProduct.id,o.$headerNotificationContainer.html('<a href="'+i.a.getBookElementUrl(t.newestEditionProduct.slug,"")+"\"> Newer edition available! <span class='action-label'>Access the latest version</span></a>"),o.showHeaderNotifier())}),this.renderPromoMessage()}else this.renderPromoMessage()},e.prototype.clean=function(){this.hideHeaderNotifier(),this.book=null,this.bookElement=null},e.prototype.renderPromoMessage=function(){if(null!=this.dotdPromoInfo){var e=null!=this.book&&this.book.shortName==this.dotdPromoInfo.productExternalId;if(null==this.book||e){if(null!=this.book&&this.book.userOwnsBook)return;this.showHeaderNotifier(),this.$headerNotificationContainer.html("\n                <div class='promo-header'>\n                    <a class=\"single-line "+(e?"add-dotd-book-to-cart":"")+'" href="'+(e?"javascript:void(0)":this.dotdPromoInfo.productLink)+'" data-product-external-id='+this.dotdPromoInfo.productExternalId+">"+(e?this.dotdPromoInfo.shortMessage:this.dotdPromoInfo.headerMessage)+'</a>\n                    <i class="fa fa-close close-promo-button" data-product-external-id="'+this.dotdPromoInfo.productExternalId+'"/>\n                </div>\n            ')}}},e.prototype.renderFreePreviewMessaging=function(){var e=this;if((null==this.bookElement||!this.bookElement.isOpen)&&d.a.hasScrambledParagraphs()){var t=this.getHeadingAndDescription(this.book,r.a.isCurrentlyLoggedIn());null!=t?(this.showHeaderNotifier(),this.$headerNotificationContainer.html('<div class="free-preview-notifier '+(t.additionalClass||"")+'">\n                <span class="free-preview-heading-wrapper">'+t.heading+"</span>\n                "+(t.description?'<i class="fa fa-question-circle dont-propagate-click" data-tooltip aria-haspopup="true" data-options="disable_for_touch:true;" title="'+t.description+'" aria-hidden="true"></i>':"")+"\n                <a class=\"newer-version-link dont-propagate-click hidden\" style='display: inline;' href=\"\">(access the <span style='text-decoration: underline'>latest</span> version)</a>\n             </div>"),"free-preview-starting"==t.additionalClass&&this.countDownToAutoStartFreePreview(),this.$headerNotificationContainer.foundation("tooltip"),"free-preview-start"!=t.additionalClass&&"free-preview-running"!=t.additionalClass&&"free-preview-sign-in"!=t.additionalClass||(this.book.latestMeapVersion!=this.bookElement.meapVersion?this.updateNewerVersionLink(i.a.getBookElementUrl(this.book.slug,this.bookElement.shortName)):n.a.getNewestEditionProduct(this.book).then(function(t){null!=t&&t.newestEditionProduct&&t.newestEditionProduct.slug&&e.updateNewerVersionLink(i.a.getBookElementUrl(t.newestEditionProduct.slug,""))}))):this.hideHeaderNotifier()}},e.prototype.updateNewerVersionLink=function(e){this.$headerNotificationContainer.find(".newer-version-link").attr("href",e).removeClass("hidden")},e.prototype.countDownToAutoStartFreePreview=function(){var e=this;0!=this.$headerNotificationContainer.find(".free-preview-auto-start-countdown").length&&s.a.setTimeout(function(){e.$headerNotificationContainer.find(".free-preview-count-down-wrapper").addClass("activate-1"),s.a.setTimeout(function(){e.$headerNotificationContainer.find(".free-preview-count-down-wrapper").removeClass("activate-1").addClass("activate-2"),s.a.setTimeout(function(){e.$headerNotificationContainer.find(".free-preview-count-down-wrapper").removeClass("activate-2").addClass("activate-3"),s.a.setTimeout(function(){$(document).trigger("anonymousFreePreviewStartRequested")},1e3)},1e3)},1e3)},1)},e.prototype.getHeadingAndDescription=function(e,t){return e.isFreeEbook?t?null:{heading:"<span class='action-label'>sign in</span> to access this free eBook",description:"This eBook is free after you log in",additionalClass:"free-ebook-sign-in"}:l.a.isFreePreviewActive()?{heading:"in free preview"+this.getAdditionalPriceMessage(),description:"",additionalClass:"free-preview-running"}:c.a.isFreePreviewAtBeginningAndNotStarted(e)||c.a.isFreePreviewAvailable(e)?t?e.isOpen?{heading:"<span class='action-label'>start</span> your 24h free preview",description:"The text will unlock so you can read this book for 24 hours.",additionalClass:"free-preview-start"}:{heading:"<span class='action-label'>start</span> your free preview",description:"The text will unlock so you can read each liveBook for a total of 5 minutes per day. (to pause and resume, click the hourglass in the header)",additionalClass:"free-preview-start"}:{heading:"starting free preview in <span class='free-preview-auto-start-countdown'><div class='free-preview-count-down-wrapper'><div class='free-preview-count-down-3'>3</div><div class='free-preview-count-down-2'>2</div><div class='free-preview-count-down-1'>1</div><div class='free-preview-count-down-0'>0</div></div></span>",additionalClass:"free-preview-starting",description:""}:c.a.hasFreePreviewExpired(e)&&!t?e.isOpen?{heading:"<span class='action-label'>sign in</span> to unlock the whole book for 24h"+this.getAdditionalPriceMessage(),description:"The text will unlock so you can read this book for 24 hours.",additionalClass:"free-preview-sign-in"}:{heading:"<span class='action-label'>sign in</span> to unlock the whole book"+this.getAdditionalPriceMessage(),description:"The text will unlock so you can read each liveBook for a total of 5 minutes per day.",additionalClass:"free-preview-sign-in"}:void 0},e.prototype.getAdditionalPriceMessage=function(){return null!=this.dotdPromoInfo&&null!=this.book&&this.dotdPromoInfo.productExternalId==this.book.shortName?' <span class="action-label add-dotd-book-to-cart" data-product-external-id='+this.dotdPromoInfo.productExternalId+">(get the book for "+this.dotdPromoInfo.priceMessage+")</span>":""},e.prototype.hideHeaderNotifier=function(){this.$headerNotificationContainer.addClass("hidden"),$(document).trigger("headerNotifierHidden")},e.prototype.showHeaderNotifier=function(){this.$headerNotificationContainer.removeClass("hidden"),$(document).trigger("headerNotifierShown")},e}())},440:function(e,t,o){"use strict";o.d(t,"a",function(){return n});var i=o(3),n=new(function(){function e(){this.shouldWishListABeShown=!0}return e.prototype.initialize=function(e){this.getWishListManagerSource().then(function(t){return t.WishListManager.initalize(e)})},e.prototype.clean=function(){this.getWishListManagerSource().then(function(e){return e.WishListManager.clean()})},e.prototype.addCurrentBookToWishList=function(){this.getWishListManagerSource().then(function(e){return e.WishListManager.addCurrentBookToWishList()})},e.prototype.getWishListManagerSource=function(){return this.wishListManagerSourcePromise||(this.wishListManagerSourcePromise=i.a.importWebpackModuleWithRetry(this.constructWishListManagerSourcePromise)),this.wishListManagerSourcePromise},e.prototype.constructWishListManagerSourcePromise=function(){return o.e(49).then(o.bind(null,663))},e}())},441:function(e,t,o){var i=o(442);"string"==typeof i&&(i=[[e.i,i,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};o(324)(i,n);i.locals&&(e.exports=i.locals)},442:function(e,t,o){(e.exports=o(323)(!1)).push([e.i,"#header-notification-container{background-color:#5facbe;line-height:1.8;color:white;text-align:center;margin:0 auto;user-select:none}@media screen and (max-width: 689px){#header-notification-container{font-size:0.75rem}}#header-notification-container a{color:white;font-weight:350;display:block;width:100%;font-size:13px;padding:2px}#header-notification-container .action-label{text-decoration:underline;display:inline-block}#header-notification-container .free-preview-notifier{cursor:pointer;font-weight:300;user-select:none;background-color:#ffcc00;color:#3c3c3c;transition:background-color 0.5s ease-in}#header-notification-container .free-preview-notifier.free-preview-starting .free-preview-heading-wrapper{display:flex;justify-content:center}#header-notification-container .free-preview-notifier.free-preview-running{background-color:#5cb85c;color:white;cursor:initial}#header-notification-container .free-preview-notifier spanÂ {font-size:90%;font-weight:300}#header-notification-container .free-preview-notifier i{display:inline-block;margin-left:0.25em}#header-notification-container .free-preview-notifier .free-preview-auto-start-countdown{position:relative;overflow:hidden;display:inline-block;height:1.4em;margin-left:0.3em;font-weight:bold}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper{transition:transform 1s ease-in-out}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper.activate-1{transform:translateY(-25%)}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper.activate-2{transform:translateY(-50%)}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper.activate-3{transform:translateY(-75%)}#header-notification-container .free-preview-notifier .free-preview-count-down-3{display:block}#header-notification-container .free-preview-notifier .free-preview-count-down-2{display:block}#header-notification-container .free-preview-notifier .free-preview-count-down-1{display:block}.promo-header{padding:0 0.5em;display:flex;align-items:center}.promo-header a{font-weight:normal}.promo-header a:hover{text-decoration:underline}.promo-header .fa{margin:0 0.5em;cursor:pointer}.add-dotd-book-to-cart{cursor:pointer}\n",""])},848:function(e,t,o){var i=o(849);"string"==typeof i&&(i=[[e.i,i,""]]);var n={hmr:!0,transform:void 0,insertInto:void 0};o(324)(i,n);i.locals&&(e.exports=i.locals)},849:function(e,t,o){(e.exports=o(323)(!1)).push([e.i,".hourglass-component-wrapper{display:inline-block;position:relative;cursor:pointer}.hourglass{background:white;width:16px;height:16px;display:block;clip-path:polygon(0 0, 100% 0, 60% 50%, 100% 100%, 0 100%, 40% 50%);position:relative}.hourglass.is-dripping .bloop,.hourglass.is-dripping .bloop-two{animation-play-state:running}.hourglass .hourglass-inner{background:#4d4d4d;display:block;width:100%;height:100%;clip-path:polygon(10% 5%, 90% 5%, 55% 50%, 90% 95%, 10% 95%, 45% 50%)}.hourglass .top-sand{background:white;display:block;width:100%;height:0;transform:scaleY(0.5);transform-origin:0 0}.hourglass .bottom-sand{background:white;display:block;width:100%;height:100%;transform:scaleY(0.5);transform-origin:0 0%;position:absolute;top:50%}.hourglass .bloop,.hourglass .bloop-two{background:#4d4d4d;display:block;width:10%;height:10%;position:absolute;left:45%;top:40%}.hourglass .bloop,.hourglass .bloop-two{animation-name:hourglassBloopAnimation;animation-duration:750ms;animation-delay:0s;animation-iteration-count:infinite;animation-timing-function:ease-in-out;animation-play-state:paused}.hourglass .bloop-two{animation-delay:375ms}@keyframes hourglassBloopAnimation{0%{top:40%;height:0%;left:45%}50%{height:10%}100%{top:95%;height:10%;width:20%;left:40%}}.hourglass-circle{width:16px;height:16px;border:2px solid #ccc;border-radius:100%;text-align:center;color:#fff;background-color:#4d4d4d;display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;align-items:center;box-sizing:border-box}\n",""])}}]);
//# sourceMappingURL=freePreviewManager.chunk.js.map?447d6011dc3aecde4128