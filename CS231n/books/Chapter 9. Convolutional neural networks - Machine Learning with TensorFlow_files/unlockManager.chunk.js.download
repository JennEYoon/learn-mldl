(window.webpackJsonp=window.webpackJsonp||[]).push([[36,28,38],{310:function(e,t,n){"use strict";n.r(t),n.d(t,"UnlockText",function(){return p});var o=n(17),r=n(2),i=n(13),a=n(4),s=n(46),l=n(12),c=n(18),u=n(112),d=n(110),h=$(document),f=a.b.isTouchDevice(),p=new(function(){function e(){var e=this;this.handleUnlockSuccess=this.handleUnlockSuccess.bind(this),this.handleUnlockHeadingClick=this.handleUnlockHeadingClick.bind(this),this.handleMouseEnter=this.handleMouseEnter.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.handleHeadingMouseEnter=this.handleHeadingMouseEnter.bind(this),h.on("freePreviewModeActivated",function(){e.hideHeadingLocks()}),h.on("freePreviewModeDeactivated",function(){e.showHeadingLocks()}),h.on("pointingLinkOpened",function(t,n,o){o&&e.hideHeadingLocks()})}return e.prototype.initialize=function(e,t){var n=this;null!=t&&t.isOpen||null==t.bookElementPriceInfo||e&&(c.a.isUnlockingWholeContentThroughPointingLink||(this.book=e,this.bookElement=t,$(document.body).addClass("unlock-supported"),this.$headings=o.a.getHeadings(),h.on("unlockSuccess",this.handleUnlockSuccess),this.book&&r.a.setTimeout(function(){n.$headings.each(function(e,t){var r=$(t),i=o.a.getHeadingSectionCost(n.bookElement.bookElementPriceInfo,r,n.$headings);i>0&&0==r.find(".scrambled-notifier").length&&r.append(n.generateScrambledParagraphNotifierHTML(i,!0,r.text().trim()))}),c.a.isFreePreviewActive()&&n.hideHeadingLocks(),f||n.$headings.on("mouseenter",n.handleHeadingMouseEnter)},10),this.book.isParagraphByParagraphUnlockDisabled||(h.on("mouseenter",".readable-text.scrambled",this.handleMouseEnter),h.on("mouseleave",".readable-text.scrambled",this.handleMouseLeave),$(".readable-text.scrambled").on("click",this.handleScrambledTextClick)),h.on("click",".scrambled-notifier",this.handleScrambledTextClick)))},e.prototype.clean=function(){this.$headings=null,h.off("unlockSuccess",this.handleUnlockSuccess),h.off("click",".scrambled-notifier",this.handleScrambledTextClick),this.unsubscribeParagraphUnlockEvents(),$(".scrambled").off(),$(document.body).removeClass("unlock-supported")},e.prototype.disableParagraphByParagraphUnlock=function(){this.unsubscribeParagraphUnlockEvents()},e.prototype.getParagraphsPrice=function(e){var t=this;if(null!=e&&0!=e.length&&null!=this.bookElement&&null!=this.bookElement.bookElementPriceInfo){var n=0;return e.forEach(function(e){return n+=t.getParagraphPrice(e)}),Math.max(n,0)}},e.prototype.getParagraphPrice=function(e){if(null==this.bookElement||null==this.bookElement.bookElementPriceInfo)return 0;if(!e||!e.length)return 0;var t=(this.bookElement.wordCount||0)-(this.bookElement.freeWordCount||0);if(!(t<=0)){var n=this.bookElement.bookElementPriceInfo.fullTokenPrice;if(!(n<=0)){var o=e.text();return e.find(".scrambled-notifier").length&&(o=o.replace(e.find(".scrambled-notifier").text(),"")),Math.max(Math.ceil(l.a.getNumberOfWords(o)/t*1.2*n),0)}}},e.prototype.showHeadingLocks=function(){$(".heading-scrambled-notifier").css("display","flex")},e.prototype.hideHeadingLocks=function(){$(".heading-scrambled-notifier").css("display","none")},e.prototype.unsubscribeParagraphUnlockEvents=function(){h.off("mouseenter",".readable-text.scrambled",this.handleMouseEnter),h.off("mouseleave",".readable-text.scrambled",this.handleMouseLeave),h.off("click",".scrambled-notifier",this.handleScrambledTextClick)},e.prototype.handleHeadingMouseEnter=function(e){$(e.currentTarget).find(".heading-scrambled-notifier").removeClass("heading-scrambled-notifier-hidden")},e.prototype.handleMouseEnter=function(e){var t=$(e.currentTarget);if(f||$(".heading-scrambled-notifier").addClass("heading-scrambled-notifier-hidden"),!t.is(".unscrambled, .unscrambling")&&t.is(".scrambled")&&!c.a.isFreePreviewActive())if(t.is("li")){var n=o.a.expandListOfScrambledParagraphsIfNecessary([t]);n.length>1?this.addScrambleParagraphNotifierHtml(t.parent()):this.addScrambleParagraphNotifierHtml(t),n.forEach(function(e){return e.addClass("unscramble-target")})}else this.addScrambleParagraphNotifierHtml(t),t.addClass("unscramble-target")},e.prototype.handleMouseLeave=function(e){var t=$(e.currentTarget);t.find(".scrambled-notifier").remove(),t.is("li")&&t.parent().find(".scrambled-notifier").remove(),$(".unscramble-target").removeClass("unscramble-target")},e.prototype.addScrambleParagraphNotifierHtml=function(e){if(e&&e.length&&0==e.find(".scrambled-notifier").length){var t=0;if(e.is("ul, ol")){var n=[];e.children().each(function(e,t){n.push($(t))}),t=this.getParagraphsPrice(n)}else t=this.getParagraphPrice(e);t>0&&e.append(this.generateScrambledParagraphNotifierHTML(t))}},e.prototype.handleUnlockSuccess=function(e,t){var n=this;t!=u.a.FreePreview&&"FreePreview"!=t&&r.a.setTimeout(function(){n.book&&n.bookElement&&n.book.shortName&&n.bookElement.shortName&&s.a.bookContentService.then(function(e){n.book&&n.bookElement&&n.book.shortName&&n.bookElement.shortName&&e.getCompleteBookElementPriceInfo(n.book.shortName,n.bookElement.shortName,n.bookElement.meapVersion).then(function(e){null!=e&&0!=e.tokenPrice&&(n.bookElement.bookElementPriceInfo=e,n.$headings.each(function(e,t){var r=$(t),i=o.a.getHeadingSectionCost(n.bookElement.bookElementPriceInfo,r,n.$headings);0!=i?r.find(".price-container").text(i):r.find(".scrambled-notifier").remove()}))}).catch(function(e){console.log("Cannot get book element price info")})})},50)},e.prototype.handleUnlockHeadingClick=function(e){var t=$("#"+$(e.currentTarget).attr("data-heading-id"));d.a.showModalForCurrentBookElementPurchases(t)},e.prototype.generateScrambledParagraphNotifierHTML=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n="");var o="";o=t?i.a.isChapterOrAppendix(n)?"unlock whole chapter":"unlock whole section":"unlock this paragraph";var r=a.b.isTouchDevice()?"tap":"click";return t?'<div class="scrambled-notifier heading-scrambled-notifier '+(f?"":"heading-scrambled-notifier-hidden")+' unlock-notifier" title="'+o+'">\n                        <div class="token-icon-container">\n                            <svg viewBox="0 0 10.583333 10.583334"><use xlink:href="#token-icon"></svg>\n                            <span class="price-container show-medium-up">'+e+"</span>\n                        </div>\n                    </div>":'<div class="scrambled-notifier paragraph-scrambled-notifier unlock-notifier '+(e>9?"contains-double-digit-tokens":"")+'" title="'+o+'">\n                        <span class="scramble-message-container show-medium-up">'+r+' to unlock! </span>\n                        <div class="token-icon-container">\n                            <svg viewBox="0 0 10.583333 10.583334"><use xlink:href="#token-icon"></svg>\n                            <span class="price-container show-medium-up">'+e+'</span>\n                        </div>\n                        <span class="scrambled-arrow-container"></span>\n                    </div>'},e.prototype.getRelevantScrambledParagraph=function(e){if(e)try{var t=$(e).closest(".readable-text");if(t.is(".scrambled")&&!t.is("li"))t[0];else{var n=parseInt(t.attr("refid"));if(Number.isNaN(n))return null;for(var o=n+1;o<n+10;o++){if((r=$(document.getElementById(""+o))).is(".scrambled")&&!r.is("li"))return r[0]}for(o=n-1;o>n-10;o--){var r;if((r=$(document.getElementById(""+o))).is(".scrambled")&&!r.is("li"))return r[0]}}}catch(e){}return null},e.prototype.handleScrambledTextClick=function(e){if(!$(e.target).is("a")&&!$(document.body).is(".free-preview-mode")){var t=$(e.currentTarget);t.is(".scrambled")?d.a.showModalForCurrentBookElementPurchases(null,o.a.expandListOfScrambledParagraphsIfNecessary([t])):t.is(".scrambled-notifier.heading-scrambled-notifier")&&d.a.showModalForCurrentBookElementPurchases(t.closest(".readable-text"))}},e}())},311:function(e,t,n){"use strict";n.r(t);var o,r=n(322),i=n(328),a=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=function(e){function t(t){var n=e.call(this,t||"Promise was canceled")||this;return n.name="CancelError",n}return a(t,e),Object.defineProperty(t.prototype,"isCanceled",{get:function(){return!0},enumerable:!0,configurable:!0}),t}(Error),l=function(){function e(e){var t=this;this._cancelHandlers=[],this._isPending=!0,this._isCanceled=!1,this._promise=new Promise(function(n,o){return t._reject=o,e(function(e){t._isPending=!1,n(e)},function(e){t._isPending=!1,o(e)},function(e){t._cancelHandlers.push(e)})})}return e.fn=function(t){return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return new e(function(e,o,r){n.push(r),t.apply(void 0,n).then(e,o)})}},e.prototype.then=function(e,t){return this._promise.then(e,t)},e.prototype.catch=function(e){return this._promise.catch(e)},e.prototype.finally=function(e){return this._promise.finally(e)},e.prototype.cancel=function(e){if(this._isPending&&!this._isCanceled){if(this._cancelHandlers.length>0)try{for(var t=0,n=this._cancelHandlers;t<n.length;t++){(0,n[t])()}}catch(e){this._reject(e)}this._isCanceled=!0,this._reject(new s(e))}},Object.defineProperty(e.prototype,"isCanceled",{get:function(){return this._isCanceled},enumerable:!0,configurable:!0}),e}(),c=l;Object.setPrototypeOf(l.prototype,Promise.prototype);var u=n(654),d=n.n(u),h=n(0),f=n(14),p=n(2),m=n(380),k=n(67),g=n(17),b=n(334),v=n(365),_=n(550),y=n(310),E=n(12),C=n(6),T=n(28),w=n(68),P=n(112),O=function(){function e(e){this.$readableTexts=e,P.b.markParagraphsForUnscrambling(e)}return e.prototype.startUnlockAnimation=function(){this.fadeOutAllText()},e.prototype.revertAnimation=function(){this.fadeInAllText()},e.prototype.fadeOutAllText=function(){var e=this,t=$($.map(this.$readableTexts,function(e){return e.get()}));t.velocity({opacity:0},{duration:2e3,complete:function(){e.isUnscrambledTextInserted||t.velocity({opacity:1},{duration:2e3,complete:function(){e.isUnscrambledTextInserted||e.fadeOutAllText()}})}})},e.prototype.fadeInAllText=function(){var e=$($.map(this.$readableTexts,function(e){return e.get()}));e.velocity("stop"),e.velocity({opacity:1},{duration:250})},e.prototype.insertUnscrambledContent=function(e){for(var t=function(t){var o=n.$readableTexts[t],r=o.attr("refid"),i=e.find(function(e){return e.paragraphID==r});i&&(o.html(i.content),o.removeClass("scrambled unscrambling"),o.addClass("unscrambled"),o.find(".scrambled-notifier").remove(),o.removeClass("scrambled unscrambling"),o.addClass("unscrambled"),o.attr("data-original-html",""))},n=this,o=0;o<this.$readableTexts.length;o++)t(o)},e.prototype.unlockWithAnimations=function(e){this.fadeInAllText(),e&&e()},e}(),M=n(16);n.d(t,"UnlockContentManager",function(){return L});var I=$(document),L=new(function(){function e(){var e=this;this.$unscrambleInfoModal=$("#unscramble-info-modal"),0==this.$unscrambleInfoModal.length&&($(document.body).append(S),this.$unscrambleInfoModal=$("#unscramble-info-modal")),p.a.onDescendantEventWithCooldown(this.$unscrambleInfoModal,"click touchstart",".add-to-cart-button",function(){return e.addCurrentBookToCart()}),p.a.onDescendantEventWithCooldown(this.$unscrambleInfoModal,"click touchstart",".view-in-cart-button",function(){e.hideOutOfTokensModal(),setTimeout(function(){return w.a.requestMenuOpen()},300)}),p.a.onDescendantEventWithCooldown(this.$unscrambleInfoModal,"click touchstart",".buy-tokens-button",function(){e.hideOutOfTokensModal()}),I.on("shoppingCartItemsChanged",function(){return e.updatePurchaseButtons()})}return e.prototype.initialize=function(e,t){this.book=e,this.bookElement=t,this.fetchAndDisplayLatestTokenInfo()},e.prototype.clean=function(){this.book=null,this.bookElement=null},e.prototype.fetchAndDisplayLatestTokenInfo=function(e){var t=this;void 0===e&&(e=!1),C.a.isCurrentlyLoggedIn()?m.a.getTokenCountInfo(e).then(function(e){t.refreshTokenStateInToolbar(e)}).catch(function(e){t.refreshTokenStateInToolbar({availableCompedTokenCount:0,availablePurchasedTokenCount:0})}):this.refreshTokenStateInToolbar({availableCompedTokenCount:0,availablePurchasedTokenCount:0})},e.prototype.tryToSearchUnlockFragmentInCurrentBookElement=function(e){this.unlockFragments(this.book,this.bookElement,P.a.Search,"",e)},e.prototype.tryToUnlockTocBookElement=function(e,t,n){var o=this;C.a.isLoggedIn().then(function(r){r.loggedIn?o.hasEnoughTokens(n,r.userDetails&&r.userDetails.tokenInfo)?(k.a.showTemporaryNotification("Unlocking content ..."),o.getUnlockTocBookElementPromise(e,t).then(function(e){I.trigger("unlockSuccess",[P.a.BookElement]),k.a.showTemporaryNotification("Unlock success. Loading "+t+"."),p.a.setTimeout(function(){b.a.openLink(b.a.formLinkFromBookSlugAndBookElementShortName(o.book.slug,t)),h.a.reloadPage()},2e3)}).catch(function(e){I.trigger("unlockFailure",[P.a.BookElement,[]]),k.a.showTemporaryNotification("Error unlocking "+t+". Try later.")})):o.showOutOfTokensModal():o.showLoginModal("Want to see more? Just sign in and use tokens to unlock this content.")})},e.prototype.hasEnoughTokens=function(e,t){return null!=t&&this.getTotalNumberOfTokens(t)>=e},e.prototype.unlockFragments=function(e,t,n,o,r,i,a,s){var l=this;return new c(function(c,u,d){C.a.isLoggedIn().then(function(h){var f=n==P.a.Search,p=n==P.a.FreePreview;if(h.loggedIn||p){var g=r.map(function(e){return e.attr("id")}),b=a||l.getTokenCost(r);l.getTotalNumberOfTokens(h.userDetails&&h.userDetails.tokenInfo);if(p||f||l.hasEnoughTokens(b,h.userDetails&&h.userDetails.tokenInfo)){var v=l.unlockContent(t,n,o,g,s).then(function(e){P.b.replaceEncryptedContent($("body"),e.ownedContent||e.unlockedParagraphs),I.trigger("paragraphsUnlocked",[g]),f||p||null!=e.tokenInfo&&(m.a.setTokenCountInfo(e.tokenInfo),l.refreshTokenStateInToolbar(e.tokenInfo)),I.trigger("unlockSuccess",[P.a[n]]),c(e),setTimeout(function(){e.licenseCreated?_.TokenModal.renderLicenceCreatedModal():e.productTokenInfo&&e.productTokenInfo.spentAmountInDollars&&e.productTokenInfo.spentAmountInTokens&&w.a.getBookPrice(l.book).then(function(t){e.productTokenInfo.spentAmountInDollars>=.25*t&&_.TokenModal.renderUpsellModal(!0,l.book,e.productTokenInfo.spentAmountInTokens,e.productTokenInfo.spentAmountInDollars)})},100)}).catch(function(t){var o="Error when unlocking content";f?o="Unfortunatly, you've exceeded the search unscrambling limit for this book. Try again tomorrow.":p&&(o="Unfortunatly, you've exceeded the free preview limit for this book. Try again tomorrow."),null!=t.remainingPreviewDuration&&t.remainingPreviewDuration<0||(k.a.showTemporaryNotification(o),I.trigger("unlockFailure",[P.a[n],g]),u(),t&&t.outOfSingleParagraphUnlocks&&(I.trigger("outOfParagraphByParagraphUnlocks"),_.TokenModal.renderOutOfParagraphByParagraphUnlocks(!0,t.reason),y.UnlockText.disableParagraphByParagraphUnlock(),e&&(e.isParagraphByParagraphUnlockDisabled=!0)))});d(function(){return v&&v.cancel()})}else l.showOutOfTokensModal()}else l.showLoginModal("Want to see more? Just sign in"+(n==P.a.Search?" and the paragraph will unlock for you.":" and use tokens to unlock this content.")),l.setOriginalLinkLocation(i)})})},e.prototype.tryToUnlockPointedParagraph=function(e,t,n,o){var r=this;if(e&&t&&n&&!(n.length<2)){var i=P.b.getDataFromPointingLink(e,t,n);if(null!=i){for(var a=[],s=i.startParagraphId;s<=i.endParagraphId;s++){var l=document.getElementById(s);l&&a.push($(l))}var c=P.b.isEncompassingWholeContent(i.startParagraphId,i.endParagraphId);c||a.forEach(function(e){return e.addClass("paragraph-selected")});var u=a.filter(function(e){return e.is(".scrambled")});i.paragraphsToUnlock=u.map(function(e){return e.attr("id")}).join(","),I.trigger("pointingLinkOpened",[i.pointingLinkId,c]),u.length?C.a.isLoggedIn().then(function(t){if(t.loggedIn)if(i.isUserEditorLink)r.unlockPointedParagraphs(e,u,i.startParagraphId,i.endParagraphId,i);else{var n=Math.max(r.getTokenCost(u),1);if(!(r.getTotalNumberOfTokens(t.userDetails&&t.userDetails.tokenInfo)>=n))return void k.a.showTemporaryNotification("You don't have enough tokens to unlock the whole pointed content");k.a.showNotificationModal("Confirm","Spend "+n+" "+(n>1?"tokens":"token")+" to unlock this content?",!0,function(){return r.unlockPointedParagraphs(e,u,i.startParagraphId,i.endParagraphId,i)})}else r.showLoginModal("Want to see more? Just sign in."),r.setOriginalLinkLocation(o)}):i.pointingLinkId&&this.reportPointingLinkUsed(i.pointingLinkId)}}},e.prototype.unlockPointedParagraphs=function(e,t,n,o,r){var i=this,a=new O(t);a.startUnlockAnimation(),h.a.getFromOurBackend(h.a.getAbsoluteUrl("api/pointing/getPointedContent"),function(e){a.insertUnscrambledContent(e.paragraphInfos||[]),a.unlockWithAnimations(),I.trigger("unlockSuccess",[P.a[P.a.Point]]),null!=e.tokenInfo&&(m.a.setTokenCountInfo(e.tokenInfo),i.refreshTokenStateInToolbar(e.tokenInfo))},function(e){k.a.showNotification("Error when trying to unlock. Please try later."),I.trigger("unlockFailure",[!1,!0,[n,o]]),a.revertAnimation()},r)},e.prototype.reportPointingLinkUsed=function(e){h.a.getFromOurBackend(h.a.getAbsoluteUrl("api/pointing/reportSimpleUse"),function(e){},function(e){},{pointingLinkId:e})},e.prototype.unlockContent=function(e,t,n,o,r){var i=this;return void 0===r&&(r={}),new c(function(a,s,l){var c=new O(o.map(function(e){return $(document.getElementById(e))}));c.startUnlockAnimation(),i.getUnlockBookElementContentPromise(e,t,n,o,r).then(function(e){if(!e.success)return null!=c&&c.revertAnimation(),void s(e);e.tokenInfo&&i.refreshTokenStateInToolbar(e.tokenInfo),t==P.a.BookElement&&$(".heading-scrambled-notifier").remove(),c.insertUnscrambledContent(e.ownedContent||e.unlockedParagraphs),c.unlockWithAnimations(function(){return a(e)})}).catch(function(e){null!=c&&c.revertAnimation(),s(e)})})},e.prototype.getUnlockTocBookElementPromise=function(e,t){var n=this;return new Promise(function(o,r){h.a.postToOurBackend(h.a.getAbsoluteUrl("api/userBook/unlockTocBookElement"),function(e){return o(e)},function(e){return r(e)},{bookShortName:e.shortName,bookElementShortName:t,meapVersion:n.bookElement.meapVersion})})},e.prototype.getUnlockBookElementContentPromise=function(e,t,n,o,r){var i=this;return new c(function(a,s,l){h.a.postToOurBackend(h.a.getAbsoluteUrl("api/userBook/unlockBookElementContent"),function(t){t&&(t.ownedContent?i.fixOwnedContentImages(t.ownedContent):t.unlockedParagraphs&&i.fixOwnedContentImages(t.unlockedParagraphs),t.productTokenInfo&&e.book&&(e.book.spendingInfo={spentTokenAmount:t.productTokenInfo.spentAmountInTokens,spentDollarAmount:t.productTokenInfo.spentAmountInDollars},I.trigger("bookSpendingInfoArrived"))),a(t)},function(e){return s(e)},i.getUnlockBookElementContentApiSendData(e,t,n,o,r))})},e.prototype.getUnlockBookElementContentApiSendData=function(e,t,n,o,r){var i={bookShortName:e.book.shortName,bookElementShortName:e.shortName,paragraphIDs:(o||[]).join(","),meapVersion:e.meapVersion,isSearch:t==P.a.Search,isFreePreview:t==P.a.FreePreview,logTimings:!!M.a.getItem("logTimings")};switch(t){case P.a.BookElement:delete i.paragraphIDs;break;case P.a.Section:i.sectionShortName=n;break;case P.a.Subsection:i.subsectionShortName=n}try{if(r&&r instanceof Object)for(var a in r)i[a]=r[a]}catch(e){console.log("Error when adding additional parameters when unlocking")}return i},e.prototype.fixOwnedContentImages=function(e){if(!e)return e;for(var t=0;t<e.length;t++)e[t].content=e[t].content.replace(/\{\{BOOK_ROOT_FOLDER\}\}/g,h.a.getAwsPublic())},e.prototype.addCurrentBookToCart=function(){w.a.requestAddBookToCart(this.book)},e.prototype.updatePurchaseButtons=function(){this.book?(this.$unscrambleInfoModal.find(".add-to-cart-button").toggleClass("hidden",this.book.userOwnsBook||w.a.isEbookInShoppingCart(this.book)),this.$unscrambleInfoModal.find(".view-in-cart-button").toggleClass("hidden",!w.a.isEbookInShoppingCart(this.book)),this.$unscrambleInfoModal.find(".buy-tokens-button").toggleClass("hidden",!0)):this.$unscrambleInfoModal.find(".add-to-cart-button, .buy-tokens-button, .view-in-cart-button").addClass("hidden")},e.prototype.refreshTokenStateInToolbar=function(e){var t=$(".token-amount-container"),n=parseInt(t.first().text().replace(",","")||"0");Number.isNaN(n)&&(n=0);var o=(e.availableCompedTokenCount||0)+(e.availablePurchasedTokenCount||0);if(0==o||0==n||0==t.filter(":visible").length)t.each(function(e,t){i.unmountComponentAtNode(t)}),t.html(""+E.a.numberWithCommas(o||""));else try{i.render(r.createElement(d.a,{start:n,end:o,duration:1.5,separator:",",onStart:function(){n!=o&&t.addClass("counting glow-text")},onEnd:function(){t.removeClass("counting glow-text")}}),t.filter(":visible")[0])}catch(e){t.each(function(e,t){i.unmountComponentAtNode(t)}),t.html(""+(o||""))}v.a.reposition(),setTimeout(function(){return v.a.reposition()},150)},e.prototype.showLoginModal=function(e){void 0===e&&(e=""),T.a.requestOpenModal("signin",e,"microtransactions")},e.prototype.showOutOfTokensModal=function(){_.TokenModal.renderOutOfTokensNotifier(this.book),this.updatePurchaseButtons()},e.prototype.hideOutOfTokensModal=function(){f.a.hideFoundationModal(this.$unscrambleInfoModal)},e.prototype.getTotalNumberOfTokens=function(e){return null==e?0:(e.availableCompedTokenCount||0)+(e.availablePurchasedTokenCount||0)},e.prototype.getTokenCost=function(e){return y.UnlockText.getParagraphsPrice(g.a.expandListOfScrambledParagraphsIfNecessary(e.filter(function(e){return e.is(".scrambled")})))},e.prototype.setOriginalLinkLocation=function(e){e&&p.a.setTimeout(function(){e&&history.pushState({},document.title,e)},400)},e}()),S='<div id="unscramble-info-modal" class="reveal-modal" data-reveal>\n    <span class="close-reveal-modal">&times;</span>\n    <div class="row">\n        <div class="small-12 columns unscramble-info-modal-content-container">\n            {{{UNSCRAMBLE_INFO_CONTENT}}}\n        </div>\n    </div>\n</div>'},334:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return LinksUtils});var query_string__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(358),query_string__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(query_string__WEBPACK_IMPORTED_MODULE_0__),_DeviceUtils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_BookContentUtils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(17),_DOMUtils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(14),_WebUtils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(0),_EventUtils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(2),_BookViewDOMUtils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(5),_RouteUtils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(21),_components_misc_LinkPreviewer__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(348),_managers_ScreenScrollManager__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(111),_modules_discussions_DiscussionModule__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(86),_modules_UnlockModule__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(110),$document=$(document),LinksUtilsClass=function(){function LinksUtilsClass(){var e=this;_DeviceUtils__WEBPACK_IMPORTED_MODULE_1__.b.loadDeviceInfo().then(function(t){e.currentPlatform=t.platform,$("body").on("click","a:not(.immediately-go-to-link)",function(e){return LinksUtils.handleLinkClick(e,e.currentTarget)}),t.isTouchDevice||(_EventUtils__WEBPACK_IMPORTED_MODULE_5__.a.onDescendantEventWithCooldown($("body"),"mouseenter","#book-markup-container a",function(t){return e.handleLinkHover(t,t.currentTarget)}),$("body").on("mouseleave","#book-markup-container a",function(e){return LinksUtils.handleLinkLeave(e.currentTarget)}))})}return LinksUtilsClass.prototype.clean=function(){_components_misc_LinkPreviewer__WEBPACK_IMPORTED_MODULE_8__.a.hidePreview(!1,!0)},LinksUtilsClass.prototype.formLink=function(e,t,n){return void 0===n&&(n=""),document.location.protocol+"//"+document.location.host+this.formHash(e,t)+n},LinksUtilsClass.prototype.formLinkFromBookSlugAndBookElementShortName=function(e,t){return document.location.protocol+"//"+document.location.host+this.formHashFromSlugAndShortNames(e,t)},LinksUtilsClass.prototype.formEditLinkFromBookSlugAndBookElementShortName=function(e,t){return document.location.protocol+"//"+document.location.host+this.formEditHashFromSlugAndShortNames(e,t)},LinksUtilsClass.prototype.formHash=function(e,t){if(null==e||null==t)return"";var n="/book/"+e.slug+"/"+t.shortName+"/";return t.meapVersion>0?n+="v-"+t.meapVersion+"/":t.reviewVersion>0&&(n+="r-"+t.reviewVersion+"/"),n},LinksUtilsClass.prototype.formHashFromSlugAndShortNames=function(e,t){return"/book/"+e+"/"+t},LinksUtilsClass.prototype.formEditHashFromSlugAndShortNames=function(e,t){return"/edit/"+e+"/"+t},LinksUtilsClass.prototype.trimLastSlash=function(e){return e&&0!=e.length?"/"==e[e.length-1]?e.substring(0,e.length-1):e:""},LinksUtilsClass.prototype.handleLinkClick=function(e,link){var $link=$(link);if($(e.target).is(".dont-propagate-click")||$(e.currentTarget).is(".dont-propagate-click"))e.preventDefault();else{if(($(e.target).is(".immediately-go-to-link")||$(e.currentTarget).is(".immediately-go-to-link"))&&(document.location.href=link.href),_components_misc_LinkPreviewer__WEBPACK_IMPORTED_MODULE_8__.a.hidePreview(),-1!=link.href.indexOf("data:"))return!0;if(-1!=link.href.indexOf("javascript:void(0)"))return!0;if($link.is(".history-back-button"))return e.preventDefault(),history.go(-1),!1;if(!link.href||link.href===document.location.href||link.href===document.location.href+"#")return e.preventDefault(),!1;if($link.is(".reload-link")&&_WebUtils__WEBPACK_IMPORTED_MODULE_4__.a.reloadPage(),link.href.indexOf("search-")>=0&&$document.trigger("searchSuggestion",["link",link.href]),this.isThirdPartyLink(link.href)||e.ctrlKey||e.metaKey||2===e.which||"_blank"==$link.attr("target")){switch(e.preventDefault(),this.currentPlatform){case _DeviceUtils__WEBPACK_IMPORTED_MODULE_1__.a.Browser:this.openLinkInNewTab(link.href);break;case _DeviceUtils__WEBPACK_IMPORTED_MODULE_1__.a.Cordova:window.open(link.href,"_system");break;case _DeviceUtils__WEBPACK_IMPORTED_MODULE_1__.a.Electron:var shell=eval("require('electron').shell");shell&&shell.openExternal&&shell.openExternal(link.href)}return!1}-1==link.href.indexOf("javascript:")&&$document.trigger("searchHideRequested");var linkBookElementData=this.extractBookElementData(link);if(linkBookElementData){if(this.isLinkOnSameBookElement(linkBookElementData)){e.preventDefault();var scrollToElement_1=null;if(linkBookElementData.additional){if(linkBookElementData.additional.startsWith("comment-"))return void _modules_discussions_DiscussionModule__WEBPACK_IMPORTED_MODULE_10__.a.requestShowCommentWhenReady(linkBookElementData.additional.replace("comment-",""),0,function(){},$(e.target).closest("#in-page-discussion-wrapper").length>0);!scrollToElement_1&&linkBookElementData.additional.startsWith("note-")&&$document.trigger("noteOpenRequested",linkBookElementData.additional.replace("note-","")),scrollToElement_1=document.getElementById(linkBookElementData.additional),!scrollToElement_1&&linkBookElementData.additional.startsWith("search-")&&(scrollToElement_1=document.getElementById(linkBookElementData.additional.replace("search-","")),null!=scrollToElement_1&&($(".paragraph-selected").removeClass("paragraph-selected"),$(scrollToElement_1).addClass("paragraph-selected"))),!scrollToElement_1&&linkBookElementData.additional.startsWith("section-")&&(scrollToElement_1=_BookViewDOMUtils__WEBPACK_IMPORTED_MODULE_6__.a.getSectionHeading(linkBookElementData.additional))}else scrollToElement_1=document.querySelector(".readable-text");var text=$link.text(),isBrowsableElement=_BookContentUtils__WEBPACK_IMPORTED_MODULE_2__.a.matchesBrowsableRegEx(text);if(isBrowsableElement){var $textFragment=$link.closest(".readable-text"),textFragment=$textFragment[0];if(textFragment){var browsable=_BookContentUtils__WEBPACK_IMPORTED_MODULE_2__.a.getMatchingBrowsable(textFragment.browsables,$link.text());$(browsable).closest(".focus-off").removeClass("focus-off"),browsable&&_DOMUtils__WEBPACK_IMPORTED_MODULE_3__.a.precedesElement(scrollToElement_1,textFragment)&&(scrollToElement_1=textFragment)}}return scrollToElement_1&&($document.trigger("disableToolbarHiding"),_managers_ScreenScrollManager__WEBPACK_IMPORTED_MODULE_9__.a.scrollToElement(scrollToElement_1,function(){$document.trigger("enableToolbarHiding"),$(scrollToElement_1).is(".scrambled")&&linkBookElementData&&linkBookElementData.additional.startsWith("search-")&&_modules_UnlockModule__WEBPACK_IMPORTED_MODULE_11__.a.tryToSearchUnlockFragmentInCurrentBookElement([$(scrollToElement_1)])}),$document.trigger("withinChapterLinkScroll",scrollToElement_1)),!1}var pageType=link.href.indexOf("/book/")>-1?"book":"edit";if(linkBookElementData.book&&linkBookElementData.bookElement){var link_1="/"+pageType+"/"+linkBookElementData.book+"/"+linkBookElementData.bookElement+"/";return linkBookElementData.meapVersion?link_1+="v-"+linkBookElementData.meapVersion+"/":linkBookElementData.reviewVersion&&(link_1+="r-"+linkBookElementData.reviewVersion+"/"),linkBookElementData.additional&&(link_1+=linkBookElementData.additional),page(link_1),!1}if(linkBookElementData.book&&!linkBookElementData.bookElement)return page("/"+pageType+"/"+linkBookElementData.book),!1}}},LinksUtilsClass.prototype.handleLinkHover=function(e,t){clearTimeout(this.linkHoverTimer);var n=$(t),o=this.extractBookElementData(t);if(o&&this.isLinkOnSameBookElement(o))try{var r=document.getElementById(o.additional);if(null!=r){var i=$(r).closest(".browsable-container, .readable-text");if(i.is(".browsable-container"))return void(_BookViewDOMUtils__WEBPACK_IMPORTED_MODULE_6__.a.isElementVisibleEvenALittle(i.get(0))||_components_misc_LinkPreviewer__WEBPACK_IMPORTED_MODULE_8__.a.showBrowsablePreview(t,i));if(i.is(".readable-text"))return void(_BookViewDOMUtils__WEBPACK_IMPORTED_MODULE_6__.a.isElementVisibleEvenALittle(i.get(0))||_components_misc_LinkPreviewer__WEBPACK_IMPORTED_MODULE_8__.a.showWithinChapterPreview(t,i))}}catch(e){}if(this.isLivebookLink(t.href)){var a=_WebUtils__WEBPACK_IMPORTED_MODULE_4__.a.getAbsoluteUrl("api/book/linkPreviewDetails"),s=this.extractBookElementData(t);this.linkHoverTimer=_EventUtils__WEBPACK_IMPORTED_MODULE_5__.a.setTimeout(function(){_WebUtils__WEBPACK_IMPORTED_MODULE_4__.a.getFromOurBackend(a,function(e){null!=e&&n.is(":hover")&&_components_misc_LinkPreviewer__WEBPACK_IMPORTED_MODULE_8__.a.showBookElementPreview(t,e)},function(e){console.error("Something went wrong retrieveing preview details: ",e)},{linkHash:t.hash||t.pathname,bookElementLink:s})},100)}},LinksUtilsClass.prototype.handleLinkLeave=function(e){clearTimeout(this.linkHoverTimer),this.linkHoverTimer=_EventUtils__WEBPACK_IMPORTED_MODULE_5__.a.setTimeout(function(){$(e).is(":hover")||_components_misc_LinkPreviewer__WEBPACK_IMPORTED_MODULE_8__.a.hidePreview(!0)},300)},LinksUtilsClass.prototype.extractBookElementData=function(e){var t=query_string__WEBPACK_IMPORTED_MODULE_0__.extract(e.href);if(t){var n="",o=t.indexOf("#");-1!=o&&(n=t.substring(o+1),t=t.substring(0,o));var r=query_string__WEBPACK_IMPORTED_MODULE_0__.parse(t),i=r.book,a=r.bookElement;if("search"in r&&(n="search-"+n),i&&a)return{book:i,bookElement:a,additional:n,isEditLink:t.indexOf("/edit/")>0}}var s=e.pathname,l=_RouteUtils__WEBPACK_IMPORTED_MODULE_7__.a.getRouteInfo(s);return l||((s=e.hash).startsWith("#!")&&(s=s.substring("#!".length),l=_RouteUtils__WEBPACK_IMPORTED_MODULE_7__.a.getRouteInfo(s))?l:document.getElementById(e.hash.substring(1))?((l=_RouteUtils__WEBPACK_IMPORTED_MODULE_7__.a.getCurrentRouteInfo()).additional=e.hash.substring(1),l):null)},LinksUtilsClass.prototype.isLinkOnSameBookElement=function(e){var t=_RouteUtils__WEBPACK_IMPORTED_MODULE_7__.a.getCurrentRouteInfo();return!!t&&(t.book===e.book&&t.bookElement===e.bookElement&&t.meapVersion==e.meapVersion&&t.isEditLink==e.isEditLink)},LinksUtilsClass.prototype.isThirdPartyLink=function(e){return"string"==typeof e&&""!=e&&-1==e.indexOf("localhost")&&-1==e.indexOf("livebook")&&-1==e.indexOf("liveaudio")&&-1==e.indexOf("vbook")&&0!==e.indexOf("file://")&&0!==e.indexOf("javascript")},LinksUtilsClass.prototype.isLivebookLink=function(e){return!!e&&(-1!==e.indexOf("localhost")||-1!==e.indexOf("livebook")||0==e.indexOf("#"))},LinksUtilsClass.prototype.openLinkInNewTab=function(e){window.open(e,"_blank").focus()},LinksUtilsClass.prototype.openLink=function(e){this.isLivebookLink(e)?document.location.href=e:this.openLinkInNewTab(e)},LinksUtilsClass}(),LinksUtils=new LinksUtilsClass},348:function(e,t,n){"use strict";var o=n(5),r=n(2),i=n(0),a=n(359),s=$(window),l=function(){function e(){this.handleMouseLeave=this.handleMouseLeave.bind(this)}return e.prototype.initialize=function(e,t){this.book=e,$("#link-preview-popup").css("display","").on("mouseleave",this.handleMouseLeave)},e.prototype.handleMouseLeave=function(){var e=this;clearTimeout(this.linkPreviewMouseLeaveTimer),this.linkPreviewMouseLeaveTimer=r.a.setTimeout(function(){e.hidePreview(!0)},200)},e.prototype.clean=function(){this.book=null,this.hidePreview(!1,!0)},e.prototype.showBrowsablePreview=function(e,t){if(e&&null!=t&&0!=t.length){var n=$("#link-preview-popup");try{n.removeClass("book-element-preview is-cover-left is-cover-right").addClass("browsable-preview");var o=n.find(".browsable-preview-container"),r=t.find(".code-area > .hljs:not(.hljs-line-numbers)");if(r.length>0){var i=$("<h5></h5>");i.html(t.find("h5").html());var a=$("<pre></pre>");a.text(r.text()),o.html(""),o.append(i),o.append(a)}else o.html(t.html());n.removeClass("closed").addClass("open"),n.css({opacity:0}),n.find("img").css({cursor:"initial"}),this.positionPreviewPopup($(e))}catch(e){}}},e.prototype.showWithinChapterPreview=function(e,t){if(e&&null!=t&&0!=t.length){for(var n=[],o=parseInt(t.attr("refid")),r=$("#book-markup-container").find("h1, h2, h3, h4"),a=null,s=0;s<r.length;s++){var l=r.eq(s).closest(".browsable-container, .readable-text");if(l.length>0){if(parseInt(l.attr("refid"))>o)break;a=l}}var c=null!=a?a.text():"";if(c!=t.text())n.push(t.html());else try{var u=document.getElementById(""+(o+1));u&&n.push($(u).html())}catch(e){}this.showBookElementPreview(e,{coverUrl:i.a.getBookCoverUrl(null!=this.book?this.book.shortName:""),title:c,paragraphs:n})}},e.prototype.showBookElementPreview=function(e,t){if(t&&this.referentLink!=e){var n=$(e),r=$("#link-preview-popup");r.addClass("book-element-preview").removeClass("browsable-preview"),r.css({"max-width":.9*$("#book-markup-container").width()});var s=r.find(".chapter-preview-paragraphs-container"),l=r.find(".book-cover"),c=r.find(".chapter-preview-title");r.removeClass("closed").addClass("open"),r.css({opacity:0}),l.attr("src",i.a.getLivebookCdn()+"assets/images/cover.png"),l.attr("data-src",t.coverUrl),c.text(t.title),s.html(t.paragraphs.join("<br>")),r.find(".browsable-preview-container").html(""),o.a.replaceBookCoversOnImageLoad(r,[t.coverUrl]),this.referentLink=e;try{c&&c.length&&a(c.get(0),{clamp:2}),s&&s.length&&a(s.get(0),{clamp:4})}catch(e){}this.positionPreviewPopup(n)}},e.prototype.hidePreview=function(e,t){var n=$("#link-preview-popup");e&&n.is(":hover")||(n.is(".open")&&!t?n.velocity({translateY:(n.is(".is-arrow-up")?"":"-")+"25%",opacity:0},{duration:100,complete:function(){n.removeClass("open").addClass("closed")}}):n.removeClass("open").addClass("closed"),this.referentLink=null)},e.prototype.positionPreviewPopup=function(e){if(null!=e&&0!=e.length){var t=$("#link-preview-popup"),n=$("#book-markup-container"),o=t.width(),r=t.height(),i=e.width(),a=e.height(),l=e.offset(),c=e.get(0).getBoundingClientRect(),u=l.left+.5*i,d=n.offset(),h=n.width(),f=c.top+r<s.height()-100;if(t.toggleClass("is-arrow-up",f),t.toggleClass("is-arrow-down",!f),t.is(".browsable-preview"))t.removeClass("is-cover-left is-cover-right");else{var p=u>=s.width()/2;t.toggleClass("is-cover-left",p),t.toggleClass("is-cover-right",!p)}var m=Math.max(u-.5*o,d.left+50),k=d.left+.9*h;m+o>k&&(m=Math.max(k-o,50)),t.css({top:f?l.top+a+10:l.top-r-30,left:m}),t.find(".arrow-up, .arrow-down").css({left:Math.min(u-m,o-20)}),t.velocity({translateY:(f?"":"-")+"25%",opacity:0},0),t.velocity({translateY:"0",opacity:1},200)}},e}();t.a=new l},358:function(e,t,n){"use strict";function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var a=n(362),s=n(363),l=n(364);function c(e,t){return t.encode?t.strict?a(e):encodeURIComponent(e):e}function u(e,t){return t.decode?s(e):e}function d(e){var t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function h(e){var t=(e=d(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function f(e,t){var n=function(e){var t;switch(e.arrayFormat){case"index":return function(e,n,o){t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===o[e]&&(o[e]={}),o[e][t[1]]=n):o[e]=n};case"bracket":return function(e,n,o){t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==o[e]?o[e]=[].concat(o[e],n):o[e]=[n]:o[e]=n};case"comma":return function(e,t,n){var o="string"==typeof t&&t.split("").indexOf(",")>-1?t.split(","):t;n[e]=o};default:return function(e,t,n){void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",parseNumbers:!1,parseBooleans:!1},t)),i=Object.create(null);if("string"!=typeof e)return i;if(!(e=e.trim().replace(/^[?#&]/,"")))return i;var a=!0,s=!1,c=void 0;try{for(var d,h=e.split("&")[Symbol.iterator]();!(a=(d=h.next()).done);a=!0){var f=d.value,p=o(l(f.replace(/\+/g," "),"="),2),m=p[0],k=p[1];k=void 0===k?null:u(k,t),t.parseNumbers&&!Number.isNaN(Number(k))?k=Number(k):!t.parseBooleans||null===k||"true"!==k.toLowerCase()&&"false"!==k.toLowerCase()||(k="true"===k.toLowerCase()),n(u(m,t),k,i)}}catch(e){s=!0,c=e}finally{try{a||null==h.return||h.return()}finally{if(s)throw c}}return!1===t.sort?i:(!0===t.sort?Object.keys(i).sort():Object.keys(i).sort(t.sort)).reduce(function(e,t){var n=i[t];return Boolean(n)&&"object"===r(n)&&!Array.isArray(n)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"===r(t)?e(Object.keys(t)).sort(function(e,t){return Number(e)-Number(t)}).map(function(e){return t[e]}):t}(n):e[t]=n,e},Object.create(null))}t.extract=h,t.parse=f,t.stringify=function(e,t){if(!e)return"";var n=function(e){switch(e.arrayFormat){case"index":return function(t){return function(n,o){var r=n.length;return void 0===o?n:[].concat(i(n),null===o?[[c(t,e),"[",r,"]"].join("")]:[[c(t,e),"[",c(r,e),"]=",c(o,e)].join("")])}};case"bracket":return function(t){return function(n,o){return void 0===o?n:[].concat(i(n),null===o?[[c(t,e),"[]"].join("")]:[[c(t,e),"[]=",c(o,e)].join("")])}};case"comma":return function(t){return function(n,o,r){return null==o||0===o.length?n:0===r?[[c(t,e),"=",c(o,e)].join("")]:[[n,c(o,e)].join(",")]}};default:return function(t){return function(n,o){return void 0===o?n:[].concat(i(n),null===o?[c(t,e)]:[[c(t,e),"=",c(o,e)].join("")])}}}}(t=Object.assign({encode:!0,strict:!0,arrayFormat:"none"},t)),o=Object.keys(e);return!1!==t.sort&&o.sort(t.sort),o.map(function(o){var r=e[o];return void 0===r?"":null===r?c(o,t):Array.isArray(r)?r.reduce(n(o),[]).join("&"):c(o,t)+"="+c(r,t)}).filter(function(e){return e.length>0}).join("&")},t.parseUrl=function(e,t){return{url:d(e).split("?")[0]||"",query:f(h(e),t)}}},359:function(e,t,n){var o,r,i;
/*!
 * Clamp.js 0.7.0
 *
 * Copyright 2011-2013, Joseph Schmitt http://joe.sh
 * Released under the WTFPL license
 * http://sam.zoy.org/wtfpl/
 */r=[],void 0===(i="function"==typeof(o=function(){return function(e,t){t=t||{};var n,o=window,r={clamp:t.clamp||2,useNativeClamp:void 0===t.useNativeClamp||t.useNativeClamp,splitOnChars:t.splitOnChars||[".","-","–","—"," "],animate:t.animate||!1,truncationChar:t.truncationChar||"…",truncationHTML:t.truncationHTML},i=e.style,a=e.innerHTML,s=void 0!==e.style.webkitLineClamp,l=r.clamp,c=l.indexOf&&(l.indexOf("px")>-1||l.indexOf("em")>-1);function u(e,t){return o.getComputedStyle||(o.getComputedStyle=function(e,t){return this.el=e,this.getPropertyValue=function(t){var n=/(\-([a-z]){1})/g;return"float"==t&&(t="styleFloat"),n.test(t)&&(t=t.replace(n,function(){return arguments[2].toUpperCase()})),e.currentStyle&&e.currentStyle[t]?e.currentStyle[t]:null},this}),o.getComputedStyle(e,null).getPropertyValue(t)}function d(t){var n=t||e.clientHeight,o=h(e);return Math.max(Math.floor(n/o),0)}function h(e){var t=u(e,"line-height");return"normal"==t&&(t=1.2*parseInt(u(e,"font-size"))),parseInt(t)}r.truncationHTML&&((n=document.createElement("span")).innerHTML=r.truncationHTML);var f,p,m,k,g=r.splitOnChars.slice(0),b=g[0];function v(t){return t.lastChild.children&&t.lastChild.children.length>0?v(Array.prototype.slice.call(t.children).pop()):t.lastChild&&t.lastChild.nodeValue&&""!==t.lastChild.nodeValue&&t.lastChild.nodeValue!=r.truncationChar?t.lastChild:(t.lastChild.parentNode.removeChild(t.lastChild),v(e))}function _(e,t){e.nodeValue=t+r.truncationChar}if("auto"==l?l=d():c&&(l=d(parseInt(l))),s&&r.useNativeClamp)i.overflow="hidden",i.textOverflow="ellipsis",i.webkitBoxOrient="vertical",i.display="-webkit-box",i.webkitLineClamp=l,c&&(i.height=r.clamp+"px");else{var y=(k=l,h(e)*k);y<=e.clientHeight&&(m=function t(o,i){if(i){var a=o.nodeValue.replace(r.truncationChar,"");if(f||(b=g.length>0?g.shift():"",f=a.split(b)),f.length>1?(p=f.pop(),_(o,f.join(b))):f=null,n&&(o.nodeValue=o.nodeValue.replace(r.truncationChar,""),e.innerHTML=o.nodeValue+" "+n.innerHTML+r.truncationChar),f){if(e.clientHeight<=i){if(!(g.length>=0&&""!==b))return e.innerHTML;_(o,f.join(b)+b+p),f=null}}else""===b&&(_(o,""),o=v(e),g=r.splitOnChars.slice(0),b=g[0],f=null,p=null);if(!r.animate)return t(o,i);setTimeout(function(){t(o,i)},!0===r.animate?10:r.animate)}}(v(e),y))}return{original:a,clamped:m}}})?o.apply(t,r):o)||(e.exports=i)},362:function(e,t,n){"use strict";e.exports=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%".concat(e.charCodeAt(0).toString(16).toUpperCase())})}},363:function(e,t,n){"use strict";var o=new RegExp("%[a-f0-9]{2}","gi"),r=new RegExp("(%[a-f0-9]{2})+","gi");function i(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),o=e.slice(t);return Array.prototype.concat.call([],i(n),i(o))}function a(e){try{return decodeURIComponent(e)}catch(r){for(var t=e.match(o),n=1;n<t.length;n++)t=(e=i(t,n).join("")).match(o);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},n=r.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var o=a(n[0]);o!==n[0]&&(t[n[0]]=o)}n=r.exec(e)}t["%C2"]="�";for(var i=Object.keys(t),s=0;s<i.length;s++){var l=i[s];e=e.replace(new RegExp(l,"g"),t[l])}return e}(e)}}},364:function(e,t,n){"use strict";e.exports=((e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]})},365:function(e,t,n){"use strict";var o=n(5),r=n(14),i=n(17),a=n(334),s=n(111),l=n(13),c=n(2),u=n(69),d=n(4),h=n(12),f=n(117),p=n(110),m=n(18),k=n(112),g=$(window),b=$(document),v=function(){function e(){var e=this;this.$sectionNavigationContainer=$("#section-navigation-container"),this.$sectionNavigationWrapper=$("#section-navigation-container .section-navigation-wrapper"),this.$titleSectionContainers=$(".title-section-container"),this.handleChapterTitleClick=this.handleChapterTitleClick.bind(this),this.render=this.render.bind(this),this.reposition=this.reposition.bind(this),this.handleSlideMenuOpened=this.handleSlideMenuOpened.bind(this),this.handleSlideMenuClosed=this.handleSlideMenuClosed.bind(this),this.trackScrolling=this.trackScrolling.bind(this),this.handleUnlockSuccess=this.handleUnlockSuccess.bind(this),this.handleHeaderItemTextClick=this.handleHeaderItemTextClick.bind(this),this.handleHeaderItemUnlockClick=this.handleHeaderItemUnlockClick.bind(this),this.renderAndRepeatWithDelay=this.renderAndRepeatWithDelay.bind(this),this.handleTextSlideMenuOpened=this.handleTextSlideMenuOpened.bind(this),this.handleTextSlideMenuHidden=this.handleTextSlideMenuHidden.bind(this),b.on("sectionTitleRespositionRequested",this.reposition),b.on("freePreviewModeActivated freePreviewModeDeactivated",function(){e.fillSectionNavigationContainer(),e.render()}),b.on("headerNotifierHidden headerNotifierShown",function(){e.render()}),b.on("requestUpdateHistoryOnScroll",function(t,n){return e.rewriteUrlOnScroll=n})}return e.prototype.initialize=function(e,t,n){(!d.b.isSafari()||e.userOwnsBook||t.isOpen)&&g.on("scroll",this.render),g.on("scrollstop",this.trackScrolling),g.on("resizestop",this.render),b.on("unlockSuccess",this.handleUnlockSuccess),b.on("click",".header-item-text",this.handleHeaderItemTextClick),b.on("click",".header-item-lock",this.handleHeaderItemUnlockClick),b.on("textSlideMenuOpened",this.handleTextSlideMenuOpened),b.on("textSlideMenuClosed",this.handleTextSlideMenuHidden),b.on("contentFullyConstructed subtitlesLoaded audio-controls-built text-addons-data-ready",this.renderAndRepeatWithDelay),this.$trackPointColumn=$("#track-point-column"),this.rewriteUrlOnScroll=f.a.rewriteUrlOnScroll&&n,this.showLocksWhenAppropriate=!e.userOwnsBook&&!t.isOpen,this.showLocksWhenAppropriate&&e.latestMeapVersion!=t.meapVersion&&(this.showLocksWhenAppropriate=!1),this.showLocksWhenAppropriate&&m.a.isUnlockingWholeContentThroughPointingLink&&(this.showLocksWhenAppropriate=!1),this.$bookChapterTitleContainer=$("#top-bar-container .title-label"),this.$bookChapterTitleContainer.on("click",this.handleChapterTitleClick),this.book=e,this.bookElement=t,this.setBookElementTitle(t.title),this.$headerElements=i.a.getHeadings(),this.fillSectionNavigationContainer(),this.renderAndRepeatWithDelay(),b.on("slideMenuOpened",this.handleSlideMenuOpened),b.on("slideMenuClosed",this.handleSlideMenuClosed)},e.prototype.clean=function(){g.off("scroll",this.render),g.off("scrollstop",this.trackScrolling),g.off("resizestop",this.render),g.off("resize",this.render),b.off("contentFullyConstructed",this.render),b.off("unlockSuccess",this.handleUnlockSuccess),b.off("click",".header-item-text",this.handleHeaderItemTextClick),b.off("click",".header-item-lock",this.handleHeaderItemUnlockClick),b.off("textSlideMenuOpened",this.handleTextSlideMenuOpened),b.off("textSlideMenuClosed",this.handleTextSlideMenuHidden),b.off("contentFullyConstructed subtitlesLoaded audio-controls-built text-addons-data-ready",this.renderAndRepeatWithDelay),this.$bookChapterTitleContainer&&this.$bookChapterTitleContainer.off("click",this.handleChapterTitleClick),this.$headerElements=null,this.$bookChapterTitleContainer=null,this.rewriteUrlOnScroll=!1,this.book=null,this.bookElement=null,this.$sectionNavigationWrapper.html(""),this.hide(),$(".title-section-container").addClass("hidden"),b.off("slideMenuOpened",this.handleSlideMenuOpened),b.off("slideMenuClosed",this.handleSlideMenuClosed)},e.prototype.reposition=function(){this.render()},e.prototype.setBookElementTitle=function(e){this.$titleSectionContainers.removeClass("hidden");var t=this.$titleSectionContainers.find(".chapter-title-label");t.attr("title",e),t.find(".chapter-type-label").text(l.a.extractBookElementType(e)),t.find(".chapter-title-text-label").text(l.a.extractCleanBookElementTitle(e))},e.prototype.fillSectionNavigationContainer=function(){var e=this;if(null!=this.$headerElements){var t="",n=m.a.isFreePreviewActive();this.$headerElements.each(function(o,r){var a=$(r),s=r.querySelector("h1, h2, h3, h4, h5"),c=$(s).text().trim();if(!l.a.isChapterOrAppendix(c)&&"H1"!=r.tagName){c=h.a.escapeHtml(c);var u=e.showLocksWhenAppropriate;if(u)u=i.a.getHeadingSectionCost(e.bookElement.bookElementPriceInfo,a,e.$headerElements)>0;u&&n&&(u=!1);var d=a.attr("refid"),f=null!=s?s.id:"";t+="<div class='header-item' data-refid="+d+" data-id="+f+">\n                        "+(u?'<svg class="header-item-lock" viewBox="0 0 10.583333 10.583334" title=\'unlock '+c+'\'><use xlink:href="#token-icon"></svg>':"")+"\n                        <span class='header-item-text'>"+c+"</span>\n                     </div>"}}),this.$sectionNavigationWrapper.html(t),this.show()}},e.prototype.getTopReadableElement=function(e,t){for(var n=e.eq(0),o=0;o<e.length;o++){if(null!=(i=e.eq(o).offset())&&i.top>=t&&o>0){n=e.eq(o-1);break}}var r=parseInt(n.attr("refid"));if(Number.isNaN(r))return e.eq(0);r>0&&(r-=1);for(o=r;o<r+60;o++){var i;if(null!=(i=$("[refid='"+o+"']").offset())&&i.top>=t)return $("[refid='"+(o-1)+"']")}return n},e.prototype.renderAndRepeatWithDelay=function(){this.render(),c.a.setTimeout(this.render,16),c.a.setTimeout(this.render,100)},e.prototype.handleChapterTitleClick=function(e){$(e.target).is(".wish-list-icon")||s.a.scrollToElement(this.$headerElements[0])},e.prototype.handleTextSlideMenuHidden=function(){var e=this;c.a.setTimeout(function(){return e.updateHeaderTitleContainersPositions()},100)},e.prototype.handleTextSlideMenuOpened=function(){var e=this;c.a.setTimeout(function(){return e.updateHeaderTitleContainersPositions()},100)},e.prototype.render=function(){var e=this,t=g.scrollTop(),n=t+o.a.getTopNavBarHeight(),r=0==t?$(null):this.getLastHeader(n+40);this.$titleSectionContainers.toggleClass("chapter-title-shown",0!=r.length),r=r.filter("[refid!='1']");var i=this.$sectionNavigationWrapper.children(),a=r.attr("refid");if(a){i.filter("[data-refid!='"+a+"']").removeClass("header-item-shown");var s=i.filter("[data-refid='"+a+"']");s.addClass("header-item-shown"),this.$sectionNavigationContainer.css("display","block");var l=this.getTrackPointPosition(),u=this.getTextReferentLeftPosition();if(s.length>0){var d=s.children(".header-item-lock"),h=s.children(".header-item-text");d.css("left",Math.round(l-d.width()/2+1)),h.css("left",u),s.css("padding-right",u+"px")}}else c.a.setTimeout(function(){e.$sectionNavigationContainer.is(".has-shown-header-items")||e.$sectionNavigationContainer.css("display","none")},125);if(this.updateHeaderTitleContainersPositions(),this.$sectionNavigationContainer.toggleClass("has-shown-header-items",!!a),!$("#header-notification-container").is(".hidden")&&t>0)return this.$titleSectionContainers.toggleClass("chapter-title-shown",!0),this.$sectionNavigationContainer.css("display","none"),void this.$sectionNavigationContainer.removeClass("has-shown-header-items")},e.prototype.updateHeaderTitleContainersPositions=function(){var e=this.$titleSectionContainers.filter(":not(.second-row-top-bar-section .title-section-container)"),t=this.$titleSectionContainers.filter(".second-row-top-bar-section .title-section-container");d.b.isSmallScreenSize()?(e.css("display","none"),t.css("display","block"),this.updateSizeAndPositionForSmallTitleContainer(t)):(t.css("display","none"),e.css("display","block"),this.updateSizeAndPositionForMediumLargeTitleContainer(e))},e.prototype.updateSizeAndPositionForSmallTitleContainer=function(e){var t=$(".second-row-top-bar-section.top-bar-section.pull-left"),n=$(".second-row-top-bar-section.top-bar-section.pull-right"),o=t.find("li:first-of-type"),i=o.offset().left+o.width()+r.a.getMarginRight(o),a=this.getTextReferentLeftPosition(),s=n.offset().left,l=Math.max(i,a),c=s-l-10;e.css("left",l==a?Math.abs(a-i)+"px":"0px"),e.width(c);var u=e.find(".free-preview-icon-container"),d=c-("none"==u.css("display")?0:u.width());e.find(".title-label").width(d)},e.prototype.updateSizeAndPositionForMediumLargeTitleContainer=function(e){$(".top-bar-section.pull-left:not(.second-row-top-bar-section)");var t=$(".top-bar-section.pull-right:not(.second-row-top-bar-section)"),n=e.prev(),o=n.offset()||{left:0},i=t.offset()||{left:0},a=o.left+n.width()+r.a.getMarginRight(n),s=i.left,l=this.getTextReferentLeftPosition(),c=Math.max(a,l),u=$(document.querySelector("#book-main-content-container p")||document.querySelector("#book-main-content-container")).width(),d=Math.min(s-c-10,u);e.css("left",c==l?Math.abs(l-a)+"px":"0px"),e.width(d),e.find(".title-label").width(d-1.2*e.find(".free-preview-icon-container").width())},e.prototype.getTextReferentLeftPosition=function(){if(null==this.$headerElements)return 0;var e=this.$headerElements.first().find("h1, h2, h3, h4, h5"),t=parseInt(e.css("padding-left"));return null==e||0==e.length?0:e.offset().left+(Number.isNaN(t)?0:t)},e.prototype.getTrackPointPosition=function(){return(this.$trackPointColumn.offset()||{left:0}).left},e.prototype.getTopMostReadableElement=function(){return null==this.$headerElements||0==this.$headerElements.length?$(null):this.getTopReadableElement(this.$headerElements,g.scrollTop()+o.a.getTopNavBarHeight())},e.prototype.trackScrolling=function(){var e=this;clearTimeout(this.urlUpdateTimerID),this.urlUpdateTimerID=c.a.setTimeout(function(){var t=e.getTopMostReadableElement();window.history.replaceState&&e.rewriteUrlOnScroll&&window.history.replaceState({},"livebook - "+e.book.title+" - "+e.bookElement.title,a.a.formLink(e.book,e.bookElement,t.attr("refid"))),b.trigger("readableElementScrolled",[t.attr("refid")])},1e3)},e.prototype.getLastHeader=function(e){return null==this.$headerElements?$(null):this.$headerElements.filter(function(t,n){return o.a.isHeadingVisible($(n),e)}).last()},e.prototype.disable=function(){this.hide(),g.off("scroll",this.render),g.off("scrollstop",this.trackScrolling),g.off("resizestop",this.render)},e.prototype.enable=function(){this.show(),g.on("scroll",this.render),g.on("scrollstop",this.trackScrolling),g.on("resizestop",this.render)},e.prototype.show=function(){this.$sectionNavigationContainer.removeClass("hidden")},e.prototype.hide=function(){this.$sectionNavigationContainer.addClass("hidden")},e.prototype.handleSlideMenuOpened=function(e,t){this.updateHeaderTitleContainersPositions(),null==t||0==t.length||t.is("#toc-index-menu")||this.hide()},e.prototype.handleSlideMenuClosed=function(){var e=this;c.a.setTimeout(function(){u.a.isSideMenuOpened||(e.show(),e.render())},500)},e.prototype.handleUnlockSuccess=function(e,t){var n=this;t!=k.a.FreePreview&&"FreePreview"!=t&&c.a.setTimeout(function(){n.fillSectionNavigationContainer(),n.render()},50)},e.prototype.handleHeaderItemTextClick=function(e){var t=$(e.target).closest(".header-item").attr("data-refid");s.a.scrollToElement(document.querySelector("[refid='"+t+"']"))},e.prototype.handleHeaderItemUnlockClick=function(e){var t=$(e.target).closest(".header-item").attr("data-refid"),n=document.querySelector("[refid='"+t+"']");if(null!=n){var o=$(n);p.a.showModalForCurrentBookElementPurchases(o)}},e}();t.a=new v},380:function(e,t,n){"use strict";var o=n(0),r=n(6),i=n(23),a=n(110),s=n(12),l=function(){function e(){}return e.prototype.getTokenCountInfo=function(e){var t=this;return void 0===e&&(e=!1),e||null==this.currentTokenCountInfo?e||null==this.currentTokenCountInfoPromise?this.currentTokenCountInfoPromise=new Promise(function(n,o){r.a.isLoggedIn(e).then(function(e){e.loggedIn&&e.userDetails.tokenInfo?(t.currentTokenCountInfo=e.userDetails.tokenInfo,n(e.userDetails.tokenInfo)):(t.currentTokenCountInfoPromise=null,o("No token count info"))}).catch(function(e){return o(e)})}):this.currentTokenCountInfoPromise:Promise.resolve(this.currentTokenCountInfo)},e.prototype.setTokenCountInfo=function(e){this.currentTokenCountInfo=e,i.a.setTokenInfo(e)},e.prototype.getTokenLedgerItems=function(e){var t=this;return void 0===e&&(e=!1),r.a.isCurrentlyLoggedIn()?e&&this.lastTokenLedger?Promise.resolve(this.lastTokenLedger):new Promise(function(e,n){o.a.getFromOurBackend(o.a.getAbsoluteUrl("api/token/getTokenLedger"),function(n){var o=n.map(function(e){return{date:s.a.getDateFromString(e.date),quantity:e.quantity,description:e.description,notes:e.notes,link:e.link,isFreeTokensRedemption:"COMPED"==e.type}});t.lastTokenLedger=o,e(o)},function(e){n("Error getting token ledger")})}):Promise.resolve([])},e.prototype.getTokenCashoutInfo=function(){var e=this;return new Promise(function(t,n){o.a.getFromOurBackend(o.a.getAbsoluteUrl("api/token/getCashoutInfo"),function(n){n&&n.tokenCount&&(e.setTokenCountInfo(n.tokenCount),a.a.refreshTokenStateInToolbar(n.tokenCount)),t(n)},function(e){return n("Error getting token ledger")})})},e.prototype.cashout=function(){var e=this;return new Promise(function(t,n){o.a.getFromOurBackend(o.a.getAbsoluteUrl("api/token/cashout"),function(n){n&&n.tokenCount&&(e.setTokenCountInfo(n.tokenCount),a.a.refreshTokenStateInToolbar(n.tokenCount)),t(n)},function(e){return n("Error performing token cashout")})})},e}();t.a=new l},530:function(e,t,n){var o,r;void 0===(r="function"==typeof(o=function(e,t,n){return function(e,t,n,o,r,i){function a(e){return"number"==typeof e&&!isNaN(e)}var s=this;if(s.version=function(){return"1.9.3"},s.options={useEasing:!0,useGrouping:!0,separator:",",decimal:".",easingFn:function(e,t,n,o){return n*(1-Math.pow(2,-10*e/o))*1024/1023+t},formattingFn:function(e){var t,n,o,r,i,a,l=e<0;if(e=Math.abs(e).toFixed(s.decimals),t=(e+="").split("."),n=t[0],o=t.length>1?s.options.decimal+t[1]:"",s.options.useGrouping){for(r="",i=0,a=n.length;i<a;++i)0!==i&&i%3==0&&(r=s.options.separator+r),r=n[a-i-1]+r;n=r}return s.options.numerals.length&&(n=n.replace(/[0-9]/g,function(e){return s.options.numerals[+e]}),o=o.replace(/[0-9]/g,function(e){return s.options.numerals[+e]})),(l?"-":"")+s.options.prefix+n+o+s.options.suffix},prefix:"",suffix:"",numerals:[]},i&&"object"==typeof i)for(var l in s.options)i.hasOwnProperty(l)&&null!==i[l]&&(s.options[l]=i[l]);""===s.options.separator?s.options.useGrouping=!1:s.options.separator=""+s.options.separator;for(var c=0,u=["webkit","moz","ms","o"],d=0;d<u.length&&!window.requestAnimationFrame;++d)window.requestAnimationFrame=window[u[d]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[u[d]+"CancelAnimationFrame"]||window[u[d]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var n=(new Date).getTime(),o=Math.max(0,16-(n-c)),r=window.setTimeout(function(){e(n+o)},o);return c=n+o,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)}),s.initialize=function(){return!(!s.initialized&&(s.error="",s.d="string"==typeof e?document.getElementById(e):e,s.d?(s.startVal=Number(t),s.endVal=Number(n),a(s.startVal)&&a(s.endVal)?(s.decimals=Math.max(0,o||0),s.dec=Math.pow(10,s.decimals),s.duration=1e3*Number(r)||2e3,s.countDown=s.startVal>s.endVal,s.frameVal=s.startVal,s.initialized=!0,0):(s.error="[CountUp] startVal ("+t+") or endVal ("+n+") is not a number",1)):(s.error="[CountUp] target is null or undefined",1)))},s.printValue=function(e){var t=s.options.formattingFn(e);"INPUT"===s.d.tagName?this.d.value=t:"text"===s.d.tagName||"tspan"===s.d.tagName?this.d.textContent=t:this.d.innerHTML=t},s.count=function(e){s.startTime||(s.startTime=e),s.timestamp=e;var t=e-s.startTime;s.remaining=s.duration-t,s.options.useEasing?s.countDown?s.frameVal=s.startVal-s.options.easingFn(t,0,s.startVal-s.endVal,s.duration):s.frameVal=s.options.easingFn(t,s.startVal,s.endVal-s.startVal,s.duration):s.countDown?s.frameVal=s.startVal-(s.startVal-s.endVal)*(t/s.duration):s.frameVal=s.startVal+(s.endVal-s.startVal)*(t/s.duration),s.countDown?s.frameVal=s.frameVal<s.endVal?s.endVal:s.frameVal:s.frameVal=s.frameVal>s.endVal?s.endVal:s.frameVal,s.frameVal=Math.round(s.frameVal*s.dec)/s.dec,s.printValue(s.frameVal),t<s.duration?s.rAF=requestAnimationFrame(s.count):s.callback&&s.callback()},s.start=function(e){s.initialize()&&(s.callback=e,s.rAF=requestAnimationFrame(s.count))},s.pauseResume=function(){s.paused?(s.paused=!1,delete s.startTime,s.duration=s.remaining,s.startVal=s.frameVal,requestAnimationFrame(s.count)):(s.paused=!0,cancelAnimationFrame(s.rAF))},s.reset=function(){s.paused=!1,delete s.startTime,s.initialized=!1,s.initialize()&&(cancelAnimationFrame(s.rAF),s.printValue(s.startVal))},s.update=function(e){if(s.initialize()){if(!a(e=Number(e)))return void(s.error="[CountUp] update() - new endVal is not a number: "+e);s.error="",e!==s.frameVal&&(cancelAnimationFrame(s.rAF),s.paused=!1,delete s.startTime,s.startVal=s.frameVal,s.endVal=e,s.countDown=s.startVal>s.endVal,s.rAF=requestAnimationFrame(s.count))}},s.initialize()&&s.printValue(s.startVal)}})?o.call(t,n,t,e):o)||(e.exports=r)},550:function(e,t,n){"use strict";n.r(t),n.d(t,"TokenModalClass",function(){return b}),n.d(t,"TokenModal",function(){return v});var o=n(322),r=n(328),i=n(523),a=n(614),s=n(667),l=n(330),c=n(615),u=n(380),d=n(2),h=n(5),f=n(17),p=n(0),m=n(6),k=n(68),g=n(110),b=function(){function e(){var e=this;this.handleResizeStop=this.handleResizeStop.bind(this),this.$tokenHeaderButton=$(".main-token-status-container"),this.initialStep=void 0,$(document).on("click",".main-token-status-container",function(){e.$tokenHeaderButton.is(".selected")?e.render(!1):e.render(!0)}).on("click",".token-notifier-container .sign-in-button",function(){return e.render(!1)}).on("slideMenuOpened modalOpening searchOpen",function(){return e.render(!1)}).on("click",".token-ledger-table-container a",function(){return e.render(!1)}).on("withinChapterLinkScroll",function(){return e.render(!1)}).on("landing-page-appropriate-releases-initialized",function(){void 0!==e.initialStep&&(e.render(!0),e.initialStep=void 0)}),$(window).on("resizestop",this.handleResizeStop),k.a.getTokenProductOffering().then(function(t){e.tokenProductOfferingPrice=t.price||.01}).catch(function(t){console.log("Error when getting token product offering price"),e.tokenProductOfferingPrice=.01})}return e.prototype.initialize=function(){this.initialStep=this.getInitialTokenModalState()},e.prototype.getInitialTokenModalState=function(){var e=document.location.hash||document.location.pathname;return e.indexOf("token-ledger")>=0?s.a.ledger:e.indexOf("token-modal")>=0?s.a.showingTokenInfo:e.indexOf("token-cashout")>=0?s.a.cashout:e.indexOf("get-tokens")>=0?s.a.purchasing:void 0},e.prototype.clean=function(){r.unmountComponentAtNode(document.getElementById("full-screen-modal")),this.$tokenHeaderButton.removeClass("selected")},e.prototype.handleResizeStop=function(){var e=this;this.positionModal(),setTimeout(function(){return e.positionModal()},100)},e.prototype.positionModal=function(){if($(document.body).is(".ReactModal__Body--open")){var e=$(".ReactModal__Overlay");if(!(e.find(".shopping-cart-modal").length>0)){var t=h.a.getNavbarHeightInPx();e.css("top",t)}}},e.prototype.show=function(){this.render(!0),this.positionModal()},e.prototype.hide=function(){this.render(!1)},e.prototype.render=function(e){var t=this;this.$tokenHeaderButton.toggleClass("selected",e),m.a.isCurrentlyLoggedIn()?r.render(o.createElement(s.b,{isShown:e,onClose:function(){return t.render(!1)},livebookBaseLink:p.a.getLivebookCdn(),livevideoBaseLink:p.a.getLivevideoBaseUrl(),initialStep:this.initialStep,tokenPrice:this.tokenProductOfferingPrice||.01,topOffset:h.a.getNavbarHeightInPx(),onCashout:function(){return new Promise(function(e,t){u.a.cashout().then(function(n){n&&!1===n.success&&n.reason?t(n.reason):e(!0)}).catch(function(e){t("Error when performing cashout. Try later or contact our support: support@manning.com")})})},onAddTokensToCart:function(e){return t.buyTokens(e)},getCashoutPaymentTypes:function(){return new Promise(function(e,t){u.a.getTokenCashoutInfo().then(function(t){e(t&&t.paymentsInfo)}).catch(function(e){t("Error when ")})})},getTokenLedgerItems:function(){return u.a.getTokenLedgerItems()},getTokenState:function(){return new Promise(function(e,t){u.a.getTokenCountInfo(!0).then(function(t){u.a.setTokenCountInfo(t),g.a.refreshTokenStateInToolbar(t),e(t)}).catch(function(e){t(e)})})}}),document.getElementById("full-screen-modal")):r.render(o.createElement(i.a,{isShown:e,title:"Tokens",onClose:function(){return t.render(!1)},topOffset:h.a.getNavbarHeightInPx()},o.createElement("p",null,"Tokens can be used to unlock parts of books, from sub-sections to chapters.",o.createElement("br",null),"Any dollar amount spent unlocking content will be deducted from the final book price.",o.createElement("br",null),"You can cash out any time, reverting tokens back to dollars."),o.createElement("p",null,o.createElement("a",{className:"sign-in-button micropurchase-sign-in",href:"javascript:void(0)"},"sign in")," and get 500 tokens for FREE!")),document.getElementById("full-screen-modal"))},e.prototype.renderOutOfTokensNotifier=function(e,t){var n=this;void 0===t&&(t=!0),r.render(o.createElement(a.a,{isShown:t,topOffset:h.a.getNavbarHeightInPx(),showBuyTokensButton:!0,showCartButton:!0,isProductAlreadyInCart:k.a.isEbookInShoppingCart(e),productType:"book",productTitle:f.a.cleanBookTitle(e.title),isMeap:e.isMeap,onRequestBuyTokens:function(){n.renderOutOfTokensNotifier(e,!1),setTimeout(function(){n.initialStep=s.a.purchasing,n.render(!0)},200)},onRequestCart:function(){k.a.isEbookInShoppingCart(e)||k.a.requestAddBookToCart(e),n.renderOutOfTokensNotifier(e,!1)},onClose:function(){return n.renderOutOfTokensNotifier(e,!1)}}),document.getElementById("full-screen-modal"))},e.prototype.renderOutOfParagraphByParagraphUnlocks=function(e,t){var n=this;r.render(o.createElement(i.a,{isShown:e,title:"Out of individual paragraph tokens",onClose:function(){return n.renderOutOfParagraphByParagraphUnlocks(!1)},topOffset:h.a.getNavbarHeightInPx()},o.createElement("p",null,t)),document.getElementById("full-screen-modal"))},e.prototype.renderLicenceCreatedModal=function(e){var t=this;void 0===e&&(e=!0),r.render(o.createElement(i.a,{isShown:e,title:"you've spent enough tokens on this book to unlock the rest of it for free",theme:l.a.green,topOffset:h.a.getNavbarHeightInPx(),onClose:function(){return t.renderLicenceCreatedModal(!1)}},o.createElement("em",null,"the full eBook is in your ",o.createElement("a",{href:""+p.a.getMarketplaceUrl("dashboard"),style:{color:"white"}},"library")," for you to download or save at your leisure")),document.getElementById("full-screen-modal"))},e.prototype.renderUpsellModal=function(e,t,n,i){var a=this;void 0===e&&(e=!0),r.render(o.createElement(c.a,{isShown:e,spentTokenAmount:n,spentDollarAmount:i,productTitle:f.a.cleanBookTitle(t&&t.title),onBuy:function(){k.a.isEbookInShoppingCart(t)?k.a.requestMenuOpen():k.a.requestAddBookToCart(t)},topOffset:h.a.getNavbarHeightInPx(),onClose:function(){return a.renderUpsellModal(!1)}}),document.getElementById("full-screen-modal"))},e.prototype.buyTokens=function(e){k.a.addTokensToCart(e),d.a.setTimeout(function(){return k.a.requestMenuOpen()},150)},e}(),v=new b},654:function(e,t,n){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(t,"__esModule",{value:!0});var r=o(n(530)),i=o(n(326)),a=n(322),s=o(a),l=o(n(655));function c(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],o=!0,r=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(o=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){r=!0,i=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var m=function(e,t){var n=t.decimal,o=t.decimals,i=t.duration,a=t.easingFn,s=t.end,l=t.formattingFn,c=t.prefix,u=t.separator,d=t.start,h=t.suffix,f=t.useEasing;return new r(e,d,s,o,i,{decimal:n,easingFn:a,formattingFn:l,separator:u,prefix:c,suffix:h,useEasing:f,useGrouping:!!u})},k=function(e){function t(){var e,n,o,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var i=arguments.length,a=new Array(i),c=0;c<i;c++)a[c]=arguments[c];return o=this,r=(e=d(t)).call.apply(e,[this].concat(a)),n=!r||"object"!=typeof r&&"function"!=typeof r?f(o):r,u(f(f(n)),"createInstance",function(){return"function"==typeof n.props.children&&l(n.containerRef.current&&(n.containerRef.current instanceof HTMLElement||n.containerRef.current instanceof SVGTextElement),'Couldn\'t find attached element to hook the CountUp instance into! Try to attach "containerRef" from the render prop to a an HTMLElement, eg. <span ref={containerRef} />.'),m(n.containerRef.current,n.props)}),u(f(f(n)),"pauseResume",function(){var e=f(f(n)),t=e.reset,o=e.restart,r=e.update,i=n.props.onPauseResume;n.instance.pauseResume(),i({reset:t,start:o,update:r})}),u(f(f(n)),"reset",function(){var e=f(f(n)),t=e.pauseResume,o=e.restart,r=e.update,i=n.props.onReset;n.instance.reset(),i({pauseResume:t,start:o,update:r})}),u(f(f(n)),"restart",function(){n.reset(),n.start()}),u(f(f(n)),"start",function(){var e=f(f(n)),t=e.pauseResume,o=e.reset,r=e.restart,i=e.update,a=n.props,s=a.delay,l=a.onEnd,c=a.onStart,u=function(){return n.instance.start(function(){return l({pauseResume:t,reset:o,start:r,update:i})})};s>0?n.timeoutId=setTimeout(u,1e3*s):u(),c({pauseResume:t,reset:o,update:i})}),u(f(f(n)),"update",function(e){var t=f(f(n)),o=t.pauseResume,r=t.reset,i=t.restart,a=n.props.onUpdate;n.instance.update(e),a({pauseResume:o,reset:r,start:i})}),u(f(f(n)),"containerRef",s.createRef()),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(t,a.Component),n=t,(o=[{key:"componentDidMount",value:function(){var e=this.props,t=e.children,n=e.delay;this.instance=this.createInstance(),"function"==typeof t&&0!==n||this.start()}},{key:"shouldComponentUpdate",value:function(e){return this.props.duration!==e.duration||this.props.end!==e.end||this.props.start!==e.start||this.props.redraw}},{key:"componentDidUpdate",value:function(e){this.props.duration===e.duration&&this.props.start===e.start||(this.instance=this.createInstance(),this.start()),this.props.end!==e.end&&(this.instance.reset(),this.instance.update(this.props.end))}},{key:"componentWillUnmount",value:function(){this.timeoutId&&clearTimeout(this.timeoutId),this.instance.reset()}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.className,o=e.style,r=this.containerRef,i=this.pauseResume,a=this.reset,l=this.restart,c=this.update;return"function"==typeof t?t({countUpRef:r,pauseResume:i,reset:a,start:l,update:c}):s.createElement("span",{className:n,ref:r,style:o})}}])&&c(n.prototype,o),r&&c(n,r),t}();u(k,"propTypes",{decimal:i.string,decimals:i.number,delay:i.number,easingFn:i.func,end:i.number.isRequired,formattingFn:i.func,onEnd:i.func,onStart:i.func,prefix:i.string,redraw:i.bool,separator:i.string,start:i.number,suffix:i.string,style:i.object,useEasing:i.bool}),u(k,"defaultProps",{decimal:".",decimals:0,delay:null,duration:null,easingFn:null,formattingFn:null,onEnd:function(){},onPauseResume:function(){},onReset:function(){},onStart:function(){},onUpdate:function(){},prefix:"",redraw:!1,separator:"",start:0,suffix:"",style:void 0,useEasing:!0});t.default=k,t.useCountUp=function(e){var t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),o.forEach(function(t){u(e,t,n[t])})}return e}({},k.defaultProps,e),n=t.start,o=t.formattingFn,r=p(a.useState("function"==typeof o?o(n):n),2),i=r[0],s=r[1],l=a.useRef(null),c=function(){var e=l.current;if(null!==e)return e;var n=function(){var e=m(-1,t),n=e.options.formattingFn;return e.options.formattingFn=function(){var e=n.apply(void 0,arguments);s(e)},e}();return l.current=n,n},d=function(){var e=t.onReset;c().reset(),e({pauseResume:f,start:h,update:g})},h=function e(){var n=t.onStart,o=t.onEnd;c().reset(),c().start(function(){o({pauseResume:f,reset:d,start:e,update:g})}),n({pauseResume:f,reset:d,update:g})},f=function(){var e=t.onPauseResume;c().pauseResume(),e({reset:d,start:h,update:g})},g=function(e){var n=t.onUpdate;c().update(e),n({pauseResume:f,reset:d,start:h})};return a.useEffect(function(){var e=t.delay,n=t.onStart,o=t.onEnd,r=setTimeout(function(){n({pauseResume:f,reset:d,update:g}),c().start(function(){clearTimeout(r),o({pauseResume:f,reset:d,start:h,update:g})})},1e3*e);return d},[]),{countUp:i,start:h,pauseResume:f,reset:d,update:g}}},655:function(e,t,n){"use strict";var o=function(){};e.exports=o}}]);
//# sourceMappingURL=unlockManager.chunk.js.map?d92b93abc255eaa3100a