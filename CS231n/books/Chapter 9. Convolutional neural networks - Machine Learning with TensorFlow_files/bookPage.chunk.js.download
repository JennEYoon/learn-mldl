(window.webpackJsonp=window.webpackJsonp||[]).push([[13,5,31],{309:function(e,t,n){"use strict";n.r(t),n.d(t,"LoginManager",function(){return b});var o=n(322),i=n(328),r=n(4),a=n(14),s=n(67),l=n(379),c=n(6),d=n(23),u=n(330),h=n(0),p=n(119),m=n(16),g=$(document),f=!1;r.b.loadDeviceInfo().then(function(e){f=e.isTouchDevice});var b=new(function(){function e(){var e=this;this.$loginModal=$("#login-modal"),this.$loginModal.html('<span class="close-reveal-modal">&times;</span>\n<div class="row">\n    <div class="small-12 columns">\n        <div class="login-notification-message-container"></div>\n    </div>\n</div>\n<div class="tab-title-container">\n    <div class="tab-title tab-signin">sign in</div>\n    <div class="tab-title tab-register">register</div>\n</div>\n<div class="tabs-container">\n    <div class="tab-container tab-signin">\n        <form method="GET" onsubmit="return false">\n            <div class="row">\n                <div class="small-12 columns">\n                    <label class="first" for="email">email</label>\n                    <input type="email" id="email" name="username" placeholder="email" autocomplete="email"/>\n                </div>\n            </div>\n\n            <div class="row">\n                <div class="small-12 columns">\n                    <label class="first" for="password">password</label>\n                    <input type="password" id="password" name="password" placeholder="password" autocomplete="current-password"/>\n                </div>\n            </div>\n\n            <div class="row">\n                <div class="small-12 columns">\n                    <div data-alert class="error-message-login"></div>\n                </div>\n            </div>\n\n            <div class="row">\n                <div class="small-12 columns">\n                    <div style="display: flex; justify-content: space-between; align-items: center">\n                        <a class="pull-left" href="https://www.manning.com/user/forgotPassword" target="_blank">forgot password</a>\n                        <button type="submit" id="login-button" class="emphasized-button pull-right login-button">sign in</button>\n                    </div>\n                </div>\n            </div>\n        </form>\n    </div>\n    <div class="tab-container tab-register">\n        <form onsubmit="return false">\n            <div class="row">\n                <div class="small-12 columns">\n                    <label class="first" for="first-name">first name</label>\n                    <input type="text" id="first-name" placeholder="first name" autocomplete="name"/>\n                </div>\n            </div>\n\n            <div class="row">\n                <div class="small-12 columns">\n                    <label class="first" for="last-name">last name</label>\n                    <input type="text" id="last-name" placeholder="last name" autocomplete="family-name"/>\n                </div>\n            </div>\n\n            <div class="row">\n                <div class="small-12 columns">\n                    <label class="first" for="email-register">email</label>\n                    <input type="email" id="email-register" placeholder="email" autocorrect="off" autocapitalize="off" spellcheck="false" autocomplete="email"/>\n                </div>\n            </div>\n\n            <div class="row">\n                <div class="small-12 columns">\n                    <label class="first" for="password-register">password</label>\n                    <input type="password" id="password-register" placeholder="password" autocorrect="off" autocapitalize="off" spellcheck="false" autocomplete="new-password"/>\n                </div>\n            </div>\n\n            <div class="row">\n                <div class="small-12 columns">\n                    <label class="first" for="password-register-confirm">confirm password</label>\n                    <input type="password" id="password-register-confirm" placeholder="password" autocorrect="off" autocapitalize="off" spellcheck="false" autocomplete="new-password"/>\n                </div>\n            </div>\n\n            <div class="row">\n                <div class="small-12 columns">\n                    <label class="error-message-register"></label>\n                </div>\n            </div>\n\n            <div class="register-subscribe-container">\n                <div title="subscribe now for great discounts and news about upcoming titles" data-tooltip aria-haspopup="true" data-options="disable_for_touch:true">\n                    <input id="subscribe-me-checkbox" type="checkbox" checked><label for="subscribe-me-checkbox">subscribe to emails (*)</label>\n                </div>\n                <div>\n                    <button type="submit" class="emphasized-button pull-right register-button">register</a>\n                </div>\n            </div>\n        </form>\n    </div>\n</div>\n</div>'),this.$inputMail=$("#email"),this.$inputPassword=$("#password"),this.$labelMail=this.$inputMail.siblings("label"),this.$labelPassword=this.$inputPassword.siblings("label"),this.$errorMessageLogin=this.$loginModal.find(".error-message-login"),this.$inputRegisterFirstName=this.$loginModal.find("#first-name"),this.$inputRegisterLastName=this.$loginModal.find("#last-name"),this.$inputRegisterEmail=this.$loginModal.find("#email-register"),this.$inputRegisterPassword=this.$loginModal.find("#password-register"),this.$inputRegisterConfirmPassword=this.$loginModal.find("#password-register-confirm"),this.$labelRegisterFirstName=this.$inputRegisterFirstName.siblings("label"),this.$labelRegisterLastName=this.$inputRegisterLastName.siblings("label"),this.$labelRegisterEmail=this.$inputRegisterEmail.siblings("label"),this.$labelRegisterPassword=this.$inputRegisterPassword.siblings("label"),this.$labelRegisterConfirmPassword=this.$inputRegisterConfirmPassword.siblings("label"),this.$inputPassword.on("keyup",function(t){13===t.which&&e.initiateLoginIfAllFilled()}),this.$inputMail.on("keyup",function(t){13===t.which&&e.initiateLoginIfAllFilled()}),this.tabs=new l.a(this.$loginModal,function(e){1==e&&g.trigger("registrationModalShown")}),g.on("click","#login-modal .login-button",function(t){return e.initiateLoginIfAllFilled(),t.preventDefault(),!1}),g.on("click","#login-modal .register-button",function(t){return e.initiateRegisterIfAllFilled(),t.preventDefault(),!1});var t=0;g.on("click",".request-activation-email-link",function(e){c.a.lastEmail&&($(document).trigger("requestNotification","sending activation email"),g.trigger("activationRequested",++t),h.a.postToOurBackend(h.a.getAbsoluteUrl("user/requestAccountActivationEmail"),function(e){$(document).trigger("requestNotification","Account activation mail sent. Check your inbox.")},function(e){return $(document).trigger("requestNotification","Error requesting account activation. Contact our support at support@manning.com")},{emailAddress:c.a.lastEmail}))}),g.on("logInUnsuccessful",function(t,n){e.$errorMessageLogin.html('Error logging in, \n                    <a href="https://www.manning.com/user/forgotPassword" target="_blank">reset password</a> \n                    or \n                    <a href=\'mailto:support@manning.com\' target="_blank">contact support</a>')}),g.on("registrationUnsuccessful",function(t){e.$errorMessageLogin.text("Error: "+t.data)})}return e.prototype.requestLogin=function(e,t){var n=this;void 0===e&&(e=""),void 0===t&&(t=""),this.isPerformingLogin||(g.trigger("slideMenuCloseRequested"),c.a.isLoggedIn().then(function(o){"fully"!==o.status&&n.openModal("",e,!0,t)}))},e.prototype.initiateLoginIfAllFilled=function(){var e=this.$inputMail.val(),t=this.$inputPassword.val();e&&t&&this.performLogin(e,t),this.toggleLoginErrorMessages()},e.prototype.initiateRegisterIfAllFilled=function(){var e=this,t=this.$inputRegisterFirstName.val(),n=this.$inputRegisterLastName.val(),o=this.$inputRegisterEmail.val(),i=this.$inputRegisterPassword.val(),r=(this.$inputRegisterConfirmPassword.val(),$("#subscribe-me-checkbox").is(":checked"));return this.$loginModal.find(".register-button").attr("disabled","true"),s.a.showTemporaryNotification("Registering.."),c.a.getUserAccountStatus(o).then(function(a){if("ACTIVE"===a)e.$loginModal.find(".register-button").attr("disabled",null),e.showError(e.$labelRegisterEmail,'This account already exists. If you forgot your password you can <a target="_blank" href="https://www.manning.com/user/forgotPassword">reset it</a>.');else if("DISABLED"===a)e.$loginModal.find(".register-button").attr("disabled",null),e.showError(e.$labelRegisterEmail,'This account has been disabled. Please contact our <a target="_blank" href="mailto:support@manning.com">support</a>.');else{if(e.checkRegisterDataForValidity())return c.a.registerUser(t,n,o,i,r).then(function(){m.a.setItem("email",o),e.$loginModal.find(".register-button").attr("disabled",null),e.closeModal(),s.a.showTemporaryNotification("One more step! Please confirm your email and login."),e.renderRegistrationSuccessfulModal(),g.trigger("registrationSuccessful")}).catch(function(t){e.$loginModal.find(".register-button").attr("disabled",null),s.a.hideNotification(),e.showError(e.$labelRegisterEmail,'Registration was unsuccessful. Please contact our <a target="_blank" href="mailto:support@manning.com">support</a>.'),g.trigger("registrationUnsuccessful",t),console.log("Couldn't register new user",t)});e.$loginModal.find(".register-button").attr("disabled",null)}}),!1},e.prototype.openModal=function(e,t,n,o,i){var r=this;void 0===e&&(e=""),void 0===t&&(t=""),void 0===n&&(n=!1),void 0===i&&(i=""),s.a.hideNotificationModal(),a.a.showFoundationModal(this.$loginModal),this.tabs&&this.tabs.selectTab("register"===e?1:0),this.$errorMessageLogin.text("");var l=this.$loginModal.find(".login-notification-message-container");if(l.toggleClass("hidden",!t),l.text(t),f||setTimeout(function(){return r.$inputMail.focus()},200),n||i){var c=function(e){e&&(r.$inputMail.val(e),f||setTimeout(function(){return r.$inputPassword.focus()},300))};i?c(i):d.a.getUserEmail().then(c)}o&&g.trigger("signInRequested",o)},e.prototype.closeModal=function(){a.a.hideFoundationModal(this.$loginModal)},e.prototype.toggleLoginErrorMessages=function(){this.$inputMail.val()?this.hideError(this.$labelMail):this.showError(this.$labelMail),this.$inputPassword.val()?this.hideError(this.$labelPassword):this.showError(this.$labelPassword)},e.prototype.checkRegisterDataForValidity=function(){var e=this.validateRegisterFirstName();!0===e?this.hideError(this.$labelRegisterFirstName):this.showError(this.$labelRegisterFirstName,e);var t=this.validateRegisterLastName();!0===t?this.hideError(this.$labelRegisterLastName):this.showError(this.$labelRegisterLastName,t);var n=this.validateRegisterEmail();!0===n?this.hideError(this.$labelRegisterEmail):this.showError(this.$labelRegisterEmail,n);var o=this.validateRegisterPassword(this.$inputRegisterPassword);!0===o?this.hideError(this.$labelRegisterPassword):this.showError(this.$labelRegisterPassword,o);var i=this.validateRegisterPassword(this.$inputRegisterConfirmPassword);!0===i?this.hideError(this.$labelRegisterConfirmPassword):this.showError(this.$labelRegisterConfirmPassword,i);var r=this.$inputRegisterPassword.val()==this.$inputRegisterConfirmPassword.val();return!0===i&&(r?this.hideError(this.$labelRegisterConfirmPassword):this.showError(this.$labelRegisterConfirmPassword,"passwords should match")),!0===e&&!0===t&&!0===n&&!0===o&&!0===i&&r},e.prototype.showError=function(e,t){e.addClass("error"),e.siblings("input").addClass("has-error"),this.removeErrorMessageFromLabel(e),e.html(e.text()+" ("+(t||"*")+")")},e.prototype.hideError=function(e){e.removeClass("error"),e.siblings("input").removeClass("has-error"),this.removeErrorMessageFromLabel(e)},e.prototype.removeErrorMessageFromLabel=function(e){var t=e.text(),n=t.indexOf("(");-1!=n&&(t=t.substring(0,n)),e.text(t)},e.prototype.validateRegisterFirstName=function(){var e=this.$inputRegisterFirstName.val().trim();return e?!(e.length<2)||"at least 2 characters":"*"},e.prototype.validateRegisterLastName=function(){var e=this.$inputRegisterLastName.val().trim();return!!e&&(!(e.length<2)||"at least 2 characters")},e.prototype.validateRegisterEmail=function(){var e=this.$inputRegisterEmail.val().trim();if(!e)return!1;return!!/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)||"invalid email"},e.prototype.validateRegisterPassword=function(e){var t=e.val().trim();return!!t&&(!(t.length<6)||"at least 6 characters")},e.prototype.performLogin=function(e,t){var n=this;this.isPerformingLogin=!0,g.trigger("requestPermanentNotification","Logging in..."),c.a.attemptLogin(e,t).then(function(t){if(n.isPerformingLogin=!1,t.loggedIn)try{n.closeModal(),g.trigger("requestNotification","Welcome: "+e),setTimeout(function(){return h.a.reloadPage()},1500)}catch(e){console.log("Error when processing successful login",e)}else t.accountNotActive&&(n.renderAccountNotActivatedModal(),n.closeModal())}).catch(function(e){n.isPerformingLogin=!1,g.trigger("requestNotification","Error when logging in. Try again later or reset your password. If you've just registered, please activate your account first."),g.trigger("logInUnsuccessful"),p.a.modifyUIWithLogout(),console.log("Error when logging in",e)})},e.prototype.performLogout=function(){g.trigger("requestPermanentNotification","Logging out..."),c.a.logout().then(function(){return h.a.reloadPage()}).catch(function(){return h.a.reloadPage()})},e.prototype.renderRegistrationSuccessfulModal=function(e){var t=this;void 0===e&&(e=!0),i.render(o.createElement(u.b,{isOpen:e,title:"Just one more step",mainContainerClassName:"registration-activation-modal",onClose:function(){return t.renderRegistrationSuccessfulModal(!1)},isContentVerticalTop:!1},o.createElement("p",null,"You must activate your account by clicking the link in the confirmation email we just sent you. If there is no activation email in your inbox, check your spam folder. You can also ",o.createElement("a",{href:"javascript:void(0)",className:"request-activation-email-link"},"request another one")," or ",o.createElement("a",{href:"mailto:support@manning.com",target:"_blank"},"contact our support"),".")),document.getElementById("full-screen-modal"))},e.prototype.renderAccountNotActivatedModal=function(e){var t=this;void 0===e&&(e=!0),g.trigger("registrationAccountNotActivated"),i.render(o.createElement(u.b,{isOpen:e,title:"Please activate your account to sign in",mainContainerClassName:"registration-activation-modal",onClose:function(){return t.renderAccountNotActivatedModal(!1)},isContentVerticalTop:!1},o.createElement("p",null,'Your account is not yet activated. Please click the activation link we emailed you (subject line "Activate your livebook account"). If there is no activation email in your inbox, check your spam folder. If you can\'t find it, you can can ',o.createElement("a",{href:"javascript:void(0)",className:"request-activation-email-link"},"request another one")," or ",o.createElement("a",{href:"mailto:support@manning.com",target:"_blank"},"contact our support"),".")),document.getElementById("full-screen-modal"))},e}())},334:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return LinksUtils});var query_string__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(358),query_string__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(query_string__WEBPACK_IMPORTED_MODULE_0__),_DeviceUtils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4),_BookContentUtils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(17),_DOMUtils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(14),_WebUtils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(0),_EventUtils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(2),_BookViewDOMUtils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(5),_RouteUtils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(21),_components_misc_LinkPreviewer__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(348),_managers_ScreenScrollManager__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(111),_modules_discussions_DiscussionModule__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(86),_modules_UnlockModule__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(110),$document=$(document),LinksUtilsClass=function(){function LinksUtilsClass(){var e=this;_DeviceUtils__WEBPACK_IMPORTED_MODULE_1__.b.loadDeviceInfo().then(function(t){e.currentPlatform=t.platform,$("body").on("click","a:not(.immediately-go-to-link)",function(e){return LinksUtils.handleLinkClick(e,e.currentTarget)}),t.isTouchDevice||(_EventUtils__WEBPACK_IMPORTED_MODULE_5__.a.onDescendantEventWithCooldown($("body"),"mouseenter","#book-markup-container a",function(t){return e.handleLinkHover(t,t.currentTarget)}),$("body").on("mouseleave","#book-markup-container a",function(e){return LinksUtils.handleLinkLeave(e.currentTarget)}))})}return LinksUtilsClass.prototype.clean=function(){_components_misc_LinkPreviewer__WEBPACK_IMPORTED_MODULE_8__.a.hidePreview(!1,!0)},LinksUtilsClass.prototype.formLink=function(e,t,n){return void 0===n&&(n=""),document.location.protocol+"//"+document.location.host+this.formHash(e,t)+n},LinksUtilsClass.prototype.formLinkFromBookSlugAndBookElementShortName=function(e,t){return document.location.protocol+"//"+document.location.host+this.formHashFromSlugAndShortNames(e,t)},LinksUtilsClass.prototype.formEditLinkFromBookSlugAndBookElementShortName=function(e,t){return document.location.protocol+"//"+document.location.host+this.formEditHashFromSlugAndShortNames(e,t)},LinksUtilsClass.prototype.formHash=function(e,t){if(null==e||null==t)return"";var n="/book/"+e.slug+"/"+t.shortName+"/";return t.meapVersion>0?n+="v-"+t.meapVersion+"/":t.reviewVersion>0&&(n+="r-"+t.reviewVersion+"/"),n},LinksUtilsClass.prototype.formHashFromSlugAndShortNames=function(e,t){return"/book/"+e+"/"+t},LinksUtilsClass.prototype.formEditHashFromSlugAndShortNames=function(e,t){return"/edit/"+e+"/"+t},LinksUtilsClass.prototype.trimLastSlash=function(e){return e&&0!=e.length?"/"==e[e.length-1]?e.substring(0,e.length-1):e:""},LinksUtilsClass.prototype.handleLinkClick=function(e,link){var $link=$(link);if($(e.target).is(".dont-propagate-click")||$(e.currentTarget).is(".dont-propagate-click"))e.preventDefault();else{if(($(e.target).is(".immediately-go-to-link")||$(e.currentTarget).is(".immediately-go-to-link"))&&(document.location.href=link.href),_components_misc_LinkPreviewer__WEBPACK_IMPORTED_MODULE_8__.a.hidePreview(),-1!=link.href.indexOf("data:"))return!0;if(-1!=link.href.indexOf("javascript:void(0)"))return!0;if($link.is(".history-back-button"))return e.preventDefault(),history.go(-1),!1;if(!link.href||link.href===document.location.href||link.href===document.location.href+"#")return e.preventDefault(),!1;if($link.is(".reload-link")&&_WebUtils__WEBPACK_IMPORTED_MODULE_4__.a.reloadPage(),link.href.indexOf("search-")>=0&&$document.trigger("searchSuggestion",["link",link.href]),this.isThirdPartyLink(link.href)||e.ctrlKey||e.metaKey||2===e.which||"_blank"==$link.attr("target")){switch(e.preventDefault(),this.currentPlatform){case _DeviceUtils__WEBPACK_IMPORTED_MODULE_1__.a.Browser:this.openLinkInNewTab(link.href);break;case _DeviceUtils__WEBPACK_IMPORTED_MODULE_1__.a.Cordova:window.open(link.href,"_system");break;case _DeviceUtils__WEBPACK_IMPORTED_MODULE_1__.a.Electron:var shell=eval("require('electron').shell");shell&&shell.openExternal&&shell.openExternal(link.href)}return!1}-1==link.href.indexOf("javascript:")&&$document.trigger("searchHideRequested");var linkBookElementData=this.extractBookElementData(link);if(linkBookElementData){if(this.isLinkOnSameBookElement(linkBookElementData)){e.preventDefault();var scrollToElement_1=null;if(linkBookElementData.additional){if(linkBookElementData.additional.startsWith("comment-"))return void _modules_discussions_DiscussionModule__WEBPACK_IMPORTED_MODULE_10__.a.requestShowCommentWhenReady(linkBookElementData.additional.replace("comment-",""),0,function(){},$(e.target).closest("#in-page-discussion-wrapper").length>0);!scrollToElement_1&&linkBookElementData.additional.startsWith("note-")&&$document.trigger("noteOpenRequested",linkBookElementData.additional.replace("note-","")),scrollToElement_1=document.getElementById(linkBookElementData.additional),!scrollToElement_1&&linkBookElementData.additional.startsWith("search-")&&(scrollToElement_1=document.getElementById(linkBookElementData.additional.replace("search-","")),null!=scrollToElement_1&&($(".paragraph-selected").removeClass("paragraph-selected"),$(scrollToElement_1).addClass("paragraph-selected"))),!scrollToElement_1&&linkBookElementData.additional.startsWith("section-")&&(scrollToElement_1=_BookViewDOMUtils__WEBPACK_IMPORTED_MODULE_6__.a.getSectionHeading(linkBookElementData.additional))}else scrollToElement_1=document.querySelector(".readable-text");var text=$link.text(),isBrowsableElement=_BookContentUtils__WEBPACK_IMPORTED_MODULE_2__.a.matchesBrowsableRegEx(text);if(isBrowsableElement){var $textFragment=$link.closest(".readable-text"),textFragment=$textFragment[0];if(textFragment){var browsable=_BookContentUtils__WEBPACK_IMPORTED_MODULE_2__.a.getMatchingBrowsable(textFragment.browsables,$link.text());$(browsable).closest(".focus-off").removeClass("focus-off"),browsable&&_DOMUtils__WEBPACK_IMPORTED_MODULE_3__.a.precedesElement(scrollToElement_1,textFragment)&&(scrollToElement_1=textFragment)}}return scrollToElement_1&&($document.trigger("disableToolbarHiding"),_managers_ScreenScrollManager__WEBPACK_IMPORTED_MODULE_9__.a.scrollToElement(scrollToElement_1,function(){$document.trigger("enableToolbarHiding"),$(scrollToElement_1).is(".scrambled")&&linkBookElementData&&linkBookElementData.additional.startsWith("search-")&&_modules_UnlockModule__WEBPACK_IMPORTED_MODULE_11__.a.tryToSearchUnlockFragmentInCurrentBookElement([$(scrollToElement_1)])}),$document.trigger("withinChapterLinkScroll",scrollToElement_1)),!1}var pageType=link.href.indexOf("/book/")>-1?"book":"edit";if(linkBookElementData.book&&linkBookElementData.bookElement){var link_1="/"+pageType+"/"+linkBookElementData.book+"/"+linkBookElementData.bookElement+"/";return linkBookElementData.meapVersion?link_1+="v-"+linkBookElementData.meapVersion+"/":linkBookElementData.reviewVersion&&(link_1+="r-"+linkBookElementData.reviewVersion+"/"),linkBookElementData.additional&&(link_1+=linkBookElementData.additional),page(link_1),!1}if(linkBookElementData.book&&!linkBookElementData.bookElement)return page("/"+pageType+"/"+linkBookElementData.book),!1}}},LinksUtilsClass.prototype.handleLinkHover=function(e,t){clearTimeout(this.linkHoverTimer);var n=$(t),o=this.extractBookElementData(t);if(o&&this.isLinkOnSameBookElement(o))try{var i=document.getElementById(o.additional);if(null!=i){var r=$(i).closest(".browsable-container, .readable-text");if(r.is(".browsable-container"))return void(_BookViewDOMUtils__WEBPACK_IMPORTED_MODULE_6__.a.isElementVisibleEvenALittle(r.get(0))||_components_misc_LinkPreviewer__WEBPACK_IMPORTED_MODULE_8__.a.showBrowsablePreview(t,r));if(r.is(".readable-text"))return void(_BookViewDOMUtils__WEBPACK_IMPORTED_MODULE_6__.a.isElementVisibleEvenALittle(r.get(0))||_components_misc_LinkPreviewer__WEBPACK_IMPORTED_MODULE_8__.a.showWithinChapterPreview(t,r))}}catch(e){}if(this.isLivebookLink(t.href)){var a=_WebUtils__WEBPACK_IMPORTED_MODULE_4__.a.getAbsoluteUrl("api/book/linkPreviewDetails"),s=this.extractBookElementData(t);this.linkHoverTimer=_EventUtils__WEBPACK_IMPORTED_MODULE_5__.a.setTimeout(function(){_WebUtils__WEBPACK_IMPORTED_MODULE_4__.a.getFromOurBackend(a,function(e){null!=e&&n.is(":hover")&&_components_misc_LinkPreviewer__WEBPACK_IMPORTED_MODULE_8__.a.showBookElementPreview(t,e)},function(e){console.error("Something went wrong retrieveing preview details: ",e)},{linkHash:t.hash||t.pathname,bookElementLink:s})},100)}},LinksUtilsClass.prototype.handleLinkLeave=function(e){clearTimeout(this.linkHoverTimer),this.linkHoverTimer=_EventUtils__WEBPACK_IMPORTED_MODULE_5__.a.setTimeout(function(){$(e).is(":hover")||_components_misc_LinkPreviewer__WEBPACK_IMPORTED_MODULE_8__.a.hidePreview(!0)},300)},LinksUtilsClass.prototype.extractBookElementData=function(e){var t=query_string__WEBPACK_IMPORTED_MODULE_0__.extract(e.href);if(t){var n="",o=t.indexOf("#");-1!=o&&(n=t.substring(o+1),t=t.substring(0,o));var i=query_string__WEBPACK_IMPORTED_MODULE_0__.parse(t),r=i.book,a=i.bookElement;if("search"in i&&(n="search-"+n),r&&a)return{book:r,bookElement:a,additional:n,isEditLink:t.indexOf("/edit/")>0}}var s=e.pathname,l=_RouteUtils__WEBPACK_IMPORTED_MODULE_7__.a.getRouteInfo(s);return l||((s=e.hash).startsWith("#!")&&(s=s.substring("#!".length),l=_RouteUtils__WEBPACK_IMPORTED_MODULE_7__.a.getRouteInfo(s))?l:document.getElementById(e.hash.substring(1))?((l=_RouteUtils__WEBPACK_IMPORTED_MODULE_7__.a.getCurrentRouteInfo()).additional=e.hash.substring(1),l):null)},LinksUtilsClass.prototype.isLinkOnSameBookElement=function(e){var t=_RouteUtils__WEBPACK_IMPORTED_MODULE_7__.a.getCurrentRouteInfo();return!!t&&(t.book===e.book&&t.bookElement===e.bookElement&&t.meapVersion==e.meapVersion&&t.isEditLink==e.isEditLink)},LinksUtilsClass.prototype.isThirdPartyLink=function(e){return"string"==typeof e&&""!=e&&-1==e.indexOf("localhost")&&-1==e.indexOf("livebook")&&-1==e.indexOf("liveaudio")&&-1==e.indexOf("vbook")&&0!==e.indexOf("file://")&&0!==e.indexOf("javascript")},LinksUtilsClass.prototype.isLivebookLink=function(e){return!!e&&(-1!==e.indexOf("localhost")||-1!==e.indexOf("livebook")||0==e.indexOf("#"))},LinksUtilsClass.prototype.openLinkInNewTab=function(e){window.open(e,"_blank").focus()},LinksUtilsClass.prototype.openLink=function(e){this.isLivebookLink(e)?document.location.href=e:this.openLinkInNewTab(e)},LinksUtilsClass}(),LinksUtils=new LinksUtilsClass},348:function(e,t,n){"use strict";var o=n(5),i=n(2),r=n(0),a=n(359),s=$(window),l=function(){function e(){this.handleMouseLeave=this.handleMouseLeave.bind(this)}return e.prototype.initialize=function(e,t){this.book=e,$("#link-preview-popup").css("display","").on("mouseleave",this.handleMouseLeave)},e.prototype.handleMouseLeave=function(){var e=this;clearTimeout(this.linkPreviewMouseLeaveTimer),this.linkPreviewMouseLeaveTimer=i.a.setTimeout(function(){e.hidePreview(!0)},200)},e.prototype.clean=function(){this.book=null,this.hidePreview(!1,!0)},e.prototype.showBrowsablePreview=function(e,t){if(e&&null!=t&&0!=t.length){var n=$("#link-preview-popup");try{n.removeClass("book-element-preview is-cover-left is-cover-right").addClass("browsable-preview");var o=n.find(".browsable-preview-container"),i=t.find(".code-area > .hljs:not(.hljs-line-numbers)");if(i.length>0){var r=$("<h5></h5>");r.html(t.find("h5").html());var a=$("<pre></pre>");a.text(i.text()),o.html(""),o.append(r),o.append(a)}else o.html(t.html());n.removeClass("closed").addClass("open"),n.css({opacity:0}),n.find("img").css({cursor:"initial"}),this.positionPreviewPopup($(e))}catch(e){}}},e.prototype.showWithinChapterPreview=function(e,t){if(e&&null!=t&&0!=t.length){for(var n=[],o=parseInt(t.attr("refid")),i=$("#book-markup-container").find("h1, h2, h3, h4"),a=null,s=0;s<i.length;s++){var l=i.eq(s).closest(".browsable-container, .readable-text");if(l.length>0){if(parseInt(l.attr("refid"))>o)break;a=l}}var c=null!=a?a.text():"";if(c!=t.text())n.push(t.html());else try{var d=document.getElementById(""+(o+1));d&&n.push($(d).html())}catch(e){}this.showBookElementPreview(e,{coverUrl:r.a.getBookCoverUrl(null!=this.book?this.book.shortName:""),title:c,paragraphs:n})}},e.prototype.showBookElementPreview=function(e,t){if(t&&this.referentLink!=e){var n=$(e),i=$("#link-preview-popup");i.addClass("book-element-preview").removeClass("browsable-preview"),i.css({"max-width":.9*$("#book-markup-container").width()});var s=i.find(".chapter-preview-paragraphs-container"),l=i.find(".book-cover"),c=i.find(".chapter-preview-title");i.removeClass("closed").addClass("open"),i.css({opacity:0}),l.attr("src",r.a.getLivebookCdn()+"assets/images/cover.png"),l.attr("data-src",t.coverUrl),c.text(t.title),s.html(t.paragraphs.join("<br>")),i.find(".browsable-preview-container").html(""),o.a.replaceBookCoversOnImageLoad(i,[t.coverUrl]),this.referentLink=e;try{c&&c.length&&a(c.get(0),{clamp:2}),s&&s.length&&a(s.get(0),{clamp:4})}catch(e){}this.positionPreviewPopup(n)}},e.prototype.hidePreview=function(e,t){var n=$("#link-preview-popup");e&&n.is(":hover")||(n.is(".open")&&!t?n.velocity({translateY:(n.is(".is-arrow-up")?"":"-")+"25%",opacity:0},{duration:100,complete:function(){n.removeClass("open").addClass("closed")}}):n.removeClass("open").addClass("closed"),this.referentLink=null)},e.prototype.positionPreviewPopup=function(e){if(null!=e&&0!=e.length){var t=$("#link-preview-popup"),n=$("#book-markup-container"),o=t.width(),i=t.height(),r=e.width(),a=e.height(),l=e.offset(),c=e.get(0).getBoundingClientRect(),d=l.left+.5*r,u=n.offset(),h=n.width(),p=c.top+i<s.height()-100;if(t.toggleClass("is-arrow-up",p),t.toggleClass("is-arrow-down",!p),t.is(".browsable-preview"))t.removeClass("is-cover-left is-cover-right");else{var m=d>=s.width()/2;t.toggleClass("is-cover-left",m),t.toggleClass("is-cover-right",!m)}var g=Math.max(d-.5*o,u.left+50),f=u.left+.9*h;g+o>f&&(g=Math.max(f-o,50)),t.css({top:p?l.top+a+10:l.top-i-30,left:g}),t.find(".arrow-up, .arrow-down").css({left:Math.min(d-g,o-20)}),t.velocity({translateY:(p?"":"-")+"25%",opacity:0},0),t.velocity({translateY:"0",opacity:1},200)}},e}();t.a=new l},365:function(e,t,n){"use strict";var o=n(5),i=n(14),r=n(17),a=n(334),s=n(111),l=n(13),c=n(2),d=n(69),u=n(4),h=n(12),p=n(117),m=n(110),g=n(18),f=n(112),b=$(window),k=$(document),v=function(){function e(){var e=this;this.$sectionNavigationContainer=$("#section-navigation-container"),this.$sectionNavigationWrapper=$("#section-navigation-container .section-navigation-wrapper"),this.$titleSectionContainers=$(".title-section-container"),this.handleChapterTitleClick=this.handleChapterTitleClick.bind(this),this.render=this.render.bind(this),this.reposition=this.reposition.bind(this),this.handleSlideMenuOpened=this.handleSlideMenuOpened.bind(this),this.handleSlideMenuClosed=this.handleSlideMenuClosed.bind(this),this.trackScrolling=this.trackScrolling.bind(this),this.handleUnlockSuccess=this.handleUnlockSuccess.bind(this),this.handleHeaderItemTextClick=this.handleHeaderItemTextClick.bind(this),this.handleHeaderItemUnlockClick=this.handleHeaderItemUnlockClick.bind(this),this.renderAndRepeatWithDelay=this.renderAndRepeatWithDelay.bind(this),this.handleTextSlideMenuOpened=this.handleTextSlideMenuOpened.bind(this),this.handleTextSlideMenuHidden=this.handleTextSlideMenuHidden.bind(this),k.on("sectionTitleRespositionRequested",this.reposition),k.on("freePreviewModeActivated freePreviewModeDeactivated",function(){e.fillSectionNavigationContainer(),e.render()}),k.on("headerNotifierHidden headerNotifierShown",function(){e.render()}),k.on("requestUpdateHistoryOnScroll",function(t,n){return e.rewriteUrlOnScroll=n})}return e.prototype.initialize=function(e,t,n){(!u.b.isSafari()||e.userOwnsBook||t.isOpen)&&b.on("scroll",this.render),b.on("scrollstop",this.trackScrolling),b.on("resizestop",this.render),k.on("unlockSuccess",this.handleUnlockSuccess),k.on("click",".header-item-text",this.handleHeaderItemTextClick),k.on("click",".header-item-lock",this.handleHeaderItemUnlockClick),k.on("textSlideMenuOpened",this.handleTextSlideMenuOpened),k.on("textSlideMenuClosed",this.handleTextSlideMenuHidden),k.on("contentFullyConstructed subtitlesLoaded audio-controls-built text-addons-data-ready",this.renderAndRepeatWithDelay),this.$trackPointColumn=$("#track-point-column"),this.rewriteUrlOnScroll=p.a.rewriteUrlOnScroll&&n,this.showLocksWhenAppropriate=!e.userOwnsBook&&!t.isOpen,this.showLocksWhenAppropriate&&e.latestMeapVersion!=t.meapVersion&&(this.showLocksWhenAppropriate=!1),this.showLocksWhenAppropriate&&g.a.isUnlockingWholeContentThroughPointingLink&&(this.showLocksWhenAppropriate=!1),this.$bookChapterTitleContainer=$("#top-bar-container .title-label"),this.$bookChapterTitleContainer.on("click",this.handleChapterTitleClick),this.book=e,this.bookElement=t,this.setBookElementTitle(t.title),this.$headerElements=r.a.getHeadings(),this.fillSectionNavigationContainer(),this.renderAndRepeatWithDelay(),k.on("slideMenuOpened",this.handleSlideMenuOpened),k.on("slideMenuClosed",this.handleSlideMenuClosed)},e.prototype.clean=function(){b.off("scroll",this.render),b.off("scrollstop",this.trackScrolling),b.off("resizestop",this.render),b.off("resize",this.render),k.off("contentFullyConstructed",this.render),k.off("unlockSuccess",this.handleUnlockSuccess),k.off("click",".header-item-text",this.handleHeaderItemTextClick),k.off("click",".header-item-lock",this.handleHeaderItemUnlockClick),k.off("textSlideMenuOpened",this.handleTextSlideMenuOpened),k.off("textSlideMenuClosed",this.handleTextSlideMenuHidden),k.off("contentFullyConstructed subtitlesLoaded audio-controls-built text-addons-data-ready",this.renderAndRepeatWithDelay),this.$bookChapterTitleContainer&&this.$bookChapterTitleContainer.off("click",this.handleChapterTitleClick),this.$headerElements=null,this.$bookChapterTitleContainer=null,this.rewriteUrlOnScroll=!1,this.book=null,this.bookElement=null,this.$sectionNavigationWrapper.html(""),this.hide(),$(".title-section-container").addClass("hidden"),k.off("slideMenuOpened",this.handleSlideMenuOpened),k.off("slideMenuClosed",this.handleSlideMenuClosed)},e.prototype.reposition=function(){this.render()},e.prototype.setBookElementTitle=function(e){this.$titleSectionContainers.removeClass("hidden");var t=this.$titleSectionContainers.find(".chapter-title-label");t.attr("title",e),t.find(".chapter-type-label").text(l.a.extractBookElementType(e)),t.find(".chapter-title-text-label").text(l.a.extractCleanBookElementTitle(e))},e.prototype.fillSectionNavigationContainer=function(){var e=this;if(null!=this.$headerElements){var t="",n=g.a.isFreePreviewActive();this.$headerElements.each(function(o,i){var a=$(i),s=i.querySelector("h1, h2, h3, h4, h5"),c=$(s).text().trim();if(!l.a.isChapterOrAppendix(c)&&"H1"!=i.tagName){c=h.a.escapeHtml(c);var d=e.showLocksWhenAppropriate;if(d)d=r.a.getHeadingSectionCost(e.bookElement.bookElementPriceInfo,a,e.$headerElements)>0;d&&n&&(d=!1);var u=a.attr("refid"),p=null!=s?s.id:"";t+="<div class='header-item' data-refid="+u+" data-id="+p+">\n                        "+(d?'<svg class="header-item-lock" viewBox="0 0 10.583333 10.583334" title=\'unlock '+c+'\'><use xlink:href="#token-icon"></svg>':"")+"\n                        <span class='header-item-text'>"+c+"</span>\n                     </div>"}}),this.$sectionNavigationWrapper.html(t),this.show()}},e.prototype.getTopReadableElement=function(e,t){for(var n=e.eq(0),o=0;o<e.length;o++){if(null!=(r=e.eq(o).offset())&&r.top>=t&&o>0){n=e.eq(o-1);break}}var i=parseInt(n.attr("refid"));if(Number.isNaN(i))return e.eq(0);i>0&&(i-=1);for(o=i;o<i+60;o++){var r;if(null!=(r=$("[refid='"+o+"']").offset())&&r.top>=t)return $("[refid='"+(o-1)+"']")}return n},e.prototype.renderAndRepeatWithDelay=function(){this.render(),c.a.setTimeout(this.render,16),c.a.setTimeout(this.render,100)},e.prototype.handleChapterTitleClick=function(e){$(e.target).is(".wish-list-icon")||s.a.scrollToElement(this.$headerElements[0])},e.prototype.handleTextSlideMenuHidden=function(){var e=this;c.a.setTimeout(function(){return e.updateHeaderTitleContainersPositions()},100)},e.prototype.handleTextSlideMenuOpened=function(){var e=this;c.a.setTimeout(function(){return e.updateHeaderTitleContainersPositions()},100)},e.prototype.render=function(){var e=this,t=b.scrollTop(),n=t+o.a.getTopNavBarHeight(),i=0==t?$(null):this.getLastHeader(n+40);this.$titleSectionContainers.toggleClass("chapter-title-shown",0!=i.length),i=i.filter("[refid!='1']");var r=this.$sectionNavigationWrapper.children(),a=i.attr("refid");if(a){r.filter("[data-refid!='"+a+"']").removeClass("header-item-shown");var s=r.filter("[data-refid='"+a+"']");s.addClass("header-item-shown"),this.$sectionNavigationContainer.css("display","block");var l=this.getTrackPointPosition(),d=this.getTextReferentLeftPosition();if(s.length>0){var u=s.children(".header-item-lock"),h=s.children(".header-item-text");u.css("left",Math.round(l-u.width()/2+1)),h.css("left",d),s.css("padding-right",d+"px")}}else c.a.setTimeout(function(){e.$sectionNavigationContainer.is(".has-shown-header-items")||e.$sectionNavigationContainer.css("display","none")},125);if(this.updateHeaderTitleContainersPositions(),this.$sectionNavigationContainer.toggleClass("has-shown-header-items",!!a),!$("#header-notification-container").is(".hidden")&&t>0)return this.$titleSectionContainers.toggleClass("chapter-title-shown",!0),this.$sectionNavigationContainer.css("display","none"),void this.$sectionNavigationContainer.removeClass("has-shown-header-items")},e.prototype.updateHeaderTitleContainersPositions=function(){var e=this.$titleSectionContainers.filter(":not(.second-row-top-bar-section .title-section-container)"),t=this.$titleSectionContainers.filter(".second-row-top-bar-section .title-section-container");u.b.isSmallScreenSize()?(e.css("display","none"),t.css("display","block"),this.updateSizeAndPositionForSmallTitleContainer(t)):(t.css("display","none"),e.css("display","block"),this.updateSizeAndPositionForMediumLargeTitleContainer(e))},e.prototype.updateSizeAndPositionForSmallTitleContainer=function(e){var t=$(".second-row-top-bar-section.top-bar-section.pull-left"),n=$(".second-row-top-bar-section.top-bar-section.pull-right"),o=t.find("li:first-of-type"),r=o.offset().left+o.width()+i.a.getMarginRight(o),a=this.getTextReferentLeftPosition(),s=n.offset().left,l=Math.max(r,a),c=s-l-10;e.css("left",l==a?Math.abs(a-r)+"px":"0px"),e.width(c);var d=e.find(".free-preview-icon-container"),u=c-("none"==d.css("display")?0:d.width());e.find(".title-label").width(u)},e.prototype.updateSizeAndPositionForMediumLargeTitleContainer=function(e){$(".top-bar-section.pull-left:not(.second-row-top-bar-section)");var t=$(".top-bar-section.pull-right:not(.second-row-top-bar-section)"),n=e.prev(),o=n.offset()||{left:0},r=t.offset()||{left:0},a=o.left+n.width()+i.a.getMarginRight(n),s=r.left,l=this.getTextReferentLeftPosition(),c=Math.max(a,l),d=$(document.querySelector("#book-main-content-container p")||document.querySelector("#book-main-content-container")).width(),u=Math.min(s-c-10,d);e.css("left",c==l?Math.abs(l-a)+"px":"0px"),e.width(u),e.find(".title-label").width(u-1.2*e.find(".free-preview-icon-container").width())},e.prototype.getTextReferentLeftPosition=function(){if(null==this.$headerElements)return 0;var e=this.$headerElements.first().find("h1, h2, h3, h4, h5"),t=parseInt(e.css("padding-left"));return null==e||0==e.length?0:e.offset().left+(Number.isNaN(t)?0:t)},e.prototype.getTrackPointPosition=function(){return(this.$trackPointColumn.offset()||{left:0}).left},e.prototype.getTopMostReadableElement=function(){return null==this.$headerElements||0==this.$headerElements.length?$(null):this.getTopReadableElement(this.$headerElements,b.scrollTop()+o.a.getTopNavBarHeight())},e.prototype.trackScrolling=function(){var e=this;clearTimeout(this.urlUpdateTimerID),this.urlUpdateTimerID=c.a.setTimeout(function(){var t=e.getTopMostReadableElement();window.history.replaceState&&e.rewriteUrlOnScroll&&window.history.replaceState({},"livebook - "+e.book.title+" - "+e.bookElement.title,a.a.formLink(e.book,e.bookElement,t.attr("refid"))),k.trigger("readableElementScrolled",[t.attr("refid")])},1e3)},e.prototype.getLastHeader=function(e){return null==this.$headerElements?$(null):this.$headerElements.filter(function(t,n){return o.a.isHeadingVisible($(n),e)}).last()},e.prototype.disable=function(){this.hide(),b.off("scroll",this.render),b.off("scrollstop",this.trackScrolling),b.off("resizestop",this.render)},e.prototype.enable=function(){this.show(),b.on("scroll",this.render),b.on("scrollstop",this.trackScrolling),b.on("resizestop",this.render)},e.prototype.show=function(){this.$sectionNavigationContainer.removeClass("hidden")},e.prototype.hide=function(){this.$sectionNavigationContainer.addClass("hidden")},e.prototype.handleSlideMenuOpened=function(e,t){this.updateHeaderTitleContainersPositions(),null==t||0==t.length||t.is("#toc-index-menu")||this.hide()},e.prototype.handleSlideMenuClosed=function(){var e=this;c.a.setTimeout(function(){d.a.isSideMenuOpened||(e.show(),e.render())},500)},e.prototype.handleUnlockSuccess=function(e,t){var n=this;t!=f.a.FreePreview&&"FreePreview"!=t&&c.a.setTimeout(function(){n.fillSectionNavigationContainer(),n.render()},50)},e.prototype.handleHeaderItemTextClick=function(e){var t=$(e.target).closest(".header-item").attr("data-refid");s.a.scrollToElement(document.querySelector("[refid='"+t+"']"))},e.prototype.handleHeaderItemUnlockClick=function(e){var t=$(e.target).closest(".header-item").attr("data-refid"),n=document.querySelector("[refid='"+t+"']");if(null!=n){var o=$(n);m.a.showModalForCurrentBookElementPurchases(o)}},e}();t.a=new v},378:function(e,t,n){"use strict";var o=n(14),i=function(){function e(){}return e.prototype.highlight=function(e,t,n,i,r){if(void 0===i&&(i=""),void 0===r&&(r=""),e){var a=$(e);a.is(".fragment-played")&&(i="");var s=o.a.getAllDescendantTextNodes(e),l=o.a.createTextNodeTextRanges(s),c=this.getStartIndex(l.value,t,r),d=c+t.length;if(-1!==c||(d=(c=l.value.indexOf(t.replace("<","&lt;").replace(">","&gt;")))+t.length,-1!=c)){var u=o.a.splitRanges(l,c,d);if(this.markVisibleParentNodeElements(e,u.followingRanges,i),this.liftWordsInMatchingRanges(u.matchingRanges,c,d,n,i),this.liftWordsInFollowingRanges(u.followingRanges,i),""!=i.trim()){var h="."+i.trim().replace(/\s+/,".");a.find(h).each(function(e,t){var n=$(t.nextSibling);n.is("img")&&n.addClass(i)})}}}},e.prototype.liftWordsInMatchingRanges=function(e,t,n,i,r){for(var a=0,s=e.length;a<s;a++){var l=e[a],c=l.textNode.nodeValue;if(0==a){var d=t-l.start,u=n-l.start,h=c.substring(0,d),p=c.substring(d,u),m=c.substring(u,l.end);$(l.textNode).replaceWith(h+o.a.wrapToHtmlElement("span",{class:i},p)+(""!=m&&""!=r?o.a.wrapToHtmlElement("span",{class:r},m):m))}else if(a==s-1){var g=n-l.start;p=c.substring(0,g),m=c.substring(g,c.length);$(l.textNode).replaceWith(o.a.wrapToHtmlElement("span",{class:i},p)+(""!=m&&""!=r?o.a.wrapToHtmlElement("span",{class:r},m):m))}else $(l.textNode).replaceWith(o.a.wrapToHtmlElement("span",{class:i},c))}},e.prototype.liftWordsInFollowingRanges=function(e,t){if(t)for(var n=0;n<e.length;n++){var i=e[n];i.textNode.nodeValue&&i.textNode.nodeValue.trim()&&$(i.textNode).replaceWith(o.a.wrapToHtmlElement("span",{class:t},i.textNode.nodeValue))}},e.prototype.markVisibleParentNodeElements=function(e,t,n){if(e&&t&&0!=t.length&&n)for(var o=0;o<t.length;o++){var i=t[o].textNode;"KBD"==i.parentNode.nodeName&&$(i.parentNode).addClass(n)}},e.prototype.getAllIndexesOf=function(e,t){for(var n,o=0,i=[];(n=e.indexOf(t,o))>-1;)i.push(n),o=n+t.length;return i},e.prototype.getStartIndex=function(e,t,n){var o=this.getAllIndexesOf(e,t);if(0==o.length)return-1;if(1==o.length)return o[0];if(!n)return o[0];var i=e.indexOf(n);if(-1==i)return o[0];i+=n.length;for(var r=0;r<o.length;r++)if(o[r]>=i)return o[r];return o[0]},e}();t.a=new i},379:function(e,t,n){"use strict";var o=n(2),i=function(){function e(e,t){var n=this;this.currentIndex=0,this.$mainContainer=e,this.afterTabSwitchCallback=t,o.a.onDescendantEventWithCooldown(this.$mainContainer,"click touchstart",".tab-title",function(e){var t=n.$mainContainer.find(".tab-title").index(e.currentTarget);n.selectTab(t),n.afterTabSwitchCallback&&n.afterTabSwitchCallback(t)}),this.selectTab(this.currentIndex)}return e.prototype.selectTab=function(e){var t=this.$mainContainer.find(".tab-title"),n=this.$mainContainer.find(".tab-container");t.removeClass("selected"),n.removeClass("selected"),t.eq(e).length?t.eq(e).addClass("selected"):t.eq(0).addClass("selected"),n.eq(e).length?(n.eq(e).addClass("selected"),this.currentIndex=e):(n.eq(0).addClass("selected"),this.currentIndex=0)},e.prototype.getCurrentlySelectedTabIndex=function(){return this.currentIndex},e}();t.a=i},380:function(e,t,n){"use strict";var o=n(0),i=n(6),r=n(23),a=n(110),s=n(12),l=function(){function e(){}return e.prototype.getTokenCountInfo=function(e){var t=this;return void 0===e&&(e=!1),e||null==this.currentTokenCountInfo?e||null==this.currentTokenCountInfoPromise?this.currentTokenCountInfoPromise=new Promise(function(n,o){i.a.isLoggedIn(e).then(function(e){e.loggedIn&&e.userDetails.tokenInfo?(t.currentTokenCountInfo=e.userDetails.tokenInfo,n(e.userDetails.tokenInfo)):(t.currentTokenCountInfoPromise=null,o("No token count info"))}).catch(function(e){return o(e)})}):this.currentTokenCountInfoPromise:Promise.resolve(this.currentTokenCountInfo)},e.prototype.setTokenCountInfo=function(e){this.currentTokenCountInfo=e,r.a.setTokenInfo(e)},e.prototype.getTokenLedgerItems=function(e){var t=this;return void 0===e&&(e=!1),i.a.isCurrentlyLoggedIn()?e&&this.lastTokenLedger?Promise.resolve(this.lastTokenLedger):new Promise(function(e,n){o.a.getFromOurBackend(o.a.getAbsoluteUrl("api/token/getTokenLedger"),function(n){var o=n.map(function(e){return{date:s.a.getDateFromString(e.date),quantity:e.quantity,description:e.description,notes:e.notes,link:e.link,isFreeTokensRedemption:"COMPED"==e.type}});t.lastTokenLedger=o,e(o)},function(e){n("Error getting token ledger")})}):Promise.resolve([])},e.prototype.getTokenCashoutInfo=function(){var e=this;return new Promise(function(t,n){o.a.getFromOurBackend(o.a.getAbsoluteUrl("api/token/getCashoutInfo"),function(n){n&&n.tokenCount&&(e.setTokenCountInfo(n.tokenCount),a.a.refreshTokenStateInToolbar(n.tokenCount)),t(n)},function(e){return n("Error getting token ledger")})})},e.prototype.cashout=function(){var e=this;return new Promise(function(t,n){o.a.getFromOurBackend(o.a.getAbsoluteUrl("api/token/cashout"),function(n){n&&n.tokenCount&&(e.setTokenCountInfo(n.tokenCount),a.a.refreshTokenStateInToolbar(n.tokenCount)),t(n)},function(e){return n("Error performing token cashout")})})},e}();t.a=new l},389:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=function(){function e(e,t,n,o,i,r,a,s,l){this.id=e,this.bookShortName=t,this.bookElementShortName=n,this.bookElementOrdinal=o,this.meapVersion=i,this.color=r,this.highlightedParagraphs=a,this.timestamp=s,this.offset=l}return e.fromJSON=function(t){return new e(t.id,t.bookShortName,t.bookElementShortName,t.bookElementOrdinal,t.meapVersion,t.color,t.highlightedParagraphs.map(function(e){return i.fromJSON(e)}),t.timeStamp||t.timeCreated,t.offset||0)},e}();t.b=o;var i=function(){function e(e,t,n){this.ordinal=e,this.hash=t,this.selectedText=n}return e.fromJSON=function(t){return new e(t.ordinal,t.hash,t.selectedText)},e}()},390:function(e,t,n){"use strict";var o=n(113),i=n(115),r=n(389),a=n(0),s=function(){function e(){}return e.prototype.fetch=function(e){var t=this;return this.dataPromise&&this.previousRequestBackground&&this.previousRequestBackground.bookShortName===e.book.shortName?this.previousRequestBackground.bookElementShortName===e.shortName?this.dataPromise:(this.previousRequestBackground={bookShortName:e.book.shortName,bookElementShortName:e.shortName},this.dataPromise=new Promise(function(n,o){t.dataPromise.then(function(o){t.notesData=o.notes,t.notesData.bookElementNotes=o.notes.bookNotes.filter(function(t){return t.bookElementShortName===e.shortName}),t.bookmarksData=o.bookmarks,t.bookmarksData.bookElementBookmarks=o.bookmarks.bookBookmarks.filter(function(t){return t.bookElementShortName===e.shortName}),t.highlightsData=o.highlights,t.highlightsData.bookElementHighlights=o.highlights.bookHighlights.filter(function(t){return t.bookElementShortName===e.shortName}),n({notes:t.notesData,bookmarks:t.bookmarksData,highlights:t.highlightsData})}).catch(function(e){console.log("Couldn't load text addons"),o(e)})})):(this.previousRequestBackground={bookShortName:e.book.shortName,bookElementShortName:e.shortName},this.dataPromise=new Promise(function(n,s){a.a.getFromOurBackend(a.a.getAbsoluteUrl("api/textAddon/fetchTextAddonsForUsersBook"),function(a){var s=a.notes.map(function(e){return o.a.fromJSON(e)});t.notesData={bookNotes:s,bookElementNotes:s.filter(function(t){return t.bookElementShortName===e.shortName})};var l=a.bookmarks.map(function(e){return i.a.fromJSON(e)});t.bookmarksData={bookBookmarks:l,bookElementBookmarks:l.filter(function(t){return t.bookElementShortName===e.shortName})};var c=a.highlights.map(function(e){return r.b.fromJSON(e)});t.highlightsData={bookHighlights:c,bookElementHighlights:c.filter(function(t){return t.bookElementShortName===e.shortName})},n({notes:t.notesData,bookmarks:t.bookmarksData,highlights:t.highlightsData})},function(e){return n({notes:{bookNotes:[],bookElementNotes:[]},bookmarks:{bookBookmarks:[],bookElementBookmarks:[]},highlights:{bookHighlights:[],bookElementHighlights:[]}})},{bookShortName:e.book.shortName})}))},e}();t.a=new s},416:function(e,t,n){"use strict";var o=n(563),i=n(426),r=n(2),a=n(17),s=n(14),l=n(417),c=n(6),d=n(86),u=n(309),h=$(window),p=$(document),m=function(){function e(){var e=this;this.bookmarkedTextLimit=80,this.$textMarginIconsContainer=$(null),this.paragraphBubbleTemplate=' <div class="paragraph-bubble" style="display: none">\n    <div aria-haspopup="true" class="text-margin-icon-bubble bookmark-bubble" title="bookmark"><i class="fa fa-bookmark-o"></i></div>\n    <div aria-haspopup="true" class="text-margin-icon-bubble note-bubble" title="open notes"><i class="fa fa-pencil-square-o"></i><span class="note-count-container"></span></div>\n    <div aria-haspopup="true" class="text-margin-icon-bubble forums-bubble" title="open discussion"><i class="fa fa-comments-o" aria-hidden="true"></i><span class="comment-count-container"></span></div>\n    <div class="text-margin-icon-bubble editor-bubble"><i class="fa fa-pencil-square fa-2x"></i></div>\n</div>',this.$paragraphs=$(null),this.handleMouseMoveOnParagraph=this.handleMouseMoveOnParagraph.bind(this),this.hideSocialIconsContainer=this.hideSocialIconsContainer.bind(this),this.repositionParagraphBubbles=this.repositionParagraphBubbles.bind(this),this.handleLayoutModified=this.handleLayoutModified.bind(this),this.handleParagraphMouseMove=this.handleParagraphMouseMove.bind(this),r.a.onDescendantEventWithCooldown(p,"click",".bookmark-bubble",function(t){e.handleBookmarkBubbleClick(t.currentTarget.parentElement)}),r.a.onDescendantEventWithCooldown(p,"click",".note-bubble",function(t){e.handleNoteBubbleClick(t.currentTarget.parentElement)}),r.a.onDescendantEventWithCooldown(p,"click",".forums-bubble",function(t){e.handleForumBubbleClick(t.currentTarget.parentElement)}),p.on("requestShowNoteBubble",function(t,n){return e.showNoteBubble(n)}),p.on("requestHideNoteBubble",function(t,n){return e.hideNoteBubble(n)}),p.on("paragraphButtonsSetForumCount",function(t,n,o){return e.setForumCount(n,o)}),p.on("requestSelectForumsBubble",function(t,n){return e.selectForumsBubble(n)}),p.on("requestDeselectForumsBubble",function(t,n){return e.deselectForumsBubble(n)})}return e.prototype.initialize=function(e,t,n){var r=this;void 0===n&&(n=!1),this.clean(),this.book=e,this.bookElement=t,this.isInEditorMode=n,e&&(this.paragraphs=Array.prototype.slice.call(document.querySelectorAll("[refid]")),this.$textMarginIconsContainer=$("#text-margin-icons-container"),this.$textMarginIconsContainer.toggleClass("editor-mode",n),this.$textMarginIconsContainer.toggleClass("review-mode",t.reviewVersion>0),this.$paragraphs=$(this.paragraphs),this.$paragraphs.on("mouseenter",this.handleParagraphMouseMove),h.on("resizestart",this.hideSocialIconsContainer),h.on("orientationchange resizestop",this.repositionParagraphBubbles),p.on("contentFullyConstructed",this.repositionParagraphBubbles),p.on("textLayoutModified collapsiblePanelOpening",this.handleLayoutModified),this.createParagraphBubbles(),c.a.isCurrentlyLoggedIn()&&(o.a.bookmarksService.fetch(this.bookElement).then(function(e){r.updateBookmarkData(e.bookElementBookmarks)}),i.a.notesService.fetch(this.bookElement).then(function(e){r.updateNotesData(e.bookElementNotes)})))},e.prototype.clean=function(){this.hideSocialIconsContainer(),this.book=null,this.bookElement=null,$(".text-margin-icon-bubble").off().remove(),this.$textMarginIconsContainer.off(),this.$textMarginIconsContainer=$(null),this.$paragraphs.off("mouseenter",this.handleParagraphMouseMove),this.paragraphBubbles=[],this.currentHoveredParagraph=null,this.paragraphs=null,this.$paragraphs=$(null),h.off("resizestart",this.hideSocialIconsContainer),h.off("orientationchange resizestop",this.repositionParagraphBubbles),p.off("contentFullyConstructed",this.repositionParagraphBubbles),p.off("textLayoutModified collapsiblePanelOpening",this.handleLayoutModified)},e.prototype.createParagraphBubbles=function(){var e=this;this.$textMarginIconsContainer.css("opacity",0),this.paragraphBubbles=[];for(var t=0;t<this.paragraphs.length;t++){var n=this.paragraphs[t],o=$(this.paragraphBubbleTemplate).get(0);o.paragraph=n,n.paragraphBubble=o,this.paragraphBubbles.push(o)}var i=$(this.paragraphBubbles);this.$textMarginIconsContainer.append(i),setTimeout(function(){return e.repositionParagraphBubbles()},16)},e.prototype.handleParagraphMouseMove=function(e){var t=this;clearTimeout(this.hoverTimerId);var n=$(e.currentTarget);this.hoverTimerId=r.a.setTimeout(function(){s.a.isHover(n)&&t.hoverOnParagraph(e)},350)},e.prototype.hoverOnParagraph=function(e){var t=e.currentTarget;if(null!=t.paragraphBubble){var n=$(t);if(this.currentHoveredParagraph&&this.currentHoveredParagraph.paragraphBubble){var o=this.currentHoveredParagraph.paragraphBubble;t.paragraphBubble==o||o.hasAttribute("data-bookmark-active")||o.hasAttribute("data-notes-active")||o.hasAttribute("data-forums-active")||$(o).hide()}n.is(".scrambled, .temp-unscrambled")||($(this.currentHoveredParagraph).off("mousemove",this.handleMouseMoveOnParagraph),this.isOnElementRightHandSide(n,e.pageX)||0!==n.find("h1, h2, h3, h4").length?(this.showParagraphBubble(t.paragraphBubble),this.currentHoveredParagraph=t):n.on("mousemove",this.handleMouseMoveOnParagraph))}},e.prototype.handleMouseMoveOnParagraph=function(e){var t=e.currentTarget,n=$(t);this.isOnElementRightHandSide(n,e.pageX)&&(this.showParagraphBubble(t.paragraphBubble),this.currentHoveredParagraph=t,n.off("mousemove",this.handleMouseMoveOnParagraph))},e.prototype.handleBookmarkBubbleClick=function(e){c.a.isCurrentlyLoggedIn()?(e.hasAttribute("data-bookmark-active")?e.removeAttribute("data-bookmark-active"):e.setAttribute("data-bookmark-active","true"),this.visuallyMarkBookmark(e),this.syncBookmark(e),$(e.paragraph).toggleClass("has-bookmark",e.hasAttribute("data-bookmark-active"))):u.LoginManager.requestLogin("sign in to add a bookmark","bookmark")},e.prototype.visuallyMarkBookmark=function(e,t){if(e){var n=e.hasAttribute("data-bookmark-active"),o=$(e).find(".bookmark-bubble");o.toggleClass("selected",n),o.find(".fa").toggleClass("fa-bookmark",n).toggleClass("fa-bookmark-o",!n),o.attr("title",n?"remove bookmark":"bookmark"),t&&o.attr("data-id",t),$(e.paragraph).toggleClass("has-bookmark",n)}},e.prototype.syncBookmark=function(e){if(e&&e.paragraph){var t=$(e.paragraph);e.hasAttribute("data-bookmark-active")?o.a.bookmarksService.addBookmark(this.bookElement,t.attr("refid"),t.attr("data-hash"),this.cutText(t.text()),this.getSection(t)).then(function(t){$(e).find(".bookmark-bubble").attr("data-id",t),p.trigger("bookmarkAdded")}):o.a.bookmarksService.removeBookmark(this.bookElement,t.attr("refid"))}},e.prototype.updateBookmarkData=function(e){if(e){for(var t=[],n=0,o=e;n<o.length;n++){var i=o[n],r=i.contentHash?document.querySelector("[data-hash='"+i.contentHash+"']"):document.getElementById(i.contentID);r&&r.paragraphBubble&&(r.paragraphBubble.setAttribute("data-bookmark-active","true"),this.visuallyMarkBookmark(r.paragraphBubble,i.id),t.push(r.paragraphBubble))}$(t).show()}},e.prototype.updateNotesData=function(e){if(e){for(var t={},n=0;n<e.length;n++){var o=e[n],i=t[o.contentID]||(o.contentHash?document.querySelector("[data-hash='"+o.contentHash+"']"):document.getElementById(o.contentID));if(i){t[o.contentID]=i;var r=l.a.getNotes(i.paragraphBubble);r&&r.push(o)}}for(var a in t)if(t.hasOwnProperty(a)){var s=t[a].paragraphBubble,c=$(s);this.updateNotesButtonState(s),""!=c.find(".note-count-container").text()&&c.find("note-bubble").addClass("bubble-active")}}},e.prototype.handleNoteBubbleClick=function(e){var t=this;c.a.isCurrentlyLoggedIn()?this.currentParagraphBubble==e?(l.a.closeNotesMenu(),this.unbindCurrentNoteBubble()):l.a.closeNotesMenu(function(){t.currentParagraphBubble=e,l.a.showNotesMenuWithShift($(e))}):u.LoginManager.requestLogin("sign in to add a personal note","note")},e.prototype.updateNotesButtonState=function(e){var t=l.a.getNotes(e),n=t?t.length:0,o=$(e);o.find(".note-count-container").text(0!=n?n:""),0!=n?o.attr("data-notes-active","true"):o.removeAttr("data-notes-active"),0!=n||o.is(".selected")?this.showNoteBubble(e):this.hideNoteBubble(e)},e.prototype.showNoteBubble=function(e){e&&($(e).show(),e.paragraph&&$(e.paragraph).addClass("matching-text-bubble-shown"))},e.prototype.hideNoteBubble=function(e){e&&($(e).hide(),e.paragraph&&$(e.paragraph).removeClass("matching-text-bubble-shown"))},e.prototype.isOnElementRightHandSide=function(e,t){return(t-e.offset().left)/e.width()>.7},e.prototype.showParagraphBubble=function(e){if(e){var t=$(e),n=parseInt(t.css("top")),o=parseInt(this.calculateParagraphBubbleTopPosition($(e.paragraph))+"");Math.abs(n-o)>10&&this.repositionParagraphBubbles(),t.show()}},e.prototype.repositionParagraphBubbles=function(){var e=[];if(this.showSocialIconsContainer(),this.paragraphBubbles&&0!==this.paragraphBubbles.length){for(var t=0;t<this.paragraphBubbles.length;t++)e.push(this.calculateParagraphBubbleTopPosition($(this.paragraphBubbles[t].paragraph)));for(t=0;t<this.paragraphBubbles.length;t++)$(this.paragraphBubbles[t]).css("top",e[t]-0)}},e.prototype.calculateParagraphBubbleTopPosition=function(e){var t=e.position().top,n=e.height(),o=parseInt(e.css("line-height"));return t+=n>=2.8*o?1.8*o:o},e.prototype.hideSocialIconsContainer=function(){this.$textMarginIconsContainer&&this.$textMarginIconsContainer.css("opacity",0)},e.prototype.showSocialIconsContainer=function(){this.$textMarginIconsContainer&&this.$textMarginIconsContainer.css("opacity",1)},e.prototype.handleLayoutModified=function(){var e=this;this.hideSocialIconsContainer(),r.a.setTimeout(function(t){return e.repositionParagraphBubbles()},600)},e.prototype.unbindCurrentNoteBubble=function(){this.currentParagraphBubble&&$(this.currentParagraphBubble.paragraph).removeClass("matching-note-hovered being-annotated"),this.currentParagraphBubble=null},e.prototype.updateCurrentNotesCount=function(){this.updateNotesButtonState(this.currentParagraphBubble)},e.prototype.removeNoteBubbleNote=function(e,t){for(var n=l.a.getNotes(e),o=!1,i=0;i<n.length;i++)if(n[i].id==t){o=!0,n.splice(i,1);break}o&&this.updateNotesButtonState(e)},e.prototype.selectNoteBubble=function(e){if(e){var t=$(e);t.attr("data-notes-active","true"),t.addClass("selected"),t.find(".note-bubble").addClass("bubble-active"),$(".being-annotated").removeClass("being-annotated"),$(e.paragraph).addClass("being-annotated")}},e.prototype.deselectNoteBubble=function(e){if(e){var t=$(e);t.removeClass("selected"),""==t.find(".note-count-container").text()&&(t.find(".note-bubble").remove("bubble-active"),t.removeAttr("data-notes-active")),$(".being-annotated").removeClass("being-annotated")}},e.prototype.selectForumsBubble=function(e){if(e){var t=$(e);t.addClass("selected"),t.find(".forums-bubble").addClass("bubble-active"),t.attr("data-forums-active","true"),$(".being-annotated").removeClass("being-annotated"),$(e.paragraph).addClass("being-annotated"),$(e.paragraph).addClass("matching-text-bubble-shown")}},e.prototype.deselectForumsBubble=function(e){if(e){var t=$(e);t.removeClass("selected"),t.find(".forums-bubble").removeClass("bubble-active"),t.find(".comment-count-container").text().trim()||t.removeAttr("data-forums-active"),$(".being-annotated").removeClass("being-annotated"),$(e.paragraph).removeClass("matching-text-bubble-shown")}},e.prototype.setForumCount=function(e,t){if(e){var n=$(e);n.find(".comment-count-container").text(t||""),t?(n.attr("data-forums-active","true"),n.show()):n.removeAttr("data-forums-active")}},e.prototype.handleForumBubbleClick=function(e){d.a.requestOpenParagraphSideMenu(e)},e.prototype.getSection=function(e){var t=a.a.figureOutSectionOrSubsectionFromRefId(e.attr("refid"));if(t)return t;var n=this.bookElement.shortName.match(/(part\s+\d)|\w+\s+(\d+)/i);if(n){if(n[1])return n[1];if(n[2])return n[2]}return this.book.shortName},e.prototype.cutText=function(e){return e.length<this.bookmarkedTextLimit?e:e.substring(0,this.bookmarkedTextLimit)+"..."},e}();t.a=new m},417:function(e,t,n){"use strict";var o=n(113),i=n(2),r=n(426),a=n(5),s=n(67),l=n(17),c=n(418),d=n(534),u=n(416),h=n(111),p=n(14),m=n(6),g=n(23),f=$(window),b=$(document),k=function(){function e(){this.handleEditNoteClickTouch=this.handleEditNoteClickTouch.bind(this),this.handleDeleteNoteClickTouch=this.handleDeleteNoteClickTouch.bind(this),this.handleSaveNoteClickTouch=this.handleSaveNoteClickTouch.bind(this),this.handleCloseNoteClickTouch=this.handleCloseNoteClickTouch.bind(this),this.handleNoteDblClick=this.handleNoteDblClick.bind(this),this.handleNoteMouseEnter=this.handleNoteMouseEnter.bind(this),this.handleNoteMouseLeave=this.handleNoteMouseLeave.bind(this),this.handleDocumentClick=this.handleDocumentClick.bind(this),this.handleContentFullyConstructed=this.handleContentFullyConstructed.bind(this),this.handleOpenNoteRequested=this.handleOpenNoteRequested.bind(this),this.handleOrientationChange=this.handleOrientationChange.bind(this),this.handleAddNoteButtonClick=this.handleAddNoteButtonClick.bind(this),this.handleNoteInputBoxKeyDown=this.handleNoteInputBoxKeyDown.bind(this)}return e.prototype.initialize=function(e,t){this.clean(),e&&m.a.isCurrentlyLoggedIn()&&(this.book=e,this.bookElement=t,this.$notesMenu=$("#notes-menu"),this.$notesList=this.$notesMenu.find(".notes-list"),this.$noteInputBox=$("#note-input-box"),this.$addNoteButton=$("#add-note-button"),i.a.onDescendantEventWithCooldown(this.$notesMenu,"click touchstart",".note-edit-icon",this.handleEditNoteClickTouch),i.a.onDescendantEventWithCooldown(this.$notesMenu,"click touchstart",".note-delete-icon",this.handleDeleteNoteClickTouch),i.a.onDescendantEventWithCooldown(this.$notesMenu,"click touchstart",".note-input-save",this.handleSaveNoteClickTouch),i.a.onDescendantEventWithCooldown(this.$notesMenu,"click touchstart",".note-close-icon, .note-input-cancel",this.handleCloseNoteClickTouch),this.$notesMenu.on("dblclick",".note-content-container",this.handleNoteDblClick),this.$notesMenu.on("mouseenter",".note-item-container",this.handleNoteMouseEnter),this.$notesMenu.on("mouseleave",this.handleNoteMouseLeave),b.on("contentFullyConstructed",this.handleContentFullyConstructed),b.on("noteOpenRequested",this.handleOpenNoteRequested),b.on("mousedown",this.handleDocumentClick),f.on("orientationchange",this.handleOrientationChange),i.a.onEventWithCooldown(this.$addNoteButton,"click touchstart",this.handleAddNoteButtonClick),this.$noteInputBox.on("keydown",this.handleNoteInputBoxKeyDown),this.$notesMenu.find(".notes-menu-heading").text(this.bookElement.reviewVersion>0?"review notes":"notes"))},e.prototype.clean=function(){this.book=null,this.bookElement=null},e.prototype.handleNoteInputBoxKeyDown=function(e){(e.ctrlKey||e.metaKey)&&13==e.keyCode&&this.addNote(this.$noteInputBox.val().trim())},e.prototype.handleAddNoteButtonClick=function(){this.addNote(this.$noteInputBox.val().trim())},e.prototype.handleOrientationChange=function(){this.closeNotesMenu()},e.prototype.handleOpenNoteRequested=function(e,t){this.openNotes(t)},e.prototype.handleContentFullyConstructed=function(){this.openCurrentNote()},e.prototype.handleNoteDblClick=function(e){this.handleEnterEditNote(e)},e.prototype.handleEditNoteClickTouch=function(e){this.handleEnterEditNote(e)},e.prototype.handleDeleteNoteClickTouch=function(e){this.handleDeleteNoteClick(e)},e.prototype.handleSaveNoteClickTouch=function(e){this.handleLeaveEditNoteAndSave(e)},e.prototype.handleCloseNoteClickTouch=function(e){this.handleLeaveEditNoteWithoutSave(e)},e.prototype.handleDocumentClick=function(e){var t=$(e.target);this.$notesMenu.is(t)||0!=this.$notesMenu.find(t).length||0!=t.parents(".tooltip, .text-margin-icon-bubble, #text-addons-menu").length||t.is(".text-margin-icon-bubble")||this.closeNotesMenu()},e.prototype.openCurrentNote=function(){},e.prototype.openNotes=function(e,t){if(e){try{var n=document.getElementById(e);if(n&&b.trigger("slideMenuCloseRequested"),n&&n.paragraphBubble&&u.a.currentParagraphBubble!=n.paragraphBubble)return a.a.isElementVisible(n)?(u.a.handleNoteBubbleClick(n.paragraphBubble),void(t&&t())):void h.a.scrollToElement(n,function(){u.a.handleNoteBubbleClick(n.paragraphBubble),t&&t()})}catch(e){}t&&t()}else t&&t()},e.prototype.addNote=function(e){var t=this;if(!this.isAddingNoteDisabled&&(e=(e||"").trim(),u.a.currentParagraphBubble&&e&&!(e.length<1))){var n=u.a.currentParagraphBubble.paragraph,i=$(n),a=$(n).attr("refid"),l=d.a.currentTextSelection||"",c=this.getSection(i);this.isAddingNoteDisabled=!0,this.$addNoteButton.append("<i class='fa fa-spinner fa-spin'/>");var h=i.attr("data-hash");r.a.notesService.addNote(this.bookElement,a,h,l,e,c,this.bookElement.meapVersion,this.bookElement.reviewVersion).then(function(n){t.isAddingNoteDisabled=!1,t.$addNoteButton.find(".fa").remove();var i=t.createNoteElement(e),r=t.getNotes(u.a.currentParagraphBubble);i.attr("noteID",n),t.$notesList.append(i),r.push(new o.a(n,t.bookElement.shortName,t.bookElement.ordinal,a,h,l,e,c,Date.now(),t.bookElement.meapVersion,t.bookElement.reviewVersion)),u.a.updateCurrentNotesCount(),t.$noteInputBox.val(""),b.trigger("noteAdded")}).catch(function(e){t.isAddingNoteDisabled=!1,t.$addNoteButton.find(".fa").remove(),s.a.showTemporaryNotification("Error when trying to store note. Please try later")})}},e.prototype.handleEnterEditNote=function(e){var t=$(e.currentTarget).parents(".note-item-container"),n=t.find(".note-input-container"),o=t.find(".note-content-container");o.is(".note-content-container-can-edit")&&(n.text(o.text()),n.val(o.text()),t.addClass("edit-mode"))},e.prototype.handleDeleteNoteClick=function(e){var t=$(e.currentTarget).parents(".note-item-container"),n=t.find(".note-content-container"),o=t.attr("noteID");n.is(".waiting-for-deletion")||(n.addClass("waiting-for-deletion"),this.removeNote(o,function(){u.a.removeNoteBubbleNote(u.a.currentParagraphBubble,o),t.remove()},function(){n.removeClass("waiting-for-deletion"),s.a.showTemporaryNotification("Error when deleting note, try again later")}))},e.prototype.handleLeaveEditNoteAndSave=function(e){var t=$(e.currentTarget).parents(".note-item-container"),n=t.find(".note-input-container"),o=t.find(".note-content-container"),i=t.attr("noteID");t.removeClass("edit-mode");var a=n.val();o.text(a);var s=this.getCurrentNoteWithID(i);null!=s&&(s.noteText=a),r.a.notesService.editNote(this.bookElement,parseInt(i),a)},e.prototype.handleLeaveEditNoteWithoutSave=function(e){$(e.currentTarget).parents(".note-item-container").removeClass("edit-mode")},e.prototype.showNotesMenuWithShift=function(e){var t=this;jQuery.expr.filters.hidden(e[0])&&u.a.showNoteBubble(e.get(0)),u.a.selectNoteBubble(e.get(0)),this.updateNotesList(),b.trigger("notesMenuShowStart"),p.a.showTextSideMenu(this.$notesMenu,e,function(){t.$noteInputBox.focus()})},e.prototype.closeNotesMenu=function(e){var t=u.a.currentParagraphBubble;jQuery.expr.filters.visible(this.$notesMenu[0])?this.animateClosingCommentsMenu(t,e):(u.a.deselectNoteBubble(t),u.a.updateNotesButtonState(t),this.$notesMenu.removeClass("open").addClass("closed"),u.a.unbindCurrentNoteBubble(),e&&e())},e.prototype.animateClosingCommentsMenu=function(e,t){p.a.closeTextSideMenu(this.$notesMenu,function(){u.a.deselectNoteBubble(e),u.a.updateNotesButtonState(e),u.a.unbindCurrentNoteBubble(),t&&t()})},e.prototype.updateNotesList=function(){var e=this.getNotes(u.a.currentParagraphBubble);if(this.$notesList.empty(),e)for(var t=0;t<e.length;t++){var n=e[t],o=this.createNoteElement(n.noteText,n.user,n.userId);o.attr("noteID",n.id),this.$notesList.append(o)}},e.prototype.createNoteElement=function(e,t,n){return void 0===t&&(t=""),void 0===n&&(n=void 0),$(Mustache.render(v,{note:e,user:t,canEdit:null==n||n==g.a.getUserId()}))},e.prototype.getCurrentNoteWithID=function(e){var t=this.getNotes(u.a.currentParagraphBubble);if(!t)return null;for(var n=0;n<t.length;n++)if(t[n].id==e)return t[n];return null},e.prototype.getNotes=function(e){if(!e)return[];var t=e.paragraph;return t?(t.notes||(t.notes=[]),t.notes):[]},e.prototype.removeNote=function(e,t,n){e&&r.a.notesService.removeNote(parseInt(e)).then(function(e){return e?t():n()}).catch(function(e){return n()})},e.prototype.handleNoteMouseEnter=function(e){var t=this.getCurrentNoteWithID($(e.currentTarget).attr("noteID"));if(t){var n=$(u.a.currentParagraphBubble.paragraph);c.a.deleteCurrentNoteHighlight(),n.removeClass("matching-note-hovered"),t.annotatedText?c.a.highlightNoteSelection(n,t.annotatedText):n.addClass("matching-note-hovered")}},e.prototype.handleNoteMouseLeave=function(){c.a.deleteCurrentNoteHighlight(),u.a.currentParagraphBubble&&$(u.a.currentParagraphBubble.paragraph).removeClass("matching-note-hovered")},e.prototype.annotate=function(e){var t=this;if(e&&e.paragraphBubble){if(u.a.currentParagraphBubble!=e.paragraphBubble)return u.a.currentParagraphBubble?void this.closeNotesMenu(function(){u.a.currentParagraphBubble=e.paragraphBubble,t.showNotesMenuWithShift($(e.paragraphBubble))}):(u.a.currentParagraphBubble=e.paragraphBubble,void this.showNotesMenuWithShift($(e.paragraphBubble)));this.$noteInputBox.focus()}},e.prototype.getSection=function(e){var t=l.a.figureOutSectionOrSubsectionFromRefId(e.attr("refid"));if(t)return t;var n=this.bookElement.shortName.match(/(part\s+\d)|\w+\s+(\d+)/i);if(n){if(n[1])return n[1];if(n[2])return n[2]}return this.book.shortName},e}();t.a=new k;var v='<li class="note-item-container">\n    <div class="note-content-container {{#canEdit}}note-content-container-can-edit{{/canEdit}}">{{#user}}<span class="note-item-username-container">{{user}}</span>: {{/user}}{{note}}</div>\n    <textarea class="note-input-container">{{note}}</textarea>\n    <a href="javascript:void(0)" class="note-input-save">Save</a>\n    <a href="javascript:void(0)" class="note-input-cancel">Cancel</a>\n    {{#canEdit}}\n    <i class="fa note-edit-icon fa-pencil"></i><i class="fa note-delete-icon fa-trash-o"></i><i class="fa note-close-icon fa-times"></i>\n    {{/canEdit}}\n</li>'},418:function(e,t,n){"use strict";var o=n(378),i=n(389),r=n(564),a=n(9),s=n(67),l=n(14),c=n(2),d=n(6),u=$(document),h=/highlight-(\d+)/i,p=function(){function e(){var e=this;this.handleHighlightMouseEnter=this.handleHighlightMouseEnter.bind(this),this.handleHighlightMouseLeave=this.handleHighlightMouseLeave.bind(this),u.on("textSideMenuClosed",function(){return e.deleteCurrentNoteHighlight()}),u.on("click",".delete-highlight-button",function(){return e.handleDeleteButtonClick()}),u.on("click",".highlight-tooltip-container .color-selector",function(t){return e.handleColorSelectorClick(t)})}return e.prototype.initialize=function(e,t){var n=this;if(this.book=e,this.bookElement=t,this.book&&d.a.isCurrentlyLoggedIn()){this.$menuReferenceElement=$("#highlight-tooltip-menu-reference-node");try{this.$menuReferenceElement.foundation("tooltip")}catch(e){}r.a.fetch(t).then(function(e){e.bookElementHighlights.forEach(function(e){e.highlightedParagraphs.forEach(function(t){var o=t.hash?$("[data-hash="+t.hash+"]"):$(document.getElementById(t.ordinal));o.length&&n.highlight(o,t.selectedText,"highlighted-text",e.color,e.id,e.offset)})})})}},e.prototype.clean=function(){this.book=null,this.bookElement=null},e.prototype.createHighlightSelection=function(e,t,n){var o=this;if(void 0===n&&(n=-1),e&&e.length&&t&&this.bookElement){var l=this.getAssociatedReadableTextFragmentAndSelectedText(e,t);if(l&&l.length&&this.bookElement&&this.bookElement.shortName&&this.bookElement.book&&this.bookElement.book.shortName){r.a.addHighlight(this.bookElement,l.map(function(e){return new i.a(e.$readableTextFragment.attr("id"),e.$readableTextFragment.attr("data-hash"),e.selectedText)}),a.a.getHighlightColor(),n).then(function(e){o.deleteDummyHighlights();for(var t=0,i=l;t<i.length;t++){var r=i[t];o.highlight(r.$readableTextFragment,r.selectedText,"highlighted-text",a.a.getHighlightColor(),e,n)}u.trigger("highlightAdded")}).catch(function(e){o.deleteDummyHighlights(),s.a.showTemporaryNotification("Error when saving highlight!")});for(var c=0;c<l.length;c++){var d=l[c];this.highlight(d.$readableTextFragment,d.selectedText,"dummy-highlighted-text",a.a.getHighlightColor(),"",0==c?n:-1)}}}},e.prototype.getAssociatedReadableTextFragmentAndSelectedText=function(e,t){for(var n=e.filter(function(e){return e.is(".readable-text")}),o=(t||"").split(/(\r)?\n/).filter(function(e){return""!=e}),i=[],r=0,a=0;r<n.length&&a<o.length;){var s=n[r],l=o[a];-1!=s.text().indexOf(l)?(i.push({$readableTextFragment:s,selectedText:l}),r++,a++):a++}return i},e.prototype.highlightNoteSelection=function(e,t){this.highlight(e,t,"highlighted-note-text","")},e.prototype.highlight=function(e,t,n,i,r,a){if(void 0===r&&(r=""),void 0===a&&(a=-1),e&&t){var s=e.get(0),l=n+(r?" highlight-"+r:"")+(i?" highlight-color-"+i:"");o.a.highlight(s,t,l,"",a>0?s.textContent.substring(0,a):""),"dummy-highlighted-text"!=n&&(this.storeHighlightToOriginalHTML(s,t,l),e.find("."+n).hover(this.handleHighlightMouseEnter,this.handleHighlightMouseLeave))}},e.prototype.deleteCurrentNoteHighlight=function(){l.a.unwrapIntoParent($(".highlighted-note-text"))},e.prototype.deleteDummyHighlights=function(){l.a.unwrapIntoParent($(".dummy-highlighted-text"))},e.prototype.storeHighlightToOriginalHTML=function(e,t,n){if(e){var i=$("<div>"+e.originalInnerHTML+"</div>");o.a.highlight(i.get(0),t,n),e.originalInnerHTML=i.get(0).innerHTML}},e.prototype.handleHighlightMouseEnter=function(e){var t=this,n=$(e.target);clearTimeout(this.mouseLeaveTimer),clearTimeout(this.mouseEnterTimer),this.mouseEnterTimer=c.a.setTimeout(function(){l.a.isHover(n)&&(t.openHighlightTooltip(n),t.selectHeighlight(n),t.$currentlySelectedHighlight=n)},100)},e.prototype.handleHighlightMouseLeave=function(e){var t=this;clearTimeout(this.mouseLeaveTimer),this.mouseLeaveTimer=c.a.setTimeout(function(){t.isMouseOverTooltip()||l.a.isHover($(e.target))?t.handleHighlightMouseLeave(e):(clearTimeout(t.mouseLeaveTimer),t.unselectHighlights(),t.closeHighlightTooltip())},500)},e.prototype.openHighlightTooltip=function(e){if(window.Foundation&&(!this.$currentlySelectedHighlight||!e||this.$currentlySelectedHighlight[0]!=e[0])){var t=e[0].getBoundingClientRect();this.$menuReferenceElement.css({top:t.bottom+u.scrollTop()+40,left:t.left+t.width/2});var n=window.Foundation.libs.tooltip.getTip(this.$menuReferenceElement);n.velocity({translateY:5},{duration:0}),n.removeClass("tip-top tip-bottom"),n.find(".selected").removeClass("selected"),n.addClass("tip-bottom"),e.is(".highlight-color-yellow")?n.find(".color-selector.yellow").addClass("selected"):e.is(".highlight-color-red")?n.find(".color-selector.red").addClass("selected"):e.is(".highlight-color-green")?n.find(".color-selector.green").addClass("selected"):e.is(".highlight-color-blue")?n.find(".color-selector.blue").addClass("selected"):e.is(".highlight-color-pink")&&n.find(".color-selector.pink").addClass("selected"),window.Foundation.libs.tooltip.reposition(this.$menuReferenceElement,n,this.$menuReferenceElement.attr("class")),n.stop(),n.velocity("fadeIn"),n.velocity({translateY:0},{duration:100}),u.trigger("tooltipOpened")}},e.prototype.closeHighlightTooltip=function(){window.Foundation.libs.tooltip.hide(this.$menuReferenceElement),u.trigger("tooltipClosed"),this.$currentlySelectedHighlight=null},e.prototype.selectHeighlight=function(e){if(e&&e.length){this.unselectHighlights();var t=l.a.getClassNameMatchingRegEx(e[0],h);t&&$("."+t).addClass("selected-highlight")}},e.prototype.unselectHighlights=function(){$(".selected-highlight").removeClass("selected-highlight")},e.prototype.isMouseOverTooltip=function(){return l.a.isHover($("#highlight-tooltip-menu-reference-node.tooltip"))},e.prototype.handleDeleteButtonClick=function(){if(this.$currentlySelectedHighlight){var e=this.getCurrentlySelectedHighlightClassAndId();null!=e&&this.deleteHighlight(e.classId,e.id)}},e.prototype.deleteHighlight=function(e,t){r.a.removeHighlight(t).catch(function(){return s.a.showTemporaryNotification("Error syncing highlight with server.")}),this.unselectHighlights(),this.closeHighlightTooltip(),l.a.unwrapIntoParent($("."+e))},e.prototype.handleColorSelectorClick=function(e){if(this.$currentlySelectedHighlight){var t=$(e.currentTarget),n=a.a.getHighlightColor();t.is(".red")?n="red":t.is(".green")?n="green":t.is(".yellow")?n="yellow":t.is(".blue")?n="blue":t.is(".pink")&&(n="pink");var o=this.getCurrentlySelectedHighlightClassAndId();null!=o&&this.changeHighlightColor(o.classId,o.id,n)}},e.prototype.changeHighlightColor=function(e,t,n){r.a.changeColor(this.bookElement,t,n).catch(function(){return s.a.showTemporaryNotification("Error syncing highlight with server.")}),$("."+e).removeClass("highlight-color-green highlight-color-yellow highlight-color-red highlight-color-pink highlight-color-blue").addClass("highlight-color-"+n),a.a.setHighlightColor(n),this.closeHighlightTooltip()},e.prototype.getCurrentlySelectedHighlightClassAndId=function(){var e=l.a.getClassNameMatchingRegEx(this.$currentlySelectedHighlight[0],h);if(!e)return null;var t=e.match(h);return t&&t[1]?{classId:e,id:+t[1]}:null},e}();t.a=new p},420:function(e,t,n){"use strict";var o=n(2),i=n(4),r=n(5),a=(n(434),n(18)),s=$(document),l=$(window),c=function(){function e(e,t,n){var i=this;this.$menu=e,this.$menuButton=t,this.optionalArguments=n||{},this.$topBar=$("#top-bar-container"),this.$footer=$("#footer"),this.handleMenuButtonClick=this.handleMenuButtonClick.bind(this),this.handleResize=this.handleResize.bind(this),this.handleSideMenuOpened=this.handleSideMenuOpened.bind(this),this.handleTextSlideMenuBeginOpening=this.handleTextSlideMenuBeginOpening.bind(this),o.a.onEventWithCooldown(this.$menuButton,"click",this.handleMenuButtonClick),s.on("slideMenuOpened",this.handleSideMenuOpened),s.on("slideMenuCloseRequested notesMenuShowStart",function(){return i.close()}),s.on("textSlideMenuBeginOpening",this.handleTextSlideMenuBeginOpening),this.$menu.css({width:this.determineSlideMenuWidth()})}return e.prototype.handleMenuButtonClick=function(){this.$menu.is(".text-slide-menu-shown")?this.close():this.open()},e.prototype.adjustMainBookContentContainerPosition=function(){var e=this.$menu.is(".text-slide-menu-shown"),t=$("#book-main-content-container"),n=$(".summary-wrapper"),o=$("#in-page-discussion-wrapper");if(null!=t&&0!=t.length&&null!=n&&0!=n.length&&e)if(!i.b.isLargeScreenSize()||null!=a.a.book&&a.a.book.isFreeEbook)t.css("transform",""),n.css("transform",""),o.css("transform",""),s.trigger("textSlideMenuOpened",[this.$menu]),s.trigger("slideMenuStartOpening",[this.$menu,0]),s.trigger("slideMenuOpened",[this.$menu]);else{var l=r.a.getComputedTranslateX(t[0]),c=Math.max(this.$menu.width()-(t.length?t.offset().left:0)+l+(this.optionalArguments.sidePadding||0),0);c=this.$menu.is(".text-slide-menu-right")?-c:c,s.trigger("slideMenuStartOpening",[this.$menu,c]),this.adjustBookMainContentAndSummaryPosition(t,n,o,c)}},e.prototype.adjustBookMainContentAndSummaryPosition=function(e,t,n,o){var i=this;e.velocity({translateX:o},{duration:250,complete:function(){s.trigger("textSlideMenuOpened",[i.$menu]),s.trigger("slideMenuOpened",[i.$menu])}}),t.velocity({translateX:o},{duration:250}),n.velocity({translateX:o},{duration:250})},e.prototype.handleResize=function(){var e=this;o.a.setTimeout(function(){e.adjustMenuPosition(),e.adjustMainBookContentContainerPosition()},50)},e.prototype.handleSideMenuOpened=function(e,t){null!=t&&0!=t.length&&t!=this.$menu&&t.offset().left<l.width()/2&&this.close()},e.prototype.handleTextSlideMenuBeginOpening=function(e,t){null!=t&&0!=t.length&&t!=this.$menu&&this.close()},e.prototype.adjustMenuPosition=function(){var e=$("#section-navigation-container"),t=this.$topBar.height()+r.a.getComputedTranslateY(this.$topBar.get(0))-(e.is(".has-shown-header-items")?e.height():0)-($("#header-notification-container").height()||0),n=t+this.$footer.height();(i.b.isAndroid()||i.b.isIOS())&&(n+=70),this.$menu.css({top:t,height:"calc(100vh - "+n+"px)",width:this.determineSlideMenuWidth()})},e.prototype.open=function(){this.isOpened()||(this.$menu.addClass("text-slide-menu-shown"),this.$menuButton.addClass("selected"),s.trigger("textSlideMenuBeginOpening",[this.$menu]),this.optionalArguments.beforeOpenCallback&&this.optionalArguments.beforeOpenCallback(),this.adjustMenuPosition(),this.adjustMainBookContentContainerPosition(),l.on("resizestop orientationchange",this.handleResize),s.trigger("tocMenuOpen"))},e.prototype.close=function(e){if(void 0===e&&(e=!0),this.isOpened()){l.off("resizestop orientationchange",this.handleResize),this.$menu.removeClass("text-slide-menu-shown"),this.$menuButton.removeClass("selected");var t=$("#book-main-content-container"),n=$(".summary-wrapper"),o=$("#in-page-discussion-wrapper");e&&(null!=t&&t.length&&t.velocity({translateX:0},{duration:250,complete:function(){s.trigger("textSlideMenuClosed"),s.trigger("slideMenuClosed"),t.css("transform","")}}),null!=n&&n.length&&n.velocity({translateX:0},{duration:250,complete:function(){n&&n.css("transform","")}}),null!=o&&o.length&&o.velocity({translateX:0},{duration:250,complete:function(){o&&o.css("transform","")}}))}},e.prototype.isOpened=function(){return this.$menu.is(".text-slide-menu-shown")},e.prototype.determineSlideMenuWidth=function(){var e=l.width()-$("#book-main-content-container").width();return Math.min(this.optionalArguments.maxWidth||650,Math.max(e,this.optionalArguments.targetWidth||450))},e}();t.a=c},421:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),i=n(68),r=n(6),a=(n(441),n(28)),s=n(2),l=n(18),c=n(55),d=n(5),u=new(function(){function e(){var e=this;this.$headerNotificationContainer=$("#header-notification-container"),this.$headerNotificationContainer.on("click",".free-ebook-sign-in",function(){a.a.requestOpenModal("signin","sign in to read this free ebook","free-ebook-sign-in")}),this.$headerNotificationContainer.on("click",".free-preview-sign-in",function(e){$(e.target).is(".add-dotd-book-to-cart")||a.a.requestOpenModal("signin","sign in to unlock this book","free-preview-sign-in")}),this.$headerNotificationContainer.on("click",".fa-close",function(){e.hideHeaderNotifier(),$(document).trigger("headerNotifierHidden")}),this.$headerNotificationContainer.on("click",".add-dotd-book-to-cart",function(){null!=e.dotdPromoInfo&&i.a.requestAddBookToCartByBookShortName(e.book.shortName,e.dotdPromoInfo.discountCode),e.dotdPromoInfo=null,e.hideHeaderNotifier()}),this.$headerNotificationContainer.on("click",".free-preview-start",function(e){$(e.target).is(".newer-version-link")?document.location=e.target.href:$(document).trigger("freePreviewRequested")}),$(document).on("freePreviewModeActivated freePreviewModeDeactivated",function(){s.a.setTimeout(function(){e.renderFreePreviewMessaging()},16)}),$(document).on("freePreviewModeExpired",function(){r.a.isCurrentlyLoggedIn()&&e.hideHeaderNotifier()})}return e.prototype.setPromotion=function(e){this.dotdPromoInfo=e,this.initialize(this.book,this.bookElement)},e.prototype.initialize=function(e,t){var n=this;if(this.book=e,this.bookElement=t,null!=e||null!=t){if(e.latestMeapVersion!=t.meapVersion)return this.$headerNotificationContainer.html('<a href="'+o.a.getBookElementUrl(this.book.slug,this.bookElement.shortName)+"\"> Newer version available! <span class='action-label'>Access the latest version</span></a>"),void this.showHeaderNotifier();i.a.getNewestEditionProduct(e).then(function(t){null!=t&&t.newestEditionProduct&&t.newestEditionProduct.slug&&(e.newerEditionId=t.newestEditionProduct.id,n.$headerNotificationContainer.html('<a href="'+o.a.getBookElementUrl(t.newestEditionProduct.slug,"")+"\"> Newer edition available! <span class='action-label'>Access the latest version</span></a>"),n.showHeaderNotifier())}),this.renderPromoMessage()}else this.renderPromoMessage()},e.prototype.clean=function(){this.hideHeaderNotifier(),this.book=null,this.bookElement=null},e.prototype.renderPromoMessage=function(){if(null!=this.dotdPromoInfo){var e=null!=this.book&&this.book.shortName==this.dotdPromoInfo.productExternalId;if(null==this.book||e){if(null!=this.book&&this.book.userOwnsBook)return;this.showHeaderNotifier(),this.$headerNotificationContainer.html("\n                <div class='promo-header'>\n                    <a class=\"single-line "+(e?"add-dotd-book-to-cart":"")+'" href="'+(e?"javascript:void(0)":this.dotdPromoInfo.productLink)+'" data-product-external-id='+this.dotdPromoInfo.productExternalId+">"+(e?this.dotdPromoInfo.shortMessage:this.dotdPromoInfo.headerMessage)+'</a>\n                    <i class="fa fa-close close-promo-button" data-product-external-id="'+this.dotdPromoInfo.productExternalId+'"/>\n                </div>\n            ')}}},e.prototype.renderFreePreviewMessaging=function(){var e=this;if((null==this.bookElement||!this.bookElement.isOpen)&&d.a.hasScrambledParagraphs()){var t=this.getHeadingAndDescription(this.book,r.a.isCurrentlyLoggedIn());null!=t?(this.showHeaderNotifier(),this.$headerNotificationContainer.html('<div class="free-preview-notifier '+(t.additionalClass||"")+'">\n                <span class="free-preview-heading-wrapper">'+t.heading+"</span>\n                "+(t.description?'<i class="fa fa-question-circle dont-propagate-click" data-tooltip aria-haspopup="true" data-options="disable_for_touch:true;" title="'+t.description+'" aria-hidden="true"></i>':"")+"\n                <a class=\"newer-version-link dont-propagate-click hidden\" style='display: inline;' href=\"\">(access the <span style='text-decoration: underline'>latest</span> version)</a>\n             </div>"),"free-preview-starting"==t.additionalClass&&this.countDownToAutoStartFreePreview(),this.$headerNotificationContainer.foundation("tooltip"),"free-preview-start"!=t.additionalClass&&"free-preview-running"!=t.additionalClass&&"free-preview-sign-in"!=t.additionalClass||(this.book.latestMeapVersion!=this.bookElement.meapVersion?this.updateNewerVersionLink(o.a.getBookElementUrl(this.book.slug,this.bookElement.shortName)):i.a.getNewestEditionProduct(this.book).then(function(t){null!=t&&t.newestEditionProduct&&t.newestEditionProduct.slug&&e.updateNewerVersionLink(o.a.getBookElementUrl(t.newestEditionProduct.slug,""))}))):this.hideHeaderNotifier()}},e.prototype.updateNewerVersionLink=function(e){this.$headerNotificationContainer.find(".newer-version-link").attr("href",e).removeClass("hidden")},e.prototype.countDownToAutoStartFreePreview=function(){var e=this;0!=this.$headerNotificationContainer.find(".free-preview-auto-start-countdown").length&&s.a.setTimeout(function(){e.$headerNotificationContainer.find(".free-preview-count-down-wrapper").addClass("activate-1"),s.a.setTimeout(function(){e.$headerNotificationContainer.find(".free-preview-count-down-wrapper").removeClass("activate-1").addClass("activate-2"),s.a.setTimeout(function(){e.$headerNotificationContainer.find(".free-preview-count-down-wrapper").removeClass("activate-2").addClass("activate-3"),s.a.setTimeout(function(){$(document).trigger("anonymousFreePreviewStartRequested")},1e3)},1e3)},1e3)},1)},e.prototype.getHeadingAndDescription=function(e,t){return e.isFreeEbook?t?null:{heading:"<span class='action-label'>sign in</span> to access this free eBook",description:"This eBook is free after you log in",additionalClass:"free-ebook-sign-in"}:l.a.isFreePreviewActive()?{heading:"in free preview"+this.getAdditionalPriceMessage(),description:"",additionalClass:"free-preview-running"}:c.a.isFreePreviewAtBeginningAndNotStarted(e)||c.a.isFreePreviewAvailable(e)?t?e.isOpen?{heading:"<span class='action-label'>start</span> your 24h free preview",description:"The text will unlock so you can read this book for 24 hours.",additionalClass:"free-preview-start"}:{heading:"<span class='action-label'>start</span> your free preview",description:"The text will unlock so you can read each liveBook for a total of 5 minutes per day. (to pause and resume, click the hourglass in the header)",additionalClass:"free-preview-start"}:{heading:"starting free preview in <span class='free-preview-auto-start-countdown'><div class='free-preview-count-down-wrapper'><div class='free-preview-count-down-3'>3</div><div class='free-preview-count-down-2'>2</div><div class='free-preview-count-down-1'>1</div><div class='free-preview-count-down-0'>0</div></div></span>",additionalClass:"free-preview-starting",description:""}:c.a.hasFreePreviewExpired(e)&&!t?e.isOpen?{heading:"<span class='action-label'>sign in</span> to unlock the whole book for 24h"+this.getAdditionalPriceMessage(),description:"The text will unlock so you can read this book for 24 hours.",additionalClass:"free-preview-sign-in"}:{heading:"<span class='action-label'>sign in</span> to unlock the whole book"+this.getAdditionalPriceMessage(),description:"The text will unlock so you can read each liveBook for a total of 5 minutes per day.",additionalClass:"free-preview-sign-in"}:void 0},e.prototype.getAdditionalPriceMessage=function(){return null!=this.dotdPromoInfo&&null!=this.book&&this.dotdPromoInfo.productExternalId==this.book.shortName?' <span class="action-label add-dotd-book-to-cart" data-product-external-id='+this.dotdPromoInfo.productExternalId+">(get the book for "+this.dotdPromoInfo.priceMessage+")</span>":""},e.prototype.hideHeaderNotifier=function(){this.$headerNotificationContainer.addClass("hidden"),$(document).trigger("headerNotifierHidden")},e.prototype.showHeaderNotifier=function(){this.$headerNotificationContainer.removeClass("hidden"),$(document).trigger("headerNotifierShown")},e}())},426:function(e,t,n){"use strict";var o=n(12),i=n(113),r=n(0),a=n(390),s=function(){function e(){}return e.prototype.fetch=function(e){return new Promise(function(t,n){a.a.fetch(e).then(function(e){return t(e.notes)}).catch(function(e){return n(e)})})},e.prototype.addNote=function(e,t,n,o,s,l,c,d){var u=new i.a(-1,e.shortName,e.ordinal,t,n,o,s,l,Date.now(),e.meapVersion,e.reviewVersion);return u.isBeingSynced=!0,new Promise(function(i,h){r.a.postToOurBackend(r.a.getAbsoluteUrl("api/note/createNote"),function(e){u.id=e.id,u.isBeingSynced=!1,a.a.notesData.bookNotes.push(u),a.a.notesData.bookElementNotes.push(u),i(e.id)},function(e){console.log("Error when syncing note",e),u.isBeingSynced=!1,h(e)},{book:e.book.shortName,bookElement:e.shortName,bookElementOrdinal:e.ordinal,contentItemID:t,contentHash:n,annotatedText:o,noteText:s,contentLocation:l,meapVersion:c,reviewVersion:d})})},e.prototype.addNotes=function(e,t){return t&&0!==t.length?new Promise(function(n,o){r.a.postToOurBackend(r.a.getAbsoluteUrl("api/notes/addNotes"),function(e){for(var o=e,i=0;i<o.length;i++)t[i].id=o[i];n(!0)},function(e){console.log("Error when adding notes",e),o(e)},{notes:JSON.stringify(t),bookShortName:e.book.shortName})}):Promise.resolve(!0)},e.prototype.removeNote=function(e){var t=a.a.notesData.bookElementNotes.find(function(t){return t.id===e});return new Promise(function(e,n){if(!t)return console.log("When removing note, cannot find note with id"),void n("Cannot find note with id");r.a.postToOurBackend(r.a.getAbsoluteUrl("api/note/removeNote"),function(n){o.a.removeItemFromArray(a.a.notesData.bookNotes,t),o.a.removeItemFromArray(a.a.notesData.bookElementNotes,t),e(!0)},function(e){console.log("Error when syncing note",e),n(e)},{noteID:t.id},!1)})},e.prototype.editNote=function(e,t,n){var o=a.a.notesData.bookElementNotes.find(function(e){return e.id===t});return new Promise(function(e,t){if(!o)return console.log("When editing note, cannot find note with id"),void t("Cannot find note with id");r.a.postToOurBackend(r.a.getAbsoluteUrl("api/note/editNote"),function(t){o.noteText=n,e(!0)},function(e){console.log("Error when syncing note",e),t(e)},{noteID:o.id,noteText:n},!1)})},e}(),l=n(32),c=function(){function e(){this.webService=new s}return e.prototype.fetch=function(e){var t=this,n=e.book;return this.dataPromise&&this.previousRequestBackground&&this.previousRequestBackground.bookShortName===n.shortName?this.previousRequestBackground.bookElementShortName===e.shortName?this.dataPromise:(this.previousRequestBackground={bookShortName:n.shortName,bookElementShortName:e.shortName},this.dataPromise=new Promise(function(n,o){t.dataPromise.then(function(o){t.notesData=o,t.notesData.bookElementNotes=o.bookNotes.filter(function(t){return t.bookElementShortName===e.shortName}),n(t.notesData)}).catch(function(e){console.log("Couldn't load notes"),o(e)})})):this.dataPromise=new Promise(function(o,i){l.a.loadNotes(e.book.shortName).then(function(i){var r=t.notesData={bookNotes:i,bookElementNotes:i.filter(function(t){return t.bookElementShortName===e.shortName})},a=i.filter(function(e){return e.hasNotBeenStoredOnServer}),s=function(){t.webService.fetch(e).then(function(e){t.notesData={bookNotes:e.bookNotes.slice(),bookElementNotes:e.bookElementNotes.slice()},l.a.saveNotes(n.shortName,e.bookNotes),o(t.notesData)}).catch(function(e){t.notesData=r,o(r)})};0!=a.length?t.webService.addNotes(e,a).then(function(){s()}).catch(function(n){t.webService.fetch(e).then(function(n){var i,r;(i=n.bookNotes).push.apply(i,a),(r=n.bookElementNotes).push.apply(r,a.filter(function(t){return t.bookElementShortName===e.shortName})),t.notesData=n,o(n)}).catch(function(e){t.notesData=r,o(r)})}):s()}).catch(function(e){console.log("Couldn't load notes"),i(e)})})},e.prototype.addNote=function(e,t,n,o,r,a,s,c){var d=this,u=new i.a(-1,e.shortName,e.ordinal,t,n,o,r,a,Date.now(),e.meapVersion,e.reviewVersion);return u.isBeingSynced=!0,new Promise(function(i,h){d.webService.addNote(e,t,n,o,r,a,s,c).then(function(t){u.id=t,d.addNoteToInternalData(u),l.a.saveNotes(e.book.shortName,d.notesData.bookElementNotes),i(t)}).catch(function(t){u.hasNotBeenStoredOnServer=!0,l.a.addNote(e.book.shortName,u).then(function(e){u.id=e,d.addNoteToInternalData(u),i(e)}).catch(function(e){console.log("Error when syncing notes",e),u.isBeingSynced=!1,h(e)})})})},e.prototype.removeNote=function(e){throw new Error("Not yet implemented")},e.prototype.editNote=function(e,t,n){var o=this,i=this.notesData.bookElementNotes.find(function(e){return e.id===t});return new Promise(function(r,a){if(!i)return console.log("When editing note, cannot find note with id"),void a("No note with id");o.webService.editNote(e,t,n).then(function(){i.noteText=n,l.a.saveNotes(e.book.shortName,o.notesData.bookElementNotes),r(!0)}).catch(function(t){l.a.editNote(e.book.shortName,i,n).then(function(){i.noteText=n,i.hasNotBeenStoredOnServer=!0,r(!0)}).catch(function(e){console.log("Error when syncing note",e),a(e)})})})},e.prototype.addNoteToInternalData=function(e){e.isBeingSynced=!1,this.notesData.bookNotes.push(e),this.notesData.bookElementNotes.push(e)},e.prototype.removeNoteFromInternalData=function(e){o.a.removeItemFromArray(this.notesData.bookNotes,e),o.a.removeItemFromArray(this.notesData.bookElementNotes,e)},e}(),d=n(4),u={notesService:null};d.b.loadDeviceInfo().then(function(e){u.notesService=function(e){switch(e){case d.a.Browser:return new s;case d.a.Cordova:case d.a.Electron:return new c}}(e.platform)});t.a=u},427:function(e,t,n){"use strict";var o=n(12),i=n(2),r=n(378),a=n(121),s=n(5),l=n(18),c=$("#video-mode-overlay"),d=$("#code-annotation-container"),u=$("#additional-code-annotation-container"),h=/^\#([A-Z]|\d{1,2}):?\s+-?/,p=/#([0-9]{1,2}|[A-Z])\s*$/,m={"Python 2.7":"python","Python 3.6":"python",Java:"java",JavaScript:"javascript"},g=function(){function e(e,t,n){var o="",i=e.querySelector(".code-area");i&&(o=(i.value||i.textContent).trim()),this.rawSourceCode=o,this.listingContainer=e,this.additionalListingContainer=null,this.listingContainer.annotatedListing=this,this.$listingContainer=$(e),this.$additionalListingContainer=$(null),this.sourceLines=[],this.source="",this.annotations={},this.annotatedLines=[],this.references=[],this.annotationsLinesMap={},this.styles=[],t?(this.highlightWhenInView(i),n&&n()):this.highlightCodeArea(i,n)}return e.prototype.clean=function(){this.unsubscribeEvents(),this.unsubscribeAdditionalListingEvents(),this.listingContainer=null,this.$listingContainer=null,this.additionalListingContainer=null,this.$additionalListingContainer=null,this.$codeArea=null,this.annotations=null,this.annotatedLines=null,this.annotationsLinesMap=null},e.prototype.highlightWhenInView=function(e,t){var n=this;a(e,function(){return n.highlightCodeArea(e,t)})},e.prototype.highlightCodeArea=function(e,t){var n=this;this.processLines(),this.buildReferenceAnnotatedLinesMap();try{var o=new Worker("/assets/highlightJsWorker.js");o.onmessage=function(r){try{var a=$('<pre class="code-area"><code class="hljs">'+r.data+"</code></pre>");a.find(".hljs-meta").each(function(e,t){var n=$(t);"#"===n.text().trim()&&n.text("#")}),$(e).replaceWith(a),n.$codeArea=a,t&&t()}catch(e){console.log("Error when text highlighting code",e)}i.a.setTimeout(function(){return n.createLineNumbers()},5),i.a.setTimeout(function(){return n.createAnnotationsAndLines()},7),i.a.setTimeout(function(){return n.updateTextStyle()},10),o.terminate()},o.onerror=function(e){console.log("Error when highlighting code",e),t&&t()};var r=(this.source||"").replace(/\r/g,"").trim();o.postMessage({source:r,language:this.getCurrentProgrammingLanguage()})}catch(e){console.log("Error loading highlight worker",e)}},e.prototype.getCurrentProgrammingLanguage=function(){try{if(null!=l.a.book&&""!=l.a.book.programmingLanguage&&"N/A"!=l.a.book.programmingLanguage&&m[l.a.book.programmingLanguage])return[m[l.a.book.programmingLanguage]]}catch(e){}},e.prototype.processLines=function(){if(this.rawSourceCode){var e=this.rawSourceCode.trim(),t=this.$listingContainer.find(".code-annotations-overlay-container");t.attr("data-annotations")&&(e+="\n"+atob(t.attr("data-annotations")));for(var n,i=e.split(/\r\n|\r|\n/g),r=!1,a=!1,s=!1,l=0;l<i.length;l++){var c=i[l];if(s=c.indexOf("!@%STYLE%@!")>-1,r&&!s)this.styles.push(JSON.parse(c));else if(c.match(h))a=!0,(u=c.match(h))&&u.length>=2&&(n=u[1],this.annotations[n]={reference:n,descriptions:[c.substr(u[0].length).replace(/^:(\s)+/,"")]});else a&&n&&this.annotations[n]&&c.trim()?this.annotations[n].descriptions.push(c.trim().replace("!@%STYLE%@!","")):s||(this.sourceLines.push(c),this.annotatedLines.push({line:c,lineNumber:l,annotation:null,annotationElement:null}));c.indexOf("!@%STYLE%@!")>-1&&(r=!r)}for(var d in this.annotations)this.annotations[d].description=this.annotations[d].descriptions.join(" ").trim();for(l=0;l<this.sourceLines.length;l++){var u,m=this.sourceLines[l];if(u=m.match(p)){var g=u[1];this.sourceLines[l]=o.a.trimEnd(m.substr(0,m.indexOf(u[0]))),this.annotations[g]||(this.annotations[g]={reference:g,description:""}),this.annotatedLines[l].annotation=this.annotations[g]}}this.source=this.sourceLines.join("\r\n")}},e.prototype.buildReferenceAnnotatedLinesMap=function(){this.annotationsLinesMap={};for(var e=0;e<this.annotatedLines.length;e++){var t=(h=this.annotatedLines[e]).annotation;if(t){var n=t.reference;this.annotationsLinesMap[n]||(this.annotationsLinesMap[n]={annotatedLines:[],groups:[]}),this.annotationsLinesMap[n].annotatedLines.push(h)}}for(var n in this.annotationsLinesMap)if(this.annotationsLinesMap.hasOwnProperty(n)){var o=this.annotationsLinesMap[n],i=o.annotatedLines,r=o.groups=[];if(!(i.length<=0))if(1!==i.length){for(var a=[],s=0;s<i.length-1;s++){for(var l=i[s],c=i[s+1],d=[],u=l.lineNumber+1;u<c.lineNumber;u++){var h;if(h=this.annotatedLines[u]){if(h.annotation){d=[];break}d.push(h)}}for(u=0;u<d.length;u++)d[u].annotation=l.annotation;a.push.apply(a,d)}i.push.apply(i,a),i.sort(function(e,t){return e.lineNumber-t.lineNumber}),r.push([i[0]]);for(s=1;s<i.length;s++){var p=i[s-1];l=i[s];p.lineNumber+1===l.lineNumber?r[r.length-1].push(l):r.push([l])}}else r.push([i[0]])}},e.prototype.createLineNumbers=function(){var e=this.getCountLines(this.source);if(e>0){for(var t="",n=0;n<e;n++)t+='<div class="line-number line-number-'+(n+1)+'">'+(n+1)+"</div>";this.$codeArea.prepend('<code class="hljs hljs-line-numbers" style="float:left">'+t+"</code>")}},e.prototype.getCountLines=function(e){return 0===e.length?0:e.trim().split(/\r\n|\r|\n/g).length},e.prototype.createAnnotationsAndLines=function(){if(this.$listingContainer){var e=this.$listingContainer.find(".code-annotations-overlay-container"),t="",n={};for(var o in this.annotationsLinesMap){var i=this.annotationsLinesMap[o];n[o]={};for(var r=0;r<i.groups.length;r++){var a=(u=i.groups[r])[0],s=u[u.length-1],l=this.$codeArea.find(".line-number-"+(a.lineNumber+1)),c=this.$codeArea.find(".line-number-"+(s.lineNumber+1));l.length&&c.length?n[o][r]={firstLineOffset:l.position().top,lastLineEnd:c.position().top+c.height()}:console.log("Couldn't build all lines in listing",this.source)}}for(var o in this.annotationsLinesMap){var d=(i=this.annotationsLinesMap[o]).annotatedLines[0].annotation;for(r=0;r<i.groups.length;r++){var u;a=(u=i.groups[r])[0],s=u[u.length-1];if(n[o]){var h=n[o][r];if(h){t+='<div class="line-container listing-line-group group'+o+'" \n                                   style="top: '+h.firstLineOffset+"px; height:"+(h.lastLineEnd-h.firstLineOffset-1)+"px; line-height:"+(h.lastLineEnd-h.firstLineOffset-1)+'px;"></div>';var p=$("<div class='annotation-container'\n                                                     style='top:"+h.firstLineOffset+"px; height:"+(h.lastLineEnd-h.firstLineOffset-1)+"px; line-height:"+(h.lastLineEnd-h.firstLineOffset-1)+"px'>\n                                                    <span class='annotation-label'>"+d.reference+"</span>\n                                                </div>");p.attr("title",d.description),e.append(p),d.labels||(d.labels=[]),d.labels.push(p.get(0));for(var m=0;m<u.length;m++)u[m].annotationElement=p.get(0)}}}}this.$codeArea.prepend(t),this.registerAnnotationEvents()}},e.prototype.registerAnnotationEvents=function(){var e=this,t=this.$listingContainer.find(".code-annotations-overlay-container").children(),n=this.$listingContainer.find(".line-container");i.a.onEventWithCooldown(t,"click touchstart",function(t){e.goToAnimationStep($(t.currentTarget).text().trim(),!1,t.currentTarget)}),i.a.onEventWithCooldown(n,"click touchstart",function(t){var n=$(t.currentTarget),o=x.getLineGroupReference(n);o&&e.goToAnimationStep(o)}),n.mouseenter(function(t){return e.handleLineWrapperEnter($(t.currentTarget))}),t.hover(function(t){var n=$(t.currentTarget);if(!n.is(".selected")){var o=e.getWholeLineGroup(n);null!=o&&o.length>0&&e.handleLineWrapperEnter(o.eq(0))}},function(t){var n=$(t.currentTarget);if(!n.is(".selected")){var o=e.getWholeLineGroup(n);null!=o&&o.length>0&&e.handleLineWrapperLeave(o.eq(0))}})},e.prototype.handleLineWrapperLeave=function(e){var t=x.getLineGroupClass(e);if(t){this.$listingContainer.find("."+t).removeClass("highlighted");var n=x.getLineGroupReference(e);this.annotations[n]&&this.$listingContainer.find(".hovered").removeClass("hovered")}},e.prototype.removeHighlighted=function(e){if(e&&0!=e.length){var t=e.find(".listing-line-group.highlighted");0!=t.length&&this.handleLineWrapperLeave(t.eq(0))}},e.prototype.handleLineWrapperEnter=function(e){this.removeHighlighted(e.parents(".browsable-container"));var t=x.getLineGroupClass(e);t&&($(document).trigger("code-lines-group-hovered",[this.$listingContainer.find("."+t),this.$additionalListingContainer.find("."+t)]),e.is(".selected")||this.highlight(x.getLineGroupReference(e)))},e.prototype.getWholeLineGroup=function(e){return e?this.$listingContainer.find(".group"+e.text().trim()):null},e.prototype.goToAnimationStep=function(e,t,n){var o=this;void 0===t&&(t=!1),void 0===n&&(n=null),this.listingContainer.runnableScript&&this.listingContainer.runnableScript.leaveEditMode();var r=this.annotations[e];if(r){var a=$(r.labels),l=($(r.additionalLabels),a.is(".selected"));if(x.hideAll(),!l){0==s.a.getCurrentMainContentTranslateX()?this.showTipWithAnimation(a,d,n):($(document).trigger("slideMenuCloseRequested"),i.a.setTimeout(function(){o.showTipWithAnimation(a,d,n)},300));var c=this.$listingContainer.find(".group"+e).addClass("selected"),u=this.$additionalListingContainer.find(".group"+e).addClass("selected");t&&$(document).trigger("requestPlayPointPosition",[c,u,!0])}}},e.prototype.unsubscribeEvents=function(){var e=this.$listingContainer.find(".code-annotations-overlay-container").children(),t=this.$listingContainer.find(".line-container");e.off(),t.off()},e.prototype.unsubscribeAdditionalListingEvents=function(){var e=this.$additionalListingContainer.find(".code-annotations-overlay-container").children(),t=this.$additionalListingContainer.find(".line-container");e.off("click"),e.off("mouseenter"),e.off("mouseleave"),e.off("touchstart"),t.off("click"),t.off("mouseenter"),t.off("touchstart")},e.prototype.preselect=function(e,t){var n=this.$listingContainer.find(".group"+e);n.addClass("pre-selected");var o=this.$additionalListingContainer.find(".group"+e);o.addClass("pre-selected");var i=this.annotations[e];i&&($(i.labels).addClass("hovered"),$(i.additionalLabels).addClass("hovered"),t&&$(document).trigger("requestPlayPointPosition",[n,o]))},e.prototype.highlight=function(e){var t=this.$listingContainer.find(".group"+e);this.$additionalListingContainer.find(".group"+e).addClass("highlighted"),t.addClass("highlighted");var n=this.annotations[e];n&&($(n.labels).addClass("hovered"),$(n.additionalLabels).addClass("hovered"))},e.prototype.showTipWithAnimation=function(e,t,n){if(e&&0!=e.length){e.text().trim();var o=e.attr("title"),i=t==u,r=e.parents(".code-area-container"),a=t.find(".annotation-description");t.find(".annotation-container").find(".annotation-label").text(e.text()),a.width("auto"),a.text(o);var s=this.willAnnotationFitInScreen(e),l=null;if(l=null!=n&&e.index(n)>=0?$(n).offset():e.offset(),i&&(l.top-=c.offset().top),s?(l.left+=e.width(),t.removeClass("vertical"),e.removeClass("vertical")):(l.top-=1.1*t.height(),l.left=r.width()/2-t.width()/3,t.addClass("vertical"),e.addClass("vertical")),!e.is(".selected")){t.velocity("stop");var d=t.width();o&&(s&&(t.width(0),a.css({opacity:0}),a.text("")),t.addClass("shown"),t.css({top:l.top,opacity:1,left:l.left})),e.addClass("selected"),o&&(s?(t.css({minHeight:e.height()}),t.find(".annotation-container").css({height:e.height()}),t.animate({width:d},300,function(){e.addClass("show-tip"),a.text(e.attr("title")),a.animate({opacity:1},300),t.css({left:parseFloat(t.css("left"))+2})})):t.addClass("show-tip")),x.currentAnnotatedListing=this,$(document).trigger("codeAnnotationShown",this.listingContainer)}}},e.prototype.willAnnotationFitInScreen=function(e){return e.offset().left+e.width()+d.width()<document.documentElement.clientWidth},e.prototype.setAdditionalListingContainer=function(e){this.unsubscribeAdditionalListingEvents(),this.additionalListingContainer=e,this.$additionalListingContainer=$(e);var t=this.$additionalListingContainer.find(".annotation-container"),n=function(e){var n=o.annotationsLinesMap[e];if(!n||void 0===n[0])return console.log("breakout",n),"continue";var i=n[0].annotation,r=t.filter(function(t,n){return $(n).find(".annotation-label").text()==e});if(0==r.length)return"continue";i.additionalLabels||(i.additionalLabels=[]),i.additionalLabels.push(r.get(0))},o=this;for(var i in this.annotationsLinesMap)n(i)},e.prototype.updateTextStyle=function(){var e=this;if(this.styles){var t=this.$codeArea.find(".hljs:not(.hljs-line-numbers)"),n=t[0],o=t.text().split(/\r\n|\r|\n/g);this.styles.forEach(function(t){JSON.parse(t.target).forEach(function(i){var a=i[0],s=i[1],l=(t.css,t.css&&-1!=t.css.indexOf("font-weight")),c=e.getSubstring(o,a,s);c&&l&&r.a.highlight(n,c,"bold")})})}},e.prototype.getSubstring=function(e,t,n){var o=e[t.line],i=e[n.line];if(!o||!i)return"";if(t.line===n.line)return o.substring(t.ch,n.ch);if(n.line>t.line){for(var r=o.substring(t.ch),a=t.line+1;a<n.line-1;a++)r+=e[a];return r+i.substring(0,n.ch)}return""},e}(),f=n(3),b=$("#code-annotation-container"),k=$("#additional-code-annotation-container"),v=$(document),w=$(window);f.a.loadCodeMirrorCode(),f.a.loadHighlightCode(),f.a.loadClipboardCode();var y=new(function(){function e(){this.lineGroupReferenceRegEx=/group([0-9]{1,2}|[A-Z])/,this.annotatedCodeListings=[]}return e.prototype.initialize=function(){var e=this;this.isInVideoMode=!1;var t=$(".listing-container"),n=0,i=$(".code-annotations-overlay-container[data-annotations]").length>0;0===t.length?v.trigger("annotatedListingsLoaded"):o.a.asyncEach(t,function(o){return e.annotatedCodeListings.push(new g(o,i,function(){++n>=t.length&&v.trigger("annotatedListingsLoaded")}))},function(){})},e.prototype.clean=function(){this.hideAll(),this.currentAnnotatedListing=null,this.activeCue=null,this.currentPausedAtCueball=null,this.lastPausedAtCueball=null,this.annotatedCodeListings&&this.annotatedCodeListings.length&&this.annotatedCodeListings.forEach(function(e){return e.clean()}),this.annotatedCodeListings=[]},e.prototype.registerGlobalEventHandlers=function(){var e=this;w.on("resizestart",function(){return e.hideAll()}),v.on("cueballWillBeReached",function(e,t,n){t.listingContainer.annotatedListing.preselect(n,!1)}),v.on("cueballReached",function(t,n,o,i){e.currentPausedAtCueball={textFragment:n,cueballReference:i||o},e.lastPausedAtCueball=e.currentPausedAtCueball,e.hasAnnotatedListing(n)&&(n.listingContainer.annotatedListing.goToAnimationStep(o,null==i),null!=i&&n.listingContainer.annotatedListing.preselect(i,!0))}),v.on("runnableScriptEditModeEntered",function(){return e.hideAll()}),v.on("runnableScriptEditModeLeft",function(e,t){}),v.on("audioBookCueChange",function(t){e.activeCue=t}),v.on("mouseup touchstart",function(t){var n=$(t.target).parents(".listing-container"),o=$(t.target).parents("#play-point");n.length||o.length||e.hideAll()}),v.on("videoModeEntered",function(){e.isInVideoMode=!0}),v.on("videoModeLeft",function(){e.isInVideoMode=!1}),v.on("playingTextFragmentChange",function(){return e.hideAll()})},e.prototype.hideAll=function(){this.hideAnnotations(),this.clearCodeHighlights()},e.prototype.consumePausedCueball=function(){this.currentPausedAtCueball=null},e.prototype.hideAnnotations=function(){$(".annotation-container.selected").removeClass("selected"),$(".annotation-container.show-tip").removeClass("show-tip"),b.removeClass("show-tip"),k.removeClass("show-tip"),b.removeClass("shown"),b.css("opacity:0"),k.removeClass("shown"),k.css("opacity:0")},e.prototype.clearCodeHighlights=function(){null!=this.currentAnnotatedListing&&(this.currentAnnotatedListing.$listingContainer.find(".listing-line-group").removeClass("selected highlighted pre-selected"),this.currentAnnotatedListing.$listingContainer.find(".hovered").removeClass("hovered"),this.currentAnnotatedListing.$additionalListingContainer&&(this.currentAnnotatedListing.$additionalListingContainer.find(".listing-line-group").removeClass("selected highlighted pre-selected"),this.currentAnnotatedListing.$additionalListingContainer.find(".hovered").removeClass("hovered")))},e.prototype.hasAnnotatedListing=function(e){return!!(e&&e.listingContainer&&e.listingContainer.annotatedListing)},e.prototype.unsubscribeEvents=function(e){e&&e.annotatedListing&&e.annotatedListing.unsubscribeEvents()},e.prototype.getLineGroupReference=function(e){var t=this.getLineGroupClassMatch(e);return t?t[1]:""},e.prototype.getLineGroupClass=function(e){var t=this.getLineGroupClassMatch(e);return t?t[0]:""},e.prototype.getLineGroupClassMatch=function(e){if(!e)return null;var t=e.attr("class").match(this.lineGroupReferenceRegEx);return t&&t.length>=2?t:null},e.prototype.isCurrentlyStoppedCue=function(e){return!(!this.lastPausedAtCueball||!e)&&(e.matchingTextFragment==this.lastPausedAtCueball.textFragment&&e.cueballReference==this.lastPausedAtCueball.cueballReference)},e}());y.registerGlobalEventHandlers();var x=t.a=y},431:function(e,t,n){"use strict";var o=n(0),i=function(){function e(){}return e.prototype.createSimpleLink=function(e,t,n){return""},e.prototype.createPointingLink=function(e,t,n,i){void 0===i&&(i=!0);var r=this.createSimpleLink(e,t,n);return new Promise(function(a,s){o.a.getFromOurBackend(o.a.getAbsoluteUrl("api/pointing/create"),function(e){e.link=(e.link||"").replace("#!","");var t=o.a.getClientAbsoluteUrl(e.link);i?$.ajax({url:"https://www.googleapis.com/urlshortener/v1/url?key=AIzaSyBX77QKufqi8RxQeDQ4ziGbcl1XuZ9Uayw",method:"post",contentType:"application/json; charset=utf-8",data:'{ longUrl: "'+t+'"}'}).done(function(e){a(e&&e.id?e.id:t)}).fail(function(e){a(t)}):a(t)},function(e){console.log("Error when producing the pointing link",e),a(r)},{bookShortName:e.shortName,bookElementShortName:t.shortName,meapVersion:t.meapVersion,paragraphIds:n.join(",")})})},e}();t.a=new i},434:function(e,t,n){var o=n(435);"string"==typeof o&&(o=[[e.i,o,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(324)(o,i);o.locals&&(e.exports=o.locals)},435:function(e,t,n){(e.exports=n(323)(!1)).push([e.i,".text-slide-menu{position:fixed;z-index:1007;max-width:100vw;transition:transform 0.35s ease-in-out}.text-slide-menu.text-slide-menu-left{left:0;transform:translateX(-100%)}.text-slide-menu.text-slide-menu-right{right:0;transform:translateX(100%)}.text-slide-menu.text-slide-menu-shown{transform:translateX(0)}\n",""])},436:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(3),i=new(function(){function e(){}return e.prototype.getSupportedLanguagesInfo=function(){var e=this;return new Promise(function(t,n){e.getSource().then(function(e){var n=e.TryItManager;return t(n.getSupportedLanguagesInfo())})})},e.prototype.executeCode=function(e,t,n,o,i){var r=this;return new Promise(function(a,s){r.getSource().then(function(r){var s=r.TryItManager;return a(s.executeCode(e,t,n,o,i))})})},e.prototype.renderTryItCreator=function(e){this.getSource().then(function(t){return t.TryItManager.renderTryItCreator(e)})},e.prototype.unmountAtNode=function(e){this.getSource().then(function(t){return t.TryItManager.unmountAtNode(e)})},e.prototype.getSource=function(){return this.sourcePromise||(this.sourcePromise=o.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise},e.prototype.constructSourcePromise=function(){return Promise.all([n.e(3),n.e(0),n.e(10),n.e(34)]).then(n.bind(null,662))},e}())},437:function(e,t,n){"use strict";var o=n(0),i=function(){function e(){}return e.prototype.initialize=function(e,t){if(this.book=e,this.bookElement=t,null!=this.bookElement.videos&&0!=this.bookElement.videos.length){for(var n=0,o=this.bookElement.videos;n<o.length;n++){var i=o[n],r=(i.referentItemID||"").split("-"),a=r[0],s=r[1];this.insertVideoNextToParagraph(i.id,a,s,i.videoUrl)}$(document).trigger("videoSectionsInserted")}else $(document).trigger("videoSectionsInserted")},e.prototype.insertVideoNextToParagraph=function(e,t,n,o){var i=$(Mustache.render(r,{id:e,refId:t,videoLocation:o})),a=$("[data-hash='"+n+"']");0==a.length&&(a=$("#"+t));var s=a.closest(".callout-container");s.length>0&&(a=s.next()),i.insertAfter(a),a[0].videoElement=i[0]},e.prototype.clean=function(){this.book=null,this.bookElement=null},e.prototype.addVideo=function(e,t,n){var i=this;o.a.postToOurBackend(o.a.getAbsoluteUrl("api/videos/addVideo"),function(o){i.insertVideoNextToParagraph(o.id,e,t,n)},function(e){alert("Error adding video. Try later")},{bookShortName:this.book&&this.book.shortName,bookElementShortName:this.bookElement&&this.bookElement.shortName,referentItemID:t?e+"-"+t:e,videoUrl:n})},e.prototype.removeVideo=function(e){o.a.postToOurBackend(o.a.getAbsoluteUrl("api/videos/removeVideo"),function(t){var n=$("[data-video-id='"+e+"']"),o=n.prev();o&&o.length&&(o[0].videoElement=null),n.remove()},function(e){alert("Error removing video. Try later")},{bookShortName:this.book&&this.book.shortName,videoId:e})},e}();t.a=new i;var r='<div class="browsable-container video-section-container row" data-video-id="{{{id}}}">\n    <div class="video-container flex-video">\n        <video class="section-videos" id="section-video-{{{refId}}}" src="{{{videoLocation}}}" controls="true"></video>\n    </div>\n</div>'},438:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(3),i=new(function(){function e(){}return e.prototype.load=function(e,t,n){void 0===n&&(n=!1),Promise.all([this.getSource()]).then(function(o){o[0].Exercises.initialize(e,t,n)})},e.prototype.clean=function(){this.sourcePromise&&this.getSource().then(function(e){return e.Exercises.clean()})},e.prototype.paragraphHasExercise=function(e){var t=this;return new Promise(function(n,o){t.getSource().then(function(t){var o=t.Exercises;return n(o.paragraphHasExercise(e))})})},e.prototype.deleteExerciseGroup=function(e){this.getSource().then(function(t){return t.Exercises.deleteExerciseGroup(e)})},e.prototype.createExerciseGroup=function(e){this.getSource().then(function(t){return t.Exercises.createExerciseGroup(e)})},e.prototype.getSource=function(){return this.sourcePromise||(this.sourcePromise=o.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise},e.prototype.constructSourcePromise=function(){return Promise.all([n.e(3),n.e(7),n.e(10),n.e(9),n.e(21)]).then(n.bind(null,708))},e}())},440:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(3),i=new(function(){function e(){this.shouldWishListABeShown=!0}return e.prototype.initialize=function(e){this.getWishListManagerSource().then(function(t){return t.WishListManager.initalize(e)})},e.prototype.clean=function(){this.getWishListManagerSource().then(function(e){return e.WishListManager.clean()})},e.prototype.addCurrentBookToWishList=function(){this.getWishListManagerSource().then(function(e){return e.WishListManager.addCurrentBookToWishList()})},e.prototype.getWishListManagerSource=function(){return this.wishListManagerSourcePromise||(this.wishListManagerSourcePromise=o.a.importWebpackModuleWithRetry(this.constructWishListManagerSourcePromise)),this.wishListManagerSourcePromise},e.prototype.constructWishListManagerSourcePromise=function(){return n.e(49).then(n.bind(null,663))},e}())},441:function(e,t,n){var o=n(442);"string"==typeof o&&(o=[[e.i,o,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(324)(o,i);o.locals&&(e.exports=o.locals)},442:function(e,t,n){(e.exports=n(323)(!1)).push([e.i,"#header-notification-container{background-color:#5facbe;line-height:1.8;color:white;text-align:center;margin:0 auto;user-select:none}@media screen and (max-width: 689px){#header-notification-container{font-size:0.75rem}}#header-notification-container a{color:white;font-weight:350;display:block;width:100%;font-size:13px;padding:2px}#header-notification-container .action-label{text-decoration:underline;display:inline-block}#header-notification-container .free-preview-notifier{cursor:pointer;font-weight:300;user-select:none;background-color:#ffcc00;color:#3c3c3c;transition:background-color 0.5s ease-in}#header-notification-container .free-preview-notifier.free-preview-starting .free-preview-heading-wrapper{display:flex;justify-content:center}#header-notification-container .free-preview-notifier.free-preview-running{background-color:#5cb85c;color:white;cursor:initial}#header-notification-container .free-preview-notifier span{font-size:90%;font-weight:300}#header-notification-container .free-preview-notifier i{display:inline-block;margin-left:0.25em}#header-notification-container .free-preview-notifier .free-preview-auto-start-countdown{position:relative;overflow:hidden;display:inline-block;height:1.4em;margin-left:0.3em;font-weight:bold}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper{transition:transform 1s ease-in-out}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper.activate-1{transform:translateY(-25%)}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper.activate-2{transform:translateY(-50%)}#header-notification-container .free-preview-notifier .free-preview-count-down-wrapper.activate-3{transform:translateY(-75%)}#header-notification-container .free-preview-notifier .free-preview-count-down-3{display:block}#header-notification-container .free-preview-notifier .free-preview-count-down-2{display:block}#header-notification-container .free-preview-notifier .free-preview-count-down-1{display:block}.promo-header{padding:0 0.5em;display:flex;align-items:center}.promo-header a{font-weight:normal}.promo-header a:hover{text-decoration:underline}.promo-header .fa{margin:0 0.5em;cursor:pointer}.add-dotd-book-to-cart{cursor:pointer}\n",""])},443:function(e,t,n){var o,i,r;o=this,i=-1,r={onVisible:function(e){var t=r.isSupported();if(!t||!r.hidden())return e(),t;var n=r.change(function(t,o){r.hidden()||(r.unbind(n),e())});return n},change:function(e){if(!r.isSupported())return!1;var t=i+=1;return r._callbacks[t]=e,r._listen(),t},unbind:function(e){delete r._callbacks[e]},afterPrerendering:function(e){var t=r.isSupported();if(!t||"prerender"!=r.state())return e(),t;var n=r.change(function(t,o){"prerender"!=o&&(r.unbind(n),e())});return n},hidden:function(){return!(!r._doc.hidden&&!r._doc.webkitHidden)},state:function(){return r._doc.visibilityState||r._doc.webkitVisibilityState||"visible"},isSupported:function(){return void 0!==r._doc.hidden||void 0!==r._doc.webkitHidden},_doc:document||{},_callbacks:{},_change:function(e){var t=r.state();for(var n in r._callbacks)r._callbacks[n].call(r._doc,e,t)},_listen:function(){if(!r._init){var e="visibilitychange";r._doc.webkitVisibilityState&&(e="webkit"+e);var t=function(){r._change.apply(r,arguments)};r._doc.addEventListener?r._doc.addEventListener(e,t):r._doc.attachEvent(e,t),r._init=!0}}},e.exports?e.exports=r:o.Visibility=r},533:function(e,t,n){"use strict";var o=function(){return function(e,t,n,o,i){this.id=e,this.paragraphOrdinal=t,this.paragraphHash=n,this.html=o,this.color=i}}(),i=n(4),r=n(0),a=function(){function e(){}return e.prototype.getTextAddendums=function(e,t){return new Promise(function(n,i){r.a.getFromOurBackend(r.a.getAbsoluteUrl("api/textAddendum/get"),function(e){e&&0!=e.length?n(e.map(function(e){return new o(e.id,e.paragraphOrdinal,e.paragraphHash,e.html,e.color)})):n([])},function(e){console.log("Error when updating exercise group"),i(e)},{bookShortName:e,bookElementShortName:t})})},e.prototype.addTextAddendum=function(e,t,n){return new Promise(function(o,i){r.a.postToOurBackend(r.a.getAbsoluteUrl("api/textAddendum/add"),function(e){e&&e.id?(n.id=e.id,o(!0)):o(!1)},function(e){return o(!1)},{bookShortName:e,bookElementShortName:t,paragraphOrdinal:n.paragraphOrdinal,paragraphHash:n.paragraphHash,html:n.html,color:n.color})})},e.prototype.deleteTextAddendum=function(e,t,n){return new Promise(function(o,i){r.a.postToOurBackend(r.a.getAbsoluteUrl("api/textAddendum/delete"),function(e){return o(!0)},function(e){return o(!1)},{id:n.id,bookShortName:e,bookElementShortName:t})})},e}(),s=new(function(){function e(){this.textAddendumsPromiseMap={}}return e.prototype.getTextAddendums=function(e,t){var n=this,o=e+"-"+t;return this.textAddendumsPromiseMap[o]?this.textAddendumsPromiseMap[o]:this.textAddendumsPromiseMap[o]=new Promise(function(o,i){n.getAppropriateService().then(function(n){n.getTextAddendums(e,t).then(function(e){return o(e)}).catch(function(e){return i(e)})}).catch(function(e){return i(e)})})},e.prototype.addTextAddendum=function(e,t,n){var o=this;return new Promise(function(i,r){o.getAppropriateService().then(function(o){o.addTextAddendum(e,t,n).then(function(e){return i(e)}).catch(function(e){return r(e)})}).catch(function(e){return r(e)})})},e.prototype.deleteTextAddendum=function(e,t,n){var o=this;return new Promise(function(i,r){o.getAppropriateService().then(function(o){o.deleteTextAddendum(e,t,n).then(function(e){return i(e)}).catch(function(e){return r(e)})}).catch(function(e){return r(e)})})},e.prototype.getAppropriateService=function(){var e=this;return new Promise(function(t,n){i.b.loadDeviceInfo().then(function(n){t(e.getService(n.platform))}).catch(function(e){return n(e)})})},e.prototype.getService=function(e){switch(e){case i.a.Browser:return new a;case i.a.Cordova:case i.a.Electron:throw new Error("Not yet implemented")}},e}()),l=n(67),c=n(12),d=n(14),u=n(2),h=$(document),p=function(){function e(){var e=this;this.$modal=$("#text-addendum-modal"),this.$modal.html(m),h.on("modalClosed",function(){h.off("click","#text-addendum-modal .text-addendum-save-button"),e.$modal.find("textarea").off("change keyup"),e.$modal.find("select").off("change"),e.$modal.off("mouseup touchend selectionchange"),e.$modal.find(".text-addendum-create-link").off("click")})}return e.prototype.show=function(e){var t=this;this.$modal.find("textarea").val("Enter text/HTML"),d.a.showFoundationModal(this.$modal),h.on("click","#text-addendum-modal .text-addendum-save-button",function(){var n=$("#text-addendum-modal textarea").val();n&&e&&e(n,t.$modal.find("select").val())}),this.$modal.find("textarea").on("keyup",function(){t.updatePreview(),t.handlePointerPressEnd()}),this.$modal.find("select").on("change",function(){return t.updatePreview()}),this.$modal.find(".text-addendum-create-link").on("click",function(){return t.handleCreateLinkClick()}),this.$modal.on("mouseup touchend selectionchange",function(e){return t.handlePointerPressEnd()}),this.updatePreview()},e.prototype.hide=function(){d.a.hideFoundationModal(this.$modal)},e.prototype.updatePreview=function(){this.$modal.find(".text-addendum-modal-preview-container").html('<div class="text-addendum-container text-addendum-'+this.$modal.find("select").val()+'">'+(this.$modal.find("textarea").val()||"&nbsp;")+"</div>")},e.prototype.handleCreateLinkClick=function(){var e=this.getCurrentlySelectedText();this.getSelectionStartIndex();if(e){var t=prompt("Enter link");if(t){var n=this.$modal.find("textarea");n.val(n.val().replace(e,'<a href="'+t+'">'+e+"</a>")),this.updatePreview()}}},e.prototype.handlePointerPressEnd=function(){var e=this;return clearTimeout(this.pressEndTimerId),this.pressEndTimerId=u.a.setTimeout(function(){e.hasSelectedText=!!e.getCurrentlySelectedText(),e.$modal.find(".text-addendum-create-link").css("display",e.hasSelectedText?"block":"none")},200),!0},e.prototype.getCurrentlySelectedText=function(){var e=this.$modal.find("textarea").get(0);return e.value.substring(e.selectionStart,e.selectionEnd)},e.prototype.getSelectionStartIndex=function(){return this.$modal.find("textarea").get(0).selectionStart||0},e}(),m='\n<span class="close-reveal-modal">&times;</span>\n<div class="row"><div class="small-12 columns">&nbsp;</div></div>\n<div class="row">\n    <div class="small-12 columns">    \n        <div class="text-addendum-header-container">\n            <h4>Text addendum</h4>\n            <label> Box color: <br>\n                <select>\n                    <option value="white">white</option>\n                    <option value="red">red</option>\n                    <option value="blue">blue</option>\n                    <option value="yellow">yellow</option>\n                    <option value="green">green</option>\n                </select>\n            </label>\n        </div>\n    </div>\n</div>\n<div class="row">\n    <div class="small-12 columns">    \n        <textarea rows="4"></textarea>\n        <small>(* select a piece of text to make it a link)</small>\n    </div>\n</div>\n<div class="row">\n    <div class="small-12 columns">\n        <hr>\n        <a href="javascript:void(0)" class="pull-left text-addendum-create-link" style="display: none;">create link</a>\n        <a href="javascript:void(0)" class="pull-right emphasized-button text-addendum-save-button">save</a>\n    </div>\n</div>\n<div class="row">\n    <div class="small-12 columns">\n        Preview\n        <div class="text-addendum-modal-preview-container"></div>\n    </div>\n</div>',g=new p,f=function(){function e(){this.handleDeleteTextAddendumClick=this.handleDeleteTextAddendumClick.bind(this)}return e.prototype.initialize=function(e,t,n){var o=this;this.book=e,this.bookElement=t,this.isEditMode=n,this.isEditMode||this.book.hasTextAddendums?s.getTextAddendums(e.shortName,t.shortName).then(function(e){o.textAddendums=e,o.createTextAddendums(),$(document).trigger("initialTextAddendumsCreated")}).catch(function(){$(document).trigger("initialTextAddendumsCreated")}):$(document).trigger("initialTextAddendumsCreated"),this.isEditMode&&$(document).on("click",".text-addendum-container .text-addendum-delete-button",this.handleDeleteTextAddendumClick)},e.prototype.clean=function(){this.book=null,this.bookElement=null,this.isEditMode=!1,this.textAddendums=null,$(document).off("click",".text-addendum-container .text-addendum-delete-button",this.handleDeleteTextAddendumClick)},e.prototype.createTextAddendums=function(){var e=this;this.textAddendums&&this.textAddendums.length&&this.textAddendums.forEach(function(t){return e.createTextAddendum(t)})},e.prototype.createTextAddendum=function(e){if(null!=e){var t=e.paragraphHash&&$(".readable-text[data-hash='"+e.paragraphHash+"']");t||(t=$(".readable-text[refid='"+e.paragraphOrdinal+"']")),t&&t.length&&(t.after('<div class="text-addendum-container text-addendum-'+e.color+'" data-id="'+e.id+'">\n                                '+e.html+'\n                                <span class="text-addendum-delete-button">\n                                    <i class="fa fa-2x fa-trash"></i>\n                                </span>\n                            </div>'),$(document).trigger("textLayoutModified"))}},e.prototype.addNewTextAddendum=function(e,t){var n=this;null==this.textAddendums&&(this.textAddendums=[]),g.show(function(i,r){g.hide();var a=new o(-1,e,t,i,r);s.addTextAddendum(n.book.shortName,n.bookElement.shortName,a).then(function(e){e?(n.textAddendums.push(a),n.createTextAddendum(a)):l.a.showNotification("Error saving. Try later.")}).catch(function(e){l.a.showNotification("Error saving. Try later.")})})},e.prototype.removeTextAddendum=function(e,t,n){var o=this;if(this.textAddendums&&this.textAddendums.length){var i=null;e&&(i=this.textAddendums.find(function(t){return t.id==e})),!i&&n&&(i=this.textAddendums.find(function(e){return e.paragraphHash==n})),!i&&t&&(i=this.textAddendums.find(function(e){return e.paragraphOrdinal==t})),i&&s.deleteTextAddendum(this.book.shortName,this.bookElement.shortName,i).then(function(e){e?(c.a.removeItemFromArray(o.textAddendums,i),$(".text-addendum-container[data-id='"+i.id+"']").remove(),$(document).trigger("textLayoutModified")):l.a.showNotification("Error saving. Try later.")}).catch(function(e){return l.a.showNotification("Error saving. Try later.")})}},e.prototype.paragraphHasTextAddendum=function(e,t){return null!=this.textAddendums.find(function(n){return n.paragraphHash==t||n.paragraphOrdinal==e})},e.prototype.handleDeleteTextAddendumClick=function(e){var t=$(e.target).closest(".text-addendum-container"),n=parseInt(t.attr("data-id"));n&&confirm("Delete?")&&this.removeTextAddendum(n)},e}();t.a=new f},534:function(e,t,n){"use strict";var o=n(2),i=n(334),r=n(4),a=n(418),s=n(67),l=n(535),c=n(431),d=n(417),u=n(86),h=n(14),p=n(70),m=n(12),g=$(document),f=r.b.isTouchDevice(),b=function(){function e(){var e=this;this.isTextSelectionActionEnabled=!0,this.handlePointerPressStart=this.handlePointerPressStart.bind(this),this.handlePointerPressEnd=this.handlePointerPressEnd.bind(this),this.handlePointerOnHover=this.handlePointerOnHover.bind(this),g.on("requestShowTooltip",function(){return e.showTooltip()})}return e.prototype.initializeUiElementsIfNecessary=function(){if(null==this.$menuReferenceElement||0==this.$menuReferenceElement.length){this.$menuReferenceElement=$("#text-selection-menu-reference-node");try{this.$menuReferenceElement.foundation("tooltip")}catch(e){}if(window.Foundation){var e=window.Foundation.libs.tooltip.getTip(this.$menuReferenceElement);e&&e.length&&(this.initialTooltipTitle=e.html())}}},e.prototype.initialize=function(e,t){this.currentBook=e,this.currentBookElement=t,this.currentBookElement.reviewVersion>0||(this.initializeUiElementsIfNecessary(),g.on("mousedown touchstart",this.handlePointerPressStart),r.b.isTouchDevice()?o.a.onEventWithCooldown(g,"mouseup touchend selectionchange",this.handlePointerPressEnd):o.a.onEventWithCooldown(g,"mouseup touchend",this.handlePointerPressEnd))},e.prototype.clean=function(){this.$selectedFragments=[],this.currentBook=null,this.currentBookElement=null,g.off("mousedown touchstart",this.handlePointerPressStart),g.off("mouseup touchend selectionchange",this.handlePointerPressEnd);try{this.hideToolTips()}catch(e){}$(".scrambled").off()},e.prototype.handlePointerOnHover=function(e){if(!window.getSelection().toString().trim().length){var t=$(e);this.$selectedFragments&&0!==this.$selectedFragments.length&&this.$selectedFragments.find(function(e){return e.attr("refid")==t.attr("refid")})||(this.$selectedFragments=[t])}},e.prototype.handlePointerPressStart=function(e){var t=this,n=$(e.target);if(n.closest(".tooltip").length<=0)this.hideTextSelectionTooltip();else if(this.isTextSelectionActionEnabled){if(n.is(".note-button"))this.highlightCurrentNoteSelection(),this.annotateCurrentSelection(),this.hideToolTips(),this.isTextSelectionActionEnabled=!1;else if(n.is(".tweet-button"))this.tweetCurrentSelection(),this.isTextSelectionActionEnabled=!1,this.hideToolTips();else if(n.is(".highlight-button"))this.highlightCurrentSelection(),this.hideToolTips(),this.isTextSelectionActionEnabled=!1;else if(n.is(".link-button"))this.hideToolTips(),this.currentBook&&this.$selectedFragments&&(g.trigger("paragraphsSelected",[this.$selectedFragments]),l.a.createPointingSelection(this.currentBook,this.currentBookElement,this.$selectedFragments)),this.isTextSelectionActionEnabled=!1;else if(n.is(".forum-button")){if(this.hideToolTips(),this.currentBook&&this.$selectedFragments)(i=this.$selectedFragments[0])&&i[0]&&u.a.requestOpenParagraphSideMenu(i[0].paragraphBubble);this.isTextSelectionActionEnabled=!1}else if(n.is(".error-report")){var i;if(this.hideToolTips(),this.currentBook&&this.$selectedFragments)if((i=this.$selectedFragments[0])&&i[0]){var r=$("#modal-feedback");p.a.getSource().then(function(){o.a.setTimeout(function(){return h.a.showFoundationModal(r)},300),r.find("#feedback-subject").val("Content Error Report").change(),r.find("#feedback-content").val("Found an error:\n"+t.currentTextSelection),r.find(".paragraph-location-input").val(t.$selectedFragments[0].attr("data-hash")||t.$selectedFragments[0].attr("refId"))})}this.isTextSelectionActionEnabled=!1}this.isTextSelectionActionEnabled||setTimeout(function(){t.isTextSelectionActionEnabled=!0},300)}},e.prototype.handlePointerPressEnd=function(e){var t=this,n=null,i=null,r=!1;$(e.target).closest("#text-selection-menu-reference-node").length||o.a.setTimeout(function(){var e=window.getSelection();if(0!==e.rangeCount){var o=e.getRangeAt(0);if(n=$(o.startContainer).parents(".readable-text"),i=$(o.endContainer).parents(".readable-text"),0===o.endOffset&&n.attr("id")!=i.attr("id")&&(i=i.prev()),0!==n.length){t.currentTextSelection=e.toString().trim(),t.currentTextSelectionStartOffset=-1,r=t.currentTextSelection.length>3;var a=parseInt(n.attr("id")),s=parseInt(i.attr("id"));if(!Number.isNaN(a)&&!Number.isNaN(s)){t.$selectedFragments=[];for(var l=a;l<=s;l++){var c=$(document.getElementById(l+""));c.length&&t.$selectedFragments.push(c)}a==s&&m.a.countOccurences(t.currentTextSelection,n.text())>1&&(t.currentTextSelectionStartOffset=t.getCurrentlySelectedOffset()),!!!t.$selectedFragments.find(function(e){return e.is(".scrambled")})&&r&&t.showTooltip(t.isBackwardSelection(e))}}}},150)},e.prototype.getCurrentlySelectedOffset=function(){var e=window.getSelection(),t=e.anchorNode,n=h.a.getFirstBlockAncestor(t);if(null==n||null==t)return-1;for(var o=h.a.getAllDescendantTextNodes(n),i=e.anchorOffset,r=0;r<o.length;r++){var a=o[r];if(a==t)return i;i+=a.textContent.length}return-1},e.prototype.isBackwardSelection=function(e){var t=!1;try{var n=e.anchorNode.compareDocumentPosition(e.focusNode);(!n&&e.anchorOffset>e.focusOffset||n===Node.DOCUMENT_POSITION_PRECEDING)&&(t=!0)}catch(e){console.log("Error when determining backward selection",e)}return t},e.prototype.showTooltip=function(e){if(void 0===e&&(e=!1),window.Foundation){var t,n=this.$menuReferenceElement;t=window.getSelection().getRangeAt(0).getBoundingClientRect();var o=(e&&!f?t.top:t.bottom)+g.scrollTop()+(e?60:40);f&&(o+=20),n.css({top:o,left:t.left+t.width/2});var i=window.Foundation.libs.tooltip.getTip(n);if(0==i.length){if(console.log("Cannot find text selection tip:",this.initialTooltipTitle),!this.initialTooltipTitle)return;if(n.attr("title",this.initialTooltipTitle),window.Foundation.libs.tooltip.create(n),null==(i=window.Foundation.libs.tooltip.getTip(n)))return}i.velocity({translateY:5},{duration:0}),i.removeClass("tip-top tip-bottom"),i.addClass("tip-bottom"),window.Foundation.libs.tooltip.reposition(n,i,n.attr("class")),i.stop(),i.velocity("fadeIn"),i.velocity({translateY:0},{duration:100}),g.trigger("tooltipOpened")}},e.prototype.hideToolTips=function(){this.hideTextSelectionTooltip()},e.prototype.hideTextSelectionTooltip=function(){window.Foundation&&(window.Foundation.libs.tooltip.hide(this.$menuReferenceElement),g.trigger("tooltipClosed"))},e.prototype.highlightCurrentNoteSelection=function(){this.$selectedFragments[0]&&0!=this.$selectedFragments[0].length&&this.currentTextSelection&&a.a.highlightNoteSelection(this.$selectedFragments[0],this.currentTextSelection)},e.prototype.tweetCurrentSelection=function(){var e=this;if(this.$selectedFragments[0]&&0!=this.$selectedFragments[0].length&&this.currentTextSelection){var t=this.currentTextSelection;this.currentBook?(s.a.showTemporaryNotification("Getting your tweet link"),c.a.createPointingLink(this.currentBook,this.currentBookElement,[this.$selectedFragments[0].attr("refid")]).then(function(n){n=(n||"").replace("#!",""),e.tweet(t,n),s.a.hideNotification()}).catch(function(n){e.tweet(t,e.getCurrentlySelectedParagraphSimpleLink()),s.a.hideNotification()})):this.tweet(t,this.getCurrentlySelectedParagraphSimpleLink())}},e.prototype.highlightCurrentSelection=function(){this.$selectedFragments[0]&&0!=this.$selectedFragments[0].length&&this.currentTextSelection&&(a.a.createHighlightSelection(this.$selectedFragments,this.currentTextSelection,this.currentTextSelectionStartOffset),this.clearTextSelection())},e.prototype.tweet=function(e,t){window.open("https://twitter.com/intent/tweet?url="+encodeURIComponent(t)+"&text="+encodeURIComponent(e),"twitterwindow","height=450, width=550, toolbar=0, location=0, menubar=0, directories=0, scrollbars=0")},e.prototype.annotateCurrentSelection=function(){this.$selectedFragments[0]&&0!=this.$selectedFragments[0].length&&d.a.annotate(this.$selectedFragments[0].get(0))},e.prototype.getCurrentlySelectedParagraphSimpleLink=function(){if(this.$selectedFragments[0]){var e=this.$selectedFragments[0].attr("refid");if(this.currentBook&&this.currentBookElement)return i.a.formLink(this.currentBook,this.currentBookElement,e)}},e.prototype.getCurrentSelectionReadableText=function(){return $(window.getSelection().anchorNode).parents(".readable-text")},e.prototype.clearTextSelection=function(){window.getSelection&&(window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges())},e}();t.a=new b},535:function(e,t,n){"use strict";var o,i,r=n(322),a=n(328),s=n(2),l=n(17),c=n(5),d=n(67),u=n(431),h=(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),p=$(document),m=$(window);!function(e){e[e.Default=0]="Default",e[e.DisplayingActionResult=1]="DisplayingActionResult"}(i||(i={}));var g=function(){function e(){this.dragStartPosition=0,this.$draggedPoint=null,this.pointingInfoBox=document.getElementById("pointing-info-box"),null==this.pointingInfoBox&&($(document.body).append('<div id="pointing-info-box"></div>'),this.pointingInfoBox=document.getElementById("pointing-info-box")),this.$pointingInfoBox=$(this.pointingInfoBox),this.handleBoxClose=this.handleBoxClose.bind(this),this.handleParagraphClick=this.handleParagraphClick.bind(this),this.handleActionClick=this.handleActionClick.bind(this),this.handlePositionPointMouseDown=this.handlePositionPointMouseDown.bind(this),this.handleDocumentMouseMove=this.handleDocumentMouseMove.bind(this),this.handleDocumentMouseUp=this.handleDocumentMouseUp.bind(this),this.handleDragPaused=this.handleDragPaused.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this),p.on("mouseup",this.handleDocumentMouseUp)}return e.prototype.initialize=function(){this.clean()},e.prototype.clean=function(){this.startSectionParagraph=null,this.endSectionParagraph=null,this.$draggedPoint=null,this.book=null,this.bookElement=null,this.error="",this.pointingLink="",this.state=i.Default,this.renderCurrentState(),this.$pointingInfoBox.is(".shown")&&this.hideBox(),p.off("mousemove",this.handleDocumentMouseMove),m.off("resizestop",this.handleResizeStop),clearTimeout(this.dragPauseTimeoutId)},e.prototype.onStartParagraphSelected=function(e){this.startSectionParagraph=e,this.renderCurrentState()},e.prototype.onEndParagraphSelected=function(e){this.endSectionParagraph=e,this.renderCurrentState()},e.prototype.createPointingSelection=function(e,t,n){if(n&&n.length){this.startSectionParagraph=n[0][0],this.endSectionParagraph=n[n.length-1][0],this.$pointingStartPoint=$("#pointing-start-point"),this.$pointingEndPoint=$("#pointing-end-point"),this.$pointingStartPoint.off("mousedown",this.handlePositionPointMouseDown),this.$pointingEndPoint.off("mousedown",this.handlePositionPointMouseDown),this.$pointingStartPoint.on("mousedown",this.handlePositionPointMouseDown),this.$pointingEndPoint.on("mousedown",this.handlePositionPointMouseDown);var o=l.a.getTextFragmentElements();o&&o[o.length-1]?this.lastParagraphId=o[o.length-1].id:this.lastParagraphId=1e3,this.book=e,this.bookElement=t,this.state=i.Default,this.error="",this.pointingLink="",this.renderCurrentState(),this.showBox(),this.makeParagraphsClickable()}},e.prototype.handlePositionPointMouseDown=function(e){var t=$(e.currentTarget);return this.$draggedPoint=t,p.on("mousemove",this.handleDocumentMouseMove),this.dragStartPosition=e.pageY,e.preventDefault(),e.stopImmediatePropagation(),!1},e.prototype.handleDocumentMouseMove=function(e){if(this.$draggedPoint){clearTimeout(this.dragPauseTimeoutId);var t=e.pageY-this.dragStartPosition,n=c.a.getComputedTranslateY(this.$draggedPoint[0]);this.$draggedPoint.css("transform","translateY("+(n+t)+"px)"),this.dragStartPosition=e.pageY,this.dragPauseTimeoutId=setTimeout(this.handleDragPaused,100)}},e.prototype.handleDocumentMouseUp=function(e){p.off("mousemove",this.handleDocumentMouseMove),this.handleDragPaused(e,!0),this.dragStartPosition=0,this.$draggedPoint=null},e.prototype.handleDragPaused=function(e,t){if(this.$draggedPoint){var n=$(this.startSectionParagraph),o=$(this.endSectionParagraph),r=this.$draggedPoint.is("#pointing-start-point"),a=(r?this.startSectionParagraph:this.endSectionParagraph,c.a.getComputedTranslateY(this.$draggedPoint[0])),s=this.getStartIconPosition(),l=this.getEndIconPosition(),d=parseInt(n.attr("id")),u=parseInt(o.attr("id")),h=null;if(a<s)for(var p=d;p>=0;p--){var m=document.getElementById(p+"");if(this.isReferentParagraph(m,a)){h=m;break}}else if(a>l){var g=this.lastParagraphId;for(p=u;p<=g;p++){m=document.getElementById(p+"");if(this.isReferentParagraph(m,a)){h=m;break}}}else for(p=d;p<=u;p++){m=document.getElementById(p+"");if(this.isReferentParagraph(m,a)){h=m;break}}if(h){var f=parseInt(h.id);r?f<=u?this.startSectionParagraph=h:(this.startSectionParagraph=this.endSectionParagraph,this.endSectionParagraph=h):f>=d?this.endSectionParagraph=h:(this.endSectionParagraph=this.startSectionParagraph,this.startSectionParagraph=h),!0===t?(this.error="",this.state=i.Default,this.pointingLink="",this.renderCurrentState()):this.highlightSelectedParagraphs()}else!0===t&&(this.error="",this.state=i.Default,this.pointingLink="",this.renderStartEndIcons())}},e.prototype.handleResizeStop=function(){this.$pointingInfoBox&&this.$pointingInfoBox.is(".shown")&&this.renderStartEndIcons()},e.prototype.isReferentParagraph=function(e,t){if(!e)return!1;var n=this.getStartIconPositionForParagraph(e),o=this.getEndIconPositionForParagraph(e);return n<=t&&t<=o},e.prototype.renderCurrentState=function(){(this.startSectionParagraph||this.endSectionParagraph)&&(this.highlightSelectedParagraphs(),this.renderStartEndIcons(),a.render(r.createElement(f,{startParagraph:this.startSectionParagraph,endParagraph:this.endSectionParagraph,state:this.state,error:this.error,pointingLink:this.pointingLink,onClose:this.handleBoxClose,onActionClick:this.handleActionClick}),this.pointingInfoBox))},e.prototype.hideBox=function(e){var t=this;m.off("resizestop",this.handleResizeStop),this.$pointingInfoBox.removeClass("shown"),this.$pointingStartPoint.removeClass("shown"),this.$pointingEndPoint.removeClass("shown"),s.a.setTimeout(function(){a.unmountComponentAtNode(t.pointingInfoBox),t.$pointingInfoBox.css("display","none"),e&&e()},250)},e.prototype.showBox=function(){this.renderCurrentState(),this.$pointingInfoBox.css("display","block"),this.$pointingInfoBox.addClass("shown"),m.off("resizestop",this.handleResizeStop),m.on("resizestop",this.handleResizeStop)},e.prototype.handleBoxClose=function(){var e=this;this.unmakeParagraphsClickable(),$(".paragraph-selected").removeClass("paragraph-selected"),this.hideBox(function(){return e.clean()})},e.prototype.makeParagraphsClickable=function(){$(".readable-text").addClass("clickable"),p.off("click",".readable-text",this.handleParagraphClick),p.on("click",".readable-text",this.handleParagraphClick)},e.prototype.unmakeParagraphsClickable=function(){$(".readable-text").removeClass("clickable"),p.off("click",".readable-text",this.handleParagraphClick)},e.prototype.handleParagraphClick=function(e){var t=e.currentTarget;if(null!=this.startSectionParagraph&&null!=this.endSectionParagraph){var n=parseInt(t.id),o=parseInt(this.startSectionParagraph.id),r=parseInt(this.endSectionParagraph.id),a=!1;return o+1!=r||n!==o&&n!==r?n===o||n===r?(this.startSectionParagraph=t,this.endSectionParagraph=t,a=!1):(n<=o&&(this.startSectionParagraph=t,a=!1),n>=r&&(this.endSectionParagraph=t,a=!1)):(this.startSectionParagraph=t,this.endSectionParagraph=t,a=!1),o<n&&n<r&&(Math.abs(o-n)<Math.abs(r-n)?(this.startSectionParagraph=t,a=!1):(this.endSectionParagraph=t,a=!1)),a&&(this.state=i.Default,this.error="",this.pointingLink=""),this.renderCurrentState(),e.preventDefault(),e.stopImmediatePropagation(),!1}},e.prototype.handleActionClick=function(){var e=this;this.error="",this.pointingLink="",this.unmakeParagraphsClickable(),this.state=i.DisplayingActionResult,u.a.createPointingLink(this.book,this.bookElement,this.getSelectedParagraphs().map(function(e){return e.attr("id")}),!1).then(function(t){t=(t||"").replace("#!",""),e.pointingLink=t,e.renderCurrentState()}).catch(function(t){e.error="Error when creating pointing link",e.pointingLink="",e.renderCurrentState()}),this.renderCurrentState()},e.prototype.highlightSelectedParagraphs=function(){$(".paragraph-selected").removeClass("paragraph-selected"),this.getSelectedParagraphs().forEach(function(e){return e.addClass("paragraph-selected")})},e.prototype.renderStartEndIcons=function(){this.$pointingStartPoint.addClass("shown"),this.$pointingEndPoint.addClass("shown");$(this.startSectionParagraph),$(this.endSectionParagraph);this.$pointingStartPoint.is(".velocity-animating")||(this.$pointingStartPoint.velocity({translateY:[this.getStartIconPosition(),c.a.getComputedTranslateY(this.$pointingStartPoint[0])]},250),this.$pointingEndPoint.velocity({translateY:[this.getEndIconPosition(),c.a.getComputedTranslateY(this.$pointingEndPoint[0])]},250))},e.prototype.getStartIconPosition=function(){return this.getStartIconPositionForParagraph(this.startSectionParagraph)},e.prototype.getStartIconPositionForParagraph=function(e){return l.a.getTextElementPositionPointTop($(e))-this.$pointingStartPoint.height()/2},e.prototype.getEndIconPosition=function(){return this.getEndIconPositionForParagraph(this.endSectionParagraph)},e.prototype.getEndIconPositionForParagraph=function(e){var t=$(e);return l.a.getTextElementPositionPointTop(t)+t.height()-.4*this.$pointingEndPoint.height()},e.prototype.getSelectedParagraphs=function(){if(this.startSectionParagraph||this.endSectionParagraph){if(this.startSectionParagraph&&this.endSectionParagraph){var e=parseInt(this.startSectionParagraph.id),t=parseInt(this.endSectionParagraph.id);if(Number.isNaN(e)||Number.isNaN(t))return[];for(var n=[],o=e;o<=t;o++){var i=document.getElementById(o+"");i&&n.push($(i))}return n}return this.startSectionParagraph&&!this.endSectionParagraph?[$(this.startSectionParagraph)]:!this.startSectionParagraph&&this.endSectionParagraph?[$(this.endSectionParagraph)]:(console.log("Shouldn't be here"),[])}return[]},e}(),f=function(e){function t(t){var n=e.call(this,t)||this;return n.handleActionClick=n.handleActionClick.bind(n),n.handleCopyToCliboardElementCreated=n.handleCopyToCliboardElementCreated.bind(n),n.handleCloseClick=n.handleCloseClick.bind(n),n}return h(t,e),t.prototype.shouldComponentUpdate=function(e){return this.props.startParagraph!==e.startParagraph||this.props.endParagraph!==e.endParagraph||this.props.state!==e.state||this.props.error!==e.error||this.props.pointingLink!==e.pointingLink},t.prototype.render=function(){return r.createElement("div",null,r.createElement("div",{className:"pointing-info-left-container"},this.renderPointingInfoLeftContent()),r.createElement("div",{className:"pointing-info-middle-container"},this.renderPoingintIfoMiddleContent()),r.createElement("div",{className:"pointing-info-right-container"},r.createElement("i",{className:"fa fa-close",onClick:this.handleCloseClick})))},t.prototype.renderPointingInfoLeftContent=function(){return this.props.state===i.Default?r.createElement("i",{className:"fa fa-fw fa-link","aria-hidden":"true",title:"create link",onClick:this.handleActionClick}):this.props.error?r.createElement("i",{className:"fa fa-fw fa-undo","aria-hidden":"true",title:"try again",onClick:this.handleActionClick}):this.props.pointingLink?r.createElement("i",{className:"fa fa-fw fa-clipboard copy-to-clipboard",title:"copy to clipboard","aria-hidden":"true",ref:this.handleCopyToCliboardElementCreated}):r.createElement("i",{className:"fa fa-fw fa-spinner fa-spin",title:"loading...","aria-hidden":"true"})},t.prototype.renderPoingintIfoMiddleContent=function(){return this.props.state===i.Default?r.createElement("a",{href:"javascript:void(0)",onClick:this.handleActionClick},"create link"):this.props.error?r.createElement("span",{className:"error-message"}," ",this.props.error," "):this.props.pointingLink?r.createElement("input",{readOnly:!0,type:"text",value:this.props.pointingLink,ref:function(e){return e&&e.select&&e.select()}}):r.createElement("span",null,"Creating link ...")},t.prototype.handleCloseClick=function(){this.props.onClose&&this.props.onClose()},t.prototype.handleActionClick=function(){this.props.onActionClick&&this.props.onActionClick()},t.prototype.handleCopyToCliboardElementCreated=function(){var e=this,t=new window.Clipboard("#pointing-info-box .copy-to-clipboard",{text:function(){return e.props.pointingLink}});t.on("success",function(e){return d.a.showTemporaryNotification("Link copied to clipboard")}),t.on("error",function(e){d.a.showTemporaryNotification("Unfortunatly your environment doesn't support copying to clipboard")})},t}(r.Component);t.a=new g},537:function(e,t,n){"use strict";var o=n(0),i=window,r=function(){function e(){this.modeURL="vendor/codemirror/mode/%N/%N.js",this.loading={}}return e.prototype.requireMode=function(e,t,n){var i=this;if(void 0===n&&(n=function(){}),t){if(e.modes.hasOwnProperty(t))return this.ensureDeps(e,t,n);if(this.loading.hasOwnProperty(t))return this.loading[t].push(n);var r=o.a.getLivebookCdn()+this.modeURL.replace(/%N/g,t),a=document.createElement("script");a.src=r;var s=document.getElementsByTagName("script")[0],l=this.loading[t]=[n];e.on(a,"load",function(){i.ensureDeps(e,t,function(){for(var e=0;e<l.length;++e)l[e]()})}),s.parentNode.insertBefore(a,s)}else n&&n()},e.prototype.autoLoadMode=function(e,t,n){var o=this;i.CodeMirror=e,e.modes.hasOwnProperty(n)?this.setLanguageMode(e,t):this.requireMode(e,n,function(){return o.setLanguageMode(e,t)})},e.prototype.setLanguageMode=function(e,t){var n=t.getOption("mode")||"";switch(n.toLowerCase()){case"java":n="text/x-java";break;case"scala":n="text/x-scala";break;case"kotlin":n="text/x-kotlin";break;case"ruby":n="text/x-ruby";break;case"python":n="text/x-python";break;case"html":case"htmlmixed":case"css":case"javascript":n="text/html"}t.setOption("mode",n)},e.prototype.splitCallback=function(e,t){var n=t;return function(){0==--n&&e()}},e.prototype.ensureDeps=function(e,t,n){var o=e.modes[t].dependencies;if(!o)return n();for(var i=[],r=0;r<o.length;++r)e.modes.hasOwnProperty(o[r])||i.push(o[r]);if(!i.length)return n();var a=this.splitCallback(n,i.length);for(r=0;r<i.length;++r)this.requireMode(e,i[r],a)},e}();t.a=new r},538:function(e,t,n){var o=n(578);"string"==typeof o&&(o=[[e.i,o,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(324)(o,i);o.locals&&(e.exports=o.locals)},539:function(e,t,n){e.exports=n(592)},562:function(e,t,n){"use strict";var o=n(0),i=function(){function e(){}return e.prototype.reset=function(){this.tocAndIndexPromise=null,this.bookResourcesPromise=null,this.previousTocBookShortName="",this.previousTocBookMeapVersion=-1,this.previousResourcesBookShortName=""},e.prototype.getMeapVersions=function(e){return new Promise(function(t,n){o.a.postToOurBackend(o.a.getAbsoluteUrl("api/book/getMeapVersions/"+e),function(e){e&&e.length?t(e.map(function(e){return e.version}).filter(function(e){return e>0})):t([])},function(e){t([])})})},e.prototype.getAccessibleResources=function(e,t){var n=this;return void 0===t&&(t=!1),e?(t&&(this.bookResourcesPromise=null),this.previousResourcesBookShortName==e&&this.bookResourcesPromise?this.bookResourcesPromise:(this.previousResourcesBookShortName=null,this.bookResourcesPromise=new Promise(function(t,i){o.a.postToOurBackend(o.a.getAbsoluteUrl("api/catalog/getAccessibleResources?cache=true"),function(i){n.previousResourcesBookShortName=e;var r=i.downloads||[];r&&r.length&&(r.sort(function(e,t){return e.ordinal-t.ordinal}),r.forEach(function(e){e.url&&!e.url.startsWith("http")&&(e.url=o.a.getMarketplaceS3Url(e.url))}));var a=i.restrictedDownloads||[];a&&a.length&&a.forEach(function(e){e.linkText=e.restrictedDownloadType||e.description||e.productFormat,"SOURCE_CODE"==e.linkText&&(e.linkText="Source Code"),(!e.url||e.url.indexOf("restrictedDownload")>=0)&&(e.url=o.a.getProductionMarketplaceUrl("dashboard/download?restrictedDownloadId="+e.id),e.licenseId&&(e.url+="&licenseId="+e.licenseId))}),t(i)},function(e){return t(null)},{bookShortName:e})}))):Promise.resolve(null)},e.prototype.getTocAndIndex=function(e,t,n){if(!e)return Promise.reject({});var o=t&&n&&n.meapVersion||0,i=t&&n&&n.reviewVersion||0;return this.tocAndIndexPromise&&this.previousTocBookShortName===e&&this.previousTocBookMeapVersion==o?this.tocAndIndexPromise:(this.previousTocBookShortName=null,this.previousTocBookMeapVersion=null,this.tocAndIndexPromise=this.getTocAndIndexPromise(e,o,i))},e.prototype.getTocAndIndexPromise=function(e,t,n){var i=this,r="";return r=t?"/"+e+"/v-"+t+"/tocAndIndex.json":n?"/"+e+"/r-"+n+"/tocAndIndex.json":"/"+e+"/tocAndIndex.json",new Promise(function(n,a){$.ajax({url:o.a.getAwsUrl(r),dataType:"json"}).then(function(o){"string"==typeof o&&(o=JSON.parse(o)),"string"==typeof o.index&&(o.index=JSON.parse(o.index)),"string"==typeof o.toc&&(o.toc=JSON.parse(o.toc)),i.previousTocBookShortName=e,i.previousTocBookMeapVersion=t,n(o)}).fail(function(e){return a(e)})})},e}(),r=n(32),a=function(){function e(){this.webService=new i}return e.prototype.getTocAndIndex=function(e,t,n){return t&&t.hasBeenDownloaded?r.a.loadTocAndIndex(t):this.webService.getTocAndIndex(e,t,n)},e.prototype.getAccessibleResources=function(e,t){throw new Error("Not yet implemented")},e.prototype.reset=function(){},e}(),s=n(4),l={bookResourcesService:new Promise(function(e,t){s.b.loadDeviceInfo().then(function(t){e(function(e){switch(e){case s.a.Browser:return new i;case s.a.Cordova:case s.a.Electron:return new a}}(t.platform))}).catch(function(e){return t(e)})})};t.a=l},563:function(e,t,n){"use strict";var o=n(12),i=n(115),r=n(390),a=n(0),s=function(){function e(){}return e.prototype.fetch=function(e){return new Promise(function(t,n){r.a.fetch(e).then(function(e){return t(e.bookmarks)}).catch(function(e){return n(e)})})},e.prototype.addBookmarks=function(e,t){return t&&0!==t.length?new Promise(function(n,o){a.a.postToOurBackend(a.a.getAbsoluteUrl("api/bookmarks/addBookmarks"),function(e){for(var o=e,i=0;i<o.length;i++)t[i].id=o[i];n(!0)},function(e){console.log("Error when adding bookmarks",e),o(e)},{bookmarks:JSON.stringify(t),bookShortName:e.book.shortName})}):Promise.resolve(!0)},e.prototype.addBookmark=function(e,t,n,o,s){var l=new i.a(-1,e.shortName,e.ordinal,t,n,o,s,Date.now(),e.meapVersion);return l.isBeingSynced=!0,r.a.bookmarksData||(r.a.bookmarksData={bookBookmarks:[],bookElementBookmarks:[]}),new Promise(function(i,c){a.a.postToOurBackend(a.a.getAbsoluteUrl("api/bookmarks/addBookmark"),function(e){l.id=e.bookmarkID,l.isBeingSynced=!1,r.a.bookmarksData.bookBookmarks.push(l),r.a.bookmarksData.bookElementBookmarks.push(l),i(l.id)},function(e){console.log("Error when syncing bookmark",e),l.isBeingSynced=!1,c(e)},{book:e.book.shortName,bookElement:e.shortName,bookElementOrdinal:e.ordinal,contentID:t,contentHash:n,bookmarkedText:o,contentLocation:s,meapVersion:e.meapVersion})})},e.prototype.removeBookmark=function(e,t){var n=r.a.bookmarksData&&r.a.bookmarksData.bookElementBookmarks.find(function(e){return e.contentID===t});return n?this._removeBookmark(n):Promise.resolve(!0)},e.prototype.removeBookmarkById=function(e){var t=r.a.bookmarksData&&r.a.bookmarksData.bookElementBookmarks.find(function(t){return t.id==e});return t||null==r.a.bookmarksData||(t=r.a.bookmarksData&&r.a.bookmarksData.bookBookmarks.find(function(t){return t.id==e})),t?this._removeBookmark(t):Promise.resolve(!0)},e.prototype._removeBookmark=function(e){return new Promise(function(t,n){a.a.postToOurBackend(a.a.getAbsoluteUrl("api/bookmarks/removeBookmark"),function(n){o.a.removeItemFromArray(r.a.bookmarksData.bookBookmarks,e),o.a.removeItemFromArray(r.a.bookmarksData.bookElementBookmarks,e),t(!0)},function(e){console.log("Error when syncing bookmark",e),n(e)},{bookmarkID:e.id})})},e}(),l=n(32),c=function(){function e(){this.webService=new s}return e.prototype.fetch=function(e){var t=this,n=e.book;return this.dataPromise&&this.previousRequestBackground&&this.previousRequestBackground.bookShortName===n.shortName?this.previousRequestBackground.bookElementShortName===e.shortName?this.dataPromise:(this.previousRequestBackground={bookShortName:n.shortName,bookElementShortName:e.shortName},this.dataPromise=new Promise(function(n,o){t.dataPromise.then(function(o){t.bookmarksData=o,t.bookmarksData.bookElementBookmarks=o.bookBookmarks.filter(function(t){return t.bookElementShortName===e.shortName}),n(t.bookmarksData)}).catch(function(e){console.log("Couldn't load bookmarks"),o(e)})})):this.dataPromise=new Promise(function(n,o){l.a.loadBookmarks(e.book.shortName).then(function(o){var i=t.bookmarksData={bookBookmarks:o,bookElementBookmarks:o.filter(function(t){return t.bookElementShortName===e.shortName})},r=o.filter(function(e){return e.hasNotBeenStoredOnServer}),a=function(){t.webService.fetch(e).then(function(o){t.bookmarksData={bookBookmarks:o.bookBookmarks.slice(),bookElementBookmarks:o.bookElementBookmarks.slice()},l.a.saveBookmarks(e,o.bookBookmarks),n(t.bookmarksData)}).catch(function(e){t.bookmarksData=i,n(i)})};0!=r.length?t.webService.addBookmarks(e,r).then(function(){return a()}).catch(function(o){t.webService.fetch(e).then(function(o){var i,a;t.bookmarksData={bookBookmarks:o.bookBookmarks.slice(),bookElementBookmarks:o.bookElementBookmarks.slice()},(i=t.bookmarksData.bookBookmarks).push.apply(i,r),(a=t.bookmarksData.bookElementBookmarks).push.apply(a,r.filter(function(t){return t.bookElementShortName===e.shortName})),n(t.bookmarksData)}).catch(function(e){t.bookmarksData=i,n(i)})}):a()}).catch(function(e){console.log("Couldn't load bookmarks"),o(e)})})},e.prototype.addBookmark=function(e,t,n,o,r){var a=this,s=new i.a(-1,e.shortName,e.ordinal,t,n,o,r,Date.now(),e.meapVersion);return s.isBeingSynced=!0,new Promise(function(i,c){a.webService.addBookmark(e,t,n,o,r).then(function(t){s.id=t,a.addBookmarkToInternalData(s),l.a.saveBookmarks(e,a.bookmarksData.bookBookmarks),i(s.id)}).catch(function(t){s.hasNotBeenStoredOnServer=!0,l.a.addBookmark(e.book.shortName,s).then(function(e){s.id=e,a.addBookmarkToInternalData(s)}).catch(function(e){console.log("Error when syncing bookmark",e),s.isBeingSynced=!1,c(e)})})})},e.prototype.removeBookmark=function(e,t){var n=this,o=this.bookmarksData.bookElementBookmarks.find(function(e){return e.contentID===t});return new Promise(function(i,r){n.webService.removeBookmark(e,t).then(function(){n.removeBookmarkFromInternalData(o),l.a.saveBookmarks(e,n.bookmarksData.bookBookmarks),i(!0)}).catch(function(t){l.a.removeBookmark(e.book.shortName,o).then(function(){n.removeBookmarkFromInternalData(o),i(!0)}).catch(function(e){return r(e)})})})},e.prototype.removeBookmarkById=function(e){throw new Error("Not yet implemented")},e.prototype.addBookmarkToInternalData=function(e){e.isBeingSynced=!1,this.bookmarksData.bookBookmarks.push(e),this.bookmarksData.bookElementBookmarks.push(e)},e.prototype.removeBookmarkFromInternalData=function(e){o.a.removeItemFromArray(this.bookmarksData.bookBookmarks,e),o.a.removeItemFromArray(this.bookmarksData.bookElementBookmarks,e)},e}(),d=n(4),u={bookmarksService:null};d.b.loadDeviceInfo().then(function(e){u.bookmarksService=function(e){switch(e){case d.a.Browser:return new s;case d.a.Cordova:case d.a.Electron:return new c}}(e.platform)});t.a=u},564:function(e,t,n){"use strict";var o=n(12),i=n(389),r=n(390),a=n(0),s=function(){function e(){}return e.prototype.fetch=function(e){return new Promise(function(t,n){r.a.fetch(e).then(function(e){return t(e.highlights)}).catch(function(e){return n(e)})})},e.prototype.addHighlight=function(e,t,n,o){var s=new i.b(-1,e.book.shortName,e.shortName,e.ordinal,e.meapVersion,n,t,Date.now(),o);return s.isBeingSynced=!0,r.a.highlightsData||(r.a.highlightsData={bookHighlights:[],bookElementHighlights:[]}),new Promise(function(i,l){a.a.postToOurBackend(a.a.getAbsoluteUrl("api/highlight/createHighlight"),function(e){s.id=e.id,s.isBeingSynced=!1,r.a.highlightsData.bookHighlights.push(s),r.a.highlightsData.bookElementHighlights.push(s),i(s.id)},function(e){console.log("Error when syncing highlight",e),s.isBeingSynced=!1,l(e)},{bookShortName:e.book.shortName,bookElementShortName:e.shortName,bookElementOrdinal:e.ordinal,meapVersion:e.meapVersion,highlightedParagraphsJson:JSON.stringify(t),offset:o,color:n})})},e.prototype.removeHighlight=function(e){var t=r.a.highlightsData&&r.a.highlightsData.bookElementHighlights.find(function(t){return t.id===e});return t?new Promise(function(e,n){a.a.postToOurBackend(a.a.getAbsoluteUrl("api/highlight/deleteHighlight"),function(n){o.a.removeItemFromArray(r.a.highlightsData.bookHighlights,t),o.a.removeItemFromArray(r.a.highlightsData.bookElementHighlights,t),e(!0)},function(e){console.log("Error when syncing highlights",e),n(e)},{highlightID:t.id})}):Promise.resolve(!0)},e.prototype.changeColor=function(e,t,n){var o=r.a.highlightsData&&r.a.highlightsData.bookElementHighlights.find(function(e){return e.id===t});return o&&n?new Promise(function(t,i){a.a.postToOurBackend(a.a.getAbsoluteUrl("api/highlight/changeColor"),function(e){o.color=n,t(!0)},function(e){console.log("Error when changing highlight color",e),i(e)},{bookShortName:e.book.shortName,highlightID:o.id,color:n})}):Promise.reject("No highlight to change color to")},e}(),l=function(){function e(){}return e.prototype.fetch=function(e){throw new Error("Not yet implemented")},e.prototype.addHighlight=function(e,t,n,o){throw new Error("Not yet implemented")},e.prototype.removeHighlight=function(e){throw new Error("Not yet implemented")},e.prototype.changeColor=function(e,t,n){throw new Error("Not yet implemented")},e}(),c=n(4),d=new(function(){function e(){}return e.prototype.addHighlight=function(e,t,n,o){var i=this;return new Promise(function(r,a){i.highlightsServicePromise.then(function(i){i.addHighlight(e,t,n,o).then(function(e){return r(e)}).catch(function(e){return a(e)})})})},e.prototype.removeHighlight=function(e){var t=this;return new Promise(function(n,o){t.highlightsServicePromise.then(function(t){t.removeHighlight(e).then(function(e){return n(e)}).catch(function(e){return o(e)})})})},e.prototype.changeColor=function(e,t,n){var o=this;return e&&t&&n?new Promise(function(i,r){o.highlightsServicePromise.then(function(o){if(!e||!t||!n)return r("");o.changeColor(e,t,n).then(function(e){return i(e)}).catch(function(e){return r(e)})})}):Promise.reject("")},e.prototype.fetch=function(e){var t=this;return new Promise(function(n,o){t.highlightsServicePromise.then(function(t){t.fetch(e).then(function(e){return n(e)}).catch(function(e){return o(e)})})})},e}());d.highlightsServicePromise=new Promise(function(e,t){c.b.loadDeviceInfo().then(function(t){e(function(e){switch(e){case c.a.Browser:return new s;case c.a.Cordova:case c.a.Electron:return new l}}(t.platform))}).catch(function(e){console.log("Couldn't load device info")})});t.a=d},567:function(e,t,n){"use strict";var o=n(125),i=n(2),r=n(21),a=n(6),s=$(window),l=$(document),c=function(){function e(){var e=this;this.noOfUnsyncedItems=0,this.noOfUnsyncedItemsLimit=5,this.isDataSynced=!0,this.progressMap={},o.a.progressService.then(function(t){e.progressService=t}),l.on("readableTextListened",function(t,n){return e.handleParagraphListened(n)}),l.on("readableElementScrolled",function(t,n){return e.handleParagraphScrolled(n)}),s.on("beforeunload",function(){e.isDataSynced||e.storeProgress(!0)})}return e.prototype.initialize=function(e,t){this.clean(),this.book=e,this.bookElement=t,this.fetchProgress(),this.periodicallySyncProgressIfNecessary()},e.prototype.clean=function(){this.isDataSynced||this.storeProgressIfBookChanges(),this.book=null,this.bookElement=null,this.completedContentItemIDs=null,this.lastContentItemID=null,this.noOfUnsyncedItems=0,this.isDataSynced=!0},e.prototype.storeProgressIfBookChanges=function(){var e=this;if(a.a.isCurrentlyLoggedIn()){this.updateInternalProgressCache();var t=null!=this.book?this.book.shortName:"",n=null!=this.book?this.book.slug:"",o=this.bookElement,i=this.completedContentItemIDs,s=this.lastContentItemID;setTimeout(function(){var a=r.a.getCurrentRouteInfo(),l=null==a;l||(l=a.book!==t&&a.book!==n),l&&(console.log("Storing:",o,s),e.progressService.storeProgress(o,i,s,!1))},250)}},e.prototype.periodicallySyncProgressIfNecessary=function(){var e=this;i.a.setTimeout(function(){e.isDataSynced||(e.storeProgress(),e.isDataSynced=!0),e.periodicallySyncProgressIfNecessary()},3e5)},e.prototype.storeProgress=function(e){void 0===e&&(e=!1),a.a.isCurrentlyLoggedIn()&&(this.updateInternalProgressCache(),this.progressService.storeProgress(this.bookElement,this.completedContentItemIDs,this.lastContentItemID,e))},e.prototype.fetchProgress=function(){var e=this;this.book&&this.book.userOwnsBook&&this.book.userOwnsAudio&&a.a.isCurrentlyLoggedIn()?this.progressService.fetchProgress(this.bookElement).then(function(t){t&&"null"!=t||(t={}),e.completedContentItemIDs=t,e.lastContentItemID=e.getLastCompletedContentItemId(t),l.trigger("progressLoaded",t)}).catch(function(e){return l.trigger("progressLoaded",{})}):l.trigger("progressLoaded",{})},e.prototype.syncData=function(){this.timerId=null,this.isDataSynced||(this.noOfUnsyncedItems++,this.noOfUnsyncedItems>=this.noOfUnsyncedItemsLimit&&(this.storeProgress(),this.noOfUnsyncedItems=0,this.isDataSynced=!0))},e.prototype.handleParagraphListened=function(e){var t=this;if(this.completedContentItemIDs&&this.book&&this.book.userOwnsBook&&this.book.userOwnsAudio&&e){if(this.completedContentItemIDs&&!this.completedContentItemIDs[e]&&(this.completedContentItemIDs[e]=1,this.isDataSynced=!1),this.lastContentItemID!=e)$(document.getElementById(e)).is(".readable-text")&&(this.lastContentItemID=e,this.isDataSynced=!1);this.timerId||(this.timerId=i.a.setTimeout(function(){return t.syncData()},1e3))}},e.prototype.handleParagraphScrolled=function(e){this.book&&e&&(this.book.lastBookElementItem=e,this.lastContentItemID=e,this.isDataSynced=!1)},e.prototype.getLastCompletedContentItemId=function(e){if(!e)return"";try{var t=-1;for(var n in e)if(e.hasOwnProperty(n)){var o=parseInt(n);!isNaN(o)&&o>t&&(t=o)}return-1!=t?t:""}catch(e){return""}},e.prototype.updateInternalProgressCache=function(){this.progressMap[this.book.shortName]={bookElement:this.bookElement.shortName,position:this.lastContentItemID,lastAccessTime:Date.now(),meapVersion:this.bookElement.meapVersion}},e}();t.a=new c},568:function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o='\n<div id="text-addendum-modal" class="reveal-modal" data-reveal data-options="close_on_background_click: false; close_on_esc:false;"></div>\n<div id="pointing-modal" class="reveal-modal" data-reveal>\n    <span class="close-reveal-modal">&times;</span>\n    \n    <div class="row">\n        <div class="small-12 columns">\n            <h3 class="pointing-modal-title">Pointing</h3>\n            <div class="pointing-modal-message">\n                You can share this paragraph with anyone by using the following link:\n            </div>\n            <div class="pointing-modal-input-container">\n                <input type="text" class="pointing-modal-textbox" autocorrect="off" autocapitalize="off" spellcheck="false"/>\n                <a href="javascript:void(0)" data-tooltip class="button-copy button radius">\n                    <span class="show-medium-up">copy</span>\n                    <i class="fa fa-clipboard show-small" aria-hidden="true"></i>\n                </a>\n            </div>\n        </div>\n    </div>\n</div>\n<div id="video-mode-overlay">\n    <div style="display:flex; flex-direction: column" class="video-mode-content-wrapper">\n        <div class="video-mode-title-container"></div>\n        <div style="display: flex; align-items: center; flex-grow: 1; height: 100%">\n            <div class="video-mode-content-container"></div>\n            <div style="flex-grow: 1; flex-basis: 40%" class="video-mode-text-content-container"></div>\n        </div>\n    </div>\n    <div id="additional-code-annotation-container" lang="en">\n        <div class="annotation-description"></div>\n    </div>\n    <div class="track-point-wrapper" id="additional-listing-play-point">\n        <div class="track-point track-point-play">\n            <i class="icon-i-play-triangle"></i>\n        </div>\n    </div>\n</div>\n<div id="volume-menu" class="slide-in-menu closed">\n    <div class="slide-in-menu-container">\n        <div id="volume-menu-container" unselectable="on" onselectstart="return false;">\n            <div class="volume-line-container">\n                <div class="volume-line">\n                    <div class="volume-line-full"></div>\n                </div>\n                <div class="volume-control-current-position-container">\n                    <div class="toolbar-current-position-outer-point">\n                        <div class="toolbar-current-position-inner-point"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<div id="text-addons-menu" class="slide-in-menu closed">\n    <div class="slide-in-menu-container">\n        <div class="tab-title-container">\n            <div class="tab-title selected highlights-tab" style="margin-right:3px;"><i class="highlight-icon-font icon-highlighter-full"></i> highlights</div>\n            <div class="tab-title selected bookmarks-tab" style="margin-right:3px;"><i class="fa fa-bookmark-o"></i> bookmarks</div>\n            <div class="tab-title selected notes-tab"><i class="fa fa-pencil-square-o"></i> <span class="notes-tab-title">notes</span></div>\n        </div>\n        <div class="search-input-container">\n            <input type="text" class="search-input" placeholder="filter" list="reviewer-list">\n            <datalist id="reviewer-list"></datalist>\n            <span class="sort-command-container">\n                <a href="javascript:void(0)" class="sort-by-time-button selected"><i class="fa fa-long-arrow-down"></i><i class="fa fa-clock-o"></i></a>\n                <a href="javascript:void(0)" class="sort-by-book-button"><i class="fa fa-sort-numeric-asc"></i></a>\n            </span>\n        </div>\n        <div class="items-container">\n            <ul></ul>\n        </div>\n        <div>\n            <ul id="text-addons-pagination"></ul>\n        </div>\n    </div>\n</div>\n\n<div id="newest-edition-box" style="display:none;">\n    <a href="" class="newest-edition-available-link">\n        <div class="newest-edition-available-heading">new edition available</div>\n        <div class="newest-edition-available-book-title"></div>\n        <div class="newest-edition-available-this-included">This edition is included with the purchase of the revised book.</div>\n    </a>\n</div>\n<div id="add-to-cart-box"></div>\n<div id="free-ebooks-upsell-root" style="display:none">\n      <div class="free-ebooks-upsell-close"><i class="fa fa-close close-icon" aria-hidden="true"></i></div>\n      <div class="free-ebooks-upsell-title">related <span>products</span></div>\n      <div class="free-ebooks-upsell-carausel"></div>\n  </div>\n  <div id="link-preview-popup" class="closed" style="display:none">\n      <div class="arrow-up"></div>\n      <div class="chapter-preview-container">\n          <img class="book-cover" src="'+n(0).a.getLivebookCdn()+'assets/images/cover.png" alt="link book cover"/>\n          <span class="chapter-preview-title"></span>\n          <span class="chapter-preview-paragraphs-container"></span>\n      </div>\n      <div class="browsable-preview-container">\n      </div>\n      <div class="arrow-down"></div>\n  </div>\n  <div id="notes-menu" class="closed">\n      <span class="notes-menu-heading">notes</span>\n      <ul class="notes-list"></ul>\n      <textarea id="note-input-box" type="text" placeholder="new note..."></textarea>\n      <a href="javascript:void(0)" id="add-note-button" class="button main-action"> add note </a>\n  </div>\n  <div id="code-annotation-container" lang="en">\n      <div class="annotation-description"></div>\n  </div>\n  <div id="highlight-tooltip-menu-reference-node" class="highlight-tooltip-reference-node tip-top radius" data-tooltip aria-haspopup="true"\n        title="<div class=\'highlight-tooltip-container\'><i class=\'color-selector yellow highlight-icon-font icon-highlighter-full\'></i><i class=\'color-selector green highlight-icon-font icon-highlighter-full\'></i><i class=\'color-selector red highlight-icon-font icon-highlighter-full\'></i><i class=\'color-selector pink highlight-icon-font icon-highlighter-full\'></i><i class=\'color-selector blue highlight-icon-font icon-highlighter-full\'></i> | <i class=\'fa fa-trash delete-highlight-button\' aria-hidden=\'true\' title=\'delete highlight\'></i></div>">\n  </div> \n  <div id="text-selection-menu-reference-node" class="text-selection-reference-node tip-top radius"  data-tooltip aria-haspopup="true" \n        title="<div class=\'text-selection-tooltip-container\'><i class=\'highlight-icon-font icon-highlighter-full highlight-button\' aria-hidden=\'true\' title=\'highlight\'></i><i class=\'fa fa-pencil-square-o note-button\' title=\'annotate\'></i><i class=\'fa fa-link link-button\' title=\'create link\'></i><i class=\'fa fa-twitter tweet-button\' title=\'tweet\'></i><i class=\'fa fa-comments forum-button\' title=\'discussion\'></i><i class=\'fa fa-exclamation-triangle error-report\' title=\'report error\'></i></div></div>"></div>\n  <div id="audio-loader" class="loader"></div>\n  <div id="toc-index-menu" class="text-slide-menu text-slide-menu-left hidden">\n      <div class="loading-container">\n          <i class="fa fa-spin fa-circle-o-notch fa-3x fa-fw"></i>\n      </div>\n  </div>\n  <div id="indexed-terms-slide-menu" class="text-slide-menu text-slide-menu-right"></div>\n  <div id="book-resources-menu" class="slide-in-menu closed">\n      <div class="slide-in-menu-container"></div>\n  </div>\n  <audio id="audio-player" preload="metadata" crossorigin="anonymous"></audio>',i=new(function(){function e(){this.fillWithNecessaryHtmlElements()}return e.prototype.fillWithNecessaryHtmlElements=function(){null==document.getElementById("text-addendum-modal")&&$(document.body).append(o)},e}())},570:function(e,t,n){"use strict";var o=n(562),i=n(2),r=n(5),a=n(12),s=n(0),l=n(379),c=n(334),d=n(13),u=n(17),h=n(46),p=n(420),m=n(4),g=n(6),f=(n(571),n(573),n(18)),b=$(window),k=$(document),v=function(){function e(){var e=this;this.defaultMainRoute="/book/",this.mainRoute="/book/",this.$menu=$("#toc-index-menu"),this.$tocMenuButtons=$(".toc-menu-button"),this.handleScrollStop=this.handleScrollStop.bind(this),this.textSlideMenu=new p.a(this.$menu,this.$tocMenuButtons,{sidePadding:20,targetWidth:380,maxWidth:450}),new l.a(this.$menu,function(t){e.textSlideMenu.adjustMenuPosition(),1==t&&e.adjustSymbolsPosition()}),i.a.onDescendantEventWithCooldown(this.$menu,"click touchstart",".index-symbol-container",function(t){return e.handleIndexSymbolClick(t.currentTarget)}),i.a.onDescendantEventWithCooldown(this.$menu,"click",".book-chapter, .book-element-link",function(t){return e.handleTocChapterClick(t.target,t.currentTarget)}),k.on("unlockSectionSubsectionSuccess",function(t,n,o,r){i.a.setTimeout(function(){var t=e.$menu.find("[data-short-name='"+r+"']");t.removeClass("user-not-owned"),t.addClass("user-owned"),t.next().is("ul")&&t.next().find(".book-element-link").removeClass("user-not-owned").addClass("user-owned")},100)}),k.on("unlockBookElementSuccess",function(t,n,o,i){var r=e.$menu.find("[data-short-name='"+o+"']");r.removeClass("user-not-owned"),r.addClass("user-owned"),r.siblings("ul").find(".user-not-owned").removeClass("user-not-owned").addClass("user-owned")}),k.on("contentFullyConstructed",function(){return e.handleContentConstructed()}),k.on("requestTocIndexMenuOpen",function(){return e.open()}),this.$menu.on("click",".index-content-container",function(){k.trigger("tocIndexClick")})}return e.prototype.initialize=function(e,t,n,i){var r=this;this.$menu.removeClass("hidden"),this.bookElement=t,this.mainRoute=i||this.defaultMainRoute,this.bookElementShortName=n,this.markCurrentBookElementAsSelectedInToc(e,t),this.$headerElements=u.a.getHeadings(),this.$tocMenuButtons.filter(":not(.second-row-top-bar-section .toc-menu-button)").removeClass("hidden"),b.on("scrollstop",this.handleScrollStop),null==this.book||null==e||this.book.shortName!=e.shortName?(this.book=e,o.a.bookResourcesService.then(function(n){n.getTocAndIndex(e.shortName,e,t).then(function(e){return r.handleDataArrived(e.toc,e.index)})}),this.textSlideMenu.isOpened()&&this.textSlideMenu.handleResize()):this.textSlideMenu.adjustMainBookContentContainerPosition()},e.prototype.handleContentConstructed=function(){var e=this;i.a.setTimeout(function(){e.bookElement&&(e.bookElement.isBookOverview||f.a.isFirstTimeBookVisit())&&m.b.isExtraLargeScreenSize()&&!d.a.isSpecialPathPartInsteadOfBookElement(e.bookElementShortName)&&e.textSlideMenu.open(),f.a.markCurrentBookAsVisited()},500)},e.prototype.clean=function(){this.toc=null,this.index=null,this.book=null,this.bookElement=null,this.bookElementShortName="",this.partialClean(),this.$tocMenuButtons.filter(":not(.second-row-top-bar-section .toc-menu-button)").addClass("hidden"),this.textSlideMenu.close(),o.a.bookResourcesService.then(function(e){e.reset()}),this.$menu.html('<div class="loading-container">\n            <i class="fa fa-spin fa-circle-o-notch fa-3x fa-fw"></i>\n        </div>')},e.prototype.partialClean=function(){this.unselectHeadings(),null!=this.$bookMainContentContainer&&this.$bookMainContentContainer.length&&this.$bookMainContentContainer.velocity("stop",!0),this.$headerElements=null,b.off("scrollstop",this.handleScrollStop)},e.prototype.open=function(){this.textSlideMenu.open()},e.prototype.isOpened=function(){return this.textSlideMenu.isOpened()},e.prototype.handleDataArrived=function(e,t){var n=this;this.toc=e,this.index=this.fixIndexLinks(t),null!=this.book&&(this.fillTocSummaryWithHtmlIfNecessary(),this.book.userOwnsBook||this.book.isReview?this.fillTocMenuHtml():g.a.isCurrentlyLoggedIn()?h.a.getTocOwnership(this.book.shortName).then(function(e){n.fillTocMenuHtml(e)}).catch(function(e){console.log("Error filling TOC with ownership info",e),n.fillTocMenuHtml()}):this.fillTocMenuHtml({partialChapterOwnership:[]}))},e.prototype.fixIndexLinks=function(e){try{if(!e||!e.length)return;for(var t=0,n=e;t<n.length;t++){var o=n[t];if(o&&o.links&&o.links.length)for(var i=0,r=o.links;i<r.length;i++){var a=r[i];a.link&&(a.link=a.link.replace("#!/","/"))}}}catch(e){}return e},e.prototype.fillTocSummaryWithHtmlIfNecessary=function(){try{var e=$(".toc-summary-container");if(0==e.length)return;if(0==e.find(".toc-summary-loading-container").length)return;var t="";if(null!=this.toc){if(null!=this.toc.frontMatter&&this.toc.frontMatter.length>0)for(var n=0,o=this.toc.frontMatter;n<o.length;n++){var i=o[n];t+='<a class="toc-summary-front-back-matter-link" href="'+(i.link||"").replace("#!/","/")+'">'+i.title+"</a>"}if(null!=this.toc.parts&&this.toc.parts.length>0)for(var r=0,a=this.toc.parts;r<a.length;r++){var s=a[r];if(s.link&&(t+='<a class="toc-summary-part-link" href="'+(s.link||"").replace("#!/","/")+'">'+s.title+"</a>"),null!=s.chapters&&s.chapters.length>0)for(var l=0,c=s.chapters;l<c.length;l++){var d=c[l];t+='<a class="toc-summary-chapter-link" href="'+(d.link||"").replace("#!/","/")+'">'+d.title+"</a>"}}if(null!=this.toc.backMatter&&this.toc.backMatter.length>0){t+="<br/>";for(var u=0,h=this.toc.backMatter;u<h.length;u++){var p=h[u];t+='<a class="toc-summary-front-back-matter-link" href="'+(p.link||"").replace("#!/","/")+'">'+p.title+"</a>"}}}t?e.find(".toc-summary-content").html(t):e.remove()}catch(e){console.error(e)}},e.prototype.fillTocMenuHtml=function(e){void 0===e&&(e=null),this.adjustCurrentToc(this.toc,e),this.adjustLinkLayout(this.index),this.$menu.html(Mustache.render(w,{toc:this.toc,index:this.index,title:this.book?(this.book.title||"").replace(/\s*MEAP\s*(V\d+)?/i,""):""}))},e.prototype.handleTocChapterClick=function(e,t){var n=$(e),o=$(t);this.$menu.find(".current-book-element").remove("current-book-element");var i=n.closest(".book-chapter");if(i.addClass("current-book-element"),k.trigger("tocMenuClick"),n.is(".book-element-link"))return this.unselectHeadings(),n.addClass("selected-heading"),r.a.closeMenuIfTakesTooMuchSpace(this.$menu),!1;var a=i.find(".book-sections-list");i.is(".opened")?(o.find(".toc-toggle-button i").removeClass("fa-caret-down").addClass("fa-caret-right"),$.Velocity.animate(a,"slideUp","normal").then(function(){i.removeClass("opened")})):(o.find(".toc-toggle-button i").removeClass("fa-caret-right").addClass("fa-caret-down"),$.Velocity.animate(a,"slideDown","fast").then(function(){i.addClass("opened")}))},e.prototype.adjustCurrentToc=function(e,t){var n=this;if(void 0===t&&(t=null),e){if(e&&e.frontMatter&&e.frontMatter.length>0){var o=e.frontMatter.find(function(e){return"Copyright"==e.title});null!=o&&a.a.removeItemFromArray(e.frontMatter,o)}var i={};null!=t&&t.partialChapterOwnership.forEach(function(e){i[e.shortName]=e.userOwned,null!=e.partialSectionOwnership&&e.partialSectionOwnership.forEach(function(e){i[e.shortName]=e.userOwned,e.partialSubsectionOwnership&&e.partialSubsectionOwnership.forEach(function(e){i[e.shortName]=e.userOwned})})});var r=this.bookElement.shortName,l=function(e,o){if(void 0===o&&(o=!1),e){if(e.chapters&&!e.link&&(e.link=s.a.getBookElementUrl(n.book.slug,"chapter-1",n.bookElement.meapVersion,n.bookElement.reviewVersion)),e.title&&"Chapters"!=e.title&&"Appendixes"!=e.title&&(e.title=e.title.replace("Chapter","Ch").replace("Appendix","App")),e.id){if(e.shortName===r?e.chapters?e.isCurrentPart=!0:e.isCurrent=!0:e.chapters?e.isCurrentPart=!1:e.isCurrent=!1,"isFree"in e&&(e.isFree=e.link&&n.shouldFreeFlagBeShown(e.link),e.hasAudio=n.book.hasAudio&&!n.book.userOwnsAudio,e.isFree)){var c=e.title;e.title=a.a.getWithoutLastWordOrFullIfSingleWord(c),e.lastWord=a.a.getLastWordOrEmptyIfSingleWord(c)}e.userDoesntOwn=!e.isFree&&!n.book.userOwnsBook}for(var u in e.shortName||(e.shortName=d.a.extractNumbering(e.title||"")),t&&(e.userOwns=!!i[e.shortName]||o,e.userDoesntOwn=!e.userOwns),n.book.userOwnsBook&&(e.userOwns=!0),0==(e.link||"").indexOf("#!")&&(e.link=e.link.replace("#!","")),e.link&&n.mainRoute!==n.defaultMainRoute&&(e.link=e.link.replace(n.defaultMainRoute,n.mainRoute)),e)e.hasOwnProperty(u)&&e[u]&&"object"==typeof e[u]&&l(e[u],e.userOwns)}};l(e)}},e.prototype.shouldFreeFlagBeShown=function(e){return!!this.book&&(!(this.book.userOwnsBook||!a.a.endsWithOneOf(e,this.book.openChapters,!0))||!(!this.book.userOwnsBook||!this.book.hasAudio||this.book.userOwnsAudio||!a.a.endsWithOneOf(e,this.book.openChapters)))},e.prototype.adjustLinkLayout=function(e){if(e)for(var t=0;t<e.length;t++)for(var n=e[t].letter,o=n.match(/[a-z]/i),i=e[t].links,r=0;r<i.length;r++){var a=i[r],s=a.content;switch(s){case"2nd":case"3rd":case"4th":case"5th":case"6th":case"7th":case"8th":case"9th":a.content=s.slice(0,1)+"<sup>"+s.slice(1)+"</sup>",a.isSuperScript=!0,a.additionalClass="not-stand-alone",r-1>0&&(i[r-1].additionalClass="not-stand-alone");break;default:a.additionalClass="",s=s.toUpperCase().replace(/\W+/g,""),o&&0!==s.indexOf(n)&&(a.additionalClass+=" indented")}}},e.prototype.handleScrollStop=function(){var e=this;i.a.setTimeout(function(){return e.selectCurrentHeadersInToc()},16)},e.prototype.selectCurrentHeadersInToc=function(){if(this.unselectHeadings(),null!=this.$headerElements&&0!=this.$headerElements.length){var e=this.getStructurallyImportantHeadersForPosition(b.scrollTop()+r.a.getTopNavBarHeight()+40);if(e.length>0){var t=$(e[0]);this.$menu.find("[data-short-name='"+d.a.extractNumbering(t.text().trim())+"']").addClass("selected-heading")}}},e.prototype.markCurrentBookElementAsSelectedInToc=function(e,t){this.$menu.find(".current-book-element").removeClass("current-book-element"),this.unselectHeadings();var n=c.a.formHash(e,t),o=this.$menu.find(".book-element-link[href='"+n+"'], .book-element-link[href='"+c.a.trimLastSlash(n)+"']");o.addClass("current-book-element opened"),o.closest(".book-chapter").addClass("opened")},e.prototype.unselectHeadings=function(){this.$menu.find(".selected-heading").removeClass("selected-heading")},e.prototype.getStructurallyImportantHeadersForPosition=function(e){var t=[],n=this.$headerElements.filter(function(t,n){return r.a.isHeadingVisible($(n),e)}).last();n.length>0&&t.push(n);var o=u.a.getOwnerSectionHeading(n,this.$headerElements);return null!=o&&t.push(o),t},e.prototype.adjustSymbolsPosition=function(){var e=this.$menu.find(".index-symbols-container"),t=parseFloat(e.css("line-height"))/parseFloat(e.css("font-size")),n=(this.$menu.height()-40)/e.find(".index-symbol-container").length,o=Math.max(Math.min(Math.floor(n/t),15),8);e.css("font-size",o+"px")},e.prototype.handleIndexSymbolClick=function(e){k.trigger("tocIndexClick");var t=$(e),n=this.$menu.find(".index-content-container").closest(".tabs-container"),o=t.text(),i=n.find("h5").filter(function(e,t){return $(t).text()===o});console.log(n.scrollTop(),i.position().top),n.animate({scrollTop:i.position().top},1e3)},e}();t.a=new v;var w='<div class="tab-title-container">\n<div class="tab-title selected">table of contents</div>\n{{#index.length}}\n<div class="tab-title">index</div>\n{{/index.length}}\n</div>\n<div class="tabs-container">\n<div class="tab-container selected">\n    <ul class="toc-book-elements-container">\n        {{#toc.frontMatter.length}}\n        {{#toc.frontMatter}}\n        <li class=\'{{#sections.length}}intro-chapter book-chapter has-dropdown {{/sections.length}}\'>\n            {{#sections.length}}\n            {{/sections.length}}\n            <a class="book-element-link {{#isCurrent}}current-book-element{{/isCurrent}} {{#userOwns}}user-owned{{/userOwns}} {{#userDoesntOwn}}user-not-owned{{/userDoesntOwn}}" href="{{link}}">{{title}} {{#isFree}} <span class="no-wrap">{{lastWord}}<span class="free-flag">free {{#hasAudio}}audio{{/hasAudio}}</span></span>{{/isFree}}</a>\n            {{#sections.length}} \n            <a href="javascript:void(0)" class=\'toc-interaction-icon toc-toggle-button {{#isCurrent}}current-book-element{{/isCurrent}}\'>\n                <i class=\'fa {{#isCurrent}}current-book-element fa-caret-down{{/isCurrent}} {{^isCurrent}}fa-caret-right{{/isCurrent}}\'></i>\n            </a>\n            <ul class=\'dropdown book-sections-list {{#isCurrent}}current-book-element-sections{{/isCurrent}}\'>\n                {{#sections}}\n                <li class=\'book-section\'>\n                    <a class="book-element-link {{#userOwns}}user-owned{{/userOwns}} {{#userDoesntOwn}}user-not-owned{{/userDoesntOwn}}" href="{{link}}" data-short-name="{{shortName}}">{{title}}</a>\n                    {{#subsections.length}}\n                        <ul>\n                        {{#subsections}}\n                            <li><a class="book-element-link {{#userOwns}}user-owned{{/userOwns}} {{#userDoesntOwn}}user-not-owned{{/userDoesntOwn}}" href="{{link}}" data-short-name="{{shortName}}">{{title}}</a></li>\n                        {{/subsections}}\n                        </ul>\n                    {{/subsections.length}}\n                </li>\n                {{/sections}}\n            </ul>\n            {{/sections.length}}\n        </li>\n        {{/toc.frontMatter}}\n        {{/toc.frontMatter.length}}\n\n        {{#toc.parts}}\n        <a class="container-link book-element-link {{#isCurrentPart}}current-book-element{{/isCurrentPart}}" href="{{link}}">{{title}}</a>\n        {{#chapters}}\n        <li class=\'book-chapter has-dropdown {{#isCurrent}}opened contains-current-section{{/isCurrent}}\'>\n            <a class="book-element-link {{#isCurrent}}current-book-element{{/isCurrent}} {{#userOwns}}user-owned{{/userOwns}} {{#userDoesntOwn}}user-not-owned{{/userDoesntOwn}}" href="{{link}}" data-short-name="{{shortName}}">{{title}}{{#isFree}} <span class="no-wrap">{{lastWord}}<span class="free-flag">free {{#hasAudio}}audio{{/hasAudio}}</span></span>{{/isFree}}</a>\n            <a href="javascript:void(0)" class=\'toc-interaction-icon toc-toggle-button {{#isCurrent}}current-book-element{{/isCurrent}}\'>\n                <i class=\'fa {{#isCurrent}}current-book-element fa-caret-down{{/isCurrent}} {{^isCurrent}}fa-caret-right{{/isCurrent}}\'></i>\n            </a>\n            <ul class=\'dropdown book-sections-list {{#isCurrent}}current-book-element-sections{{/isCurrent}}\'>\n                {{#sections}}\n                <li class=\'book-section\'>\n                    <a class="book-element-link {{#userOwns}}user-owned{{/userOwns}} {{#userDoesntOwn}}user-not-owned{{/userDoesntOwn}}" href="{{link}}" data-short-name="{{shortName}}">{{title}}</a>\n                    {{#subsections.length}}\n                        <ul>\n                        {{#subsections}}\n                            <li><a class="book-element-link {{#userOwns}}user-owned{{/userOwns}} {{#userDoesntOwn}}user-not-owned{{/userDoesntOwn}}" href="{{link}}" data-short-name="{{shortName}}">{{title}}</a></li>\n                        {{/subsections}}\n                        </ul>\n                    {{/subsections.length}}\n                </li>\n                {{/sections}}\n            </ul>\n        </li>\n        {{/chapters}}\n        {{/toc.parts}}\n\n        {{#toc.backMatter.length}}\n        {{#toc.backMatter}}\n        <li class="book-chapter">\n            <a class="book-element-link {{#isCurrent}}current-book-element{{/isCurrent}} {{#userOwns}}user-owned{{/userOwns}}  {{#userDoesntOwn}}user-not-owned{{/userDoesntOwn}}" data-short-name="{{shortName}}" href="{{link}}">\n                {{title}} {{#isFree}}<span class="free-flag">free {{#hasAudio}}audio{{/hasAudio}}</span>{{/isFree}}\n            </a>\n        </li>\n        {{/toc.backMatter}}\n        {{/toc.backMatter.length}}\n    </ul>\n</div>\n<div class="tab-container">\n    <div class="index-container">\n        <div class="index-symbols-container">\n            {{#index}}\n            <span class="index-symbol-container">{{letter}}</span><br>\n            {{/index}}\n        </div>\n        <div class="index-content-container">\n            {{#index}}\n            <h5>{{letter}}</h5>\n            <div>\n                {{#links}}\n                <a href="{{link}}" class="index-link {{additionalClass}}">\n                    {{#isSuperScript}} {{{content}}} {{/isSuperScript}}\n                    {{^isSuperScript}} {{content}} {{/isSuperScript}}\n                </a>\n                {{/links}}\n            </div>\n            {{/index}}\n        </div>\n    </div>\n</div>\n</div>'},571:function(e,t,n){var o=n(572);"string"==typeof o&&(o=[[e.i,o,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(324)(o,i);o.locals&&(e.exports=o.locals)},572:function(e,t,n){(e.exports=n(323)(!1)).push([e.i,"#toc-index-menu{left:0;background-color:#e8e8e8;border-right:1px solid #d0cdcd;color:#443}#toc-index-menu .loading-container{text-align:center;margin-top:1em}@media screen and (max-width: 689px){#toc-index-menu{font-size:13px}}#toc-index-menu .tab-title-container{height:2.1em;line-height:1.7em}#toc-index-menu .tab-title{color:inherit;font-size:90%;padding:0.1em}#toc-index-menu .toc-book-elements-container{margin:0;padding:0 1em}#toc-index-menu .container-link{display:block;cursor:default;user-select:none}#toc-index-menu .book-element-link{display:block;cursor:pointer}#toc-index-menu .book-element-link.user-not-owned{color:#6d6d61 !important}#toc-index-menu a{color:inherit}#toc-index-menu ul,#toc-index-menu ol,#toc-index-menu li{font-size:1em;list-style-type:none}#toc-index-menu .book-part{margin-top:5px;padding:0 4px;font-size:0.9em;text-transform:uppercase}#toc-index-menu .free-flag{color:white}#toc-index-menu .free-flag:after{border-color:transparent #e8e8e8 transparent transparent}#toc-index-menu .toc-interaction-icon{position:absolute;display:block;top:0.45em;min-height:2rem;min-width:2rem;font-size:small;cursor:pointer}@media screen and (min-width: 690px){#toc-index-menu .toc-interaction-icon{top:0.7em}}#toc-index-menu .toc-toggle-button{right:0;text-align:center}#toc-index-menu .book-chapter{position:relative;border:1px solid transparent;margin-top:1px;padding:0 1.2em 0 0.5em}#toc-index-menu .book-chapter .book-element-link{display:inline-block;padding:0.3em 1.5em 0 0.3em}#toc-index-menu .book-chapter .toc-interaction-icon i{font-size:1.1em}#toc-index-menu .book-chapter.opened .book-sections-list{display:block}#toc-index-menu .book-chapter.opened .toc-interaction-icon{display:inline-block}#toc-index-menu .intro-chapter:not(.buyable-intro-chapter){padding-left:0}#toc-index-menu .intro-chapter:not(.buyable-intro-chapter) .book-element-link{padding-left:0}#toc-index-menu .book-sections-list{margin-left:1rem;display:none}#toc-index-menu .book-section{line-height:1.2rem}#toc-index-menu .book-section a{padding:2px;display:inline-block}#toc-index-menu .book-section .book-element-link.selected-heading{font-weight:900}#toc-index-menu .current-book-element.book-element-link{font-weight:900}#toc-index-menu a,#toc-index-menu span{color:inherit}#toc-index-menu .container-link{color:inherit}#toc-index-menu .toc-interaction-icon{color:inherit}.tab-container.selected .index-symbols-container{display:block}.index-container{padding:5px;padding-bottom:0;color:inherit;position:relative}.index-container .index-symbols-container{background-color:#484848;color:white;padding-left:0;width:25px;text-align:center;position:fixed;display:none}.index-container .index-symbol-container{cursor:pointer;width:25px;display:inline-block}.index-container .index-content-container{margin-left:35px}.index-container h5{font-weight:bolder;color:inherit}.index-container .index-link{display:block;padding:2px;text-decoration:underline;font-size:12px}.index-container .index-link.not-stand-alone{display:inline-block}.index-container .index-link.indented{padding-left:1rem}\n",""])},573:function(e,t,n){var o=n(574);"string"==typeof o&&(o=[[e.i,o,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(324)(o,i);o.locals&&(e.exports=o.locals)},574:function(e,t,n){(e.exports=n(323)(!1)).push([e.i,"body.unlock-supported .readable-text{position:relative}body.unlock-supported #book-markup-container ul,body.unlock-supported #book-markup-container ol{position:relative}body.unlock-supported .readable-text.scrambled{cursor:pointer}body.unlock-supported .readable-text.scrambled:hover .token-icon-container svg,body.unlock-supported .readable-text.scrambled .unscramble-target .token-icon-container svg{transform:rotateY(360deg);transition-duration:1.2s}.unscramble-target p,li.unscramble-target{background-color:rgba(218,218,218,0.7)}.unscrambling p,li.unscrambling{background-color:rgba(218,218,218,0.25)}body.unlock-supported:not(.free-preview-mode) .scrambled p:hover,body.unlock-supported:not(.free-preview-mode) li.scrambled:hover{background-color:rgba(218,218,218,0.7)}.callout-container .unscramble-target p,.callout-container li.unscramble-target,.callout-container .unscrambling p,.callout-container li.unscrambling{background-color:#ececec}.readable-text.scrambled{color:#747474}.unlock-confirm-modal .unlock-confirm-root .unlock-confirm-price-container{font-size:16px}\n",""])},575:function(e,t,n){"use strict";n.d(t,"a",function(){return o});n(576);var o={insertNextChapterSummary:function(e){if(null!=e){var t=$(Mustache.render(i,e)),n=t.find(".next-button span");0==(e.shortName||"").indexOf("Part")&&n.text("Go to next part"),$("body").append(t)}}},i='<div class="summary-wrapper">\n<div class="summary-container">\n    <div class="summary-box-container">\n        <div><div class="summary-label">Up next...</div></div>\n        <div class="summary-next-heading">\n            <a class="heading-link" href="{{link}}">{{title}}</a>\n        </div>\n        <div>\n            <div class="summary-next-points">\n                <ul>{{#introItems}}<li>{{.}}</li>{{/introItems}}</ul>\n            </div>\n        </div>\n        {{^noNextElement}}\n        <div class="rt footer-button-next">\n            <a class="next-button button radius" href="{{link}}" title="{{title}}"><span>Go to next chapter</span> <i class="fa fa-angle-right"></i></a>\n        </div>\n        {{/noNextElement}}\n    </div>\n</div>\n<div class="summary-copyright-container">\n    &copy; 2019 Manning Publications Co.\n</div>\n</div>'},576:function(e,t,n){var o=n(577);"string"==typeof o&&(o=[[e.i,o,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(324)(o,i);o.locals&&(e.exports=o.locals)},577:function(e,t,n){(e.exports=n(323)(!1)).push([e.i,".summary-wrapper .summary-copyright-container{margin:2em 0 2em 0;text-align:center;color:rgba(0,0,0,0.5);font-size:90%}@media only screen and (max-width: 690px){.summary-wrapper .summary-copyright-container{font-size:0.7rem}}.summary-container{margin:0 auto;box-shadow:0 0 10px 0 rgba(0,0,0,0.15);border:1px solid #e5e5e5;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIGNvdW50PScxMDAlJyBoZWlnaHQ9JzEwMCUnPgoJPGNpcmNsZSBjeD0nNTAlJyBjeT0nNTAlJyByPSc1JScgZmlsbC1vcGFjaXR5PScuMycgZmlsbD0nI2ZmZicgLz4KCTxjaXJjbGUgY3g9JzUwJScgY3k9JzUwJScgcj0nMTAlJyBmaWxsLW9wYWNpdHk9Jy4zJyBmaWxsPScjZmZmJyAvPgoJPGNpcmNsZSBjeD0nNTAlJyBjeT0nNTAlJyByPScxNSUnIGZpbGwtb3BhY2l0eT0nLjMnIGZpbGw9JyNmZmYnIC8+Cgk8Y2lyY2xlIGN4PSc1MCUnIGN5PSc1MCUnIHI9JzIwJScgZmlsbC1vcGFjaXR5PScuMycgZmlsbD0nI2ZmZicgLz4KCTxjaXJjbGUgY3g9JzUwJScgY3k9JzUwJScgcj0nMjUlJyBmaWxsLW9wYWNpdHk9Jy4zJyBmaWxsPScjZmZmJyAvPgoJPGNpcmNsZSBjeD0nNTAlJyBjeT0nNTAlJyByPSczMCUnIGZpbGwtb3BhY2l0eT0nLjMnIGZpbGw9JyNmZmYnIC8+Cgk8Y2lyY2xlIGN4PSc1MCUnIGN5PSc1MCUnIHI9JzM1JScgZmlsbC1vcGFjaXR5PScuMycgZmlsbD0nI2ZmZicgLz4KCTxjaXJjbGUgY3g9JzUwJScgY3k9JzUwJScgcj0nNDAlJyBmaWxsLW9wYWNpdHk9Jy4zJyBmaWxsPScjZmZmJyAvPgoJPGNpcmNsZSBjeD0nNTAlJyBjeT0nNTAlJyByPSc0NSUnIGZpbGwtb3BhY2l0eT0nLjMnIGZpbGw9JyNmZmYnIC8+Cgk8Y2lyY2xlIGN4PSc1MCUnIGN5PSc1MCUnIHI9JzUwJScgZmlsbC1vcGFjaXR5PScuMycgZmlsbD0nI2ZmZicgLz4KCTxjaXJjbGUgY3g9JzUwJScgY3k9Jy0xMCUnIHI9JzIwJScgZmlsbC1vcGFjaXR5PScuMicgZmlsbD0nI2NjYycgLz4KCTxjaXJjbGUgY3g9JzUwJScgY3k9Jy0xMCUnIHI9JzMwJScgZmlsbC1vcGFjaXR5PScuMicgZmlsbD0nI2NjYycgLz4KCTxjaXJjbGUgY3g9JzUwJScgY3k9Jy0xMCUnIHI9JzQwJScgZmlsbC1vcGFjaXR5PScuMicgZmlsbD0nI2NjYycgLz4KCTxjaXJjbGUgY3g9JzUwJScgY3k9Jy0xMCUnIHI9JzUwJScgZmlsbC1vcGFjaXR5PScuMicgZmlsbD0nI2NjYycgLz4KCTxjaXJjbGUgY3g9JzUwJScgY3k9Jy0xMCUnIHI9JzYwJScgZmlsbC1vcGFjaXR5PScuMicgZmlsbD0nI2NjYycgLz4KCTxjaXJjbGUgY3g9JzUwJScgY3k9Jy0xMCUnIHI9JzcwJScgZmlsbC1vcGFjaXR5PScuMicgZmlsbD0nI2NjYycgLz4KCTxjaXJjbGUgY3g9JzUwJScgY3k9Jy0xMCUnIHI9JzgwJScgZmlsbC1vcGFjaXR5PScuMicgZmlsbD0nI2NjYycgLz4KCTxjaXJjbGUgY3g9JzUwJScgY3k9Jy0xMCUnIHI9JzkwJScgZmlsbC1vcGFjaXR5PScuMicgZmlsbD0nI2NjYycgLz4KCTxjaXJjbGUgY3g9JzUwJScgY3k9Jy0xMCUnIHI9JzEwMCUnIGZpbGwtb3BhY2l0eT0nLjInIGZpbGw9JyNjY2MnIC8+Cgk8Y2lyY2xlIGN4PScwJyBjeT0nMCcgcj0nMTAlJyBmaWxsLW9wYWNpdHk9Jy4yJyBmaWxsPScjZmZmJyAvPgoJPGNpcmNsZSBjeD0nMCcgY3k9JzAnIHI9JzIwJScgZmlsbC1vcGFjaXR5PScuMicgZmlsbD0nI2ZmZicgLz4KCTxjaXJjbGUgY3g9JzAnIGN5PScwJyByPSczMCUnIGZpbGwtb3BhY2l0eT0nLjInIGZpbGw9JyNmZmYnIC8+Cgk8Y2lyY2xlIGN4PScwJyBjeT0nMCcgcj0nNDAlJyBmaWxsLW9wYWNpdHk9Jy4yJyBmaWxsPScjZmZmJyAvPgoJPGNpcmNsZSBjeD0nMCcgY3k9JzAnIHI9JzUwJScgZmlsbC1vcGFjaXR5PScuMicgZmlsbD0nI2ZmZicgLz4KCTxjaXJjbGUgY3g9JzAnIGN5PScwJyByPSc2MCUnIGZpbGwtb3BhY2l0eT0nLjInIGZpbGw9JyNmZmYnIC8+Cgk8Y2lyY2xlIGN4PScwJyBjeT0nMCcgcj0nNzAlJyBmaWxsLW9wYWNpdHk9Jy4yJyBmaWxsPScjZmZmJyAvPgoJPGNpcmNsZSBjeD0nMTAwJScgY3k9JzAnIHI9JzEwJScgZmlsbC1vcGFjaXR5PScuMScgZmlsbD0nI2VlZScgLz4KCTxjaXJjbGUgY3g9JzEwMCUnIGN5PScwJyByPScyMCUnIGZpbGwtb3BhY2l0eT0nLjEnIGZpbGw9JyNlZWUnIC8+Cgk8Y2lyY2xlIGN4PScxMDAlJyBjeT0nMCcgcj0nMzAlJyBmaWxsLW9wYWNpdHk9Jy4xJyBmaWxsPScjZWVlJyAvPgoJPGNpcmNsZSBjeD0nMTAwJScgY3k9JzAnIHI9JzQwJScgZmlsbC1vcGFjaXR5PScuMScgZmlsbD0nI2VlZScgLz4KCTxjaXJjbGUgY3g9JzEwMCUnIGN5PScwJyByPSc1MCUnIGZpbGwtb3BhY2l0eT0nLjEnIGZpbGw9JyNlZWUnIC8+Cgk8Y2lyY2xlIGN4PScxMDAlJyBjeT0nMCcgcj0nNjAlJyBmaWxsLW9wYWNpdHk9Jy4xJyBmaWxsPScjZWVlJyAvPgoJPGNpcmNsZSBjeD0nMTAwJScgY3k9JzAnIHI9JzcwJScgZmlsbC1vcGFjaXR5PScuMScgZmlsbD0nI2VlZScgLz4KCTxjaXJjbGUgY3g9JzEwMCUnIGN5PScxMDAlJyByPScxMCUnIGZpbGwtb3BhY2l0eT0nLjEnIGZpbGw9JyNmMmYyZjInIC8+Cgk8Y2lyY2xlIGN4PScxMDAlJyBjeT0nMTAwJScgcj0nMjAlJyBmaWxsLW9wYWNpdHk9Jy4xJyBmaWxsPScjZjJmMmYyJyAvPgoJPGNpcmNsZSBjeD0nMTAwJScgY3k9JzEwMCUnIHI9JzMwJScgZmlsbC1vcGFjaXR5PScuMScgZmlsbD0nI2YyZjJmMicgLz4KCTxjaXJjbGUgY3g9JzEwMCUnIGN5PScxMDAlJyByPSc0MCUnIGZpbGwtb3BhY2l0eT0nLjEnIGZpbGw9JyNmMmYyZjInIC8+Cgk8Y2lyY2xlIGN4PScxMDAlJyBjeT0nMTAwJScgcj0nNTAlJyBmaWxsLW9wYWNpdHk9Jy4xJyBmaWxsPScjZjJmMmYyJyAvPgoJPGNpcmNsZSBjeD0nMTAwJScgY3k9JzEwMCUnIHI9JzYwJScgZmlsbC1vcGFjaXR5PScuMScgZmlsbD0nI2YyZjJmMicgLz4KCTxjaXJjbGUgY3g9JzEwMCUnIGN5PScxMDAlJyByPSc3MCUnIGZpbGwtb3BhY2l0eT0nLjEnIGZpbGw9JyNmMmYyZjInIC8+Cgk8Y2lyY2xlIGN4PScwJScgY3k9JzEwMCUnIHI9JzEwJScgZmlsbC1vcGFjaXR5PScuMScgZmlsbD0nI2VlZScgLz4KCTxjaXJjbGUgY3g9JzAlJyBjeT0nMTAwJScgcj0nMjAlJyBmaWxsLW9wYWNpdHk9Jy4xJyBmaWxsPScjZWVlJyAvPgoJPGNpcmNsZSBjeD0nMCUnIGN5PScxMDAlJyByPSczMCUnIGZpbGwtb3BhY2l0eT0nLjEnIGZpbGw9JyNlZWUnIC8+Cgk8Y2lyY2xlIGN4PScwJScgY3k9JzEwMCUnIHI9JzQwJScgZmlsbC1vcGFjaXR5PScuMScgZmlsbD0nI2VlZScgLz4KCTxjaXJjbGUgY3g9JzAlJyBjeT0nMTAwJScgcj0nNTAlJyBmaWxsLW9wYWNpdHk9Jy4xJyBmaWxsPScjZWVlJyAvPgoJPGNpcmNsZSBjeD0nMCUnIGN5PScxMDAlJyByPSc2MCUnIGZpbGwtb3BhY2l0eT0nLjEnIGZpbGw9JyNlZWUnIC8+Cgk8Y2lyY2xlIGN4PScwJScgY3k9JzEwMCUnIHI9JzcwJScgZmlsbC1vcGFjaXR5PScuMScgZmlsbD0nI2VlZScgLz4KPC9zdmc+)}.summary-container .summary-next-heading{max-width:360px}.summary-container .summary-next-heading a{color:#e71e21;font-weight:bold}.summary-container .footer-button-next{position:absolute;top:35px;right:0}body.night-mode .summary-container{border-color:transparent;background-image:none;background:#515556;color:#b9b9ad}body.night-mode .summary-container .summary-box-container .summary-next-points,body.night-mode .summary-container .summary-box-container .summary-label{color:inherit}body.night-mode .summary-container .summary-next-heading a{color:inherit}@media only screen and (min-width: 320px){.summary-container .summary-box-container{width:300px;padding:20px 10px 10px;margin:20px auto 0 auto;position:relative}.summary-container .summary-box-container a{font-size:larger}.summary-container .summary-box-container .summary-label{font-size:0.8rem;font-weight:300;color:#333}.summary-container .summary-box-container .summary-next-points{padding-left:10px;max-width:360px;color:#333}.summary-container a{font-size:1.1rem}.summary-container p,.summary-container ul,.summary-container ol{font-size:0.8rem}}@media only screen and (min-width: 320px) and (max-width: 689px){.summary-container .summary-box-container{width:90%}.summary-container .rt.footer-button-next{top:-10px;right:0}}@media only screen and (min-width: 690px){.summary-container{width:750px}.summary-container .summary-box-container{width:600px;padding:20px 40px 40px;margin:20px auto 0 auto}.summary-container .summary-box-container a{font-size:larger}.summary-container .summary-box-container .summary-label{font-size:20px;display:inline-block;font-style:italic;font-weight:300}.summary-container .summary-box-container .summary-next-points{padding-left:20px;max-width:360px}.summary-container p,.summary-container ul,.summary-container ol{font-size:1rem}.summary-container a{font-size:larger}}\n",""])},578:function(e,t,n){(e.exports=n(323)(!1)).push([e.i,'@font-face{font-family:\'highlight-font-icon\';src:url("/assets/fonts/highlight-font-icon.eot");src:url("/assets/fonts/highlight-font-icon.eot") format("embedded-opentype"),url("/assets/fonts/highlight-font-icon.woff") format("woff"),url("/assets/fonts/highlight-font-icon.ttf") format("truetype"),url("/assets/fonts/highlight-font-icon.svg") format("svg");font-weight:normal;font-style:normal}.highlight-icon-font:before{font-family:"highlight-font-icon" !important;content:attr(data-icon);font-style:normal !important;font-weight:normal !important;font-variant:normal !important;text-transform:none !important;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-highlighter-full:before{content:"\\e908"}.introduction-summary{margin:0 8%;margin-top:1em;margin-bottom:1em}#text-margin-icons-container{display:block;height:100%;width:1px;position:absolute;background-color:transparent;top:0;right:5%}@media only screen and (min-width: 320px){#text-margin-icons-container{right:7% !important}.introduction-summary ul{padding-left:1em !important}.callout-container,.text-addendum-container{padding:5px}#book-markup-container p,#book-markup-container ul,#book-markup-container ol,#book-markup-container table,#book-markup-container .toc-summary-content{font-size:0.8rem}#book-markup-container p i,#book-markup-container ul i,#book-markup-container ol i,#book-markup-container table i,#book-markup-container .toc-summary-content i{font-size:1rem}#book-markup-container h1,#book-markup-container .head1{font-weight:bold;font-size:1.25rem}#book-markup-container h2,#book-markup-container .head2{font-size:.9375rem}#book-markup-container h3,#book-markup-container .head3{font-size:.875rem}#book-markup-container h4{font-size:.8125rem}#book-markup-container h5{font-size:.75rem}#book-markup-container kbd{font-size:.75rem}#book-markup-container .head2,#book-markup-container .head3{margin-top:7px}.text-size-small #book-markup-container p,.text-size-small #book-markup-container ul,.text-size-small #book-markup-container ol,.text-size-small #book-markup-container table,.text-size-small #book-markup-container i,.text-size-small #book-markup-container .toc-summary-content{font-size:0.6rem}.text-size-small #book-markup-container h1,.text-size-small #book-markup-container .head1{font-weight:bold;font-size:1.125rem}.text-size-small #book-markup-container h2,.text-size-small #book-markup-container .head2{font-size:.8125rem}.text-size-small #book-markup-container h3,.text-size-small #book-markup-container .head3{font-size:.6875rem}.text-size-small #book-markup-container h4{font-size:.6875rem}.text-size-small #book-markup-container h5{font-size:.625rem}.text-size-small #book-markup-container kbd{font-size:.625rem}.text-size-small #book-markup-container .head2,.text-size-small #book-markup-container .head3{margin-top:5px}.text-size-standard #book-markup-container p,.text-size-standard #book-markup-container ul,.text-size-standard #book-markup-container ol,.text-size-standard #book-markup-container table,.text-size-standard #book-markup-container i,.text-size-standard #book-markup-container .toc-summary-content{font-size:0.8rem}.text-size-standard #book-markup-container h1,.text-size-standard #book-markup-container .head1{font-weight:bold;font-size:1.25rem}.text-size-standard #book-markup-container h2,.text-size-standard #book-markup-container .head2{font-size:.9375rem}.text-size-standard #book-markup-container h3,.text-size-standard #book-markup-container .head3{font-size:.875rem}.text-size-standard #book-markup-container h4{font-size:.8125rem}.text-size-standard #book-markup-container h5{font-size:.75rem}.text-size-standard #book-markup-container kbd{font-size:.75rem}.text-size-standard #book-markup-container .head2,.text-size-standard #book-markup-container .head3{margin-top:7px}.text-size-large #book-markup-container p,.text-size-large #book-markup-container ul,.text-size-large #book-markup-container ol,.text-size-large #book-markup-container table,.text-size-large #book-markup-container i,.text-size-large #book-markup-container .toc-summary-content{font-size:1rem}.text-size-large #book-markup-container h1,.text-size-large #book-markup-container .head1{font-size:2rem}.text-size-large #book-markup-container h2,.text-size-large #book-markup-container .head2{font-size:1.25rem}.text-size-large #book-markup-container h3,.text-size-large #book-markup-container .head3{font-size:1.125rem}.text-size-large #book-markup-container h4{font-size:1rem}.text-size-large #book-markup-container h5{font-size:.875rem}.text-size-large #book-markup-container .head2,.text-size-large #book-markup-container .head3{margin-top:7px}.text-size-large #book-markup-container kbd,.text-size-large #book-markup-container .listing-container .code-area{font-size:.875rem}.text-size-extra-large #book-markup-container p,.text-size-extra-large #book-markup-container ul,.text-size-extra-large #book-markup-container ol,.text-size-extra-large #book-markup-container table,.text-size-extra-large #book-markup-container i,.text-size-extra-large #book-markup-container .toc-summary-content{font-size:1.2rem}.text-size-extra-large #book-markup-container h1,.text-size-extra-large #book-markup-container .head1{font-size:2.25rem}.text-size-extra-large #book-markup-container h2,.text-size-extra-large #book-markup-container .head2{font-size:1.5rem}.text-size-extra-large #book-markup-container h3,.text-size-extra-large #book-markup-container .head3{font-size:1.25rem}.text-size-extra-large #book-markup-container h4{font-size:1.75rem}.text-size-extra-large #book-markup-container h5{font-size:1rem}.text-size-extra-large #book-markup-container .head2,.text-size-extra-large #book-markup-container .head3{margin-top:7px}.text-size-extra-large #book-markup-container kbd,.text-size-extra-large #book-markup-container .listing-container .code-area{font-size:1rem}#book-markup-container .browsable-container{overflow:auto}#book-markup-container .figure-container{overflow:initial}#book-markup-container pre.prettyprint{font-size:10px}.introduction-summary h3{font-size:.8125rem}}@media only screen and (min-width: 360px){#text-margin-icons-container{right:7% !important}.introduction-summary ul{padding-left:1em !important}}@media only screen and (min-width: 480px){#text-margin-icons-container{right:7% !important}.introduction-summary ul{padding-left:1em !important}}@media only screen and (min-width: 690px){#book-markup-container p,#book-markup-container ul,#book-markup-container ol,#book-markup-container table,#book-markup-container .toc-summary-content{font-size:16px;line-height:30px}#book-markup-container p{padding:5px}#book-markup-container pre.prettyprint{font-size:13px}#book-markup-container p,#book-markup-container ul,#book-markup-container ol,#book-markup-container table,#book-markup-container i,#book-markup-container .toc-summary-content{font-size:16px;line-height:30px}#book-markup-container h1,#book-markup-container .head1{font-size:2rem}#book-markup-container h2,#book-markup-container .head2{font-size:1.25rem}#book-markup-container h3,#book-markup-container .head3{font-size:1.125rem}#book-markup-container h4{font-size:1rem}#book-markup-container h5{font-size:.875rem}#book-markup-container .head2,#book-markup-container .head3{margin-top:7px}#book-markup-container kbd{font-size:.875rem}.text-size-standard #book-markup-container p,.text-size-standard #book-markup-container ul,.text-size-standard #book-markup-container ol,.text-size-standard #book-markup-container table,.text-size-standard #book-markup-container i,.text-size-standard #book-markup-container .toc-summary-content{font-size:16px;line-height:30px}.text-size-standard #book-markup-container h1,.text-size-standard #book-markup-container .head1{font-size:2rem}.text-size-standard #book-markup-container h2,.text-size-standard #book-markup-container .head2{font-size:1.25rem}.text-size-standard #book-markup-container h3,.text-size-standard #book-markup-container .head3{font-size:1.125rem}.text-size-standard #book-markup-container h4{font-size:1rem}.text-size-standard #book-markup-container h5{font-size:.875rem}.text-size-standard #book-markup-container .head2,.text-size-standard #book-markup-container .head3{margin-top:7px}.text-size-standard #book-markup-container kbd{font-size:.875rem}.text-size-large #book-markup-container p,.text-size-large #book-markup-container ul,.text-size-large #book-markup-container ol,.text-size-large #book-markup-container table,.text-size-large #book-markup-container i,.text-size-large #book-markup-container .toc-summary-content{font-size:18px;line-height:34px}.text-size-large #book-markup-container h1,.text-size-large #book-markup-container .head1{font-size:2.25rem}.text-size-large #book-markup-container h2,.text-size-large #book-markup-container .head2{font-size:1.5rem}.text-size-large #book-markup-container h3,.text-size-large #book-markup-container .head3{font-size:1.375rem}.text-size-large #book-markup-container h4{font-size:1.125rem}.text-size-large #book-markup-container h5{font-size:1rem}.text-size-large #book-markup-container .head2,.text-size-large #book-markup-container .head3{margin-top:10px}.text-size-large #book-markup-container kbd{font-size:1rem}.text-size-small #book-markup-container p,.text-size-small #book-markup-container ul,.text-size-small #book-markup-container ol,.text-size-small #book-markup-container table,.text-size-small #book-markup-container i,.text-size-small #book-markup-container .toc-summary-content{font-size:14px;line-height:26px}.text-size-small #book-markup-container h1,.text-size-small #book-markup-container .head1{font-size:1.75rem}.text-size-small #book-markup-container h2,.text-size-small #book-markup-container .head2{font-size:1.125rem}.text-size-small #book-markup-container h3,.text-size-small #book-markup-container .head3{font-size:1rem}.text-size-small #book-markup-container h4{font-size:.9375rem}.text-size-small #book-markup-container h5{font-size:.875rem}.text-size-small #book-markup-container .head2,.text-size-small #book-markup-container .head3{margin-top:7px}.text-size-small #book-markup-container kbd{font-size:.875rem}.introduction-summary h3{font-size:1.125rem}}@media only screen and (min-width: 800px){.show-small,.show-medium-down{display:none !important}.show-medium-up{display:inline-block !important}.show-large-up:not(.hidden){display:inherit !important}.callout-container:not(.interactive-container),.text-addendum-container{padding:15px}}.introduction-summary i,.readable-text i{font-family:Merriweather,"serif";font-style:italic}#book-main-content-container ul{margin-left:0}#book-main-content-container table ul,#book-main-content-container li ul,#book-main-content-container li ol{margin-left:1.25rem}#book-main-content-container table td{padding-left:0.5em;padding-right:0.5em}#book-main-content-container table td pre{font-size:80%;line-height:normal}#book-main-content-container h1,#book-main-content-container .head1,#book-main-content-container h2,#book-main-content-container .head2,#book-main-content-container h3,#book-main-content-container .head3,#book-main-content-container h4,#book-main-content-container h5{font-weight:bold}#book-main-content-container .head2,#book-main-content-container .head3{margin-top:7px}#book-main-content-container kbd{font-family:Consolas, Courier, monospace;padding:3px 5px;border:1px solid #DCDCDC;border-radius:3px;background-color:#F5F5F5}#book-main-content-container .callout-container,#book-main-content-container .text-addendum-container{margin:0 8%;margin-top:1em;margin-bottom:1em;border-radius:5px}#book-main-content-container .callout-container>.readable-text>h5,#book-main-content-container .callout-container>h5,#book-main-content-container .text-addendum-container>.readable-text>h5,#book-main-content-container .text-addendum-container>h5{text-transform:uppercase}#book-main-content-container .callout-container .readable-text,#book-main-content-container .text-addendum-container .readable-text{padding:0 1em}#book-main-content-container .callout-container.collapsed,#book-main-content-container .text-addendum-container.collapsed{border:0}#book-main-content-container .callout-container>ul,#book-main-content-container .callout-container>ol,#book-main-content-container .text-addendum-container>ul,#book-main-content-container .text-addendum-container>ol{padding-left:3rem}#book-main-content-container .callout-container>ul>.readable-text,#book-main-content-container .callout-container>ol>.readable-text,#book-main-content-container .callout-container ul .readable-text,#book-main-content-container .callout-container ol .readable-text,#book-main-content-container .text-addendum-container>ul>.readable-text,#book-main-content-container .text-addendum-container>ol>.readable-text,#book-main-content-container .text-addendum-container ul .readable-text,#book-main-content-container .text-addendum-container ol .readable-text{padding-top:0;padding-left:1em}#book-main-content-container .callout-container .browsable-container,#book-main-content-container .text-addendum-container .browsable-container{padding:1em}#book-main-content-container .callout-container iframe,#book-main-content-container .text-addendum-container iframe{width:100%;border:none}#book-main-content-container .readable-text{padding:0 8%;word-wrap:break-word}#book-main-content-container .readable-text p[definition-title]{font-weight:bolder}#book-main-content-container .readable-text p[data-is-quote]{font-style:italic}#book-main-content-container .readable-text p[data-is-cite]{text-align:right;font-weight:bolder}#book-main-content-container .readable-text p[definition-content]{margin-left:1em}#book-main-content-container .readable-text .xref{text-decoration:underline}#book-main-content-container .readable-text.clickable{cursor:pointer}#book-main-content-container .readable-text h5{margin-bottom:1.25rem}#book-main-content-container ul .readable-text,#book-main-content-container ol .readable-text{padding-top:0;padding-left:1em}#pointing-start-point,#pointing-end-point{cursor:move;cursor:grab;cursor:-moz-grab;cursor:-webkit-grab;left:15px;font-size:24px;color:gray}#pointing-start-point:active,#pointing-end-point:active{cursor:grabbing;cursor:-moz-grabbing;cursor:-webkit-grabbing}@media screen and (max-width: 500px){#pointing-start-point,#pointing-end-point{left:8px}}#book-markup-container{font-family:Merriweather,"serif";position:relative}#book-markup-container h1,#book-markup-container h2,#book-markup-container h3,#book-markup-container h4,#book-markup-container h5,#book-markup-container h6{font-family:Lato}#book-markup-container>ul,#book-markup-container>ol{padding:0 8% 0 12%}#book-markup-container .collapsed{height:0;overflow:hidden}#book-markup-container .emphasized-text{opacity:1}#book-markup-container .readable-text>p>img{cursor:pointer}#book-markup-container .readable-text .cueball{display:inline-block;background-color:black;border-radius:50%;width:16px;height:16px;color:white;text-align:center;font-size:smaller;vertical-align:middle;line-height:1;cursor:pointer}.introduction-summary{border-style:solid;border-width:1px;margin-bottom:1.25rem;padding:1.25rem;border-radius:3px;background:#F5F3F0;border-color:#ebe7e1}.introduction-summary .readable-text,.introduction-summary ul .readable-text{padding-left:0}.introduction-summary h3{font-weight:bold}.introduction-summary h3,.introduction-summary ul,.introduction-summary li,.introduction-summary p,.introduction-summary ol{color:#8a785c;font-family:Lato}.introduction-summary ul{padding-left:2rem}.browsable-container{background-color:white;position:relative}.browsable-container.figure-container{text-align:center}.browsable-container.figure-container h1,.browsable-container.figure-container h2,.browsable-container.figure-container h3,.browsable-container.figure-container h4,.browsable-container.figure-container h5{text-align:left}.browsable-container>code,.callout-code-container>code{display:block}.browsable-container code,.callout-code-container code{border-style:none}.callout-code-container{padding:0 1em}#book-markup-container>.browsable-container{margin:0 8%}#book-markup-container .browsable-container{margin-top:1em;margin-bottom:2em;padding:1em}#book-markup-container>.browsable-container.book-overview-cover-container{padding:0}.callout-container>.browsable-container{margin:1em}#book-markup-container .browsable-container:not(.collapsible-panel){border-radius:5px;border:1px solid #d9d9d9}.browsable-placeholder .listing-environment-container{display:none}.listing-environment-container{border-top:1px solid #e5e5e5;padding:10px;margin-top:5px;margin-right:5px;display:block}.listing-environment-container .listing-environment-runnable-script-container{display:inline-block}.listing-environment-container.edit-mode{border-top:1px solid transparent}.listing-environment-container.edit-mode .execution-environment-standard-mode-container{display:none}.listing-environment-container .execution-environment-edit-mode-container{display:none}.listing-environment-container.edit-mode .execution-environment-edit-mode-container{display:inline-block}.listing-environment-container .execution-environment-frame{width:100%;height:200px;display:none;background:#f7f7f7;border:1px solid #e5e5e5;margin-top:20px}.browsable-container .button,.listing-environment-container .button{color:white;border-radius:2px;font-size:smaller;padding:3px 10px;display:inline-block;margin-right:0.1rem;background-color:#0e5ba9;display:inline-block}.browsable-container .button .button-label,.listing-environment-container .button .button-label{margin-left:0.2rem}.browsable-container .button.opened,.listing-environment-container .button.opened{background-color:#0a427a}.browsable-container .button-hide,.listing-environment-container .button-hide{display:none}.browsable-placeholder{color:lightgray;border:dashed 1px;cursor:pointer}.browsable-placeholder>*{position:absolute;overflow-y:auto;cursor:pointer;max-width:630px;-webkit-box-shadow:0px 0px 10px 3px rgba(0,0,0,0.75);-moz-box-shadow:0px 0px 10px 3px rgba(0,0,0,0.75);box-shadow:0px 0px 10px 3px rgba(0,0,0,0.75);z-index:10}.browsable-placeholder>i{-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;z-index:11;font-style:normal;font-size:xx-large;opacity:0}.annotation-container{position:absolute;width:20px;right:2px;z-index:90;background:#e5e5e5;cursor:pointer;display:table;text-align:center;border-radius:2px;font-weight:600;-webkit-transition:right 0.15s ease-out;-moz-transition:right 0.15s ease-out;transition:right 0.15s ease-out}.annotation-container:active,.annotation-container:after:active{outline:0}.annotation-container:hover,.annotation-container.hovered{background:#d3d3d7}.annotation-container:hover:after,.annotation-container:after,.annotation-container.hovered:after,.annotation-container.hovered:after{border-right-color:#d3d3d7}.annotation-container.selected{background-color:#F5A623}.annotation-container.selected:not(.vertical){width:22px;right:-1px;border-top-right-radius:0;border-bottom-right-radius:0}.annotation-container.selected:hover{background:#F5A623}.annotation-container.selected:hover:after,.annotation-container.selected:after{border-right-color:#F5A623}.annotation-container.selected.vertical{border-radius:2px}.annotation-container.show-tip:after{right:21px;opacity:1;-webkit-transition:all 0.1s ease-out;-moz-transition:all 0.1s ease-out;transition:all 0.1s ease-out}.annotation-container:after{right:15px;top:50%;border:solid transparent;content:" ";height:0;width:0;position:absolute;pointer-events:none;border-right-color:#e5e5e5;border-width:7px;margin-top:-7px;opacity:0}.annotation-container .annotation-label{display:table-cell;vertical-align:middle;font-size:10px;font-weight:bold;user-select:none}#code-annotation-container,#additional-code-annotation-container{display:none;position:absolute;z-index:95;width:200px;font-size:80%;background-color:#F5A623;border-top-right-radius:2px;border-bottom-right-radius:2px;hyphens:auto}#code-annotation-container .play-pause-container,#additional-code-annotation-container .play-pause-container{text-align:center;font-size:1.8rem;cursor:pointer}#code-annotation-container .annotation-description,#additional-code-annotation-container .annotation-description{display:table-cell;vertical-align:middle;padding:0.5rem}#code-annotation-container.shown,#additional-code-annotation-container.shown{display:inline-block}#code-annotation-container.vertical,#additional-code-annotation-container.vertical{z-index:95;border-radius:2px}#code-annotation-container.vertical.show-tip:after,#additional-code-annotation-container.vertical.show-tip:after{opacity:1;transform:translateY(0);-webkit-transition:all 0.2s ease-out;-moz-transition:all 0.2s ease-out;transition:all 0.2s ease-out}#code-annotation-container.vertical:after,#additional-code-annotation-container.vertical:after{top:100%;left:50%;border:solid transparent;content:" ";height:0;width:0;position:absolute;pointer-events:none;border-color:rgba(245,166,35,0);border-top-color:#F5A623;border-width:7px;margin-left:-7px;transform:translateY(-5px)}.listing-container{z-index:95;background-color:white}.listing-container .code-area-container{position:relative}.listing-container .code-area-container .code-area .line-container{position:absolute}.listing-container .deemphasized-code{color:gray !important}.listing-container .code-annotations-overlay-container{position:absolute;top:0;right:0;bottom:0;width:25px}.listing-container .code-annotations-overlay-container,.listing-container .code-area{display:block}.listing-container .code-area>.hljs{padding:0 0.5em 0 0}.listing-container .CodeMirror{display:none}.listing-container.edit-mode .code-annotations-overlay-container,.listing-container.edit-mode .code-area{display:none}.listing-container.edit-mode .CodeMirror{display:block}.listing-container .emphasized-code{font-weight:bolder}.listing-container .hidden-annotation{opacity:0}.listing-container .shown-annotation{opacity:1}.listing-container .emphasized-annotation{-webkit-animation:fadeIn ease-in 1;-moz-animation:fadeIn ease-in 1;animation:fadeIn ease-in 1;-webkit-animation-fill-mode:forwards;-moz-animation-fill-mode:forwards;animation-fill-mode:forwards;-webkit-animation-duration:0.5s;-moz-animation-duration:0.5s;animation-duration:0.5s}@-webkit-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-moz-keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}#text-addons-menu .search-input-container{padding:0 5px}#text-addons-menu .search-input{width:201px}#text-addons-menu .sort-command-container{position:absolute;top:0;right:10px}#text-addons-menu .sort-command-container .selected{font-weight:bolder;text-decoration:underline}#book-markup-container .search-result{background-color:yellow}.readable-text>p,.readable-text>h1,.readable-text>h2,.readable-text>h3,.readable-text>h4,.readable-text>h5{padding:5px;border-right:2px solid transparent}.readable-text.matching-note-bubble-visible>p,.readable-text.matching-note-bubble-visible>h1,.readable-text.matching-note-bubble-visible>h2,.readable-text.matching-note-bubble-visible>h3,.readable-text.matching-note-bubble-visible>h4{background:#fff;border-left:0}.readable-text.matching-text-bubble-shown.being-annotated>p,.readable-text.matching-text-bubble-shown.being-annotated>h1,.readable-text.matching-text-bubble-shown.being-annotated>h2,.readable-text.matching-text-bubble-shown.being-annotated>h3,.readable-text.matching-text-bubble-shown.being-annotated>h4{background:#EAF0F9}.readable-text.contains-search-result>p,.readable-text.contains-search-result>h1,.readable-text.contains-search-result>h2,.readable-text.contains-search-result>h3,.readable-text.contains-search-result>h4{border-right:2px solid yellow}#text-margin-icons-container .paragraph-bubble{position:absolute;top:277px}#text-margin-icons-container:not(.editor-mode) .editor-bubble{display:none}#text-margin-icons-container.editor-mode .bookmark-bubble,#text-margin-icons-container.editor-mode .note-bubble,#text-margin-icons-container.editor-mode .forums-bubble{display:none}#text-margin-icons-container.editor-mode .editor-bubble{display:block}#text-margin-icons-container.review-mode .forums-bubble,#text-margin-icons-container.review-mode .bookmark-bubble{display:none}@media screen and (min-width: 870px){#text-margin-icons-container .paragraph-bubble{display:flex}}#text-margin-icons-container .text-margin-icon-bubble{position:relative;width:2rem;height:1.9rem;text-align:center;cursor:pointer;color:#666;transition:transform 0.25s ease-out;-webkit-transform-origin:50% 50%;-moz-transform-origin:50% 50%;-o-transform-origin:50% 50%;transform-origin:50% 50%;margin:1px}#text-margin-icons-container .text-margin-icon-bubble i{font-size:22px}#text-margin-icons-container .text-margin-icon-bubble.bookmark-bubble i{font-size:20px}#text-margin-icons-container .text-margin-icon-bubble.selected,#text-margin-icons-container .text-margin-icon-bubble:hover,#text-margin-icons-container .text-margin-icon-bubble.bubble-active{color:#000}#text-margin-icons-container .text-margin-icon-bubble:hover i,#text-margin-icons-container .text-margin-icon-bubble.bubble-active i{transform:scale(1.1)}#text-margin-icons-container .text-margin-icon-bubble .note-count-container{position:absolute;top:10px;right:-2px;color:000;text-align:center;font-size:10px;font-weight:bold;cursor:pointer;width:12px;display:block !important}#text-margin-icons-container .text-margin-icon-bubble .comment-count-container{position:absolute;top:50%;right:-25%;text-align:center;font-size:10px;font-weight:bold;cursor:pointer;width:12px;display:block !important}#notes-menu{width:250px;position:absolute;top:100px;right:20px;background:white;border-left:1px solid #ccc;padding:0 10px 10px;z-index:96;box-shadow:1px 0 5px 0 rgba(0,0,0,0.1)}#notes-menu .button{margin-bottom:0}#notes-menu.closed{display:none}#notes-menu.open{display:block}#notes-menu:after,#notes-menu:before{right:100%;top:23px;border:solid transparent;content:" ";height:0;width:0;position:absolute;pointer-events:none}#notes-menu:after{border-color:rgba(136,183,213,0);border-right-color:white;border-width:8px;margin-top:-8px}#notes-menu:before{border-color:rgba(194,225,245,0);border-right-color:#ccc;border-width:10px;margin-top:-10px}#notes-menu .notes-menu-heading{color:#666;margin-top:2px;font-size:18px;font-weight:500;user-select:none}#notes-menu .note-delete-icon,#notes-menu .note-edit-icon{position:absolute;right:0.2rem;top:0.2rem;color:#666;cursor:pointer;display:none;width:24px;height:24px;text-align:center;cursor:pointer;color:#666;transition:all 0.25s ease-out;border:1px solid #ccc;background:#fff;font-size:16px;padding-top:2px}#notes-menu .note-delete-icon:hover,#notes-menu .note-edit-icon:hover{color:#000}#notes-menu .note-close-icon{display:none !important}#notes-menu .note-delete-icon{border-top-right-radius:3px;border-bottom-right-radius:3px;border-left:0}#notes-menu .note-edit-icon{right:27px;border-top-left-radius:3px;border-bottom-left-radius:3px;border-right:0}#notes-menu .note-item-container{position:relative;padding:10px}#notes-menu .note-item-container .note-item-username-container{font-weight:bold}#notes-menu .note-item-container:not(.edit-mode) .note-input-container{display:none}#notes-menu .note-item-container:not(.edit-mode) .note-content-container{display:block;max-height:200px;overflow:auto}#notes-menu .note-item-container:not(.edit-mode):hover .note-delete-icon,#notes-menu .note-item-container:not(.edit-mode):hover .note-edit-icon{display:block}#notes-menu .note-item-container:not(.edit-mode) .note-input-save,#notes-menu .note-item-container:not(.edit-mode) .note-input-cancel{display:none}#notes-menu .note-item-container.edit-mode .note-input-container{display:block}#notes-menu .note-item-container.edit-mode .note-content-container{display:none}#notes-menu .note-item-container.edit-mode:hover .note-close-icon{display:block}#notes-menu .note-item-container.edit-mode .note-input-save,#notes-menu .note-item-container.edit-mode .note-input-cancel{display:inline-block}#notes-menu .note-item-container:not(:last-child){border-bottom:1px dashed #ccc}#notes-menu .note-item-container:last-child{padding-bottom:0}#notes-menu .note-item-container .waiting-for-deletion{opacity:0.4}#notes-menu .note-input-container{display:none;position:relative}#notes-menu .note-content-container{display:block;color:black;font-size:14px;position:relative;padding:5px}#notes-menu .note-content-container:hover{background-color:#f9f9f9}#notes-menu #note-input-box,#notes-menu .note-input-container{height:100px;border:1px solid #eee;box-shadow:none;overflow:auto}#notes-menu .note-input-container{margin-bottom:3px}#notes-menu .note-input-save{margin-right:10px}#notes-menu #note-input-box{margin-top:10px}#notes-menu .notes-list{list-style-type:none;font-size:smaller;margin-bottom:5px;margin-left:0;overflow-y:auto;overscroll-behavior-y:none;margin-top:5px;max-height:500px;overflow:auto;border-top:1px solid #ccc}#notes-menu .notes-list li{padding-left:5px}.highlighted-code{background-color:darkgrey;font-weight:bolder}.highlighted-text,.highlighted-note-text,.dummy-highlighted-text{background-color:#ffe680}.highlighted-text.selected-highlight,.highlighted-note-text.selected-highlight,.dummy-highlighted-text.selected-highlight{background-color:#fd5}.highlighted-text.highlight-color-yellow,.highlighted-note-text.highlight-color-yellow,.dummy-highlighted-text.highlight-color-yellow{background-color:#ffe680}.highlighted-text.highlight-color-yellow.selected-highlight,.highlighted-note-text.highlight-color-yellow.selected-highlight,.dummy-highlighted-text.highlight-color-yellow.selected-highlight{background-color:#fd5}.highlighted-text.highlight-color-red,.highlighted-note-text.highlight-color-red,.dummy-highlighted-text.highlight-color-red{background-color:#faa}.highlighted-text.highlight-color-red.selected-highlight,.highlighted-note-text.highlight-color-red.selected-highlight,.dummy-highlighted-text.highlight-color-red.selected-highlight{background-color:#f55}.highlighted-text.highlight-color-green,.highlighted-note-text.highlight-color-green,.dummy-highlighted-text.highlight-color-green{background-color:#afe9af}.highlighted-text.highlight-color-green.selected-highlight,.highlighted-note-text.highlight-color-green.selected-highlight,.dummy-highlighted-text.highlight-color-green.selected-highlight{background-color:#87de87}.highlighted-text.highlight-color-blue,.highlighted-note-text.highlight-color-blue,.dummy-highlighted-text.highlight-color-blue{background-color:#acf}.highlighted-text.highlight-color-blue.selected-highlight,.highlighted-note-text.highlight-color-blue.selected-highlight,.dummy-highlighted-text.highlight-color-blue.selected-highlight{background-color:#80b3ff}.highlighted-text.highlight-color-pink,.highlighted-note-text.highlight-color-pink,.dummy-highlighted-text.highlight-color-pink{background-color:#fac}.highlighted-text.highlight-color-pink.selected-highlight,.highlighted-note-text.highlight-color-pink.selected-highlight,.dummy-highlighted-text.highlight-color-pink.selected-highlight{background-color:#f59}.annotated-text{background-color:lightgrey;cursor:pointer}.readable-text.paragraph-selected p,.readable-text.paragraph-selected h1,.readable-text.paragraph-selected h2,.readable-text.paragraph-selected h3,.readable-text.paragraph-selected h4,.readable-text.paragraph-selected h5,.readable-text.paragraph-selected h6{background-color:rgba(254,216,1,0.2)}.readable-text.paragraph-selected.clickable:hover p,.readable-text.paragraph-selected.clickable:hover h1,.readable-text.paragraph-selected.clickable:hover h2,.readable-text.paragraph-selected.clickable:hover h3,.readable-text.paragraph-selected.clickable:hover h4,.readable-text.paragraph-selected.clickable:hover h5,.readable-text.paragraph-selected.clickable:hover h6{background-color:rgba(254,216,1,0.4)}li.readable-text.paragraph-selected{background-color:rgba(254,216,1,0.2)}li.readable-text.paragraph-selected.clickable:hover{background-color:rgba(254,216,1,0.4)}.readable-text.clickable:hover p,.readable-text.clickable:hover h1,.readable-text.clickable:hover h2,.readable-text.clickable:hover h3,.readable-text.clickable:hover h4,.readable-text.clickable:hover h5,.readable-text.clickable:hover h6{background-color:rgba(160,160,160,0.2)}li.readable-text.clickable:hover{background-color:rgba(160,160,160,0.2)}.text-selection-reference-node,.highlight-tooltip-reference-node{position:absolute}.text-selection-tooltip-container,.highlight-tooltip-container,.indexed-term-tooltip-container{padding:2px;font-size:1.4rem;cursor:default;user-select:none;display:flex;align-items:center}.text-selection-tooltip-container i,.highlight-tooltip-container i,.indexed-term-tooltip-container i{display:inline-block;margin:0 8px;cursor:pointer}.text-selection-tooltip-container .note-button,.text-selection-tooltip-container .highlight-button,.highlight-tooltip-container .note-button,.highlight-tooltip-container .highlight-button,.indexed-term-tooltip-container .note-button,.indexed-term-tooltip-container .highlight-button{display:none}.text-selection-tooltip-container i,.highlight-tooltip-container i,.indexed-term-tooltip-container i{cursor:pointer}.text-selection-tooltip-container .color-selector,.highlight-tooltip-container .color-selector,.indexed-term-tooltip-container .color-selector{cursor:pointer;display:inline-block;margin:0 8px}.text-selection-tooltip-container .color-selector.selected,.highlight-tooltip-container .color-selector.selected,.indexed-term-tooltip-container .color-selector.selected{text-decoration:underline}.text-selection-tooltip-container .color-selector.red,.highlight-tooltip-container .color-selector.red,.indexed-term-tooltip-container .color-selector.red{color:#f55}.text-selection-tooltip-container .color-selector.red.selected,.highlight-tooltip-container .color-selector.red.selected,.indexed-term-tooltip-container .color-selector.red.selected{text-shadow:0px 0px 3px #f22}.text-selection-tooltip-container .color-selector.green,.highlight-tooltip-container .color-selector.green,.indexed-term-tooltip-container .color-selector.green{color:#87de87}.text-selection-tooltip-container .color-selector.green.selected,.highlight-tooltip-container .color-selector.green.selected,.indexed-term-tooltip-container .color-selector.green.selected{text-shadow:0px 0px 3px #5fd35f}.text-selection-tooltip-container .color-selector.yellow,.highlight-tooltip-container .color-selector.yellow,.indexed-term-tooltip-container .color-selector.yellow{color:#fd5}.text-selection-tooltip-container .color-selector.yellow.selected,.highlight-tooltip-container .color-selector.yellow.selected,.indexed-term-tooltip-container .color-selector.yellow.selected{text-shadow:0px 0px 3px #ffd322}.text-selection-tooltip-container .color-selector.blue,.highlight-tooltip-container .color-selector.blue,.indexed-term-tooltip-container .color-selector.blue{color:#80b3ff}.text-selection-tooltip-container .color-selector.blue.selected,.highlight-tooltip-container .color-selector.blue.selected,.indexed-term-tooltip-container .color-selector.blue.selected{text-shadow:0px 0px 3px #4d94ff}.text-selection-tooltip-container .color-selector.pink,.highlight-tooltip-container .color-selector.pink,.indexed-term-tooltip-container .color-selector.pink{color:#f59}.text-selection-tooltip-container .color-selector.pink.selected,.highlight-tooltip-container .color-selector.pink.selected,.indexed-term-tooltip-container .color-selector.pink.selected{text-shadow:0px 0px 3px #ff227a}body.night-mode{background:#2e3436}body.night-mode .placeholder-animated-background{background:linear-gradient(to right, #9a9898 10%, #7f7f7f 18%, #858585 33%)}body.night-mode code{background-color:#929799}body.night-mode .unscramble-target p,body.night-mode li.unscramble-target{background-color:#383d3f}body.night-mode.unlock-supported:not(.free-preview-mode) .scrambled p:hover,body.night-mode.unlock-supported:not(.free-preview-mode) li.scrambled:hover{background-color:#383d3f}body.night-mode .unscrambling p,body.night-mode li.unscrambling{background-color:#383d3f}body.night-mode .scrambled-notifier.unlock-notifier:before{border-color:transparent transparent #2e3436 transparent}body.night-mode .tooltip{color:#333;background:#fff}body.night-mode .tooltip>.nub{border-color:transparent transparent #fff transparent}body.night-mode .highlighted-text,body.night-mode .highlighted-note-text,body.night-mode .dummy-highlighted-text{background-color:#d0a700}body.night-mode .highlighted-text.highlight-color-yellow,body.night-mode .highlighted-note-text.highlight-color-yellow,body.night-mode .dummy-highlighted-text.highlight-color-yellow{background-color:#d0a700}body.night-mode .highlighted-text.highlight-color-red,body.night-mode .highlighted-note-text.highlight-color-red,body.night-mode .dummy-highlighted-text.highlight-color-red{background-color:#892828}body.night-mode .highlighted-text.highlight-color-green,body.night-mode .highlighted-note-text.highlight-color-green,body.night-mode .dummy-highlighted-text.highlight-color-green{background-color:#3e913e}body.night-mode .highlighted-text.highlight-color-blue,body.night-mode .highlighted-note-text.highlight-color-blue,body.night-mode .dummy-highlighted-text.highlight-color-blue{background-color:#4075c5}body.night-mode .highlighted-text.highlight-color-pink,body.night-mode .highlighted-note-text.highlight-color-pink,body.night-mode .dummy-highlighted-text.highlight-color-pink{background-color:#d91d68}body.night-mode #book-markup-container{color:#b9b9ad}body.night-mode #book-markup-container h1,body.night-mode #book-markup-container h2,body.night-mode #book-markup-container h3,body.night-mode #book-markup-container h4,body.night-mode #book-markup-container h5,body.night-mode #book-markup-container h6{color:#b9b9ad}body.night-mode #book-markup-container .readable-text a{color:#4392e0}body.night-mode #book-markup-container .readable-text kbd{background-color:#515556}body.night-mode #book-markup-container .introduction-summary{background-color:#515556;border-color:transparent}body.night-mode #book-markup-container .introduction-summary li,body.night-mode #book-markup-container .introduction-summary p,body.night-mode #book-markup-container .introduction-summary h3{color:#b9b9ad}body.night-mode #book-markup-container .browsable-container,body.night-mode #book-markup-container .browsable-container h1,body.night-mode #book-markup-container .browsable-container h2,body.night-mode #book-markup-container .browsable-container h3,body.night-mode #book-markup-container .browsable-container h4,body.night-mode #book-markup-container .browsable-container h5,body.night-mode #book-markup-container .browsable-container h6,body.night-mode #book-markup-container #code-annotation-container,body.night-mode #book-markup-container #code-annotation-container h1,body.night-mode #book-markup-container #code-annotation-container h2,body.night-mode #book-markup-container #code-annotation-container h3,body.night-mode #book-markup-container #code-annotation-container h4,body.night-mode #book-markup-container #code-annotation-container h5,body.night-mode #book-markup-container #code-annotation-container h6,body.night-mode #book-markup-container .interactive-container,body.night-mode #book-markup-container .interactive-container h1,body.night-mode #book-markup-container .interactive-container h2,body.night-mode #book-markup-container .interactive-container h3,body.night-mode #book-markup-container .interactive-container h4,body.night-mode #book-markup-container .interactive-container h5,body.night-mode #book-markup-container .interactive-container h6{color:#3C3C3C}body.night-mode .callout-container:not(.interactive-container){background-color:#515556}body.night-mode .browsable-container h4,body.night-mode .browsable-container h5,body.night-mode .interactive-container h4,body.night-mode .interactive-container h5{color:#3C3C3C}body.night-mode #track-point-column{background-color:#515556}body.night-mode #text-margin-icons-container .text-margin-icon-bubble{color:#b9b9ad}body.night-mode .readable-text.matching-note-bubble-visible>p,body.night-mode .readable-text.matching-note-bubble-visible>h1,body.night-mode .readable-text.matching-note-bubble-visible>h2,body.night-mode .readable-text.matching-note-bubble-visible>h3,body.night-mode .readable-text.matching-note-bubble-visible>h4{background:rgba(81,85,86,0.7)}body.night-mode .readable-text.matching-text-bubble-shown.being-annotated>p,body.night-mode .readable-text.matching-text-bubble-shown.being-annotated>h1,body.night-mode .readable-text.matching-text-bubble-shown.being-annotated>h2,body.night-mode .readable-text.matching-text-bubble-shown.being-annotated>h3,body.night-mode .readable-text.matching-text-bubble-shown.being-annotated>h4{background:rgba(81,85,86,0.7)}body.night-mode .highlighted-text{color:white}.listing-container .code-area{line-height:1.3 !important;font-size:13px;overflow-x:auto}.listing-container .code-area .hljs{background:initial}.listing-container .code-area .hljs .bold{font-weight:900;background-color:#cccccc73}.listing-container .code-area .line-container{position:absolute;left:0;right:20px;top:0px;opacity:0.6;cursor:pointer}.listing-container .code-area .line-container.highlighted{background:rgba(230,230,230,0.4)}.listing-container .code-area .line-container.pre-selected{background:rgba(230,230,230,0.5)}.listing-container .code-area .line-container.selected{background:rgba(230,230,230,0.6)}#book-markup-container .readable-text a{color:#2b44d1;text-decoration:underline}.code-area-container{padding-left:10px}pre.prettyprint{padding:5px 0;background:#fff;border:none}@media only screen and (min-height: 320px) and (max-height: 450px){.tab-container.selected .index-symbols-container{display:none}.index-container .index-content-container{margin-left:5px}}@media only screen and (min-height: 451px) and (max-height: 600px){.tab-container.selected .index-symbols-container{line-height:1.3}}@media only screen and (min-height: 601px) and (max-height: 720px){.tab-container.selected .index-symbols-container{line-height:1.5}}@media only screen and (min-height: 720px) and (max-height: 850px){.tab-container.selected .index-symbols-container{line-height:1.7}}@media only screen and (min-height: 851px){.tab-container.selected .index-symbols-container{line-height:2}}.user-logged-in .text-selection-tooltip-container .note-button,.user-logged-in .text-selection-tooltip-container .highlight-button{display:inline-block}.live-audio-disabled #current-position-point,.live-audio-disabled #play-point,.live-audio-disabled .audio-controls-container{display:none !important}.editor-bubble{background-color:whitesmoke}#download-exercises-link{position:fixed;top:85px;right:2rem;display:none;cursor:pointer}.book-edit #download-exercises-link{display:block}#text-addons-pagination{text-align:center;margin:0}#text-addons-pagination.has-items{border-top:1px dashed rgba(255,255,255,0.2);padding:5px 0 0 0}#text-addons-pagination li{color:#ffffff;font-size:smaller;list-style-type:none;display:inline;margin-right:10px;user-select:none;-webkit-user-select:none;cursor:pointer}#text-addons-pagination li:hover,#text-addons-pagination li.active{color:#0e5ba9}.book-page .tour-feedback-tooltip-item.tour{display:block}.unscrambling{position:relative}.unscrambling p{position:relative}.scrambling-character{display:inline-block;visibility:visible;text-decoration:inherit}.scrambling-word{display:inline-block;transform:translate3d(0px, 0px, 0px);text-decoration:inherit}.scrambling-animated{animation-duration:0.5s;animation-fill-mode:both}.scrambling-animated.scrambling-character,.scrambling-animated .scrambling-character{text-decoration:none !important}.rotate-around{transform-origin:center center;animation-timing-function:linear}.rotate-to-start{animation-timing-function:linear;animation-duration:1s}.rotate-in{transform-origin:center center;animation-iteration-count:1}.rotate-out{animation-iteration-count:1;transform-origin:center center}.unscrambled-content-container{position:absolute;top:5px;left:5px}li .unscrambled-content-container{top:0px;left:1em}.review-book #text-addons-menu .text-addon-item-text{text-decoration:none}#text-addons-menu .text-addon-item-content{display:block;hyphens:auto}#text-addons-menu .text-addon-item-text{text-decoration:underline}#text-addons-menu .text-addon-item-username-container{font-weight:bold}#text-addons-menu .items-container ul{margin:0}#text-addons-menu .items-container .text-addon-item{position:relative;margin:0;padding:0.5rem 2rem}#text-addons-menu .items-container .text-addon-item .text-addon-icon,#text-addons-menu .items-container .text-addon-item .delete-text-addon-icon{position:absolute;color:white;top:0.8rem}#text-addons-menu .items-container .text-addon-item:first-of-type{border-top:1px dashed transparent}#text-addons-menu .items-container .text-addon-item:hover{background:initial}#text-addons-menu .items-container .text-addon-item.waiting-for-deletion{opacity:0.5}#text-addons-menu .text-addon-icon{left:0.7rem;width:12px}#text-addons-menu .text-addon-icon.red{color:#f55}#text-addons-menu .text-addon-icon.yellow{color:#fd5}#text-addons-menu .text-addon-icon.green{color:#87de87}#text-addons-menu .text-addon-icon.blue{color:#80b3ff}#text-addons-menu .text-addon-icon.pink{color:#f59}#text-addons-menu .delete-text-addon-icon{cursor:pointer;right:1.3rem}#pointing-info-box{display:none;width:310px;position:fixed;background-color:gray;bottom:46px;left:50%;transform:translateX(-50%);border-radius:3px;z-index:95;background-color:#fff;border:solid 1px #666;font-size:14px;transition:transform 0.2s ease-in-out}#pointing-info-box:not(.shown){transform:translate(-50%, 150%)}#pointing-info-box.shown{transform:translate(-50%, 0)}#pointing-info-box .fa,#pointing-info-box .add-to-cart-button{user-select:none;-webkit-user-select:none;-moz-user-select:moz-none;-ms-user-select:none}#pointing-info-box input{height:37px;display:inline-block}#pointing-info-box .pointing-info-right-container,#pointing-info-box .pointing-info-left-container{font-size:20px;display:inline-block;cursor:pointer;margin:5px 0;width:40px;height:35px;text-align:center}#pointing-info-box .pointing-info-right-container{float:right;color:gray}#pointing-info-box .pointing-info-left-container{float:left}#pointing-info-box .pointing-info-middle-container{line-height:35px;height:35px;padding:3px 0;display:inline-block;width:220px;text-align:center}#pointing-info-box .pointing-info-middle-container a{display:inline-block;width:100%}.text-addon-item-link{display:block}#book-resources-menu .book-resources-links-container{font-size:14px;margin-bottom:10px}#book-resources-menu .book-resources-links-container a{color:white}#book-resources-menu .book-resources-links-container .fa-star{color:#fc0}#book-resources-menu .book-resources-links-container .book-resource-link{display:block;padding:10px 15px}#book-resources-menu .book-resources-links-container .book-resource-link:hover{color:#222222;background-color:#cccccc}#book-resources-menu .book-resources-links-container:last-of-type{margin-bottom:0}#link-preview-popup{width:400px;position:absolute;top:0;right:0;background:white;border-left:1px solid #ccc;z-index:96;box-shadow:1px 0 5px 4px rgba(0,0,0,0.1)}#link-preview-popup .chapter-preview-container{max-height:150px;overflow:hidden}#link-preview-popup .browsable-preview-container{overflow-y:auto;max-height:50vh;padding:10px;font-size:smaller}#link-preview-popup .browsable-preview-container h4,#link-preview-popup .browsable-preview-container h5{font-size:inherit}#link-preview-popup.book-element-preview .chapter-preview-container{display:block}#link-preview-popup.book-element-preview .browsable-preview-container{display:none}#link-preview-popup.browsable-preview{padding:10px}#link-preview-popup.browsable-preview .chapter-preview-container{display:none}#link-preview-popup.browsable-preview .browsable-preview-container{display:block}#link-preview-popup .book-cover{width:30%}#link-preview-popup.is-cover-left{padding:0 0 0 0}#link-preview-popup.is-cover-left .book-cover{float:left;margin-right:5px}#link-preview-popup.is-cover-left .chapter-preview-title{padding-top:10px;padding-right:10px}#link-preview-popup.is-cover-left .chapter-preview-paragraphs-container{padding-right:20px;padding-bottom:10px}#link-preview-popup.is-cover-right{padding:0 0 0 10px}#link-preview-popup.is-cover-right .book-cover{float:right;margin-left:5px}#link-preview-popup.is-cover-right .chapter-preview-title{padding-top:10px;padding-left:10px;padding-right:10px}#link-preview-popup.is-cover-right .chapter-preview-paragraphs-container{padding-left:20px;padding-right:10px;padding-bottom:10px}#link-preview-popup.is-arrow-up .arrow-up{display:block}#link-preview-popup.is-arrow-up .arrow-down{display:none}#link-preview-popup.is-arrow-down .arrow-up{display:none}#link-preview-popup.is-arrow-down .arrow-down{display:block}#link-preview-popup .chapter-preview-title{font-weight:bold;display:block}#link-preview-popup .chapter-preview-paragraphs-container{overflow:auto;font-size:smaller;display:block;padding-top:5px}#link-preview-popup .chapter-preview-paragraphs-container ul{font-size:inherit;list-style-position:outside}#link-preview-popup .chapter-preview-paragraphs-container p{font-size:inherit;margin:0}#link-preview-popup .chapter-preview-paragraphs-container h1,#link-preview-popup .chapter-preview-paragraphs-container h2,#link-preview-popup .chapter-preview-paragraphs-container h3,#link-preview-popup .chapter-preview-paragraphs-container h4,#link-preview-popup .chapter-preview-paragraphs-container h5{font-size:inherit}#link-preview-popup.closed{display:none}#link-preview-popup.open{display:block}#link-preview-popup .arrow-up{position:absolute;top:0;left:0;transform:translateY(-100%);width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:10px solid white}#link-preview-popup .arrow-down{position:absolute;width:0;height:0;bottom:0;left:0;transform:translateY(100%);border-left:10px solid transparent;border-right:10px solid transparent;border-top:10px solid white}body:not(.book-edit) .text-addendum-container .text-addendum-delete-button{display:none}.text-addendum-container{position:relative}.text-addendum-container .text-addendum-delete-button{position:absolute;top:10px;right:10px;cursor:pointer}@media screen and (max-width: 800px){.text-addendum-container .text-addendum-delete-button{top:3px}}#text-addendum-modal textarea{margin-bottom:0}.time-limited-preview-message-header-container .modal-title-container h3{font-weight:300;margin-bottom:0}.time-limited-preview-message-header-container .modal-title-container h3 strong{font-weight:400}@media screen and (max-width: 550px){.time-limited-preview-message-header-container .modal-title-container h3{font-size:1.5em}}@media screen and (max-width: 420px){.time-limited-preview-message-header-container .modal-title-container h3{font-size:1.1em}}.time-limited-preview-message-container .tokens-button{line-height:1.85}@media screen and (max-width: 400px){.time-limited-preview-message-container .tokens-button{padding:0.25em 0.75em}}.time-limited-preview-message-container .add-to-cart-button,.time-limited-preview-message-container .sign-in-button,.time-limited-preview-message-container .start-preview-button{color:white;background-color:#3C67A2}.time-limited-preview-message-container .add-to-cart-button:hover,.time-limited-preview-message-container .sign-in-button:hover,.time-limited-preview-message-container .start-preview-button:hover{background-color:#355b8f}.time-limited-preview-message-container .add-to-cart-button:active,.time-limited-preview-message-container .sign-in-button:active,.time-limited-preview-message-container .start-preview-button:active{background-color:#2e4f7d}.time-limited-preview-message-container .start-preview-button{margin-right:1em}.time-limited-preview-message-container .modal-content-container .action-button{float:right}.time-limited-preview-message-container .modal-content-container .cancel-button{float:left}.time-limited-preview-message-container .time-limited-preview-content-container{margin-bottom:0.75em;color:gray}@media screen and (max-width: 550px){.time-limited-preview-message-container .time-limited-preview-content-container{font-size:0.9em}}@media screen and (max-width: 420px){.time-limited-preview-message-container .time-limited-preview-content-container{line-height:1.2;font-size:0.8em}}@media screen and (max-width: 500px){.token-meap-notification-modal p{font-size:0.8em}}.collapsible-panel-opened .exercise-container{-webkit-transform:translateY(0);transform:translateY(0);opacity:1;-webkit-transition-property:opacity, -webkit-transform;transition-property:opacity, transform;-webkit-transition-duration:0.4s;transition-duration:0.4s}#book-markup-container .callout-container.interactive-container.web-design-playground{padding:0;overflow:hidden;background:#fc0}#book-markup-container .callout-container.interactive-container.web-design-playground iframe{overflow:hidden;height:75vh;background:white}@media screen and (min-width: 400px){#book-markup-container .callout-container.interactive-container.web-design-playground{margin:0;width:100%}}@media screen and (min-width: 900px){#book-markup-container .callout-container.interactive-container.web-design-playground{margin:0 -10%;width:120%}}@media screen and (min-width: 1100px){#book-markup-container .callout-container.interactive-container.web-design-playground{margin:0 -25%;width:150%}}#track-point-column{display:none;height:100%;width:1px;position:absolute;background-color:#d7d7d7;left:5%}#track-point-column.shown{display:inline-block}@media only screen and (min-width: 320px){#track-point-column{left:1% !important}}@media only screen and (min-width: 360px){#track-point-column{left:4% !important}}@media only screen and (min-width: 480px){#track-point-column{left:4% !important}}.track-point-wrapper{position:absolute;left:-15px;visibility:hidden;height:35px;width:35px;z-index:10}.track-point-wrapper:hover{cursor:pointer}.track-point-wrapper.shown{visibility:visible}.book-cover-link{display:inline-block;position:relative}#newest-edition-box{position:fixed;right:1.2rem;top:130px;max-width:225px;z-index:97;display:none;border:1px solid transparent;border-radius:6px;-webkit-box-shadow:0 1px 1px rgba(0,0,0,0.05);box-shadow:0 1px 1px rgba(0,0,0,0.05)}@media screen and (max-width: 1085px){#newest-edition-box{display:none !important}}#newest-edition-box .newest-edition-available-link{text-align:center;padding:10px 15px;color:darkslategray;background:#d9e9cd;display:block;transition:all ease-in-out 125ms;text-decoration:none !important;border:none}#newest-edition-box .newest-edition-available-link:hover{background:#bad8a4}#newest-edition-box .newest-edition-available-heading{display:block}#newest-edition-box .newest-edition-available-heading{font-size:1.3em;font-weight:300;display:block}#newest-edition-box .newest-edition-available-book-title{font-size:1em;font-style:italic;display:block}#newest-edition-box .newest-edition-available-this-included{font-size:75%;display:none;margin-top:0.5em}.time-limited-preview-message-container .add-to-wish-list-button{margin-right:0.5em;float:left !important}.content-tag p{background-color:lightgray}.content-tag::before{border-color:lightgray;background:gray;color:white}.content-tag::before{content:attr(data-content-tag);position:absolute;transform:translate(50%, -50%);padding:0 0.25em;border-radius:0.2em;font-size:70%;line-height:1.8em}.content-tag.color-yellow p{background-color:#ffe680}.content-tag.color-yellow::before{background:#fd5;color:white}.content-tag.color-red p{background-color:#faa}.content-tag.color-red::before{background:#f55;color:white}.content-tag.color-green p{background-color:#afe9af}.content-tag.color-green::before{background:#87de87;color:white}.content-tag.color-blue p{background-color:#acf}.content-tag.color-blue::before{background:#80b3ff;color:white}.content-tag.color-pink p{background-color:#fac}.content-tag.color-pink::before{background:#f59;color:white}li.content-tag{background-color:lightgray}li.content-tag.color-yellow{background-color:#ffe680}li.content-tag.color-red{background-color:#faa}li.content-tag.color-green{background-color:#afe9af}li.content-tag.color-blue{background-color:#acf}li.content-tag.color-pink{background-color:#fac}.book-meap .tweet-button{display:none}.book-meap .error-report{display:initial}body:not(.book-meap) .tweet-button{display:initial}body:not(.book-meap) .error-report{display:none}#free-ebooks-upsell-root{position:fixed;top:130px;right:1em;background-color:white;padding:0.5em;width:165px}@media screen and (min-width: 1030px){#free-ebooks-upsell-root{width:200px}}@media screen and (min-width: 1500px){#free-ebooks-upsell-root{width:250px;right:1.5em}}@media screen and (min-width: 1600px){#free-ebooks-upsell-root{width:300px}}#free-ebooks-upsell-root .slick-dotted.slick-slider{margin-bottom:0.15em}#free-ebooks-upsell-root .slick-prev:before,#free-ebooks-upsell-root .slick-next:before{font-family:FontAwesome;color:#444}#free-ebooks-upsell-root .free-ebooks-upsell-close{display:none;position:absolute;top:0.25em;right:0.5em;cursor:pointer}#free-ebooks-upsell-root .slick-next{right:-20px}#free-ebooks-upsell-root .slick-prev{left:-20px}#free-ebooks-upsell-root .slick-prev:before{content:"\\f104"}#free-ebooks-upsell-root .slick-next:before{content:"\\f105"}@media screen and (max-width: 970px) and (max-height: 600px){#free-ebooks-upsell-root{display:none !important}}@media screen and (max-width: 970px){#free-ebooks-upsell-root{bottom:27px;left:0;right:0;top:initial;width:100%;margin:0 auto;max-width:600px;z-index:96;padding:initial;border:1px solid #eee}#free-ebooks-upsell-root .free-ebooks-upsell-carausel{width:90%;margin:0 auto;margin-bottom:0.5em}#free-ebooks-upsell-root .free-ebooks-upsell-close{display:block}}#free-ebooks-upsell-root .slick-slide{margin:0.5em;margin-bottom:0}#free-ebooks-upsell-root .slick-dots{bottom:-13px}#free-ebooks-upsell-root .slick-dots li button:before{content:\'\';font-size:20px;font-family:initial}#free-ebooks-upsell-root .free-ebooks-upsell-title{text-align:center;font-size:120%;user-select:none;font-weight:300}#free-ebooks-upsell-root .free-ebooks-upsell-carausel-item{position:relative;display:inline-block;border:solid thin #ddd;border-bottom-width:0}#free-ebooks-upsell-root .free-ebooks-upsell-carausel-item:focus{outline:none}#free-ebooks-upsell-root .carausel-price-container{position:absolute;bottom:0;left:0;width:100%;color:white;background-color:#407fbf;padding:0.2em 0;text-align:center;white-space:nowrap;font-size:85%;display:flex;justify-content:center;align-items:center}@media screen and (min-width: 970px) and (max-width: 1030px){#free-ebooks-upsell-root .carausel-price-container{font-size:65%}}#free-ebooks-upsell-root .carausel-original-price-container{font-size:70%;position:relative;color:#9fbfdf;margin-right:0.25em;align-self:flex-end}#free-ebooks-upsell-root .carausel-original-price-container::before{position:absolute;content:"";left:-0.15em;top:calc(50% - 1px);right:-0.15em;border-top:2px solid #2d5986;transform:rotate(-5deg)}#free-ebooks-upsell-root .carausel-discounted-price-container{font-size:80%}.dog-ears-container{position:absolute;right:0;border:none;padding:1.6em;overflow:hidden;transition:border-radius 0s;cursor:pointer}.dog-ears-container:before{cursor:pointer;content:"";position:absolute;top:0;right:0;border-style:solid;box-shadow:1px 1px 5px rgba(0,0,0,0.4);width:0;border-width:12px;border-color:#D9D9D9 #D9D9D9 #FFF #FFF;transition:border-width .2s, border-color .2s}.dog-ears-container.dog-ears-mouse-over:before{border-width:18px}.dog-ears-container.dog-ears-active:before{border-width:20px;border-color:#EEE #EEE #FFF #FFF}@media screen and (max-width: 600px){.dog-ears-container:before{border-width:6px}.dog-ears-container.dog-ears-mouse-over:before{border-width:10px}.dog-ears-container.dog-ears-active:before{border-width:12px}}.toc-summary-loading-container{text-align:center}.toc-summary-chapter-link,.toc-summary-part-link{display:block}.toc-summary-chapter-link{margin-left:1em}.toc-summary-part-link{margin-top:1em}.toc-summary-front-back-matter-link+.toc-summary-front-back-matter-link::before{content:"\\00B7";margin-left:0.5em;margin-right:0.5em}.toc-summary-part-link+.toc-summary-chapter-link{margin-top:0.5em}.indexed-term{cursor:pointer;font-size:90%;white-space:nowrap}.indexed-term sup{font-size:50%}.indexed-term:hover{text-decoration:underline}.inline-indexed-term{text-decoration:none;position:relative;cursor:pointer}.inline-indexed-term:after{content:\'\';width:100%;position:absolute;left:0;bottom:0;border-width:thin;border-style:solid;border-color:#c3c3c3;z-index:-1}kbd>.inline-indexed-term:after,.callout-container .inline-indexed-term:after{z-index:1}.term-viewer-root{background-color:white;display:flex;flex-direction:column;height:100%}.term-viewer-root img{max-width:100%}.term-viewer-root .term-viewer-delete-term{cursor:pointer}.term-viewer-root .term-viewer-label{float:right;border-radius:2px;padding:0.2em 0.5em;margin-left:0.5em;font-size:80%}.term-viewer-root .term-viewer-label.term-viewer-label-definition{background:green;color:#ceeece}.term-viewer-root .term-viewer-see-more-link{display:block;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.term-viewer-root .loading-page-image-placeholder{margin:1em 0}.term-viewer-root .term-viewer-scrollable-content{flex:1 1 auto;padding:0 1.25em;overflow-y:auto;overscroll-behavior-y:none}.term-viewer-root .term-viewer-html-content{display:block;clear:both;overflow:visible;padding-top:0.2em;padding-bottom:1em;font-size:90%;position:relative;text-align:justify}.term-viewer-root .term-viewer-html-content ul,.term-viewer-root .term-viewer-html-content p{font-size:inherit;margin-bottom:0}.term-viewer-root .term-viewer-html-content i{font-family:inherit;font-style:italic}.term-viewer-root .term-viewer-html-content h1,.term-viewer-root .term-viewer-html-content h2,.term-viewer-root .term-viewer-html-content h3,.term-viewer-root .term-viewer-html-content h4,.term-viewer-root .term-viewer-html-content h5{font-size:inherit;font-weight:bold}.term-viewer-root .term-viewer-html-content kbd{font-size:90%;font-family:Consolas, Courier, monospace;padding:3px 5px;border:1px solid #DCDCDC;border-radius:3px;background-color:#F5F5F5}.term-viewer-root .term-viewer-html-content .code-area-container{max-width:100%;padding:1em;background:#f4f4f4;overflow-x:auto}.term-viewer-root .term-viewer-html-content .term-viewer-html-content-overlay{position:absolute;top:0;left:-1em;right:-1em;bottom:0;background-color:white;opacity:0.3}.term-viewer-root .term-viewer-header{position:relative;height:55px;padding:1em 2.5em 1em 2.5em;text-align:center;border-bottom:1px solid black;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;flex:none}.term-viewer-root .term-viewer-header .fa-close{position:absolute;right:1.2em;top:1.2em;cursor:pointer}.term-viewer-root .term-viewer-header .term-viewer-back-arrow{position:absolute;left:1.2em;top:1.2em;cursor:pointer}.term-viewer-root .term-viewer-header .term-viewer-current-product{font-style:italic}.term-viewer-root .term-viewer-term{position:relative}.term-viewer-root .term-viewer-term:after{content:\'\';width:100%;position:absolute;left:0;bottom:0;border-width:thin;border-style:solid;border-color:#c3c3c3}.term-viewer-root .term-viewer-commands-container{font-size:80%;margin-top:0.25em}.term-viewer-root .term-viewer-section{margin:1em 0}.term-viewer-root .term-viewer-section .term-viewer-section-header{font-size:120%;margin-bottom:0.5em}.term-viewer-root .term-viewer-other-products{white-space:nowrap;overflow-x:auto;padding-bottom:1em}.term-viewer-root .term-viewer-other-products .term-viewer-other-product{display:inline-block;margin:0 0.2em;box-shadow:1px 1px 1px 0px rgba(0,0,0,0.25);cursor:pointer}.term-viewer-root .term-viewer-other-products .term-viewer-other-product:first-of-type{margin-left:0}.term-viewer-root .term-viewer-other-products .term-viewer-other-product:last-of-type{margin-right:0}.term-viewer-root .term-viewer-other-products img{max-height:120px}.term-viewer-root .term-viewer-other-terms .term-viewer-related-term{display:inline-block;position:relative;white-space:nowrap;cursor:pointer;user-select:none;background:#d3d3d3;color:#4d4d4d;margin:0.4em 0.2em 0 0;padding:0 0.5em;font-size:80%;border-radius:2px}.term-viewer-root .term-viewer-other-terms .term-viewer-related-term:hover{color:white;background:#369}.term-viewer-root .term-viewer-other-terms .term-viewer-related-term .term-viewer-related-term-delete{position:absolute;color:black;top:-0.5em;transition:transform 0.1s ease-in-out}.term-viewer-root .term-viewer-other-terms .term-viewer-related-term .term-viewer-related-term-delete:hover{transform:scale(1.1)}.term-viewer-root .term-viewer-other-terms .term-viewer-related-term sup{font-size:50%}.medium-zoom-image{z-index:1011;background-color:white;padding:1em}.medium-zoom-overlay{z-index:1010}\n',""])},579:function(e,t,n){var o=n(580);"string"==typeof o&&(o=[[e.i,o,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(324)(o,i);o.locals&&(e.exports=o.locals)},580:function(e,t,n){(e.exports=n(323)(!1)).push([e.i,'#book-markup-container .collapsible-panel{max-height:100px;color:white;border-radius:4px;padding:10px;margin:30px 2.2em;position:relative;background-color:transparent}#book-markup-container .collapsible-panel-background{position:absolute;top:0;left:-200%;right:-200%;height:100%;background:#3C3C3C;z-index:0}@media screen and (max-width: 800px){#book-markup-container .collapsible-panel-background{top:0;left:0;right:0;bottom:0}}body.theme-1 .button-collapsible-panel{background-color:#0e5ba9 !important;color:#fff !important;text-transform:uppercase;border-radius:0.1rem;padding:0.4rem 0.8rem;font-size:.8125rem;font-weight:700;margin-bottom:0.2rem;margin-top:0;box-shadow:0 0.1rem 0 0 #2f5182;text-align:center;transition:none;min-width:8rem}body.theme-1 .button-collapsible-panel:hover{background-color:#1777d9 !important}body.theme-1 .button-collapsible-panel:active{box-shadow:0 0;margin-top:2px;margin-bottom:1px}body.theme-1 .button-collapsible-panel>i.fa-pencil{margin-right:5px;margin-left:-10px}body.theme-1 .collapsible-panel-opened .button-collapsible-panel{background-color:#0e5ba9;color:#fff}.collapsible-panel-background,.collapsible-panel-container{max-height:0;-webkit-transition:opacity 0.5s 0.3s cubic-bezier(0.7, 0, 0.3, 1),transform 0.5s 0.3s cubic-bezier(0.7, 0, 0.3, 1),box-shadow 0.2 0.1s cubic-bezier(0.7, 0, 0.3, 1),height 0.2s cubic-bezier(0.7, 0, 0.3, 1),max-height 0.2s cubic-bezier(0.7, 0, 0.3, 1);transition:opacity 0.5s 0.3s cubic-bezier(0.7, 0, 0.3, 1),transform 0.5s 0.3s cubic-bezier(0.7, 0, 0.3, 1),box-shadow 0.2 0.1s cubic-bezier(0.7, 0, 0.3, 1),height 0.2s cubic-bezier(0.7, 0, 0.3, 1),max-height 0.2s cubic-bezier(0.7, 0, 0.3, 1)}.button-collapsible-panel{border:solid 1px #3c67a2;border-radius:5px;background-color:#F5F5F5;color:#5280BF;padding:0.5rem 1.2rem 0.5rem 1rem;display:inline-block;position:relative;-webkit-transition:all 0.3s 0.6s;transition:all 0.3s 0.6s}.button-collapsible-panel:hover,.button-collapsible-panel:active,.button-collapsible-panel:focus{color:#3c67a2}.button-collapsible-panel .icon-i-collapsible-panel-close{opacity:0}.button-collapsible-panel .icon-i-collapsible-panel-close:before{content:"\\2716";color:white}.button-collapsible-panel .icon-i-collapsible-panel-close{position:absolute;right:0.4rem;font-size:1rem}.collapsible-panel-opened .button-collapsible-panel{color:white;background-color:#5280BF;-webkit-transition:all 0.3s 0.3s;transition:all 0.3s 0.3s}.collapsible-panel-opened .icon-i-collapsible-panel-close{opacity:1;transition:all 0.3s 0.3s}.collapsible-panel-opened .collapsible-panel-background{height:100%;box-shadow:0 0 10px 3px rgba(0,0,0,0.4)}.collapsible-panel-opened .collapsible-panel-container{opacity:1;height:100%}.collapsible-panel-opened .collapsible-panel-background,.collapsible-panel-opened .collapsible-panel-container{max-height:20000px}@media only screen and (min-width: 320px){.collapsible-panel-container .toolbar-separator{width:0}}@media only screen and (min-width: 380px) and (max-width: 479px){.button-collapsible-panel{font-size:0.8rem;width:120px;margin-left:-25px}}@media only screen and (min-width: 649px){.collapsible-panel-container .toolbar-separator{width:40px}.button-collapsible-panel{font-size:1.2rem;width:150px;margin-left:0}}\n',""])},592:function(e,t,n){!function(t){var o=-1,i=function(e){return e.every=function(t,n,i){e._time(),i||(i=n,n=null);var r=o+=1;return e._timers[r]={visible:t,hidden:n,callback:i},e._run(r,!1),e.isSupported()&&e._listen(),r},e.stop=function(t){return!!e._timers[t]&&(e._stop(t),delete e._timers[t],!0)},e._timers={},e._time=function(){e._timed||(e._timed=!0,e._wasHidden=e.hidden(),e.change(function(){e._stopRun(),e._wasHidden=e.hidden()}))},e._run=function(n,o){var i,r=e._timers[n];if(e.hidden()){if(null===r.hidden)return;i=r.hidden}else i=r.visible;var a=function(){r.last=new Date,r.callback.call(t)};if(o){var s=new Date-r.last;i>s?r.delay=setTimeout(function(){r.id=setInterval(a,i),a()},i-s):(r.id=setInterval(a,i),a())}else r.id=setInterval(a,i)},e._stop=function(t){var n=e._timers[t];clearInterval(n.id),clearTimeout(n.delay),delete n.id,delete n.delay},e._stopRun=function(t){var n=e.hidden(),o=e._wasHidden;if(n&&!o||!n&&o)for(var i in e._timers)e._stop(i),e._run(i,!n)},e};e.exports?e.exports=i(n(443)):i(t.Visibility||n(443))}(window)},593:function(e,t,n){var o=n(594),i=n(595);e.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||o)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[r+s]=a[s];return t||i(a)}},594:function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var o=new Uint8Array(16);e.exports=function(){return n(o),o}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},595:function(e,t){for(var n=[],o=0;o<256;++o)n[o]=(o+256).toString(16).substr(1);e.exports=function(e,t){var o=t||0,i=n;return[i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],"-",i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]],i[e[o++]]].join("")}},668:function(e,t,n){"use strict";var o=n(0),i=function(){function e(){}return e.prototype.fetch=function(e,t){var n=this;return new Promise(function(o,i){$.ajax({url:n.getRunnableListingLocation(e,t)}).then(function(e){return o(e)}).fail(function(e){return i(e)})})},e.prototype.getRunnableListingLocation=function(e,t){return o.a.getAwsUrl("/"+e.shortName+"/RunnableListings/"+t)},e}(),r=n(32),a=function(){function e(){this.webService=new i}return e.prototype.fetch=function(e,t){return e.hasBeenDownloaded?r.a.fetchRunnableListing(e.shortName,t):this.webService.fetch(e,t)},e.prototype.getRunnableListingLocation=function(e,t){return e.hasBeenDownloaded?r.a.getRunnableListingLocation(e.shortName,t):this.webService.getRunnableListingLocation(e,t)},e}(),s=n(4);var l,c,d={runnableListingsService:new Promise(function(e,t){s.b.loadDeviceInfo().then(function(t){e(function(e){switch(e){case s.a.Browser:return new i;case s.a.Cordova:case s.a.Electron:return new a}}(t.platform))}).catch(function(e){return t(e)})})},u=n(2),h=n(12),p=n(17),m=n(67),g=n(537),f=n(3),b=n(436),k=null,v=["htmlmixed"],w={programming_languages:v.map(function(e){return{programming_language:e,lambda_name:"",default_code:"",default_html:"",default_css:"",mime_type:""}})},y=function(){function e(e,t){var n=this;this.currentConsoleBuffer="",this.baseConsoleLog=console.log,this.listingEnvironmentElement=e,this.codeMirrorSyntaxHighlightingLanguage=t,this.$listingEnvironment=$(e),this.$listingEnvironment.append(Mustache.render('<div class="listing-environment-container">\n<div class="listing-environment-toolbar">\n    <span class="listing-environment-runnable-script-container">\n        {{#isRunnableListing}}\n        <a href="javascript:void(0)" class="button-toggle-result button">\n            <span class="show-medium-up">show result</span>\n            <i class="fa fa-eye show-small" aria-hidden="true"></i>\n        </a>\n        <span class="execution-environment-standard-mode-container">\n            <a href="javascript:void(0)" class="button-edit button">\n                <span class="show-medium-up">edit</span>\n                <i class="fa fa-pencil show-small" aria-hidden="true"></i>\n            </a>\n        </span>\n        <span class="execution-environment-edit-mode-container">\n            <a href="javascript:void(0)" class="button-restore button">\n                <span class="show-medium-up">back</span>\n                <i class="fa fa-angle-double-left show-small" aria-hidden="true"></i>\n            </a>\n\n            <a href="javascript:void(0)" class="button-reset button">\n                <span class="show-medium-up">reset</span>\n                <i class="fa fa-undo show-small" aria-hidden="true"></i>\n            </a>\n            <a href="javascript:void(0)" class="button-run button">\n                <span class="show-medium-up">run</span>\n                <i class="fa fa-play show-small" aria-hidden="true"></i>\n            </a>\n        </span>\n    </span>\n    {{/isRunnableListing}}\n    <span class="listing-environment-standard-mode-container">\n        <a href="javascript:void(0)" data-tooltip class="button-copy button radius">\n            <span class="show-medium-up">copy</span>\n            <i class="fa fa-clipboard show-small" aria-hidden="true"></i>\n        </a>\n    </span>\n</div>\n</div>',{isRunnableListing:this.$listingEnvironment.is(".listing-runnable")&&(c.isOpen||l.userOwnsBook)})),this.$listingEnvironmentContainer=this.$listingEnvironment.find(".listing-environment-container"),this.isRunnableListing=this.$listingEnvironment.is(".listing-runnable"),this.isRunnableListing&&(this.$executionIFrame=this.$listingEnvironment.find(".execution-environment-frame"),this.$buttonToggleResult=this.$listingEnvironment.find(".button-toggle-result"),this.$buttonEdit=this.$listingEnvironment.find(".button-edit"),this.$buttonRun=this.$listingEnvironment.find(".button-run"),this.$buttonReset=this.$listingEnvironment.find(".button-reset"),this.$buttonRestore=this.$listingEnvironment.find(".button-restore"),u.a.onEventWithCooldown(this.$buttonToggleResult,"click touchstart",function(e){n.handleToggleResultsClick(),n.fullyShow()}),u.a.onEventWithCooldown(this.$buttonEdit,"click touchstart",function(e){n.handleEditClick(),n.fullyShow()}),u.a.onEventWithCooldown(this.$buttonRun,"click touchstart",function(e){n.handleRunClick(),n.fullyShow()}),u.a.onEventWithCooldown(this.$buttonReset,"click touchstart",function(e){n.handleResetClick(),n.fullyShow()}),u.a.onEventWithCooldown(this.$buttonRestore,"click touchstart",function(e){n.handleRestoreClick(),n.fullyShow()})),this.$buttonCopy=this.$listingEnvironment.find(".button-copy"),this.$buttonCopy.on("click",function(e){return n.fullyShow()}),this.createClipboard(),this.listingCode=function(e){if(!e)return e;var t=e.indexOf("!@%STYLE%@!");if(-1===t)return e;return e.substring(0,t)}(this.$listingEnvironment.find(".code-area").text()),this.runnableCode="",this.userEditedCode="",this.listingUrl="",this.isInEditMode=!1,this.isRunnableListing&&(this.listingEnvironmentElement.runnableScript=this,this.asyncGetRunnableCode())}return e.initialize=function(t,n){l=t,c=n,$(".browsable-container .code-area").each(function(e,t){var n=$(t).closest(".browsable-container");n.is(".listing-container")||n.addClass("listing-container")}),k=null,null!=l&&l.programmingLanguage&&"N/A"!=l.programmingLanguage&&(n.isOpen||t.userOwnsBook)&&b.a.getSupportedLanguagesInfo().then(function(e){e&&e.programming_languages&&(e.programming_languages=e.programming_languages.concat(w.programming_languages)),k=e.programming_languages.find(function(e){return e.programming_language.toLowerCase()==(l.programmingLanguage||"").toLowerCase()})}).catch(function(e){}),h.a.asyncEach($(".listing-container"),function(t){return new e(t,p.a.getCodeMirrorSyntaxHighlightMode(l,t.querySelector(".code-area").textContent))},function(){},1)},e.prototype.asyncGetRunnableCode=function(){var e=this,t=this.$listingEnvironment.attr("location");d.runnableListingsService.then(function(n){e.listingUrl=n.getRunnableListingLocation(l,t),n.fetch(l,t).then(function(t){e.runnableCode=function(e,t){if(null==e)return e;l.hasBeenDownloaded&&(t="file://"+t);var n="<base href='"+t+"'/>";if(-1==e.indexOf("<head>"))return e;return e.replace("<head>","<head>"+n)}(t,e.listingUrl),e.userEditedCode=e.runnableCode}).catch(function(e){return console.log(e)})})},e.prototype.handleToggleResultsClick=function(){var e=this.$listingEnvironment,t=this.$buttonToggleResult;if(e.removeClass("focus-off"),null==k||null==l){var n="Error when executing source code";return l&&!l.userOwnsBook&&(n="Code execution is available when you own the book"),void m.a.showTemporaryNotification(n)}t.is(".opened")?this.hideResults():(this.runCurrentCode(),this.showResults())},e.prototype.showResults=function(){var e=this.$listingEnvironment,t=this.$buttonToggleResult,n=this.$executionIFrame;t.addClass("opened").find("span").text("Hide result"),n.velocity("slideDown",function(){$(document).trigger("textLayoutModified",e[0])}),$(document).trigger("codeShowResult")},e.prototype.hideResults=function(){var e=this.$listingEnvironment,t=this.$buttonToggleResult,n=this.$executionIFrame;t.removeClass("opened").find("span").text("Show result"),n.velocity("slideUp",function(){$(document).trigger("textLayoutModified",e[0])}),$(document).trigger("codeHideResult")},e.prototype.handleEditClick=function(){this.$listingEnvironment.removeClass("focus-off"),this.enterEditMode()},e.prototype.handleRunClick=function(){null!=k&&null!=l?(this.createIFrameIfNecessary(),this.$buttonToggleResult.is(".opened")||this.showResults(),this.runCurrentCode(),$(document).trigger("codeRun")):m.a.showTemporaryNotification("Cannot execute")},e.prototype.handleResetClick=function(){$(document).trigger("codeReset"),this.userEditedCode=this.runnableCode,this.codeMirror&&this.codeMirror.setValue(this.runnableCode)},e.prototype.handleRestoreClick=function(){this.leaveEditMode()},e.prototype.runCurrentCode=function(){var e=this;this.createIFrameIfNecessary();var t="";this.isInEditMode&&this.codeMirror?this.userEditedCode=t=this.codeMirror.getValue():t=this.runnableCode,this.showContentInRunPanel(x),-1===v.indexOf(k.programming_language)?b.a.executeCode(t,"","",k.programming_language,k.lambda_name).then(function(t){e.showContentInRunPanel(t.lambda_output)}).catch(function(t){e.showContentInRunPanel("<div style='color: red;'>Error when executing code: "+t+"</div>")}):this.showContentInRunPanel(t)},e.prototype.createIFrameIfNecessary=function(){0===this.$executionIFrame.length&&(this.$executionIFrame=$('<iframe src="about:blank" class="execution-environment-frame"></iframe>'),this.$listingEnvironmentContainer.append(this.$executionIFrame),this.$executionIFrame[0].src='javascript:window["contents"]')},e.prototype.rerouteLoggingToBuffer=function(){this.currentConsoleBuffer="";var e=this;console.log=function(t){for(var n=Array.prototype.slice.call(arguments),o="",i=0;i<n.length;i++)"string"==typeof n[i]||"number"==typeof n[i]||"boolean"==typeof n[i]?o+=" "+n[i]:o+=" "+JSON.stringify(n[i]);this.currentConsoleBuffer+="<br />"+o,e.baseConsoleLog.apply(console,arguments)}},e.prototype.showContentInRunPanel=function(e){this.$executionIFrame[0].contentWindow.contents=e,this.$executionIFrame[0].src='javascript:window["contents"]'},e.prototype.enterEditMode=function(){this.createCodeMirror(),this.$listingEnvironment.addClass("edit-mode"),this.$listingEnvironmentContainer.addClass("edit-mode"),$(document).trigger("runnableScriptEditModeEntered",this.$listingEnvironment),this.isInEditMode=!0},e.prototype.leaveEditMode=function(){this.isInEditMode&&(this.$listingEnvironment.removeClass("edit-mode"),this.$listingEnvironmentContainer.removeClass("edit-mode"),$(document).trigger("runnableScriptEditModeLeft",this.$listingEnvironment),this.isInEditMode=!1)},e.prototype.fullyShow=function(){this.$listingEnvironment.removeClass("focus-off")},e.prototype.getSourceCode=function(){var e="";e=this.isInEditMode&&this.codeMirror?this.codeMirror.getValue():this.runnableCode;try{!e&&this.listingEnvironmentElement.annotatedListing&&(e=this.listingEnvironmentElement.annotatedListing.source)}catch(e){console.log(e)}return e||this.listingCode},e.prototype.createClipboard=function(){var e=this;window.Clipboard?this.initializeClipboard():f.a.loadClipboardCode().then(function(){return e.initializeClipboard()})},e.prototype.initializeClipboard=function(){var e=this;if(window.Clipboard)try{var t=new window.Clipboard(this.$buttonCopy[0],{text:function(){return e.getSourceCode()}});t.on("success",function(t){e.showMessageOnCopyButton("Copied!"),t.clearSelection(),$(document.activeElement).blur()}),t.on("error",function(t){e.showMessageOnCopyButton(function(e){var t="",n="cut"===e?"X":"C";t=/iPhone|iPad/i.test(navigator.userAgent)?"No support :(":/Mac/i.test(navigator.userAgent)?"Press -"+n+" to "+e:"Press Ctrl-"+n+" to "+e;return t}(t.action)),$(document.activeElement).blur()})}catch(e){console.log("Failed to initialize clipboard")}},e.prototype.showMessageOnCopyButton=function(e){var t=this;this.$buttonCopy.attr("title",e),window.Foundation&&(window.Foundation.libs.tooltip.create(this.$buttonCopy),window.Foundation.libs.tooltip.showTip(this.$buttonCopy),u.a.setTimeout(function(){window.Foundation.libs.tooltip.off(t.$buttonCopy)},1e3))},e.prototype.createCodeMirror=function(){var e=this;if(!this.codeMirror){var t=this.listingEnvironmentElement.querySelector(".code-area-container");f.a.loadCodeMirrorCode().then(function(n){var o=n[0];e.codeMirror=o.default(t,{value:e.getSourceCode(),mode:e.codeMirrorSyntaxHighlightingLanguage,lineNumbers:!0}),e.codeMirrorSyntaxHighlightingLanguage&&g.a.autoLoadMode(o.default,e.codeMirror,e.codeMirrorSyntaxHighlightingLanguage);var i=parseInt($(e.codeMirror.getWrapperElement()).css("line-height"))*(e.codeMirror.lineCount()+3);e.codeMirror.setSize("100%",i),u.a.setTimeout(function(){return e.codeMirror.refresh()},200)})}},e}();t.a=y;var x='<div style="text-align:center;">\n<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve">\n<path opacity="0.2" fill="#000" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946\n  s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634\n  c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"></path>\n<path fill="#000" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0\n  C22.32,8.481,24.301,9.057,26.013,10.047z" transform="rotate(192 20 20)">\n  <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 20 20" to="360 20 20" dur="0.5s" repeatCount="indefinite"></animateTransform>\n  </path>\n</svg>\n</div>'},673:function(e,t,n){"use strict";n.r(t),n.d(t,"PromoManagerClass",function(){return a}),n.d(t,"PromoManager",function(){return s});var o=n(421),i=n(116),r=n(16),a=function(){function e(){}return e.prototype.promote=function(){var e=this;i.a.getDotdPromoInfo().then(function(t){null!=t&&(e.getHiddenPromotionMap()[t.productExternalId]||(o.a.setPromotion(t),e.trackEvents()))})},e.prototype.clean=function(){o.a.clean()},e.prototype.trackEvents=function(){var e=this;$(document).on("click",".close-promo-button, .add-dotd-book-to-cart",function(t){var n=$(t.target);e.rememberHiddenPromotion(n.attr("data-product-external-id"))})},e.prototype.rememberHiddenPromotion=function(e){if(e){var t=this.getHiddenPromotionMap();t[e]=Date.now(),this.storeHiddenPromotionMap(t)}},e.prototype.getHiddenPromotionMap=function(){return JSON.parse(r.a.getItem("LB_HIDDEN_PROMOTIONS")||"{}")},e.prototype.storeHiddenPromotionMap=function(e){r.a.setItem("LB_HIDDEN_PROMOTIONS",JSON.stringify(e))},e}(),s=new a},722:function(e,t,n){"use strict";e.exports=n(723)},723:function(e,t,n){t.iframeResizer=n(724),t.iframeResizerContentWindow=n(725)},724:function(e,t,n){var o,i,r;!function(n){if("undefined"!=typeof window){var a,s=0,l=!1,c=!1,d="message".length,u="[iFrameSizer]",h=u.length,p=null,m=window.requestAnimationFrame,g={max:1,scroll:1,bodyScroll:1,documentElementScroll:1},f={},b=null,k={autoResize:!0,bodyBackground:null,bodyMargin:null,bodyMarginV1:8,bodyPadding:null,checkOrigin:!0,inPageLinks:!1,enablePublicMethods:!0,heightCalculationMethod:"bodyOffset",id:"iFrameResizer",interval:32,log:!1,maxHeight:1/0,maxWidth:1/0,minHeight:0,minWidth:0,resizeFrom:"parent",scrolling:!1,sizeHeight:!0,sizeWidth:!1,warningTimeout:5e3,tolerance:0,widthCalculationMethod:"scroll",onClosed:function(){},onInit:function(){},onMessage:function(){$("onMessage function not defined")},onResized:function(){},onScroll:function(){return!0}},v={};window.jQuery&&((a=window.jQuery).fn?a.fn.iFrameResize||(a.fn.iFrameResize=function(e){return this.filter("iframe").each(function(t,n){F(n,e)}).end()}):S("","Unable to bind to jQuery, it is not fully loaded.")),i=[],(r="function"==typeof(o=q)?o.apply(t,i):o)===n||(e.exports=r),window.iFrameResize=window.iFrameResize||q()}function w(){return window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}function y(e,t,n){e.addEventListener(t,n,!1)}function x(e,t,n){e.removeEventListener(t,n,!1)}function C(e){return u+"["+function(e){var t="Host page: "+e;return window.top!==window.self&&(t=window.parentIFrame&&window.parentIFrame.getId?window.parentIFrame.getId()+": "+e:"Nested host page: "+e),t}(e)+"]"}function E(e){return f[e]?f[e].log:l}function T(e,t){P("log",e,t,E(e))}function S(e,t){P("info",e,t,E(e))}function $(e,t){P("warn",e,t,!0)}function P(e,t,n,o){!0===o&&"object"==typeof window.console&&console[e](C(t),n)}function M(e){function t(){n("Height"),n("Width"),_(function(){D(k),z(w),l("onResized",k)},k,"init")}function n(e){var t=Number(f[w]["max"+e]),n=Number(f[w]["min"+e]),o=e.toLowerCase(),i=Number(k[o]);T(w,"Checking "+o+" is in range "+n+"-"+t),i<n&&(i=n,T(w,"Set "+o+" to min value")),i>t&&(i=t,T(w,"Set "+o+" to max value")),k[o]=""+i}function o(e){return b.substr(b.indexOf(":")+d+e)}function i(e,t){var n,o,i;n=function(){var n,o;R("Send Page Info","pageInfo:"+(n=document.body.getBoundingClientRect(),o=k.iframe.getBoundingClientRect(),JSON.stringify({iframeHeight:o.height,iframeWidth:o.width,clientHeight:Math.max(document.documentElement.clientHeight,window.innerHeight||0),clientWidth:Math.max(document.documentElement.clientWidth,window.innerWidth||0),offsetTop:parseInt(o.top-n.top,10),offsetLeft:parseInt(o.left-n.left,10),scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset,documentHeight:document.documentElement.clientHeight,documentWidth:document.documentElement.clientWidth,windowHeight:window.innerHeight,windowWidth:window.innerWidth})),e,t)},o=32,v[i=t]||(v[i]=setTimeout(function(){v[i]=null,n()},o))}function r(e){var t=e.getBoundingClientRect();return A(w),{x:Math.floor(Number(t.left)+Number(p.x)),y:Math.floor(Number(t.top)+Number(p.y))}}function a(e){var t=e?r(k.iframe):{x:0,y:0},n={x:Number(k.width)+t.x,y:Number(k.height)+t.y};T(w,"Reposition requested from iFrame (offset x:"+t.x+" y:"+t.y+")"),window.top!==window.self?window.parentIFrame?window.parentIFrame["scrollTo"+(e?"Offset":"")](n.x,n.y):$(w,"Unable to scroll to requested position, window.parentIFrame not found"):(p=n,s(),T(w,"--"))}function s(){!1!==l("onScroll",p)?z(w):L()}function l(e,t){return B(w,e,t)}var c,m,g,b=e.data,k={},w=null;"[iFrameResizerChild]Ready"===b?function(){for(var e in f)R("iFrame requested init",H(e),document.getElementById(e),e)}():u===(""+b).substr(0,h)&&b.substr(h).split(":")[0]in f?(g=b.substr(h).split(":"),k={iframe:f[g[0]]&&f[g[0]].iframe,id:g[0],height:g[1],width:g[2],type:g[3]},w=k.id,f[w]&&(f[w].loaded=!0),(m=k.type in{true:1,false:1,undefined:1})&&T(w,"Ignoring init message from meta parent page"),!m&&function(e){var t=!0;return f[e]||(t=!1,$(k.type+" No settings for "+e+". Message was: "+b)),t}(w)&&(T(w,"Received: "+b),c=!0,null===k.iframe&&($(w,"IFrame ("+k.id+") not found"),c=!1),c&&function(){var t,n=e.origin,o=f[w]&&f[w].checkOrigin;if(o&&""+n!="null"&&!(o.constructor===Array?function(){var e=0,t=!1;for(T(w,"Checking connection is from allowed list of origins: "+o);e<o.length;e++)if(o[e]===n){t=!0;break}return t}():(t=f[w]&&f[w].remoteHost,T(w,"Checking connection is from: "+t),n===t)))throw new Error("Unexpected message received from: "+n+" for "+k.iframe.id+". Message was: "+e.data+". This error can be disabled by setting the checkOrigin: false option or by providing of array of trusted domains.");return!0}()&&function(){switch(f[w]&&f[w].firstRun&&f[w]&&(f[w].firstRun=!1),k.type){case"close":f[w].closeRequeston?B(w,"onCloseRequest",f[w].iframe):N(k.iframe);break;case"message":h=o(6),T(w,"onMessage passed: {iframe: "+k.iframe.id+", message: "+h+"}"),l("onMessage",{iframe:k.iframe,message:JSON.parse(h)}),T(w,"--");break;case"scrollTo":a(!1);break;case"scrollToOffset":a(!0);break;case"pageInfo":i(f[w]&&f[w].iframe,w),function(){function e(e,o){function r(){f[n]?i(f[n].iframe,n):t()}["scroll","resize"].forEach(function(t){T(n,e+t+" listener for sendPageInfo"),o(window,t,r)})}function t(){e("Remove ",x)}var n=w;e("Add ",y),f[n]&&(f[n].stopPageInfo=t)}();break;case"pageInfoStop":f[w]&&f[w].stopPageInfo&&(f[w].stopPageInfo(),delete f[w].stopPageInfo);break;case"inPageLink":e=o(9),c=e.split("#")[1]||"",d=decodeURIComponent(c),(u=document.getElementById(d)||document.getElementsByName(d)[0])?(n=r(u),T(w,"Moving to in page link (#"+c+") at x: "+n.x+" y: "+n.y),p={x:n.x,y:n.y},s(),T(w,"--")):window.top!==window.self?window.parentIFrame?window.parentIFrame.moveToAnchor(c):T(w,"In page link #"+c+" not found and window.parentIFrame not found"):T(w,"In page link #"+c+" not found");break;case"reset":O(k);break;case"init":t(),l("onInit",k.iframe);break;default:t()}var e,n,c,d,u,h}())):S(w,"Ignored: "+b)}function B(e,t,n){var o=null,i=null;if(f[e]){if("function"!=typeof(o=f[e][t]))throw new TypeError(t+" on iFrame["+e+"] is not a function");i=o(n)}return i}function I(e){var t=e.id;delete f[t]}function N(e){var t=e.id;T(t,"Removing iFrame: "+t);try{e.parentNode&&e.parentNode.removeChild(e)}catch(e){$(e)}B(t,"onClosed",t),T(t,"--"),I(e)}function A(e){null===p&&T(e,"Get page position: "+(p={x:window.pageXOffset!==n?window.pageXOffset:document.documentElement.scrollLeft,y:window.pageYOffset!==n?window.pageYOffset:document.documentElement.scrollTop}).x+","+p.y)}function z(e){null!==p&&(window.scrollTo(p.x,p.y),T(e,"Set page position: "+p.x+","+p.y),L())}function L(){p=null}function O(e){T(e.id,"Size reset requested by "+("init"===e.type?"host page":"iFrame")),A(e.id),_(function(){D(e),R("reset","reset",e.iframe,e.id)},e,"reset")}function D(e){function t(t){c||"0"!==e[t]||(c=!0,T(o,"Hidden iFrame detected, creating visibility listener"),function(){function e(){Object.keys(f).forEach(function(e){!function(e){function t(t){return"0px"===(f[e]&&f[e].iframe.style[t])}f[e]&&(n=f[e].iframe,null!==n.offsetParent)&&(t("height")||t("width"))&&R("Visibility change","resize",f[e].iframe,e);var n}(f[e])})}function t(t){T("window","Mutation observed: "+t[0].target+" "+t[0].type),U(e,16)}var n=w();n&&(o=document.querySelector("body"),new n(t).observe(o,{attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0}));var o}())}function n(n){!function(t){e.id?(e.iframe.style[t]=e[t]+"px",T(e.id,"IFrame ("+o+") "+t+" set to "+e[t]+"px")):T("undefined","messageData id not set")}(n),t(n)}var o=e.iframe.id;f[o]&&(f[o].sizeHeight&&n("height"),f[o].sizeWidth&&n("width"))}function _(e,t,n){n!==t.type&&m?(T(t.id,"Requesting animation frame"),m(e)):e()}function R(e,t,n,o,i){var r,a=!1;o=o||n.id,f[o]&&(n&&"contentWindow"in n&&null!==n.contentWindow?(r=f[o]&&f[o].targetOrigin,T(o,"["+e+"] Sending msg to iframe["+o+"] ("+t+") targetOrigin: "+r),n.contentWindow.postMessage(u+t,r)):$(o,"["+e+"] IFrame("+o+") not found"),i&&f[o]&&f[o].warningTimeout&&(f[o].msgTimeout=setTimeout(function(){!f[o]||f[o].loaded||a||(a=!0,$(o,"IFrame has not responded within "+f[o].warningTimeout/1e3+" seconds. Check iFrameResizer.contentWindow.js has been loaded in iFrame. This message can be ignored if everything is working, or you can set the warningTimeout option to a higher value or zero to suppress this warning."))},f[o].warningTimeout)))}function H(e){return e+":"+f[e].bodyMarginV1+":"+f[e].sizeWidth+":"+f[e].log+":"+f[e].interval+":"+f[e].enablePublicMethods+":"+f[e].autoResize+":"+f[e].bodyMargin+":"+f[e].heightCalculationMethod+":"+f[e].bodyBackground+":"+f[e].bodyPadding+":"+f[e].tolerance+":"+f[e].inPageLinks+":"+f[e].resizeFrom+":"+f[e].widthCalculationMethod}function F(e,t){function o(e){var t=e.split("Callback");if(2===t.length){var n="on"+t[0].charAt(0).toUpperCase()+t[0].slice(1);this[n]=this[e],delete this[e],$(a,"Deprecated: '"+e+"' has been renamed '"+n+"'. The old method will be removed in the next major version.")}}var i,r,a=function(n){var o;return""===n&&(e.id=(o=t&&t.id||k.id+s++,null!==document.getElementById(o)&&(o+=s++),n=o),l=(t||{}).log,T(n,"Added missing iframe ID: "+n+" ("+e.src+")")),n}(e.id);a in f&&"iFrameResizer"in e?$(a,"Ignored iFrame, already setup."):(!function(t){var n;t=t||{},f[a]={firstRun:!0,iframe:e,remoteHost:e.src.split("/").slice(0,3).join("/")},function(e){if("object"!=typeof e)throw new TypeError("Options is not an object")}(t),Object.keys(t).forEach(o,t),function(e){for(var t in k)Object.prototype.hasOwnProperty.call(k,t)&&(f[a][t]=Object.prototype.hasOwnProperty.call(e,t)?e[t]:k[t])}(t),f[a]&&(f[a].targetOrigin=!0===f[a].checkOrigin?""===(n=f[a].remoteHost)||"file://"===n?"*":n:"*")}(t),function(){switch(T(a,"IFrame scrolling "+(f[a]&&f[a].scrolling?"enabled":"disabled")+" for "+a),e.style.overflow=!1===(f[a]&&f[a].scrolling)?"hidden":"auto",f[a]&&f[a].scrolling){case"omit":break;case!0:e.scrolling="yes";break;case!1:e.scrolling="no";break;default:e.scrolling=f[a]?f[a].scrolling:"no"}}(),function(){function t(t){1/0!==f[a][t]&&0!==f[a][t]&&(e.style[t]=f[a][t]+"px",T(a,"Set "+t+" = "+f[a][t]+"px"))}function n(e){if(f[a]["min"+e]>f[a]["max"+e])throw new Error("Value for min"+e+" can not be greater than max"+e)}n("Height"),n("Width"),t("maxHeight"),t("minHeight"),t("maxWidth"),t("minWidth")}(),"number"!=typeof(f[a]&&f[a].bodyMargin)&&"0"!==(f[a]&&f[a].bodyMargin)||(f[a].bodyMarginV1=f[a].bodyMargin,f[a].bodyMargin=f[a].bodyMargin+"px"),i=H(a),(r=w())&&function(t){e.parentNode&&new t(function(t){t.forEach(function(t){Array.prototype.slice.call(t.removedNodes).forEach(function(t){t===e&&N(e)})})}).observe(e.parentNode,{childList:!0})}(r),y(e,"load",function(){var t,o;R("iFrame.onload",i,e,n,!0),t=f[a]&&f[a].firstRun,o=f[a]&&f[a].heightCalculationMethod in g,!t&&o&&O({iframe:e,height:0,width:0,type:"init"})}),R("init",i,e,n,!0),f[a]&&(f[a].iframe.iFrameResizer={close:N.bind(null,f[a].iframe),removeListeners:I.bind(null,f[a].iframe),resize:R.bind(null,"Window resize","resize",f[a].iframe),moveToAnchor:function(e){R("Move to anchor","moveToAnchor:"+e,f[a].iframe,a)},sendMessage:function(e){R("Send Message","message:"+(e=JSON.stringify(e)),f[a].iframe,a)}}))}function U(e,t){null===b&&(b=setTimeout(function(){b=null,e()},t))}function W(){"hidden"!==document.visibilityState&&(T("document","Trigger event: Visiblity change"),U(function(){j("Tab Visable","resize")},16))}function j(e,t){Object.keys(f).forEach(function(n){(function(e){return f[e]&&"parent"===f[e].resizeFrom&&f[e].autoResize&&!f[e].firstRun})(n)&&R(e,t,document.getElementById(n),n)})}function J(){y(window,"message",M),y(window,"resize",function(){var e;T("window","Trigger event: "+(e="resize")),U(function(){j("Window "+e,"resize")},16)}),y(document,"visibilitychange",W),y(document,"-webkit-visibilitychange",W)}function q(){function e(e,n){n&&(!function(){if(!n.tagName)throw new TypeError("Object is not a valid DOM element");if("IFRAME"!==n.tagName.toUpperCase())throw new TypeError("Expected <IFRAME> tag, found <"+n.tagName+">")}(),F(n,e),t.push(n))}var t;return function(){var e,t=["moz","webkit","o","ms"];for(e=0;e<t.length&&!m;e+=1)m=window[t[e]+"RequestAnimationFrame"];m||T("setup","RequestAnimationFrame not supported")}(),J(),function(o,i){switch(t=[],function(e){e&&e.enablePublicMethods&&$("enablePublicMethods option has been removed, public methods are now always available in the iFrame")}(o),typeof i){case"undefined":case"string":Array.prototype.forEach.call(document.querySelectorAll(i||"iframe"),e.bind(n,o));break;case"object":e(o,i);break;default:throw new TypeError("Unexpected data type ("+typeof i+")")}return t}}}()},725:function(e,t,n){!function(t){if("undefined"!=typeof window){var n=!0,o=10,i="",r=0,a="",s=null,l="",c=!1,d={resize:1,click:1},u=128,h=!0,p=1,m="bodyOffset",g=m,f=!0,b="",k={},v=32,w=null,y=!1,x="[iFrameSizer]",C=x.length,E="",T={max:1,min:1,bodyScroll:1,documentElementScroll:1},S="child",$=!0,P=window.parent,M="*",B=0,I=!1,N=null,A=16,z=1,L="scroll",O=L,D=window,_=function(){le("onMessage function not defined")},R=function(){},H=function(){},F={height:function(){return le("Custom height calculation function not defined"),document.documentElement.offsetHeight},width:function(){return le("Custom width calculation function not defined"),document.body.scrollWidth}},U={},W=!1;try{var j=Object.create({},{passive:{get:function(){W=!0}}});window.addEventListener("test",ne,j),window.removeEventListener("test",ne,j)}catch(e){}var J,q,G,Y,V,Z,K,X=Date.now||function(){return(new Date).getTime()},Q={bodyOffset:function(){return document.body.offsetHeight+we("marginTop")+we("marginBottom")},offset:function(){return Q.bodyOffset()},bodyScroll:function(){return document.body.scrollHeight},custom:function(){return F.height()},documentElementOffset:function(){return document.documentElement.offsetHeight},documentElementScroll:function(){return document.documentElement.scrollHeight},max:function(){return Math.max.apply(null,xe(Q))},min:function(){return Math.min.apply(null,xe(Q))},grow:function(){return Q.max()},lowestElement:function(){return Math.max(Q.bodyOffset()||Q.documentElementOffset(),ye("bottom",Ee()))},taggedElement:function(){return Ce("bottom","data-iframe-height")}},ee={bodyScroll:function(){return document.body.scrollWidth},bodyOffset:function(){return document.body.offsetWidth},custom:function(){return F.width()},documentElementScroll:function(){return document.documentElement.scrollWidth},documentElementOffset:function(){return document.documentElement.offsetWidth},scroll:function(){return Math.max(ee.bodyScroll(),ee.documentElementScroll())},max:function(){return Math.max.apply(null,xe(ee))},min:function(){return Math.min.apply(null,xe(ee))},rightMostElement:function(){return ye("right",Ee())},taggedElement:function(){return Ce("right","data-iframe-width")}},te=(J=Te,V=null,Z=0,K=function(){Z=X(),V=null,Y=J.apply(q,G),V||(q=G=null)},function(){var e=X();Z||(Z=e);var t=A-(e-Z);return q=this,G=arguments,t<=0||t>A?(V&&(clearTimeout(V),V=null),Z=e,Y=J.apply(q,G),V||(q=G=null)):V||(V=setTimeout(K,t)),Y});oe(window,"message",Ie),oe(window,"readystatechange",Ne),Ne()}function ne(){}function oe(e,t,n,o){e.addEventListener(t,n,!!W&&(o||{}))}function ie(e,t,n){e.removeEventListener(t,n,!1)}function re(e){return e.charAt(0).toUpperCase()+e.slice(1)}function ae(e){return x+"["+E+"] "+e}function se(e){y&&"object"==typeof window.console&&console.log(ae(e))}function le(e){"object"==typeof window.console&&console.warn(ae(e))}function ce(){var e;!function(){function e(e){return"true"===e}var o=b.substr(C).split(":");E=o[0],r=t!==o[1]?Number(o[1]):r,c=t!==o[2]?e(o[2]):c,y=t!==o[3]?e(o[3]):y,v=t!==o[4]?Number(o[4]):v,n=t!==o[6]?e(o[6]):n,a=o[7],g=t!==o[8]?o[8]:g,i=o[9],l=o[10],B=t!==o[11]?Number(o[11]):B,k.enable=t!==o[12]&&e(o[12]),S=t!==o[13]?o[13]:S,O=t!==o[14]?o[14]:O}(),se("Initialising iFrame ("+location.href+")"),function(){function e(e,t){return"function"==typeof e&&(se("Setup custom "+t+"CalcMethod"),F[t]=e,e="custom"),e}"iFrameResizer"in window&&Object===window.iFrameResizer.constructor&&(t=window.iFrameResizer,se("Reading data from page: "+JSON.stringify(t)),Object.keys(t).forEach(de,t),_="onMessage"in t?t.onMessage:_,R="onReady"in t?t.onReady:R,M="targetOrigin"in t?t.targetOrigin:M,g="heightCalculationMethod"in t?t.heightCalculationMethod:g,O="widthCalculationMethod"in t?t.widthCalculationMethod:O,g=e(g,"height"),O=e(O,"width"));var t;se("TargetOrigin for parent set to: "+M)}(),function(){t===a&&(a=r+"px");ue("margin",function(e,t){-1!==t.indexOf("-")&&(le("Negative CSS value ignored for "+e),t="");return t}("margin",a))}(),ue("background",i),ue("padding",l),(e=document.createElement("div")).style.clear="both",e.style.display="block",e.style.height="0",document.body.appendChild(e),ge(),fe(),document.documentElement.style.height="",document.body.style.height="",se('HTML & body height set to "auto"'),se("Enable public methods"),D.parentIFrame={autoResize:function(e){return!0===e&&!1===n?(n=!0,be()):!1===e&&!0===n&&(n=!1,ke()),n},close:function(){Be(0,0,"close"),se("Disable outgoing messages"),$=!1,se("Remove event listener: Message"),ie(window,"message",Ie),!0===n&&ke()},getId:function(){return E},getPageInfo:function(e){"function"==typeof e?(H=e,Be(0,0,"pageInfo")):(H=function(){},Be(0,0,"pageInfoStop"))},moveToAnchor:function(e){k.findTarget(e)},reset:function(){Me("parentIFrame.reset")},scrollTo:function(e,t){Be(t,e,"scrollTo")},scrollToOffset:function(e,t){Be(t,e,"scrollToOffset")},sendMessage:function(e,t){Be(0,0,"message",JSON.stringify(e),t)},setHeightCalculationMethod:function(e){g=e,ge()},setWidthCalculationMethod:function(e){O=e,fe()},setTargetOrigin:function(e){se("Set targetOrigin: "+e),M=e},size:function(e,t){var n=(e||"")+(t?","+t:"");Se("size","parentIFrame.size("+n+")",e,t)}},be(),k=function(){function e(e){var n=e.getBoundingClientRect(),o={x:window.pageXOffset!==t?window.pageXOffset:document.documentElement.scrollLeft,y:window.pageYOffset!==t?window.pageYOffset:document.documentElement.scrollTop};return{x:parseInt(n.left,10)+parseInt(o.x,10),y:parseInt(n.top,10)+parseInt(o.y,10)}}function n(n){var o=n.split("#")[1]||n,i=decodeURIComponent(o),r=document.getElementById(i)||document.getElementsByName(i)[0];t!==r?function(t){var n=e(t);se("Moving to in page link (#"+o+") at x: "+n.x+" y: "+n.y),Be(n.y,n.x,"scrollToOffset")}(r):(se("In page link (#"+o+") not found in iFrame, so sending to parent"),Be(0,0,"inPageLink","#"+o))}function o(){""!==location.hash&&"#"!==location.hash&&n(location.href)}k.enable?Array.prototype.forEach&&document.querySelectorAll?(se("Setting up location.hash handlers"),Array.prototype.forEach.call(document.querySelectorAll('a[href^="#"]'),function(e){"#"!==e.getAttribute("href")&&oe(e,"click",function(e){e.preventDefault(),n(this.getAttribute("href"))})}),oe(window,"hashchange",o),setTimeout(o,u)):le("In page linking not fully supported in this browser! (See README.md for IE8 workaround)"):se("In page linking not enabled");return{findTarget:n}}(),Se("init","Init message from host page"),R()}function de(e){var t=e.split("Callback");if(2===t.length){var n="on"+t[0].charAt(0).toUpperCase()+t[0].slice(1);this[n]=this[e],delete this[e],le("Deprecated: '"+e+"' has been renamed '"+n+"'. The old method will be removed in the next major version.")}}function ue(e,n){t!==n&&""!==n&&"null"!==n&&(document.body.style[e]=n,se("Body "+e+' set to "'+n+'"'))}function he(e){var t={add:function(t){function n(){Se(e.eventName,e.eventType)}U[t]=n,oe(window,t,n,{passive:!0})},remove:function(e){var t=U[e];delete U[e],ie(window,e,t)}};e.eventNames&&Array.prototype.map?(e.eventName=e.eventNames[0],e.eventNames.map(t[e.method])):t[e.method](e.eventName),se(re(e.method)+" event listener: "+e.eventType)}function pe(e){he({method:e,eventType:"Animation Start",eventNames:["animationstart","webkitAnimationStart"]}),he({method:e,eventType:"Animation Iteration",eventNames:["animationiteration","webkitAnimationIteration"]}),he({method:e,eventType:"Animation End",eventNames:["animationend","webkitAnimationEnd"]}),he({method:e,eventType:"Input",eventName:"input"}),he({method:e,eventType:"Mouse Up",eventName:"mouseup"}),he({method:e,eventType:"Mouse Down",eventName:"mousedown"}),he({method:e,eventType:"Orientation Change",eventName:"orientationchange"}),he({method:e,eventType:"Print",eventName:["afterprint","beforeprint"]}),he({method:e,eventType:"Ready State Change",eventName:"readystatechange"}),he({method:e,eventType:"Touch Start",eventName:"touchstart"}),he({method:e,eventType:"Touch End",eventName:"touchend"}),he({method:e,eventType:"Touch Cancel",eventName:"touchcancel"}),he({method:e,eventType:"Transition Start",eventNames:["transitionstart","webkitTransitionStart","MSTransitionStart","oTransitionStart","otransitionstart"]}),he({method:e,eventType:"Transition Iteration",eventNames:["transitioniteration","webkitTransitionIteration","MSTransitionIteration","oTransitionIteration","otransitioniteration"]}),he({method:e,eventType:"Transition End",eventNames:["transitionend","webkitTransitionEnd","MSTransitionEnd","oTransitionEnd","otransitionend"]}),"child"===S&&he({method:e,eventType:"IFrame Resized",eventName:"resize"})}function me(e,t,n,o){return t!==e&&(e in n||(le(e+" is not a valid option for "+o+"CalculationMethod."),e=t),se(o+' calculation method set to "'+e+'"')),e}function ge(){g=me(g,m,Q,"height")}function fe(){O=me(O,L,ee,"width")}function be(){var e;!0===n?(pe("add"),e=0>v,window.MutationObserver||window.WebKitMutationObserver?e?ve():s=function(){function e(e){function t(e){!1===e.complete&&(se("Attach listeners to "+e.src),e.addEventListener("load",i,!1),e.addEventListener("error",r,!1),l.push(e))}"attributes"===e.type&&"src"===e.attributeName?t(e.target):"childList"===e.type&&Array.prototype.forEach.call(e.target.querySelectorAll("img"),t)}function n(e){se("Remove listeners from "+e.src),e.removeEventListener("load",i,!1),e.removeEventListener("error",r,!1),function(e){l.splice(l.indexOf(e),1)}(e)}function o(e,o,i){n(e.target),Se(o,i+": "+e.target.src,t,t)}function i(e){o(e,"imageLoad","Image loaded")}function r(e){o(e,"imageLoadFailed","Image load failed")}function a(t){Se("mutationObserver","mutationObserver: "+t[0].target+" "+t[0].type),t.forEach(e)}var s,l=[],c=window.MutationObserver||window.WebKitMutationObserver,d=(s=document.querySelector("body"),d=new c(a),se("Create body MutationObserver"),d.observe(s,{attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0}),d);return{disconnect:function(){"disconnect"in d&&(se("Disconnect body MutationObserver"),d.disconnect(),l.forEach(n))}}}():(se("MutationObserver not supported in this browser!"),ve())):se("Auto Resize disabled")}function ke(){pe("remove"),null!==s&&s.disconnect(),clearInterval(w)}function ve(){0!==v&&(se("setInterval: "+v+"ms"),w=setInterval(function(){Se("interval","setInterval: "+v)},Math.abs(v)))}function we(e,t){var n=0;return t=t||document.body,n=null!==(n=document.defaultView.getComputedStyle(t,null))?n[e]:0,parseInt(n,o)}function ye(e,t){for(var n=t.length,o=0,i=0,r=re(e),a=X(),s=0;s<n;s++)(o=t[s].getBoundingClientRect()[e]+we("margin"+r,t[s]))>i&&(i=o);return a=X()-a,se("Parsed "+n+" HTML elements"),se("Element position calculated in "+a+"ms"),function(e){e>A/2&&se("Event throttle increased to "+(A=2*e)+"ms")}(a),i}function xe(e){return[e.bodyOffset(),e.bodyScroll(),e.documentElementOffset(),e.documentElementScroll()]}function Ce(e,t){var n=document.querySelectorAll("["+t+"]");return 0===n.length&&(le("No tagged elements ("+t+") found on page"),document.querySelectorAll("body *")),ye(e,n)}function Ee(){return document.querySelectorAll("body *")}function Te(e,n,o,i){var r,a;!function(){function e(e,t){return!(Math.abs(e-t)<=B)}return r=t!==o?o:Q[g](),a=t!==i?i:ee[O](),e(p,r)||c&&e(z,a)}()&&"init"!==e?e in{init:1,interval:1,size:1}||!(g in T||c&&O in T)?e in{interval:1}||se("No change in size detected"):Me(n):($e(),Be(p=r,z=a,e))}function Se(e,t,n,o){I&&e in d?se("Trigger event cancelled: "+e):(e in{reset:1,resetPage:1,init:1}||se("Trigger event: "+t),"init"===e?Te(e,t,n,o):te(e,t,n,o))}function $e(){I||(I=!0,se("Trigger event lock on")),clearTimeout(N),N=setTimeout(function(){I=!1,se("Trigger event lock off"),se("--")},u)}function Pe(e){p=Q[g](),z=ee[O](),Be(p,z,e)}function Me(e){var t=g;g=m,se("Reset trigger event: "+e),$e(),Pe("reset"),g=t}function Be(e,n,o,i,r){var a;!0===$&&(t===r?r=M:se("Message targetOrigin: "+r),se("Sending message to host page ("+(a=E+":"+e+":"+n+":"+o+(t!==i?":"+i:""))+")"),P.postMessage(x+a,r))}function Ie(t){var n={init:function(){b=t.data,P=t.source,ce(),h=!1,setTimeout(function(){f=!1},u)},reset:function(){f?se("Page reset ignored by init"):(se("Page size reset by host page"),Pe("resetPage"))},resize:function(){Se("resizeParent","Parent window requested size check")},moveToAnchor:function(){k.findTarget(i())},inPageLink:function(){this.moveToAnchor()},pageInfo:function(){var e=i();se("PageInfoFromParent called from parent: "+e),H(JSON.parse(e)),se(" --")},message:function(){var e=i();se("onMessage called from parent: "+e),_(JSON.parse(e)),se(" --")}};function o(){return t.data.split("]")[1].split(":")[0]}function i(){return t.data.substr(t.data.indexOf(":")+1)}function r(){return t.data.split(":")[2]in{true:1,false:1}}function a(){var i=o();i in n?n[i]():!e.exports&&"iFrameResize"in window||"jQuery"in window&&"iFrameResize"in window.jQuery.prototype||r()||le("Unexpected message ("+t.data+")")}x===(""+t.data).substr(0,C)&&(!1===h?a():r()?n.init():se('Ignored message of type "'+o()+'". Received before initialization.'))}function Ne(){"loading"!==document.readyState&&window.parent.postMessage("[iFrameResizerChild]Ready","*")}}()},726:function(e,t,n){var o=n(727);"string"==typeof o&&(o=[[e.i,o,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(324)(o,i);o.locals&&(e.exports=o.locals)},727:function(e,t,n){(e.exports=n(323)(!1)).push([e.i,'#add-to-cart-stripe{text-align:center;background-color:#407fbf;color:white;cursor:pointer;font-size:1rem;position:relative;padding:0.5em;float:right;width:100%;height:40px;transition:width 0.2s ease-in-out;clear:both}#add-to-cart-stripe .close-icon{position:absolute;right:0;top:50%;transform:translate(0, -50%);transition:transform 0.2s ease-in-out;padding:0.5em 0.75em}#add-to-cart-stripe.collapsed{width:55px}#add-to-cart-stripe.collapsed .add-to-cart-stripe-message{opacity:0;display:none}#add-to-cart-stripe.collapsed .add-to-cart-stripe-icon-container{opacity:1}#add-to-cart-stripe.collapsed .close-icon{transform:translate(-50%, -50%) rotate(45deg)}#add-to-cart-stripe .add-to-cart-stripe-message{white-space:nowrap;opacity:1;transition:opacity 0.15s ease-in-out}#add-to-cart-stripe .add-to-cart-stripe-icon-container{position:absolute;top:50%;left:50%;transform:translate(-10%, -50%);transition:opacity 0.15s ease-in-out;opacity:0;white-space:nowrap}@media screen and (max-width: 650px){#add-to-cart-stripe .add-to-cart-stripe-message{font-size:90%}}@media screen and (max-width: 440px){#add-to-cart-stripe .add-to-cart-formats-message{display:none}}#add-to-cart-stripe.added-to-cart{background-color:#67a73d}#add-to-cart-stripe.added-to-cart:hover{background-color:#5b9436}#add-to-cart-stripe.added-to-cart:active{background-color:#50822f}#add-to-cart-stripe.added-to-cart .fa-plus{display:none}#add-to-cart-stripe:hover{background-color:#3a72ac}#add-to-cart-stripe:active{background-color:#369}#add-to-cart-stripe.disappear{display:none}#add-to-cart-stripe .add-to-cart-content-list-book-price{margin:0 0.25em}.add-to-cart-content-list-book-price{margin-right:0.5em;color:#b3b3b3;position:relative}.add-to-cart-content-list-book-price:before{position:absolute;content:"";left:-0.15em;top:calc(50% - 1px);right:-0.15em;border-top:2px solid #777777;transform:rotate(-5deg)}#add-to-cart-box{position:fixed;right:1.2rem;top:130px;max-width:225px;z-index:97;transition:right 0.2s ease-in-out}#add-to-cart-box .__react_component_tooltip{max-width:290px;font-size:80%}#add-to-cart-box .__react_component_tooltip i{font-style:italic;font-family:inherit;font-size:100%}#add-to-cart-box .add-to-cart-close-button{position:absolute;top:0;right:0.3em;z-index:1;color:gray;cursor:pointer;opacity:1;transition:opacity 0.25s ease-in-out}#add-to-cart-box .add-to-cart-discount-title{color:white;text-decoration:none;display:block;text-align:left;font-weight:normal}#add-to-cart-box .add-to-cart-dotd-discount-title{font-size:1.25em}#add-to-cart-box .add-to-cart-dotd-discount-title:visited{color:white}#add-to-cart-box .add-to-cart-dotd-discount-title:hover{text-decoration:underline}#add-to-cart-box .add-to-cart-discount-subtitle{color:#9fbfdf;text-align:left;font-size:0.8em;font-weight:300}#add-to-cart-box.collapsed{max-width:55px;right:0}#add-to-cart-box.collapsed .add-to-cart-close-button{opacity:0}#add-to-cart-box.collapsed .add-to-cart{max-height:0}#add-to-cart-box:not(.collapsed) .add-to-cart-collapsed-icons-container{display:none}#add-to-cart-box label{cursor:default}#add-to-cart-box .add-to-cart{background-color:#eaeaea;max-height:340px;overflow:hidden}#add-to-cart-box .add-to-cart.deal-of-the-day .add-to-cart-title-container{background-color:#407fbf;padding:10px 15px}#add-to-cart-box .add-to-cart-choices-container{padding:10px 10px 0 10px;border:none;margin:0;max-height:130px;transition:max-height 0.3s ease-in-out}#add-to-cart-box .add-to-cart-choices-container.add-to-cart-ebook-container{padding-top:0}#add-to-cart-box .add-to-cart-choices-container.add-to-cart-ebook-container .add-to-cart-choices-title-container{margin-top:10px}#add-to-cart-box .add-to-cart-choices-container.disabled{opacity:0.8}#add-to-cart-box .add-to-cart-choices-container.collapsed{max-height:0}#add-to-cart-box .add-to-cart-token-deduction-info-container{font-size:65%;color:#a6a6a6;text-align:right}#add-to-cart-box .add-to-cart-audio-upgrade-only-container{margin-top:10px}#add-to-cart-box .add-to-cart-audio-upgrade-only-container label{color:black !important}#add-to-cart-box .add-to-cart-title-container{background-color:#4d4d4d;color:white;padding:10px 25px;font-weight:bolder;text-align:center;position:relative;margin-top:0;margin-bottom:0}#add-to-cart-box .add-to-cart-title-container h5{color:white;margin:0;font-size:0.9rem;line-height:20px;max-height:40px;overflow:hidden}#add-to-cart-box .add-to-cart-title-container .minimize-button{cursor:pointer;position:absolute;top:0;right:5px;color:#a6a6a6;font-weight:300}#add-to-cart-box .add-to-cart-product-title{font-style:italic;font-weight:300}#add-to-cart-box .add-to-cart-choices-title-container{font-size:90%;overflow:auto}#add-to-cart-box .add-to-cart-content-title{display:inline-block;margin-right:0.5em;font-weight:bolder}#add-to-cart-box .add-to-cart-content-book-price{font-weight:bold;text-align:right}#add-to-cart-box .add-to-cart-content-subtitle{display:inline-block;cursor:default;font-size:80%;font-style:italic;color:#aeaeae}#add-to-cart-box .add-to-cart-choice-container{overflow:auto}#add-to-cart-box .add-to-cart-choice-container input{margin-bottom:0.3rem}#add-to-cart-box .add-to-cart-choice-container label{color:#b1b1b1}#add-to-cart-box .add-to-cart-choice-container.active label{color:#505050}#add-to-cart-box .add-to-cart-choice-check-container{float:left;clear:left;user-select:none;cursor:pointer}#add-to-cart-box .add-to-cart-choice-price-container{float:right;clear:right;margin-left:0.2rem}#add-to-cart-box .add-to-cart-add-show-button{font-size:90%;white-space:nowrap;overflow:hidden;display:block;text-overflow:ellipsis}#add-to-cart-box .add-to-cart-add-show-button,#add-to-cart-box .add-to-cart-collapsed-icons-container{display:block;position:relative;color:white;background-color:#407fbf;text-align:center;padding:10px;margin:10px -10px 0 -10px;transition:background-color 0.2s linear;user-select:none;cursor:pointer}#add-to-cart-box .add-to-cart-add-show-button:hover,#add-to-cart-box .add-to-cart-collapsed-icons-container:hover{background-color:#3a72ac}#add-to-cart-box .add-to-cart-add-show-button:active,#add-to-cart-box .add-to-cart-collapsed-icons-container:active{background-color:#369}#add-to-cart-box .add-to-cart-add-show-button.added-to-cart,#add-to-cart-box .add-to-cart-collapsed-icons-container.added-to-cart{background-color:#67a73d}#add-to-cart-box .add-to-cart-add-show-button.added-to-cart:hover,#add-to-cart-box .add-to-cart-collapsed-icons-container.added-to-cart:hover{background-color:#5b9436}#add-to-cart-box .add-to-cart-add-show-button.added-to-cart:active,#add-to-cart-box .add-to-cart-collapsed-icons-container.added-to-cart:active{background-color:#50822f}#add-to-cart-box .add-to-cart-collapsed-icons-container{padding:10px;margin:0}@keyframes addToCartGlow{from{box-shadow:0 0 0 #407fbf}to{box-shadow:0 0 30px #407fbf}}@keyframes viewInCartGlow{from{box-shadow:0 0 0 #67a73d}to{box-shadow:0 0 30px #67a73d}}.cart-glow{animation-duration:2s;animation-iteration-count:infinite;animation-direction:alternate;animation-timing-function:ease-in-out}.cart-glow.can-add-to-cart{animation-name:addToCartGlow}.cart-glow.can-view-in-cart{animation-name:viewInCartGlow}\n',""])},728:function(e,t,n){var o=n(729);"string"==typeof o&&(o=[[e.i,o,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(324)(o,i);o.locals&&(e.exports=o.locals)},729:function(e,t,n){(e.exports=n(323)(!1)).push([e.i,"#free-preview-point{position:sticky;display:flex;align-items:center;justify-content:center;top:150px;background:#333333;color:white;border-radius:50%;transition:transform 0.2s ease-in-out;transform:translate(-15px, 0) scale(0)}#free-preview-point.show{visibility:visible;transform:translate(-15px, 0) scale(1);transform-origin:300px 400px}.free-preview-header-notification{transition:transform 0.2s ease-in-out;transform:translateY(-100%);font-size:16px}.free-preview-header-notification a{font-size:inherit !important}.free-preview-header-notification.shown{transform:translateY(0)}.free-preview-header-notification.expanding-free-preview{transform:scaleX(0);transform-origin:50%}.free-preview-header-notification.expanding-free-preview.shown{transform:translateY(0%) scaleX(1)}.scrambled-notifier{position:absolute;color:#3C3C3C;font-weight:300;font-family:Lato;cursor:pointer;z-index:96}.scrambled-notifier .scrambled-arrow-container{position:absolute;top:95%;border-style:solid}.scrambled-notifier.unlock-notifier{top:0;left:-3%;z-index:96;height:2em;display:flex;align-items:center;background-color:#fc0;font-style:italic;padding:0.1em 1.4em 0.1em 3.5em;transform:translateY(35%)}.scrambled-notifier.unlock-notifier .scrambled-arrow-container{right:4px;border-color:#fc0 transparent transparent transparent;border-width:10px 0 0 10px}@media only screen and (max-width: 690px){.scrambled-notifier.unlock-notifier{left:-0.7%;height:1.2em;padding-right:0.4em}}@media only screen and (max-width: 450px){.scrambled-notifier.unlock-notifier{left:-8px}}@media only screen and (max-width: 690px){h1+.scrambled-notifier.unlock-notifier{transform:translateY(65%)}}h2+.scrambled-notifier.unlock-notifier{transform:translateY(15%)}@media only screen and (max-width: 690px){h2+.scrambled-notifier.unlock-notifier{transform:translateY(30%)}}h3+.scrambled-notifier.unlock-notifier{transform:translateY(10%)}@media only screen and (max-width: 690px){h3+.scrambled-notifier.unlock-notifier{transform:translateY(25%)}}h4+.scrambled-notifier.unlock-notifier{transform:translateY(0)}@media only screen and (max-width: 690px){h4+.scrambled-notifier.unlock-notifier{transform:translateY(25%)}}p+.scrambled-notifier.unlock-notifier{transform:translateY(-90%)}li+.scrambled-notifier.unlock-notifier{transform:translateY(-90%)}li>.scrambled-notifier.unlock-notifier{transform:translateY(-100%)}@media only screen and (max-width: 690px){.scrambled-notifier.unlock-notifier{padding-left:2em;padding-right:0}.scrambled-notifier.unlock-notifier .scramble-message-container{font-size:90%;padding-right:0.5em;padding-left:0.5em}}.scrambled-notifier.unlock-notifier:before{content:'';position:absolute;bottom:0;left:0;width:0;height:0;border-style:solid;border-width:0 4px 2em 0;border-color:transparent transparent #f4f4f4 transparent}.scrambled-notifier.contains-double-digit-tokens{padding-left:4em}.scrambled-notifier .token-icon-container{position:absolute;top:1em;left:0.85em;transform:translateY(-50%);display:flex;align-items:center;height:2em}@media only screen and (max-width: 690px){.scrambled-notifier .token-icon-container{top:.6em;height:1.2em;left:0.6em}}.scrambled-notifier .token-icon-container .price-container{font-family:Lato;font-weight:700;font-style:normal;margin-left:0.5em;user-select:none}.scrambled-notifier .token-icon-container svg{transform-style:preserve-3d;width:16px}@media only screen and (max-width: 690px){.scrambled-notifier .token-icon-container svg{width:14px}}.callout-container .scrambled-notifier:before{border-color:transparent transparent #e8e8e8 transparent}.heading-scrambled-notifier-hidden .heading-scrambled-notifier{display:none}.heading-scrambled-notifier.heading-scrambled-notifier-hidden{display:none}.heading-scrambled-notifier:hover .token-icon-container svg{transform:rotateY(360deg);transition-duration:1.2s}\n",""])},730:function(e,t){e.exports=function(e){var t,n=(e=e||{}).callback||function(){},o=e.activeCallback||function(){},i=e.idleTime||6e4,r=!0;function a(e){window[e]("load",s),document[e]("mousemove",s),document[e]("scroll",s),document[e]("keypress",s)}function s(){r||(r=!0,o()),clearTimeout(t),t=setTimeout(l,i)}function l(){r&&(r=!1,n())}return a("addEventListener"),s(),{activate:s,destroy:function(){clearTimeout(t),a("removeEventListener")},idle:l}}},922:function(e,t,n){"use strict";n.r(t);var o=n(568),i=Object.assign||function(e){for(var t,n=1;n<arguments.length;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r=function(e){return"IMG"===e.tagName},a=function(e){return e&&1===e.nodeType},s=function(e){return".svg"===(e.currentSrc||e.src).substr(-4).toLowerCase()},l=function(e){try{return Array.isArray(e)?e.filter(r):function(e){return NodeList.prototype.isPrototypeOf(e)}(e)?[].slice.call(e).filter(r):a(e)?[e].filter(r):"string"==typeof e?[].slice.call(document.querySelectorAll(e)).filter(r):[]}catch(e){throw new TypeError("The provided selector is invalid.\nExpects a CSS selector, a Node element, a NodeList or an array.\nSee: https://github.com/francoischalifour/medium-zoom")}},c=function(e,t){var n=i({bubbles:!1,cancelable:!1,detail:void 0},t);if("function"==typeof window.CustomEvent)return new CustomEvent(e,n);var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,n.bubbles,n.cancelable,n.detail),o};
/*! medium-zoom 1.0.4 | MIT License | https://github.com/francoischalifour/medium-zoom */!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}");var d,u=function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=window.Promise||function(e){function t(){}e(t,t)},r=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var o=t.reduce(function(e,t){return[].concat(e,l(t))},[]);return o.filter(function(e){return-1===p.indexOf(e)}).forEach(function(e){p.push(e),e.classList.add("medium-zoom-image")}),m.forEach(function(e){var t=e.type,n=e.listener,i=e.options;o.forEach(function(e){e.addEventListener(t,n,i)})}),w},d=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).target,t=function(){var e=Math.min,t={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,left:0,top:0,right:0,bottom:0},n=void 0,o=void 0;if(b.container)if(b.container instanceof Object)n=(t=i({},t,b.container)).width-t.left-t.right-2*b.margin,o=t.height-t.top-t.bottom-2*b.margin;else{var r=(a(b.container)?b.container:document.querySelector(b.container)).getBoundingClientRect(),l=r.width,c=r.height,d=r.left,u=r.top;t=i({},t,{width:l,height:c,left:d,top:u})}n=n||t.width-2*b.margin,o=o||t.height-2*b.margin;var h=k.zoomedHd||k.original,p=s(h)?n:h.naturalWidth||n,m=s(h)?o:h.naturalHeight||o,g=h.getBoundingClientRect(),f=g.top,v=g.left,w=g.width,y=g.height,x=e(p,n)/w,C=e(m,o)/y,E=e(x,C),T="scale("+E+") translate3d("+((n-w)/2-v+b.margin+t.left)/E+"px, "+((o-y)/2-f+b.margin+t.top)/E+"px, 0)";k.zoomed.style.transform=T,k.zoomedHd&&(k.zoomedHd.style.transform=T)};return new o(function(n){if(e&&-1===p.indexOf(e))n(w);else if(k.zoomed)n(w);else{if(e)k.original=e;else{if(!(0<p.length))return void n(w);var o=p;k.original=o[0]}if(k.original.dispatchEvent(c("medium-zoom:open",{detail:{zoom:w}})),f=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,g=!0,k.zoomed=function(e){var t=e.getBoundingClientRect(),n=t.top,o=t.left,i=t.width,r=t.height,a=e.cloneNode(),s=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,l=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;return a.removeAttribute("id"),a.style.position="absolute",a.style.top=n+s+"px",a.style.left=o+l+"px",a.style.width=i+"px",a.style.height=r+"px",a.style.transform="",a}(k.original),document.body.appendChild(v),b.template){var i=a(b.template)?b.template:document.querySelector(b.template);k.template=document.createElement("div"),k.template.appendChild(i.content.cloneNode(!0)),document.body.appendChild(k.template)}if(document.body.appendChild(k.zoomed),window.requestAnimationFrame(function(){document.body.classList.add("medium-zoom--opened")}),k.original.classList.add("medium-zoom-image--hidden"),k.zoomed.classList.add("medium-zoom-image--opened"),k.zoomed.addEventListener("click",u),k.zoomed.addEventListener("transitionend",function e(){g=!1,k.zoomed.removeEventListener("transitionend",e),k.original.dispatchEvent(c("medium-zoom:opened",{detail:{zoom:w}})),n(w)}),k.original.getAttribute("data-zoom-src")){k.zoomedHd=k.zoomed.cloneNode(),k.zoomedHd.removeAttribute("srcset"),k.zoomedHd.removeAttribute("sizes"),k.zoomedHd.src=k.zoomed.getAttribute("data-zoom-src"),k.zoomedHd.onerror=function(){clearInterval(r),console.warn("Unable to reach the zoom image target "+k.zoomedHd.src),k.zoomedHd=null,t()};var r=setInterval(function(){k.zoomedHd.complete&&(clearInterval(r),k.zoomedHd.classList.add("medium-zoom-image--opened"),k.zoomedHd.addEventListener("click",u),document.body.appendChild(k.zoomedHd),t())},10)}else if(k.original.hasAttribute("srcset")){k.zoomedHd=k.zoomed.cloneNode(),k.zoomedHd.removeAttribute("sizes");var s=k.zoomedHd.addEventListener("load",function(){k.zoomedHd.removeEventListener("load",s),k.zoomedHd.classList.add("medium-zoom-image--opened"),k.zoomedHd.addEventListener("click",u),document.body.appendChild(k.zoomedHd),t()})}else t()}})},u=function(){return new o(function(e){!g&&k.original?(g=!0,document.body.classList.remove("medium-zoom--opened"),k.zoomed.style.transform="",k.zoomedHd&&(k.zoomedHd.style.transform=""),k.template&&(k.template.style.transition="opacity 150ms",k.template.style.opacity=0),k.original.dispatchEvent(c("medium-zoom:close",{detail:{zoom:w}})),k.zoomed.addEventListener("transitionend",function t(){k.original.classList.remove("medium-zoom-image--hidden"),document.body.removeChild(k.zoomed),k.zoomedHd&&document.body.removeChild(k.zoomedHd),document.body.removeChild(v),k.zoomed.classList.remove("medium-zoom-image--opened"),k.template&&document.body.removeChild(k.template),g=!1,k.zoomed.removeEventListener("transitionend",t),k.original.dispatchEvent(c("medium-zoom:closed",{detail:{zoom:w}})),k.original=null,k.zoomed=null,k.zoomedHd=null,k.template=null,e(w)})):e(w)})},h=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).target;return k.original?u():d({target:e})},p=[],m=[],g=!1,f=0,b=n,k={original:null,zoomed:null,zoomedHd:null,template:null};"[object Object]"===Object.prototype.toString.call(t)?b=t:(t||"string"==typeof t)&&r(t);var v=function(e){var t=document.createElement("div");return t.classList.add("medium-zoom-overlay"),t.style.background=e,t}((b=i({margin:0,background:"#fff",scrollOffset:40,container:null,template:null},b)).background);document.addEventListener("click",function(e){var t=e.target;return t===v?void u():void(-1===p.indexOf(t)||h({target:t}))}),document.addEventListener("keyup",function(e){27===(e.keyCode||e.which)&&u()}),document.addEventListener("scroll",function(){if(!g&&k.original){var e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;Math.abs(f-e)>b.scrollOffset&&setTimeout(u,150)}}),window.addEventListener("resize",u);var w={open:d,close:u,toggle:h,update:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e;if(e.background&&(v.style.background=e.background),e.container&&e.container instanceof Object&&(t.container=i({},b.container,e.container)),e.template){var n=a(e.template)?e.template:document.querySelector(e.template);t.template=n}return b=i({},b,t),p.forEach(function(e){e.dispatchEvent(c("medium-zoom:update",{detail:{zoom:w}}))}),w},clone:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return e(i({},b,t))},attach:r,detach:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];k.zoomed&&u();var o=0<t.length?t.reduce(function(e,t){return[].concat(e,l(t))},[]):p;return o.forEach(function(e){e.classList.remove("medium-zoom-image"),e.dispatchEvent(c("medium-zoom:detach",{detail:{zoom:w}}))}),p=p.filter(function(e){return-1===o.indexOf(e)}),w},on:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return p.forEach(function(o){o.addEventListener("medium-zoom:"+e,t,n)}),m.push({type:"medium-zoom:"+e,listener:t,options:n}),w},off:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return p.forEach(function(o){o.removeEventListener("medium-zoom:"+e,t,n)}),m=m.filter(function(n){return n.type!=="medium-zoom:"+e||n.listener.toString()!==t.toString()}),w},getOptions:function(){return b},getImages:function(){return p},getZoomedImage:function(){return k.original}};return w},h=n(46),p=n(4),m=n(2),g=n(334),f=n(17),b=n(5),k=n(0),v=n(115),w=n(113),y=n(389),x=n(390),C=new(function(){function e(){this.periodsNumbers=[60,60,24,7,4.35,12,10],this.periodsDescriptions=["second","minute","hour","day","week","month","year","decade"]}return e.prototype.convertToRelativeHumanReadable=function(e){var t;e/=1e3;for(var n=0;n<this.periodsDescriptions.length&&(t=this.periodsDescriptions[n],e>this.periodsNumbers[n]);n++)e/=this.periodsNumbers[n],6==n&&(t=this.periodsDescriptions[7]);return(e=Math.round(e))>1&&(t+="s"),e+" "+t},e}()),E=n(55),T=n(14),S=n(69),P=n(563),M=n(67),B=n(426),I=n(564),N=n(416),A=n(6),z=n(23),L=n(12),O=$(document),D=new(function(){function e(){var e=this;this.$textAddonsMenuButton=$(".text-addons-menu-button"),this.$textAddonsMenu=$("#text-addons-menu"),this.$textAddonsContainer=this.$textAddonsMenu.find(".items-container ul"),this.$searchBox=this.$textAddonsMenu.find(".search-input"),this.$sortByTimeButton=this.$textAddonsMenu.find(".sort-by-time-button"),this.$sortByBookButton=this.$textAddonsMenu.find(".sort-by-book-button"),this.$highlightsTab=this.$textAddonsMenu.find(".highlights-tab"),this.$bookmarksTab=this.$textAddonsMenu.find(".bookmarks-tab"),this.$notesTab=this.$textAddonsMenu.find(".notes-tab"),this.paginationMaxPages=6,this.paginationMaxItems=10,this.paginationActivePage=0,this.$paginationTarget=$("#text-addons-menu"),this.$paginationWrapper=$("#text-addons-pagination"),this.$textAddonsNotificationIcon=$(".text-addons-menu-button .header-icon-notification"),this.slideMenu=new S.a(this.$textAddonsMenuButton,this.$textAddonsMenu,function(){return e.getTextAddonsData(function(){e.fillUsersAutocompleteIfNeeded(),e.fillSortedByTime()})},function(){return e.isMenuOpened=!0},void 0,function(){return e.isMenuOpened=!1}),m.a.onEventWithCooldown(this.$sortByTimeButton,"click touchstart",function(){return e.fillSortedByTime()}),m.a.onEventWithCooldown(this.$sortByBookButton,"click touchstart",function(){return e.fillSortedByBook()}),m.a.onEventWithCooldown(this.$highlightsTab,"click touchstart",function(){e.$highlightsTab.toggleClass("selected"),e.renderTextAddons()}),m.a.onEventWithCooldown(this.$bookmarksTab,"click touchstart",function(){e.$bookmarksTab.toggleClass("selected"),e.renderTextAddons()}),m.a.onEventWithCooldown(this.$notesTab,"click touchstart",function(){e.$notesTab.toggleClass("selected"),e.renderTextAddons()}),m.a.onDescendantEventWithCooldown(this.$textAddonsMenu,"click",".delete-text-addon-icon",function(t){var n=$(t.target).closest(".text-addon-item"),o=n.attr("data-id");o&&(n.is(".waiting-for-deletion")||(n.is(".bookmark-item")?confirm("Delete bookmark?")&&e.deleteBookmark(n,o):n.is(".note-item")?confirm("Delete note?")&&e.deleteNote(n,o):n.is(".highlight-item")&&confirm("Delete highlight?")&&e.deleteHighlight(n,o)))}),this.$searchBox.typeWatch&&this.$searchBox.typeWatch({callback:function(t){return e.filterBookmarks(t)},wait:200,highlight:!0,captureLength:2}),O.on("highlightAdded",function(){e.$textAddonsNotificationIcon.html("<i class='highlight-icon-font icon-highlighter-full'></i>"),e.visuallyShowAddition()}),O.on("bookmarkAdded",function(){e.$textAddonsNotificationIcon.html("<i class='fa fa-bookmark-o'></i>"),e.visuallyShowAddition()}),O.on("noteAdded",function(){e.$textAddonsNotificationIcon.html("<i class='fa fa-pencil-square-o'></i>"),e.visuallyShowAddition()}),O.on("requestTextAddonsMenuOpen",function(){return e.open()})}return e.prototype.initialize=function(e,t){var n=this;this.$textAddonsMenuButton.toggleClass("hidden",!e||!A.a.isCurrentlyLoggedIn()),this.$notesTab.find(".notes-tab-title").text(null!=t&&t.reviewVersion?"review notes":"notes"),A.a.isCurrentlyLoggedIn()&&(this.book=e,this.bookElement=t,this.getTextAddonsData(function(){n.fillUsersAutocompleteIfNeeded(),n.fillSortedByTime()}))},e.prototype.clean=function(){this.isMenuOpened||this.$textAddonsMenuButton.addClass("hidden"),this.book=null,this.bookElement=null,$("#reviewer-list").empty()},e.prototype.open=function(){this.slideMenu&&this.slideMenu.openMenu()},e.prototype.getTextAddonsData=function(e){var t=this;this.book&&this.bookElement&&A.a.isCurrentlyLoggedIn()&&x.a.fetch(this.bookElement).then(function(n){O.trigger("text-addons-data-ready"),t.textAddonsData=n,e&&e()})},e.prototype.fillUsersAutocompleteIfNeeded=function(){if(this.textAddonsData&&this.textAddonsData.notes&&this.textAddonsData.notes.bookNotes&&null!=this.bookElement&&this.bookElement.reviewVersion){for(var e={},t=0,n=this.textAddonsData.notes.bookNotes;t<n.length;t++){var o=n[t];o.user&&(e[o.user]=o.user)}$("#reviewer-list").html(L.a.mapToArray(e).sort().map(function(e){return'<option value="'+e+'">'}).join(""))}else $("#reviewer-list").empty()},e.prototype.fillSortedByTime=function(){return this.textAddonsData&&(this.$sortByBookButton.removeClass("selected"),this.$sortByTimeButton.addClass("selected"),this.renderTextAddons()),!1},e.prototype.fillSortedByBook=function(){this.textAddonsData&&(this.$sortByTimeButton.removeClass("selected"),this.$sortByBookButton.addClass("selected"),this.renderTextAddons())},e.prototype.renderTextAddons=function(){this.fillTextAddons(),this.$searchBox.val(""),this.paginationInit()},e.prototype.fillTextAddons=function(){var e=this;if(this.book){var t=this.getCurrentItems();this.$sortByBookButton.is(".selected")?t=this.sortByBook(t):this.$sortByTimeButton.is(".selected")&&(t=this.sortByTime(t)),this.$textAddonsContainer.empty();var n="",o=this.$highlightsTab.is(".selected"),i=this.$bookmarksTab.is(".selected"),r=this.$notesTab.is(".selected");t.forEach(function(t){!o&&t instanceof y.b||!i&&t instanceof v.a||!r&&t instanceof w.a||(n+=Mustache.render(_,{link:k.a.getBookElementUrl(e.book.slug,t.bookElementShortName,t.meapVersion,t.reviewVersion)+e.getContentId(t),bookElementShortName:t.bookElementShortName,bookElementTitle:E.a.pretifyShortName(t.bookElementShortName),text:t instanceof w.a&&e.bookElement.reviewVersion?e.getItemText(t):e.trimText(e.getItemText(t)),id:t.id,timeStamp:C.convertToRelativeHumanReadable(Date.now()-+t.timestamp),isMeap:t.meapVersion&&t.meapVersion>0,isReview:t.reviewVersion&&t.reviewVersion>0,meapVersion:t.meapVersion,reviewVersion:t.reviewVersion,isBookmark:t instanceof v.a,isNote:t instanceof w.a,user:t.user||"",isHighlight:t instanceof y.b,highlightColor:t instanceof y.b?t.color:"",canDelete:!(t instanceof w.a)||t.userId==z.a.getUserId()}))}),this.$textAddonsContainer.append(n)}},e.prototype.trimText=function(e){return!e||""==e||e.length<100?e:e.substr(0,100)+" ..."},e.prototype.getItemText=function(e){return e instanceof w.a?e.noteText:e instanceof v.a?e.bookmarkedText:e instanceof y.b?e.highlightedParagraphs&&e.highlightedParagraphs[0]&&e.highlightedParagraphs[0].selectedText:""},e.prototype.getContentId=function(e){return e instanceof w.a?"note-"+e.contentID:e instanceof v.a?e.contentID:e instanceof y.b?e.highlightedParagraphs&&e.highlightedParagraphs[0]&&e.highlightedParagraphs[0].ordinal:""},e.prototype.getCurrentItems=function(){var e=this.textAddonsData.notes.bookNotes,t=this.textAddonsData.bookmarks.bookBookmarks,n=this.textAddonsData.highlights.bookHighlights;return[].concat(e).concat(t).concat(n)},e.prototype.filterBookmarks=function(e){if(!(e=e.trim().toLowerCase()))return this.$textAddonsContainer.find(".hidden").removeClass("hidden"),void this.paginationInit();this.$textAddonsContainer.children().each(function(t,n){var o=$(n);o.toggleClass("hidden",-1===o.text().toLowerCase().indexOf(e))}),this.paginationInit()},e.prototype.sortByTime=function(e){return e.sort(function(e,t){return+t.timestamp-+e.timestamp})},e.prototype.sortByBook=function(e){var t=this;return e.sort(function(e,n){return e.bookElementOrdinal<n.bookElementOrdinal?-1:e.bookElementOrdinal>n.bookElementOrdinal?1:+t.getContentId(e)-+t.getContentId(n)})},e.prototype.paginationInit=function(){var e=$(".items-container li",this.$paginationTarget).not(".hidden").length;if(this.$paginationWrapper.empty(),this.$paginationWrapper.removeClass("has-items"),e>this.paginationMaxItems){this.$paginationWrapper.addClass("has-items");for(var t=Math.ceil(e/this.paginationMaxItems),n='<li data-page="1"><i class="fa fa-angle-double-left"></i></li>\n                                  <li data-page="-"><i class="fa fa-angle-left"></i></li>',o=1;o<=t;o++){n+='<li data-page="'+o+'" class="pagination-item">'+o+"</li>"}n+='<li data-page="+"><i class="fa fa-angle-right"></i></li>\n                               <li data-page="'+t+'"><i class="fa fa-angle-double-right"></i></li>',this.$paginationWrapper.append(n),this.paginationShowPage(1);var i=this;this.$paginationWrapper.children().on("click",function(){i.paginationShowPage($(this).attr("data-page"))})}return!1},e.prototype.paginationShowPage=function(e){var t=this,n=this.$paginationWrapper.find(".pagination-item"),o=n.length;if(e<1||e>o)return!1;var i=e*this.paginationMaxItems,r=i-this.paginationMaxItems;this.paginationActivePage=parseInt(e),this.$paginatedItems=this.$textAddonsContainer.children(),this.$paginatedItems.each(function(e,t){var n=$(t);e>=r&&e<i?n.removeClass("hidden"):n.addClass("hidden")}),n.each(function(n,i){var r=$(i),a=Math.round(t.paginationMaxPages/2);t.paginationActivePage+a>o?a+=t.paginationActivePage+a-o:t.paginationActivePage<a&&(a+=t.paginationActivePage),n+1>t.paginationActivePage-a&&n+1<=t.paginationActivePage+a?r.removeClass("hidden"):r.addClass("hidden"),r.toggleClass("active",e==n+1)}),$(":nth-child(2)",this.$paginationWrapper).attr("data-page",this.paginationActivePage-1),$(":nth-child("+(o+3)+")",this.$paginationWrapper).attr("data-page",this.paginationActivePage+1)},e.prototype.visuallyShowAddition=function(){var e=this;this.$textAddonsNotificationIcon.removeClass("hidden disappear").addClass("appear"),T.a.addIconButtonGlow(this.$textAddonsMenuButton),setTimeout(function(){e.$textAddonsNotificationIcon.removeClass("appear").addClass("disappear"),T.a.removeIconButtonGlow(e.$textAddonsMenuButton)},2e3)},e.prototype.deleteBookmark=function(e,t){e.addClass("waiting-for-deletion"),P.a.bookmarksService.removeBookmarkById(t).then(function(n){if(!n)return e.removeClass("waiting-for-deletion"),void M.a.showTemporaryNotification("error deleting bookmark");e.remove();var o=document.querySelector(".bookmark-bubble[data-id='"+t+"']");if(null!=o){var i=$(o).closest(".paragraph-bubble");i.removeAttr("data-bookmark-active"),N.a.visuallyMarkBookmark(i.get(0))}}).catch(function(t){e.removeClass("waiting-for-deletion"),M.a.showTemporaryNotification("error deleting bookmark")})},e.prototype.deleteNote=function(e,t){e.addClass("waiting-for-deletion"),B.a.notesService.removeNote(parseInt(t)).then(function(n){if(!n)return e.removeClass("waiting-for-deletion"),void M.a.showTemporaryNotification("error deleting note");e.remove();for(var o=document.querySelectorAll(".note-bubble.bubble-active"),i=0;i<o.length;i++){var r=$(o[i]).closest(".paragraph-bubble");N.a.removeNoteBubbleNote(r.get(0),t)}}).catch(function(t){e.removeClass("waiting-for-deletion"),M.a.showTemporaryNotification("error deleting note")})},e.prototype.deleteHighlight=function(e,t){e.addClass("waiting-for-deletion"),I.a.removeHighlight(parseInt(t)).then(function(n){if(!n)return e.removeClass("waiting-for-deletion"),void M.a.showTemporaryNotification("error deleting highlight");e.remove(),T.a.unwrapIntoParent($(".highlight-"+t))}).catch(function(t){e.removeClass("waiting-for-deletion"),M.a.showTemporaryNotification("error deleting highlight")})},e}()),_='\n<li class="item text-addon-item {{#isBookmark}}bookmark-item{{/isBookmark}} {{#isNote}}note-item{{/isNote}} {{#isHighlight}}highlight-item{{/isHighlight}}" data-id="{{id}}">\n<i class="fa {{#isBookmark}}fa-bookmark-o{{/isBookmark}} {{#isNote}}fa-pencil-square-o{{/isNote}} {{#isHighlight}}highlight-icon-font icon-highlighter-full{{/isHighlight}} text-addon-icon {{highlightColor}}" title="{{#isBookmark}}bookmark{{/isBookmark}}{{#isNote}}note{{/isNote}}{{#isHighlight}}highlight{{/isHighlight}} "/>\n<a href="{{link}}" class="text-addon-item-link" contentItemID="{{contentItemID}}" bookElementShortName="{{bookElementShortName}}" meapVersion="{{meapVersion}}">\n    <span class="livetimestamp">{{timeStamp}} ago in</span> <span class="book-element-short-name">{{bookElementTitle}}</span>\n    {{#isMeap}}<span class="meap-label">MEAP v{{meapVersion}}</span>{{/isMeap}}\n    {{#isReview}}<span class="review-label">RW {{reviewVersion}}</span>{{/isReview}}\n    <div class="text-addon-item-content">{{#user}}<span class="text-addon-item-username-container">{{user}}: </span>{{/user}}<span class="text-addon-item-text">{{text}}</span></div>\n</a>\n{{#canDelete}}\n<i class="fa fa-trash-o delete-text-addon-icon" aria-hidden="true" title="delete {{#isBookmark}}bookmark{{/isBookmark}}{{#isNote}}note{{/isNote}}{{#isHighlight}}highlight{{/isHighlight}} "></i>\n{{/canDelete}}\n</li>',R=n(118),H=n(570),F=n(562),U=n(380),W=function(){function e(){var e=this;this.$bookResourcesButton=$(".book-resources-menu-button"),this.$bookResourcesMenu=$("#book-resources-menu"),this.slideMenu=new S.a(this.$bookResourcesButton,this.$bookResourcesMenu),$(document).on("requestBookResourceMenuOpen",function(){return e.open()})}return e.prototype.initialize=function(e,t){var n=this;e&&(this.currentBook=e,this.currentBookElement=t,this.currentBook&&this.currentBookElement&&(this.currentBook.manningId?F.a.bookResourcesService.then(function(e){Promise.all([e.getAccessibleResources(n.currentBook.shortName),U.a.getTokenLedgerItems(!0)]).then(function(e){var t=e&&e[0],o=e&&e[1];if(t){var i="",r=t.productUrls||[],a=t.meapVersions||[],s=t.reviewVersions||[];if(r=r.filter(function(e){return"FORUM"!=(e.type||"")}),n.currentBook){for(var l=function(e){if(e&&e.version>0){var t="MEAP V"+e.version;if(null==r.find(function(e){return e.linkText==t})){var i=n.tokenLedgerContains(o,n.currentBook.slug,e.version);r.push({linkText:t,url:k.a.getBookElementUrl(n.currentBook.slug,"chapter-1",e.version),isStarred:i,title:i?"contains owned content":""})}}},c=0,d=a;c<d.length;c++){l(d[c])}for(var u=function(e){if(e&&e.version>0){var t="REVIEW R"+e.version;if(null==r.find(function(e){return e.linkText==t})){var i=n.tokenLedgerContains(o,n.currentBook.slug,e.version);r.push({linkText:t,url:k.a.getBookElementUrl(n.currentBook.slug,"chapter-1",null,e.version),isStarred:i,title:i?"contains owned content":""})}}},h=0,p=s;h<p.length;h++){u(p[h])}}var m=t.downloads||[],g=t.restrictedDownloads||[];i+=Mustache.render(j,{label:"downloads",items:m.concat(g.filter(function(e){return e.url}))}),r&&r.length&&(i+=Mustache.render(j,{label:"links",items:r})),n.$bookResourcesMenu.find(".slide-in-menu-container").html(i)}})}).catch(function(e){console.log("Error when fetching book resources")}):$(".book-resources-menu-button").addClass("hidden")))},e.prototype.clean=function(){this.currentBook=null,this.currentBookElement,$(".book-resources-menu-button").removeClass("hidden")},e.prototype.open=function(){this.slideMenu&&this.slideMenu.openMenu()},e.prototype.close=function(){this.slideMenu&&this.slideMenu.closeMenu()},e.prototype.tokenLedgerContains=function(e,t,n){return null!=e&&0!=e.length&&null!=e.find(function(e){return null!=e.link&&-1!=e.link.indexOf("/"+t+"/")&&-1!=e.link.indexOf("/v-"+n)})},e}(),j='<label class="section-menu-header">{{label}}</label> \n<div class="book-resources-links-container">\n    {{#items}}\n        <a class="book-resource-link" href="{{url}}" target="_blank" title="{{title}}">\n            {{linkText}} {{#isStarred}}<i class="fa fa-star" aria-hidden="true"></i>{{/isStarred}}\n        </a>\n    {{/items}}\n</div>',J=new W,q=n(114),G=n(61),Y=(n(722),$(window),$(document)),V=new(function(){function e(){}return e.prototype.initialize=function(e,t){this.book=e,this.bookElement=t,this.adjustIFrames()},e.prototype.clean=function(){this.book=null,this.bookElement=null},e.prototype.adjustIFrames=function(){var e=this;$(".interactive-container iframe").each(function(t,n){var o=$(n),i=o.attr("data-src")||o.attr("src");(i||"").indexOf("webdesignplayground")&&o.closest(".interactive-container").addClass("web-design-playground"),o.attr("src",k.a.isAbsoluteUrl(i)?i:k.a.getInteractiveCodeUrl(e.book.shortName,i)),o.on("load",function(){return Y.trigger("textLayoutModified")}),o.iFrameResize([{checkOrigin:!1,autoResize:!0}])})},e}()),Z=n(535),K=n(348),X=n(668),Q=n(437),ee=n(567),te=n(534),ne=n(418),oe=n(427),ie=n(120),re=n(365),ae=n(111),se=n(533),le=n(417),ce=n(575),de=n(86),ue=n(438),he=n(70),pe=n(83),me=(n(538),n(579),n(726),n(728),n(3)),ge=new(function(){function e(){}return e.prototype.initialize=function(){this.getSource().then(function(e){return e.AudioManager.initialize()})},e.prototype.loadBookContent=function(e,t){this.getSource().then(function(n){return n.AudioManager.loadBookContent(e,t)})},e.prototype.clean=function(){this.sourcePromise&&this.sourcePromise.then(function(e){return e.AudioManager.clean()})},e.prototype.getSource=function(){return this.sourcePromise||(this.sourcePromise=me.a.importWebpackModuleWithRetry(this.constructSourcePromise)),this.sourcePromise},e.prototype.constructSourcePromise=function(){return n.e(12).then(n.bind(null,924))},e}()),fe=n(110),be=n(18),ke=n(112),ve=n(122),we=n(322),ye=n(328),xe=n(68),Ce=n(325),Ee=n(344),Te=(d=function(e,t){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Se=function(){return(Se=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},$e=function(e){function t(t){var n=e.call(this,t)||this;return n.handleAudioSelectionChange=n.handleAudioSelectionChange.bind(n),n.handleClick=n.handleClick.bind(n),n.state={isComboAudioSelected:!1,isEbookAudioSelected:!1},n}return Te(t,e),t.prototype.render=function(){var e=(this.props.productOfferings||[]).find(function(e){return e.isComboOffering()}),t=(this.props.productOfferings||[]).find(function(e){return e.isEBookOffering()}),n=this.props.isComboInCart||this.props.isEbookInCart;return we.createElement(we.Fragment,null,we.createElement("div",{className:Ce("add-to-cart",{"deal-of-the-day":!1})},this.props.canBeMinimized&&we.createElement("div",{className:"add-to-cart-close-button",title:"close",onClick:this.props.onCloseClick},we.createElement("i",{className:"fa fa-close","aria-hidden":"true"})),we.createElement("div",{className:Ce("add-to-cart-title-container")},we.createElement("h5",null,this.generateAddToCartTitleMessage())),e&&!this.props.userOwnsBook&&we.createElement("fieldset",{className:Ce("add-to-cart-choices-container add-to-cart-combo-container",{disabled:this.props.isComboInCart}),disabled:this.props.isComboInCart},this.props.userOwnsBook?this.generateAudioChoice(e):this.generateBuyContent(e),this.createAddToCartShowButton(e)),t&&we.createElement("fieldset",{className:Ce("add-to-cart-choices-container add-to-cart-ebook-container",{disabled:this.props.isEbookInCart},{collapsed:this.props.isComboInCart}),disabled:this.props.isEbookInCart},this.props.userOwnsBook?this.generateAudioChoice(t):this.generateBuyContent(t),this.createAddToCartShowButton(t)),we.createElement(Ee,{html:!0,effect:"solid"})),we.createElement("span",{className:Ce("add-to-cart-collapsed-icons-container",{"added-to-cart":n}),onClick:this.props.onMaxmizeClick},!n&&we.createElement("i",{className:"fa fa-plus","aria-hidden":"true"}),we.createElement("i",{className:"fa fa-shopping-cart","aria-hidden":"true"})))},t.prototype.createAddToCartShowButton=function(e){var t=this,n=e.isComboOffering()?this.props.isComboInCart:this.props.isEbookInCart;return we.createElement("div",{className:Ce("add-to-cart-add-show-button",{"added-to-cart":n,disabled:this.props.userOwnsBook&&!(e.isComboOffering()?this.state.isComboAudioSelected:this.state.isEbookAudioSelected)}),onClick:function(n){return t.handleClick(e)}},this.generateButtonMessage(e))},t.prototype.generateButtonMessage=function(e){if(e.isComboOffering()){if(this.props.isEbookInCart){var t=this.getPriceDifferenceBetweenPbookAndEbook();return this.props.isComboInCart||0==t?"checkout":"get print book for $"+L.a.formatMoney(t)+" more"}return this.props.isComboInCart?"checkout":"add print book to cart"}return this.props.isEbookInCart?"checkout":this.props.userOwnsBook&&!this.props.userOwnsAudio?"upgrade":"add eBook to cart"},t.prototype.getPriceDifferenceBetweenPbookAndEbook=function(){var e=this.props.productOfferings.find(function(e){return e.isComboOffering()}),t=this.props.productOfferings.find(function(e){return e.isEBookOffering()});return null!=e&&null!=t?e.price-t.price:0},t.prototype.handleClick=function(e){var t=e.isComboOffering()?this.state.isComboAudioSelected:this.state.isEbookAudioSelected;this.props.userOwnsBook&&!this.props.userOwnsAudio&&(t=!0),this.props.onAddShowClick&&this.props.onAddShowClick(e,t)},t.prototype.generateAddToCartTitleMessage=function(){var e=f.a.cleanBookTitle(this.props.productTitle,!0);return this.props.isEbookInCart?we.createElement("span",{className:"add-to-cart-product-title"},e):we.createElement(we.Fragment,null,this.props.userOwnsBook?"upgrade":"buy"," ",we.createElement("span",{className:"add-to-cart-product-title"},e))},t.prototype.generateBuyContent=function(e){return we.createElement("div",null,this.generateBuyProductOfferingContent(e),this.generateAudioChoice(e))},t.prototype.generateBuyProductOfferingContent=function(e){return we.createElement("div",{className:"add-to-cart-choices-title-container"},we.createElement("span",{className:"add-to-cart-content-title",style:{float:"left"}},e.isComboOffering()?we.createElement("span",null," print book "):we.createElement("span",null," eBook "),we.createElement("i",{className:"fa fa-info-circle","data-place":"left","aria-hidden":"true","data-tip":this.generateTooltipMessage(e.isComboOffering())})),we.createElement("span",{className:"add-to-cart-content-book-price",style:{float:"right"}},e.unitAmountDiscounted>0?we.createElement(we.Fragment,null,we.createElement("span",{className:"add-to-cart-content-list-book-price"},"$",L.a.formatMoney(e.price)),we.createElement("span",{className:"add-to-cart-content-book-price-with-discount"},"$",L.a.formatMoney(e.price-e.unitAmountDiscounted))):we.createElement("span",null,"$",L.a.formatMoney(e.price))),we.createElement("div",{className:"add-to-cart-content-subtitle",style:{clear:"both"}},e.isComboOffering()?we.createElement(we.Fragment,null,we.createElement("span",{"data-tip":this.generatePBookMessageHTMLString()},"pBook")," + ",we.createElement("span",{"data-tip":this.generateEBookMessageHTMLString()},"eBook")," + ",we.createElement("span",{"data-tip":this.generateLiveBookMessageHTMLString()},"liveBook")):we.createElement(we.Fragment,null,we.createElement("span",{"data-tip":this.generatePdfMessageHTMLString()},"pdf")," + ",we.createElement("span",{"data-tip":this.generateEpubMessageHTMLString()},"ePub")," + ",we.createElement("span",{"data-tip":this.generateKindleMessageHTMLString()},"kindle")," + ",we.createElement("span",{"data-tip":this.generateLiveBookMessageHTMLString()},"liveBook"))))},t.prototype.generateTooltipMessage=function(e){return e?"<div>\n                        "+this.generatePBookMessageHTMLString()+" \n                        "+this.generateEBookMessageHTMLString()+" \n                        "+this.generateLiveBookMessageHTMLString()+"\n                    </div>":"<div>\n                        "+this.generatePdfMessageHTMLString()+"\n                        "+this.generateEpubMessageHTMLString()+"\n                        "+this.generateKindleMessageHTMLString()+"\n                        "+this.generateLiveBookMessageHTMLString()+"\n                    </div>"},t.prototype.generatePBookMessageHTMLString=function(){return"<div><strong><i>pBook</i></strong> - Print book </div>"},t.prototype.generateEBookMessageHTMLString=function(){return"<div><strong><i>eBook</i></strong> - Electronic Book (includes kindle, epub, pdf, and liveBook formats) </div>"},t.prototype.generateLiveBookMessageHTMLString=function(){return"<div><strong><i>liveBook</i></strong> - liveBooks are enchanced eBooks accessible from any browser. liveBook access is free with any purchase.</div>"},t.prototype.generatePdfMessageHTMLString=function(){return"<div><strong><i>pdf</i></strong> - A digital file containing a drm free copy of your book.</div>"},t.prototype.generateEpubMessageHTMLString=function(){return"<div><strong><i>epub</i></strong> - The EPUB is the most popular format for digital books. You can read EPUB files on your smartphone, tablet, eReader, or computer.</div>"},t.prototype.generateKindleMessageHTMLString=function(){return"<div><strong><i>kindle</i></strong> - The kindle format enables reading on eReaders such as the Amazon Kindle.</div>"},t.prototype.generateAudioChoice=function(e){var t=this;if(!Ae.hasAudioOffering())return null;var n=e.isComboOffering()?this.state.isComboAudioSelected:this.state.isEbookAudioSelected,o=e.isComboOffering()?this.props.isComboInCart:this.props.isEbookInCart;return o&&!n?null:we.createElement("div",{className:Ce("add-to-cart-choice-container",{active:n,"add-to-cart-audio-upgrade-only-container":!o&&this.props.userOwnsBook})},we.createElement("label",{className:"add-to-cart-choice-check-container"},o||this.props.userOwnsBook?null:we.createElement("input",{type:"checkbox",checked:n,onChange:function(n){return t.handleAudioSelectionChange(n,e)}}),o?" audio":" with audio "),we.createElement("label",{className:"add-to-cart-choice-price-container"},"$",Ae.getAudioPrice()))},t.prototype.handleAudioSelectionChange=function(e,t){t.isComboOffering()?this.setState(Se({},this.state,{isComboAudioSelected:e.currentTarget.checked})):this.setState(Se({},this.state,{isEbookAudioSelected:e.currentTarget.checked}))},t}(we.Component),Pe=n(116),Me=n(16),Be=$(document),Ie=$(window),Ne=Ie.width(),Ae=new(function(){function e(){var e=this;this.$addToCartBox=$("#add-to-cart-box"),this.$addToCartStripe=$("#add-to-cart-stripe"),this.$addToCartStripeMessage=this.$addToCartStripe.find(".add-to-cart-stripe-message"),this.$addToCartStripeCloseIcon=this.$addToCartStripe.find(".close-icon"),this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this),this.handleStripeCloseToggleClick=this.handleStripeCloseToggleClick.bind(this),this.handleStripeClick=this.handleStripeClick.bind(this),this.handleCloseClick=this.handleCloseClick.bind(this),this.handleMaximizeClick=this.handleMaximizeClick.bind(this),this.handleAddShowClick=this.handleAddShowClick.bind(this),this.textSlideMenuBeginOpening=this.textSlideMenuBeginOpening.bind(this),this.handleSlideMenuClosed=this.handleSlideMenuClosed.bind(this),Be.on("bookSpendingInfoArrived shoppingCartItemsChanged",function(){return e.renderForCurrentBook()}),Be.on("slideMenuStartOpening",this.textSlideMenuBeginOpening),Be.on("slideMenuClosed",this.handleSlideMenuClosed)}return e.prototype.initialize=function(e){var t=this;this.book=e,this.addToCartShouldBeShown=!1,this.book&&(this.book.userOwnsBook&&this.book.userOwnsAudio||(Promise.all([xe.a.getProductOfferings(e),xe.a.getProductDiscounts(e,Pe.a.getNewUserDiscountCode()),xe.a.initializeShoppingCartStore()]).then(function(n){var o=n[0],i=n[1];t.productOfferings=o,t.productOfferings&&t.productOfferings.length&&(e.newerEditionId||(!e.userOwnsBook||t.hasAudioOffering()&&t.shouldOfferAudioPurchaseToBookOwner())&&(t.associateProductOfferingsWithDiscounts(o,i),Ie.on("resizestart",t.handleResizeStart),Ie.on("resizestop",t.handleResizeStop),t.$addToCartStripeCloseIcon.on("click",t.handleStripeCloseToggleClick),t.$addToCartStripe.on("click",t.handleStripeClick),t.addToCartShouldBeShown=!0,t.renderForCurrentBook(),t.minimizeMaximizeAddToCart(!1),null!=t.productOfferings.find(function(e){return e.discountCode})&&t.$addToCartBox.addClass("cart-glow")))}),xe.a.getProductSpendingInfo(e)))},e.prototype.associateProductOfferingsWithDiscounts=function(e,t){if(t&&e&&e.length)try{for(var n in t){var o=function(o){var i=e.find(function(e){return+e.id==+o});i&&(i.discountCode=n,i.unitAmountDiscounted=t[n][o])};for(var i in t[n])o(i)}}catch(e){}},e.prototype.renderForCurrentBook=function(){this.book&&this.addToCartShouldBeShown&&(this.canBoxFit()?(this.$addToCartStripe.addClass("disappear"),this.renderAddToCartBox()):this.showAddToCartStripe())},e.prototype.clean=function(){this.book=null,this.addToCartShouldBeShown=!1,this.$addToCartBox.removeClass("cart-glow"),this.cleanAddToCartBox(),this.cleanStripe(),this.productOfferings=null,Ie.off("resizestart",this.handleResizeStart),Ie.off("resizestop",this.handleResizeStop),this.$addToCartBox.removeClass("collapsed"),this.$addToCartStripeCloseIcon.off("click",this.handleStripeCloseToggleClick),this.$addToCartStripe.off("click",this.handleStripeClick)},e.prototype.openCartMenu=function(){xe.a.requestMenuOpen()},e.prototype.renderAddToCartBox=function(){if(this.$addToCartBox[0]){this.$addToCartBox.css("top","135px");var e=xe.a.isEbookInShoppingCart(this.book),t=xe.a.isComboInShoppingCart(this.book),n=xe.a.isAudioInShoppingCart(this.book);this.$addToCartBox.toggleClass("can-add-to-cart",!(e||t)),this.$addToCartBox.toggleClass("can-view-in-cart",e||t),ye.render(we.createElement($e,{userOwnsBook:this.book.userOwnsBook,userOwnsAudio:this.book.userOwnsAudio,productOfferings:this.productOfferings,productTitle:f.a.cleanBookTitle(this.book.title),isEbookInCart:e,isComboInCart:t,isAudioInCart:n,canBeMinimized:this.canAddToCartBeMinimized(),onAddShowClick:this.handleAddShowClick,onCloseClick:this.handleCloseClick,onMaxmizeClick:this.handleMaximizeClick,isMeap:this.book.isMeap}),this.$addToCartBox[0])}},e.prototype.canAddToCartBeMinimized=function(){return!(!this.book.userOwnsBook||!this.hasAudioOffering()||this.book.userOwnsAudio)||!!(this.book.spendingInfo&&this.book.spendingInfo.spentDollarAmount>0)},e.prototype.cleanAddToCartBox=function(){this.$addToCartBox[0]&&ye.unmountComponentAtNode(this.$addToCartBox[0])},e.prototype.showAddToCartStripe=function(){this.$addToCartStripe.removeClass("disappear"),xe.a.isEbookInShoppingCart(this.book)?(this.$addToCartStripe.addClass("added-to-cart"),this.$addToCartStripeMessage.text("view in cart")):(this.$addToCartStripe.removeClass("added-to-cart"),this.$addToCartStripeMessage.html(this.book.userOwnsBook?"upgrade with audio for $"+this.getAudioPrice():this.getAddToCartMessage())),this.$addToCartStripe.addClass("collapsed")},e.prototype.cleanStripe=function(){this.$addToCartStripe.addClass("disappear").removeClass("collapsed")},e.prototype.textSlideMenuBeginOpening=function(e,t,n){this.canBoxFit()?this.canBoxFit(n)||this.$addToCartBox.addClass("collapsed"):this.book&&this.addToCartShouldBeShown?this.showAddToCartStripe():this.hideAddToCart()},e.prototype.handleSlideMenuClosed=function(){this.showAddToCart()},e.prototype.handleCloseClick=function(){this.$addToCartBox.is(".collapsed")||(this.cleanAddToCartBox(),this.cleanStripe())},e.prototype.minimizeMaximizeAddToCart=function(e){e?this.$addToCartBox.removeClass("collapsed"):this.$addToCartBox.addClass("collapsed")},e.prototype.handleMaximizeClick=function(){this.maximizeAddToCartBoxIfNecessary()},e.prototype.handleAddShowClick=function(e,t){this.maximizeAddToCartBoxIfNecessary()||this.book.userOwnsBook&&!t||(e.isEBookOffering()&&xe.a.isEbookInShoppingCart(this.book)||e.isComboOffering()&&xe.a.isComboInShoppingCart(this.book)?this.openCartMenu():xe.a.requestAddBookToCart(this.book,t,this.getDiscountCode(e),!1,e.isComboOffering()))},e.prototype.maximizeAddToCartBoxIfNecessary=function(){var e=this;return!!this.$addToCartBox.is(".collapsed")&&(0==b.a.getCurrentMainContentTranslateX()?this.minimizeMaximizeAddToCart(!0):($(document).trigger("slideMenuCloseRequested"),m.a.setTimeout(function(){e.minimizeMaximizeAddToCart(!0)},300)),!0)},e.prototype.handleResizeStart=function(){Ne!=Ie.width()&&this.hideAddToCart(),Ne=Ie.width()},e.prototype.handleResizeStop=function(){this.showAddToCart(),Ne=Ie.width()},e.prototype.hideAddToCart=function(){this.$addToCartBox.css({display:"none"}),this.cleanAddToCartBox(),this.cleanStripe()},e.prototype.showAddToCart=function(){this.$addToCartBox.css({display:"block"}),this.canBoxFit()&&this.$addToCartBox.removeClass("collapsed"),this.renderForCurrentBook()},e.prototype.handleStripeCloseToggleClick=function(){this.$addToCartStripe.is(".collapsed")?this.$addToCartStripe.removeClass("collapsed"):this.$addToCartStripe.addClass("collapsed")},e.prototype.handleStripeClick=function(e){e.target!==this.$addToCartStripeCloseIcon[0]&&(xe.a.isEbookInShoppingCart(this.book)?xe.a.requestMenuOpen():this.$addToCartStripe.is(".collapsed")?this.$addToCartStripe.removeClass("collapsed"):(xe.a.requestAddBookToCart(this.book,this.hasAudioOffering(),this.getDiscountCode(this.getEBookOffering())),this.renderForCurrentBook()))},e.prototype.getAddToCartMessage=function(){var e='<strong style="text-decoration: underline;">add</strong> to cart for '+this.getPriceMessageHTML()+" ";return this.book.spendingInfo&&this.book.spendingInfo.spentDollarAmount||(e+='<em class="add-to-cart-formats-message">(pdf + ePub + kindle + liveBook '+(this.hasAudioOffering()?" + audio":"")+")</em>"),e},e.prototype.getPriceMessageHTML=function(){var e=this.getEBookOffering(),t=this.getAudioOffering(),n="<span>",o=(e&&e.price||0)+(t&&t.price||0),i=(e&&e.unitAmountDiscounted||0)+(t&&t.unitAmountDiscounted||0);return n+=i>0?'<span class="add-to-cart-content-list-book-price">$'+L.a.formatMoney(o)+'</span>\n                          <span class="add-to-cart-content-book-price-with-discount"><strong>$'+L.a.formatMoney(o-i)+"</strong></span>":"<strong>$"+L.a.formatMoney(o)+"</strong>",n+="</span>"},e.prototype.canBoxFit=function(e){void 0===e&&(e=0);var t=$(document.querySelector(".readable-text"));if(0==t.length)return!1;var n=t.offset().left+t.width()+e-b.a.getComputedTranslateX($("#book-main-content-container")[0]),o=2.5*parseFloat(this.$addToCartBox.css("right"));return n+Math.max(this.$addToCartBox.width(),225)+o+110<Ie.width()},e.prototype.getAudioPrice=function(){var e=this.productOfferings;if(!e||!e.length)return 0;var t=e.find(function(e){return e.isAudioOffering()});return t?L.a.roundToTwoDecimalPoints(t.price):0},e.prototype.getEBookOffering=function(){return(this.productOfferings||[]).find(function(e){return e.isEBookOffering()})},e.prototype.getAudioOffering=function(){return this.productOfferings&&this.productOfferings.length?this.productOfferings.find(function(e){return e.isAudioOffering()}):null},e.prototype.hasAudioOffering=function(){return!!this.getAudioOffering()},e.prototype.getDiscountCode=function(e){return e?e.discountCode:""},e.prototype.requestOpenLogin=function(){xe.a.requestOpenLogin()},e.prototype.shouldOfferAudioPurchaseToBookOwner=function(){var e=this.getLastBookAccessTime();return(null==e||L.a.getDifferenceInDays(e,new Date)>14)&&(this.storeBookLastAccessTime(),!0)},e.prototype.getLastBookAccessTime=function(){try{var e=JSON.parse(Me.a.getItem("audio_access")||"{}");return e[this.book.shortName]?new Date(e[this.book.shortName]):null}catch(e){return null}},e.prototype.storeBookLastAccessTime=function(){try{var e=JSON.parse(Me.a.getItem("audio_access")||"{}");e[this.book.shortName]=Date.now(),Me.a.setItem("audio_access",JSON.stringify(e))}catch(e){}},e}()),ze=new(function(){function e(){this.shouldBeShownWhenAppropriate=!1,this.textSlideMenuBeginOpening=this.textSlideMenuBeginOpening.bind(this),this.textSlideMenuEndClosing=this.textSlideMenuEndClosing.bind(this),$(document).on("textSlideMenuBeginOpening slideMenuStartOpening",this.textSlideMenuBeginOpening).on("slideMenuClosed",this.textSlideMenuEndClosing)}return e.prototype.initialize=function(e){var t=this;this.book=e,xe.a.getNewestEditionProduct(e).then(function(n){null!=n&&n.newestEditionProduct&&n.newestEditionProduct.slug?(e.newerEditionId=n.newestEditionProduct.id,t.shouldBeShownWhenAppropriate=!0,t.renderNewestEditionNotification(e,n)):t.shouldBeShownWhenAppropriate=!1})},e.prototype.clean=function(){this.book=null,$("#newest-edition-box").css("display","none"),this.shouldBeShownWhenAppropriate=!1},e.prototype.renderNewestEditionNotification=function(e,t){if(!e.userOwnsBook){var n=$("#newest-edition-box");n.css("display","block"),n.find(".newest-edition-available-link").attr("href",k.a.getBookElementUrl(t.newestEditionProduct.slug,"")),n.find(".newest-edition-available-book-title").text(t.newestEditionProduct.title),n.find(".newest-edition-available-this-included").css("display",t.isCurrentProductTheFreeEdition?"block":"none")}},e.prototype.textSlideMenuBeginOpening=function(){$("#newest-edition-box").css("display","none")},e.prototype.textSlideMenuEndClosing=function(){null!=this.book&&!this.book.userOwnsBook&&this.shouldBeShownWhenAppropriate&&$("#newest-edition-box").css("display","block")},e}()),Le=n(440),Oe=n(124),De=n(13),_e=function(){function e(){this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this),this.handleCloseClick=this.handleCloseClick.bind(this),this.handleAddToCartClick=this.handleAddToCartClick.bind(this),this.handleCommandsWrapperClick=this.handleCommandsWrapperClick.bind(this)}return e.prototype.initialize=function(e){this.book=e,this.loadAndDisplayRelatedProducts(this.book.shortName),this.$freeEbooksUpsellRoot=$("#free-ebooks-upsell-root"),this.$carausel=this.$freeEbooksUpsellRoot.find(".free-ebooks-upsell-carausel")},e.prototype.clean=function(){this.book=null,this.$freeEbooksUpsellRoot&&this.$freeEbooksUpsellRoot.css("display","none"),this.$carausel&&this.$carausel.is(".slick-initialized")&&this.$carausel.slick("unslick"),this.unsubscribeFromEvents(),this.$carausel=null,this.$freeEbooksUpsellRoot=null,this.discountCode=""},e.prototype.handleResizeStart=function(){this.$freeEbooksUpsellRoot&&this.$freeEbooksUpsellRoot.css("display","none"),this.$carausel&&this.$carausel.is(".slick-initialized")&&this.$carausel.slick("unslick")},e.prototype.handleResizeStop=function(){var e=this;m.a.setTimeout(function(){e.$carausel&&e.$carausel.is(".slick-initialized")&&e.$carausel.slick("unslick"),e.$freeEbooksUpsellRoot&&e.$freeEbooksUpsellRoot.css("display","block"),e.slick()},100)},e.prototype.loadAndDisplayRelatedProducts=function(e){var t=this;Promise.all([me.a.loadSlickSliderCode(),h.a.getRelatedProducts(e)]).then(function(n){n[0];var o=n[1],i=Pe.a.getNewUserDiscountCode();t.discountCode=i,Pe.a.getNewUserProductDiscounts(o.map(function(e){return e.id}),i).then(function(n){t.book&&t.book.shortName==e&&t.fillCarausel(n,o)}).catch(function(n){t.book&&t.book.shortName==e&&t.fillCarausel([],o)})}).catch(function(e){console.log(e)})},e.prototype.fillCarausel=function(e,t){var n=this.generateCarauselHtml(e,t);if(!n)return this.$freeEbooksUpsellRoot.css("display","none"),void this.unsubscribeFromEvents();this.$freeEbooksUpsellRoot.css("display","block"),this.$carausel.is(".slick-initialized")&&this.$carausel.slick("unslick"),this.$carausel.html(n),null!=e&&e.length>0?b.a.replaceBookCoversOnImageLoad(this.$carausel,e.map(function(e){return k.a.getMarketplaceProductCoverUrl(e.imageUrl)}),!0):b.a.replaceBookCoversOnImageLoad(this.$carausel,t.map(function(e){return e.imageUrl}),!0),this.slick(),this.subscribeToEvents()},e.prototype.slick=function(){this.$freeEbooksUpsellRoot&&this.$freeEbooksUpsellRoot.find(".free-ebooks-upsell-carausel").slick($(window).width()<=970?He:Re)},e.prototype.generateCarauselHtml=function(e,t){return null!=e&&e.length>0?e.filter(function(e){return e.isLivebook}).map(function(e){var t=e.productOfferings.find(function(e){var t=(e.productType||"").toLowerCase();return"ebook"==t||"livebook"==t||"livevideo"==t});return null==t?"":Mustache.render(Fe,{externalId:e.externalId,imageUrl:k.a.getMarketplaceProductCoverUrl(e.imageUrl),price:null!=t?t.price:0,hasPrice:null!=t&&t.price>0,hasAdditionalCommands:!0,discountedPrice:null!=t?L.a.roundToTwoDecimalPoints(t.price-t.discount):0,productPath:k.a.getBookUrl(e.slug)})}).join(""):(t||[]).map(function(e){return Mustache.render(Fe,{externalId:e.externalId,productPath:e.link,imageUrl:e.imageUrl})}).join("")},e.prototype.subscribeToEvents=function(){$(window).on("resizestart",this.handleResizeStart).on("resizestop",this.handleResizeStop),this.$freeEbooksUpsellRoot.find(".free-ebooks-upsell-close").on("click",this.handleCloseClick),this.$freeEbooksUpsellRoot.on("click",".book-cover-add-to-cart-command",this.handleAddToCartClick),this.$freeEbooksUpsellRoot.on("click",".book-cover-commands-wrapper",this.handleCommandsWrapperClick)},e.prototype.unsubscribeFromEvents=function(){$(window).off("resizestart",this.handleResizeStart).off("resizestop",this.handleResizeStop),null!=this.$freeEbooksUpsellRoot&&(this.$freeEbooksUpsellRoot.find(".free-ebooks-upsell-close").off("click",this.handleCloseClick),this.$freeEbooksUpsellRoot.off("click",".book-cover-add-to-cart-command",this.handleAddToCartClick),this.$freeEbooksUpsellRoot.off("click",".book-cover-commands-wrapper",this.handleCommandsWrapperClick))},e.prototype.handleCloseClick=function(){this.$freeEbooksUpsellRoot.css("display","none"),this.clean()},e.prototype.handleAddToCartClick=function(e){var t=$(e.target).closest(".free-ebooks-upsell-carausel-item").attr("data-book-short-name");t&&($(document).trigger("addToCartFromFreeEbookUpsell",t),$(document).trigger("requestNotification","adding book to cart"),xe.a.requestAddBookToCartByBookShortName(t,this.discountCode).then(function(){$(document).trigger("hideNotification")}).catch(function(e){$(document).trigger("requestNotification","error adding book to cart")}))},e.prototype.handleCommandsWrapperClick=function(e){$(e.target).is(".book-cover-command-wrapper, .fa")||g.a.openLinkInNewTab($(e.target).attr("data-product-path"))},e}(),Re={arrows:!1,dots:!0,infinite:!1,rows:3,slidesToShow:2,slidesToScroll:2},He={dots:!1,infinite:!1,arrows:!0,slidesToShow:6,slidesToScroll:6,responsive:[{breakpoint:860,settings:{slidesToShow:6,slidesToScroll:6}},{breakpoint:600,settings:{slidesToShow:5,slidesToScroll:5}},{breakpoint:530,settings:{slidesToShow:4,slidesToScroll:4}},{breakpoint:400,settings:{slidesToShow:3,slidesToScroll:3}}]},Fe='<div class="free-ebooks-upsell-carausel-item book-cover-item" data-book-short-name="{{externalId}}">\n    <a href="{{productPath}}" target="_blank">\n        <img alt="book cover" class="book-cover" src="'+k.a.getLivebookCdn()+'assets/images/cover.png" data-src="{{imageUrl}}">\n    </a>\n    {{#hasPrice}}\n    <div class="carausel-price-container">\n        <span class="carausel-original-price-container">${{price}}</span>\n        <span class="carausel-discounted-price-container">${{discountedPrice}}</span>\n    </div>\n    {{/hasPrice}}\n    {{#hasAdditionalCommands}}\n        <div class="book-cover-commands-wrapper" data-product-path="{{productPath}}">\n            <div class="book-cover-command-wrapper" title="view product">\n                <a href="{{productPath}}" target="_blank" class="dont-propagate-click">\n                    <i class="fa fa-eye" aria-hidden="true"/>\n                </a>\n            </div>\n            <div class="book-cover-command-wrapper book-cover-add-to-cart-command dont-propagate-click" title="add to cart"><i class="fa fa-shopping-cart" aria-hidden="true"/></div>\n        </div>\n    {{/hasAdditionalCommands}}\n</div>',Ue=new _e,We=n(421),je=new(function(){function e(){var e=this;this.$dogEarsContainer=$(".dog-ears-container"),this.handleClick=this.handleClick.bind(this),this.handleMouseEnter=this.handleMouseEnter.bind(this),this.handleMouseLeave=this.handleMouseLeave.bind(this),this.$dogEarsContainer.on("click",this.handleClick),this.$dogEarsContainer.on("mouseenter",this.handleMouseEnter),this.$dogEarsContainer.on("mouseleave",this.handleMouseLeave),$(document).on("slideMenuStartOpening",function(t,n){null!=e.bookElement&&n.is("#settings-menu, #book-resources-menu, #text-addons-menu")&&e.$dogEarsContainer.addClass("hidden")}).on("slideMenuClosed",function(t){null!=e.bookElement&&e.$dogEarsContainer.removeClass("hidden")})}return e.prototype.initialize=function(e,t){this.$dogEarsContainer.removeClass("hidden"),this.book=e,this.bookElement=t,null!=this.getCurrentBookDogEarLink()?(this.$dogEarsContainer.addClass("dog-ears-active"),this.updateTooltip("go to marked location")):this.updateTooltip("mark location")},e.prototype.clean=function(){this.$dogEarsContainer.addClass("hidden").removeClass("dog-ears-active"),this.book=null,this.bookElement=null},e.prototype.handleClick=function(){if($(document).trigger("dogEarsClick"),this.$dogEarsContainer.toggleClass("dog-ears-active"),this.$dogEarsContainer.removeClass("dog-ears-mouse-over"),this.$dogEarsContainer.is(".dog-ears-active"))this.storeCurrentLocation(),this.updateTooltip("go to marked location");else{var e=this.getCurrentBookDogEarLink();if(null!=e){var t=null,n=e.link;if(-1!=n.indexOf(this.book.slug+"/")&&-1!=n.indexOf(this.bookElement.shortName+"/")){var o=n.lastIndexOf("/");if(-1!=o){var i=n.substr(o+1);try{(t=document.getElementById(i))&&ae.a.scrollToElement(t)}catch(e){}}}!t&&e&&g.a.openLink(n)}this.updateTooltip("mark location"),this.clearCurrentBookLocation()}},e.prototype.handleMouseEnter=function(){this.$dogEarsContainer.addClass("dog-ears-mouse-over")},e.prototype.handleMouseLeave=function(){this.$dogEarsContainer.removeClass("dog-ears-mouse-over")},e.prototype.storeCurrentLocation=function(){try{var e=re.a.getTopMostReadableElement();if(null==e||!e.length)return;var t=JSON.parse(Me.a.getItem("DOG_EARS")||"{}");t[this.book.shortName]={link:g.a.formLink(this.book,this.bookElement,e.attr("refid")),book:this.book.cleanTitle,bookElement:De.a.beautifyBookElementShortName(this.bookElement.shortName)},Me.a.setItem("DOG_EARS",JSON.stringify(t))}catch(e){console.log(e)}},e.prototype.getCurrentBookDogEarLink=function(){try{return JSON.parse(Me.a.getItem("DOG_EARS")||"{}")[this.book.shortName]}catch(e){return console.log(e),null}},e.prototype.clearCurrentBookLocation=function(){try{var e=re.a.getTopMostReadableElement();if(null==e||!e.length)return;var t=JSON.parse(Me.a.getItem("DOG_EARS")||"{}");delete t[this.book.shortName],Me.a.setItem("DOG_EARS",JSON.stringify(t))}catch(e){console.log(e)}},e.prototype.updateTooltip=function(e){this.$dogEarsContainer.attr("title",e)},e}()),Je=n(539),qe=n.n(Je),Ge=n(9),Ye=function(){function e(){}return e.logReading=function(e,t,n,o,i,r,a,s){return new Promise(function(l,c){"visible"==qe.a.state()&&(Ge.a.get("position-and-reading-info-disabled")||k.a.postToOurBackend(k.a.getAbsoluteUrl("api/events/view"),function(e){return l(!0)},function(e){l({})},{bookShortName:e,element:t,elementPosition:n,userOwnsBook:o,meapVersion:i,manningId:r,sessionId:a,readLogIntervalDuration:s},!1,!0,!1,!1))})},e}(),Ve=n(593),Ze=n.n(Ve),Ke=n(730),Xe=new(function(){function e(){this.readLoggingInterval=3e4,this.inactivityInterval=3e5,this.logReading=this.logReading.bind(this),this.handleOnActive=this.handleOnActive.bind(this),this.handleOnIdle=this.handleOnIdle.bind(this)}return e.prototype.initialize=function(e,t){var n=!this.book&&null!=e||null!=e&&null!=this.book&&this.book.shortName!=e.shortName;this.book=e,this.bookElement=t,clearTimeout(this.bookReadLogTimer),n&&(this.sessionId=Ze()(),this.isLoggingEnabled="visible"==qe.a.state(),this.logReading(),null!=this.idleTimer&&(this.idleTimer.destroy(),this.idleTimer=null),this.idleTimer=Ke({callback:this.handleOnIdle,activeCallback:this.handleOnActive,idleTime:this.inactivityInterval}))},e.prototype.clean=function(){this.book=null,this.bookElement=null,this.sessionId=null,clearTimeout(this.bookReadLogTimer),null!=this.idleTimer&&(this.idleTimer.destroy(),this.idleTimer=null)},e.prototype.logReading=function(){if(null!=this.book&&null!=this.bookElement){if(this.isLoggingEnabled){var e=re.a.getTopMostReadableElement(),t=null!=e&&e.attr("refid")||"1";Ye.logReading(this.book.shortName,this.bookElement.shortName,t,this.book.userOwnsBook,this.bookElement.meapVersion,this.book.manningId,this.sessionId,this.readLoggingInterval)}this.bookReadLogTimer=m.a.setTimeout(this.logReading,this.readLoggingInterval)}},e.prototype.handleOnIdle=function(){this.isLoggingEnabled=!1},e.prototype.handleOnActive=function(){this.isLoggingEnabled=!0},e}()),Qe=n(420),et=n(378),tt=new(function(){function e(){this.productTermsCacheMap={},this.libraryTermsCacheMap={},this.productTermCacheMap={}}return e.prototype.deleteRelatedTerm=function(e,t,n){return new Promise(function(o,i){k.a.getFromOurBackend(k.a.getAbsoluteUrl("knowledgeGraph/deleteRelatedTerm"),function(){return o()},function(){return i()},{baseTerm:e,relatedTerm:t,externalId:n},!1)})},e.prototype.deletePrecedingTerm=function(e,t,n){return new Promise(function(o,i){k.a.getFromOurBackend(k.a.getAbsoluteUrl("knowledgeGraph/deletePrecedingTerm"),function(){return o()},function(){return i()},{baseTerm:e,precedingTerm:t,externalId:n},!1)})},e.prototype.deleteSucceedingTerm=function(e,t,n){return new Promise(function(o,i){k.a.getFromOurBackend(k.a.getAbsoluteUrl("knowledgeGraph/deleteSucceedingTerm"),function(){return o()},function(){return i()},{baseTerm:e,succeedingTerm:t,externalId:n},!1)})},e.prototype.deleteTermContent=function(e,t,n){return new Promise(function(o,i){k.a.getFromOurBackend(k.a.getAbsoluteUrl("knowledgeGraph/deleteTermContent"),function(e){return o()},function(e){return i()},{term:e,externalId:t,rangeLocation:n},!1)})},e.prototype.deleteTermFromParagraph=function(e,t,n,o){return new Promise(function(i,r){k.a.getFromOurBackend(k.a.getAbsoluteUrl("knowledgeGraph/deleteTermOccurrenceInText"),function(e){return i()},function(e){return r()},{term:e,externalId:t,element:n,textId:o},!1)})},e.prototype.deleteTermFromProduct=function(e,t,n){return new Promise(function(o,i){k.a.getFromOurBackend(k.a.getAbsoluteUrl("knowledgeGraph/deleteProductTerm"),function(e){return o()},function(e){return i()},{term:e,externalId:t,libraryTerm:n},!1)})},e.prototype.fillContentRanges=function(e,t){var n=this,o=this.getUniqueLocationsWithoutHtml(t);return 0==o.length?Promise.resolve(t):new Promise(function(i,r){n.getLocationsHtmlAndTitles(e,o).then(function(e){n.fillLocationsWithHtmlAndTitles(t,e),i(t)}).catch(function(e){r(e)})})},e.prototype.getLocationsHtmlAndTitles=function(e,t){return new Promise(function(n,o){k.a.getFromOurBackend(k.a.getAbsoluteUrl("knowledgeGraph/getLocationsHtmlAndTitles"),function(e){return n(e)},function(e){return n({})},{locations:t.join(","),externalId:e})})},e.prototype.fillLocationsWithHtmlAndTitles=function(e,t){for(var n=0,o=e.content;n<o.length;n++)for(var i=0,r=o[n].range;i<r.length;i++){var a=r[i];!a.html&&t[a.location]&&(a.html=(t[a.location].content||"").replace(/\{\{BOOK_ROOT_FOLDER\}\}/g,k.a.getAwsPublic()),a.title=t[a.location].title||"")}},e.prototype.getUniqueLocationsWithoutHtml=function(e){for(var t=[],n={},o=0,i=e.content;o<i.length;o++)for(var r=0,a=i[o].range;r<a.length;r++){var s=a[r];n[s.location]||s.html||(n[s.location]=!0,t.push(s.location))}return t},e.prototype.getProductTerms=function(e,t){var n=this;return this.productTermsCacheMap[e]?this.productTermsCacheMap[e]:this.productTermsCacheMap[e]=new Promise(function(o,i){t?k.a.getFromOurBackend(k.a.getAbsoluteUrl("knowledgeGraph/getProductTerms"),function(e){o(n.convertToProductTermMap(n.convertRawProductTerms(e)))},function(t){delete n.productTermsCacheMap[e],o({})},{externalId:e}):$.ajax({url:k.a.getAwsUrl("/"+e+"/productTerms.json"),dataType:"json"}).then(function(e){o(n.convertToProductTermMap(n.convertRawProductTerms(e)))}).fail(function(t){delete n.productTermsCacheMap[e],o({})})})},e.prototype.getProductElementSummary=function(e,t,n){var o=this;return new Promise(function(i,r){n?k.a.getFromOurBackend(k.a.getAbsoluteUrl("knowledgeGraph/getProductElementSummary"),function(e){i(o.convertToProductElementSummaryMap(e))},function(t){delete o.productTermsCacheMap[e],i({})},{externalId:e,element:t}):$.ajax({url:k.a.getAwsUrl("/"+e+"/ElementSummaries/"+t+".json"),dataType:"json"}).then(function(e){i(o.convertToProductElementSummaryMap(e))}).fail(function(t){delete o.productTermsCacheMap[e],i({})})})},e.prototype.getLibraryTerm=function(e){var t=this;return this.libraryTermsCacheMap[e]?this.libraryTermsCacheMap[e]:this.libraryTermsCacheMap[e]=new Promise(function(n,o){k.a.getFromOurBackend(k.a.getAbsoluteUrl("knowledgeGraph/getLibraryTerm"),function(e){n({libraryTermEntries:e.document,term:e.term})},function(o){delete t.libraryTermsCacheMap[e],n({term:e,libraryTermEntries:[]})},{term:e})})},e.prototype.getProductTerm=function(e,t){var n=this,o=e+"-"+t;return null!=this.productTermCacheMap[o]?this.productTermCacheMap[o]:this.productTermCacheMap[o]=new Promise(function(i,r){k.a.getFromOurBackend(k.a.getAbsoluteUrl("knowledgeGraph/getProductTerm"),function(e){i(n.convertRawProductTerm(e))},function(e){delete n.productTermCacheMap[o],r(e)},{term:t,externalId:e})})},e.prototype.convertToProductElementSummaryMap=function(e){var t=this,n={};if(null==e||null==e.document||null==e.document.paragraphSummaries)return n;for(var o=0,i=e.document.paragraphSummaries;o<i.length;o++){var r=i[o];n[r.o]=(r.t||[]).map(function(e){return t.convertRawParagraphSummary(e)})}return n},e.prototype.convertRawParagraphSummary=function(e){return{term:e.t,relativeWeight:e.rw,absoluteWeight:e.aw,keywords:e.k}},e.prototype.convertToProductTermMap=function(e){for(var t={},n=0,o=e;n<o.length;n++){var i=o[n];t[i.term]=i}return t},e.prototype.convertRawProductTerms=function(e){var t=this;return null==e||0==e.length?[]:e.map(function(e){return t.convertRawProductTerm(e)})},e.prototype.convertRawProductTerm=function(e){return{term:e.term,keywords:e.document.k||[],content:this.convertRawProductTermContentItems(e.document.c),precedingTerms:this.convertRawProductTermRelatedTerms(e.document.pt),relatedTerms:this.convertRawProductTermRelatedTerms(e.document.rt),succeedingTerms:this.convertRawProductTermRelatedTerms(e.document.st)}},e.prototype.convertRawProductTermContentItems=function(e){var t=this;return null==e||0==e.length?[]:e.map(function(e){return t.convertRawProductTermContent(e)})},e.prototype.convertRawProductTermContent=function(e){return{type:e.t,range:this.convertRawProductTermRanges(e.r)}},e.prototype.convertRawProductTermRanges=function(e){var t=this;if(null==e||0==e.length)return[];var n=e.map(function(e){return t.convertRawProductTermRange(e)});return n.length>0&&(n[n.length-1].isLast=!0),n},e.prototype.convertRawProductTermRange=function(e){return{location:e.l,link:e.l,weight:e.w}},e.prototype.convertRawProductTermRelatedTerms=function(e){var t=this;return null==e||0==e.length?[]:e.map(function(e){return t.convertRawProductTermRelatedTerm(e)})},e.prototype.convertRawProductTermRelatedTerm=function(e){return{term:e.t,displayedTerm:e.t,weight:e.w}},e}()),nt=function(){function e(){this.viewTermActions=[],this.$indexedTermsSideMenu=$("#indexed-terms-slide-menu")}return e.prototype.initialize=function(e,t){var n=this;null!=e&&e.hasKnowledgeGraph&&(e.isKnowledgeGraphAccessible||e.userIsEditor)&&(this.book=e,this.bookElement=t,this.isEditor=this.book.userIsEditor,Promise.all([tt.getProductTerms(e.shortName,this.isAdmin||this.isEditor),tt.getProductElementSummary(e.shortName,t.shortName,this.isAdmin||this.isEditor)]).then(function(e){n.bookTermMap=e[0],n.bookElementSummary=e[1],n.initializeSideMenuIfNecessary(),n.renderBookElementTerms(),n.haveEventsBeenInitialized||n.initializeEvents()}).catch(function(e){console.log(e)}))},e.prototype.initializeEvents=function(){var e=this;$(document).on("click",".inline-indexed-term",function(t){var n=$(t.currentTarget),o=n.attr("data-original-term")||n.text();t.altKey&&(e.isAdmin||e.isEditor)?confirm('Delete "'+o+'" from this paragraph?')&&e.deleteTermFromParagraph(o,n.closest("[refid]").attr("refid"),n):(e.viewTermActions=[],e.openTerm(o,e.book.shortName,e.book.title),$(document).trigger("indexedTerms",["inlineIndexedTermClick",o,e.book.shortName]))}),$(document).on("click",".term-viewer-other-product",function(t){var n=$(t.currentTarget),o=n.attr("data-term"),i=n.attr("data-external-id");e.openTerm(o,i,n.find("img").attr("alt")),$(document).trigger("indexedTerms",["indexedTermOtherProduct",o,i])}),$(document).on("click",".term-viewer-root .term-viewer-header .fa-close",function(){e.sideMenu.close()}),$(document).on("click",".term-viewer-related-term",function(t){var n=$(t.currentTarget).attr("data-term"),o=e.$indexedTermsSideMenu.find(".term-viewer-current-product").attr("data-external-id");e.openTerm(n,o,e.$indexedTermsSideMenu.find(".term-viewer-current-product").text()),$(document).trigger("indexedTerms",["indexedTermRelatedTerm",n,o])}),$(document).on("click",".term-viewer-see-more-link",function(t){var n=e.$indexedTermsSideMenu.find(".term-viewer-current-product").attr("data-external-id"),o=e.$indexedTermsSideMenu.find(".term-viewer-header .term-viewer-term").text();$(document).trigger("indexedTerms",["seeMore",o,n])}),$(document).on("click",".term-viewer-related-term-delete",function(t){t.stopImmediatePropagation(),t.stopPropagation();var n=$(t.target).closest(".term-viewer-related-term"),o=n.attr("data-term"),i=e.$indexedTermsSideMenu.find(".term-viewer-current-product").attr("data-external-id"),r=e.$indexedTermsSideMenu.find(".term-viewer-header .term-viewer-term").text(),a=e.$indexedTermsSideMenu.find(".term-viewer-current-product").text();n.is(".preceding-term")?confirm('Delete "'+o+'" as a preceding term of "'+r+" in "+a+'"')&&e.deletePrecedingTerm(r,o,i,n):n.is(".succeeding-term")?confirm('Delete "'+o+'" as a succeeding term of "'+r+" in "+a+'"')&&e.deleteSucceedingTerm(r,o,i,n):confirm('Delete "'+o+'" as a related term of "'+r+" in "+a+'"')&&e.deleteRelatedTerm(r,o,i,n)}),$(document).on("click",".term-viewer-delete-term",function(t){var n=$(t.target),o=n.closest(".term-viewer-header").find(".term-viewer-term"),i=n.closest(".term-viewer-header").find(".term-viewer-current-product"),r=o.text(),a=i.attr("data-external-id"),s=i.text();if(confirm('Delete "'+r+'" from '+s)){var l=r;e.bookTermMap[r]&&e.bookTermMap[r].keywords&&(l=e.bookTermMap[r].keywords.join(" ")),e.deleteTermFromProduct(r,a,l)}}),$(document).on("click",".term-viewer-delete-range",function(t){var n=$(t.target),o=n.closest(".term-viewer-root").find(".term-viewer-header .term-viewer-term").text(),i=n.closest(".term-viewer-root").find(".term-viewer-current-product").attr("data-external-id"),r=n.attr("data-range-location");e.deleteTermContent(o,i,r,n)}),$(document).on("click",".term-viewer-back-arrow",function(t){if(!(null==e.viewTermActions||e.viewTermActions.length<=1)){e.viewTermActions.pop();var n=e.viewTermActions.pop();e.openTerm(n.term,n.externalId,n.title)}}),$(document).on("paragraphsUnlocked",function(t,n){for(var o=0,i=n;o<i.length;o++){var r=i[o];e.renderTermsInPargraph(r)}}),z.a.isUserAdmin().then(function(t){return e.isAdmin=t}),this.haveEventsBeenInitialized=!0},e.prototype.clean=function(){this.book=null,this.bookElement=null,this.bookTermMap=null,this.bookElementSummary=null,this.isEditor=!1},e.prototype.initializeSideMenuIfNecessary=function(){null==this.sideMenu&&(this.sideMenu=new Qe.a(this.$indexedTermsSideMenu,$(null),{sidePadding:-45}))},e.prototype.renderBookElementTerms=function(){var e=this;if(null!=this.bookElementSummary){var t=[];for(var n in this.bookElementSummary)t.push(n);var o=L.a.groupInto(t,5);L.a.asyncEach(o,function(t){for(var n=0,o=t;n<o.length;n++){var i=o[n];e.renderTermsInPargraph(i)}},function(){},16)}},e.prototype.renderTermsInPargraph=function(e){if(this.bookElementSummary&&this.bookElementSummary[e]){var t=document.querySelector("[refid='"+e+"']");if(t){var n=this.keepOnlyBookTerms(this.bookElementSummary[e]);n&&(n=n.sort(function(e,t){return t.relativeWeight-e.relativeWeight}),this.markTermsInParagraph(t,n))}}},e.prototype.keepOnlyBookTerms=function(e){var t=this;return this.bookTermMap&&e?e.filter(function(e){return t.bookTermMap[e.term]}):[]},e.prototype.markTermsInParagraph=function(e,t){if($(e).is(".listing-container"))return[];var n=[],o={},i={};t.sort(function(e,t){return t.term.length-e.term.length});for(var r=0;r<t.length;r++)for(var a=t[r],s=r+1;s<t.length;s++){var l=t[s];l.term.length>a.term.length||this.getBestMatch(a.term,l.term,(l.keywords||[]).join(" "))&&(o[a.term]||(o[a.term]=[]),o[a.term].push(l))}var c=e.textContent;for(var d in o){if(p=this.getBestMatch(c,d)){this.highlightBestMatchInParagraph(e,p,d);for(var u=0,h=o[d];u<h.length;u++){i[h[u].term]=!0}i[d]=!0}}for(r=0;r<t.length;r++){var p,m=t[r];if(!i[m.term])(p=this.getBestMatch(c,m.term,(m.keywords||[]).join(" ")))?(this.highlightBestMatchInParagraph(e,p,m.term),i[m.term]=!0):n.push(m)}return n},e.prototype.highlightBestMatchInParagraph=function(e,t,n){var o="inline-indexed-term",i="inline-indexed-term-"+n.replace(/[^a-zA-Z0-9]+/g,"-");o+=" "+i;try{et.a.highlight(e,t,o),$(e).find("."+i).attr("data-original-term",n)}catch(t){console.log('Error marking: "'+n+'" in '+e.textContent)}},e.prototype.getBestMatch=function(e,t,n){if(e.indexOf(t)>=0)return t;var o=e.toLowerCase().indexOf(t.toLowerCase());return o>=0?e.substr(o,t.length):("s"==t[t.length-1]&&(t=t.substr(0,t.length-1)),e.indexOf(t)>=0?t:(o=e.toLowerCase().indexOf(t.toLowerCase()))>=0?e.substr(o,t.length):e.indexOf(n)>=0?n:void 0)},e.prototype.openTerm=function(e,t,n){var o=this;this.$indexedTermsSideMenu.html(Mustache.render(ot,{term:e,productTitle:n})),this.sideMenu.open(),this.getProductTerm(e,t).then(function(i){var r=i.keywords.join(" ")||i.term;Promise.all([tt.fillContentRanges(t,i),o.getProductInfo(t),tt.getLibraryTerm(r)]).then(function(i){0!=o.viewTermActions.length&&o.viewTermActions[o.viewTermActions.length-1].externalId==t&&o.viewTermActions[o.viewTermActions.length-1].term==e||o.viewTermActions.push({term:e,externalId:t,title:n}),o.renderTermInfo(i[0],i[1],i[2])}).catch(function(e){$(document).trigger("requestNotification","Error getting term info. Try later."),o.sideMenu.close()})}).catch(function(e){$(document).trigger("requestNotification","Error getting term info. Try later."),o.sideMenu.close()})},e.prototype.getProductTerm=function(e,t){return null!=this.book&&this.book.shortName==t&&null!=this.bookTermMap&&this.bookTermMap[e]?Promise.resolve(this.bookTermMap[e]):tt.getProductTerm(t,e)},e.prototype.getProductInfo=function(e){return null!=this.book&&e==this.book.shortName?Promise.resolve({title:this.book.title,externalId:this.book.shortName,slug:this.book.slug}):new Promise(function(t,n){h.a.bookContentService.then(function(o){o.getBook(e).then(function(e){t({title:e.title,externalId:e.shortName,slug:e.slug})}).catch(function(e){return n(e)})})})},e.prototype.renderTermInfo=function(e,t,n){this.$indexedTermsSideMenu.html(Mustache.render(it,{term:e.term,productTitle:t.title,productExternalId:t.externalId,backArrowState:this.getBackArrowState(),productLink:"/book/"+t.slug,content:this.preprocessBeforeDisplaying(e.content),isAdmin:this.isAdmin||this.isEditor,otherProducts:this.getOtherBooks(n,t),relatedTerms:this.getRelatedTerms(e,this.processRelatedTerms(e,e.relatedTerms)),precedingTerms:this.getPrecedingSucceedingTerms(e,this.processRelatedTerms(e,e.precedingTerms)),succeedingTerms:this.getPrecedingSucceedingTerms(e,this.processRelatedTerms(e,e.succeedingTerms))})),this.$indexedTermsSideMenu.find("img[image-src]").each(function(e,t){var n=$(t);n.attr("src",n.attr("image-src"))}),this.$indexedTermsSideMenu.find("img[data-high-resolution-path]").each(function(e,t){var n=$(t);n.attr("src",n.attr("data-high-resolution-path"))}),this.$indexedTermsSideMenu.find("textarea.code-area").each(function(e,t){var n=t.textContent,o=n.indexOf("!@%STYLE%@!");o>=0&&(n=n.substr(0,o)),t.textContent=n.trim(),T.a.changeElementType(t,"pre")}),this.$indexedTermsSideMenu.find(".code-annotations-overlay-container").each(function(e,t){var n=$(t);if(n.attr("data-annotations")){var o=atob(n.attr("data-annotations")),i=o.indexOf("!@%STYLE%@!");i>=0&&(o=o.substr(0,i)),n.siblings(".code-area").append("\n"+o.trim())}})},e.prototype.getRelatedTerms=function(e,t){if(this.isAdmin||this.isEditor)return t;for(var n=[],o={},i=0,r=t;i<r.length;i++){var a=r[i];this.bookTermMap[a.term]&&(o[a.term]=!0,n.push(a))}if(e.precedingTerms)for(var s=0,l=e.precedingTerms;s<l.length;s++){a=l[s];this.bookTermMap[a.term]&&(o[a.term]||(o[a.term]=!0,n.push(a)))}if(e.succeedingTerms)for(var c=0,d=e.succeedingTerms;c<d.length;c++){a=d[c];this.bookTermMap[a.term]&&(o[a.term]||(o[a.term]=!0,n.push(a)))}return n.sort(function(e,t){return t.weight-e.weight})},e.prototype.getPrecedingSucceedingTerms=function(e,t){return this.isAdmin||this.isEditor?t:[]},e.prototype.processRelatedTerms=function(e,t){var n=this;return t&&t.length?((t=(t=t.sort(function(e,t){return t.weight-e.weight}).slice(0,10)).filter(function(e){return n.bookTermMap[e.term]})).forEach(function(e){var t=e.term.lastIndexOf("--");t>-1&&(e.displayedTerm=e.term.substr(t+2).trim())}),t):[]},e.prototype.preprocessBeforeDisplaying=function(e){if(!e||e.length<=1)return e;if(-1!=e[0].type.toLowerCase().indexOf("definition"))return e;for(var t=1;t<e.length;t++)if(e[t].type.toLowerCase().indexOf("definition")){var n=e[0];e[0]=e[t],e[t]=n;break}return e.forEach(function(e){e.range=e.range.filter(function(e){return e.html})}),e},e.prototype.getOtherBooks=function(e,t){if(null==e||null==t)return[];var n={};return n[t.externalId]=!0,(e.libraryTermEntries||[]).filter(function(e){var t=n[e.productExternalId];return n[e.productExternalId]=!0,!t}).sort(function(e,t){return t.weight-e.weight})},e.prototype.getRangesWeight=function(e){return e?e.range.reduce(function(e,t){return e+t.weight},0):0},e.prototype.deleteTermFromProduct=function(e,t,n){var o=this;$(document).trigger("requestNotification","Deleting "+e),tt.deleteTermFromProduct(e,t,n).then(function(){$(document).trigger("requestNotification","Success"),o.sideMenu.close()}).catch(function(e){$(document).trigger("requestNotification","Error deleting term.")})},e.prototype.deleteTermFromParagraph=function(e,t,n){$(document).trigger("requestNotification","Deleting "+e+" from paragraph"),tt.deleteTermFromParagraph(e,this.book.shortName,this.bookElement.shortName,t).then(function(){$(document).trigger("requestNotification","Success"),T.a.unwrapIntoParent(n)}).catch(function(){$(document).trigger("requestNotification","Error deleting term.")})},e.prototype.deleteTermContent=function(e,t,n,o){var i=this;$(document).trigger("requestNotification","Deleting connection"),o.closest(".term-viewer-html-content").append("<div class='term-viewer-html-content-overlay'></div>"),tt.deleteTermContent(e,t,n).then(function(){$(document).trigger("requestNotification","Success"),i.bookTermMap[e]&&(L.a.removeItemFromArray(i.bookTermMap[e].content,i.bookTermMap[e].content.find(function(e){return!!e.range.find(function(e){return e.location==n})})),o.closest(".term-viewer-html-content").remove())}).catch(function(e){o.closest(".term-viewer-html-content").find(".term-viewer-html-content-overlay").remove(),$(document).trigger("requestNotification","Error deleting term.")})},e.prototype.deletePrecedingTerm=function(e,t,n,o){var i=this;$(document).trigger("requestNotification","Deleting preceding term"),o.find(".term-viewer-related-term-delete").css("display","none"),tt.deletePrecedingTerm(e,t,n).then(function(){$(document).trigger("requestNotification","Success"),o.remove(),i.bookTermMap[e]&&L.a.removeItemFromArray(i.bookTermMap[e].precedingTerms,i.bookTermMap[e].precedingTerms.find(function(e){return e.term==t}))}).catch(function(){o.find(".term-viewer-related-term-delete").css("display","block"),$(document).trigger("requestNotification","Error deleting preceding term.")})},e.prototype.deleteSucceedingTerm=function(e,t,n,o){var i=this;$(document).trigger("requestNotification","Deleting succeeding term"),o.find(".term-viewer-related-term-delete").css("display","none"),tt.deleteSucceedingTerm(e,t,n).then(function(){$(document).trigger("requestNotification","Success"),o.remove(),i.bookTermMap[e]&&L.a.removeItemFromArray(i.bookTermMap[e].succeedingTerms,i.bookTermMap[e].succeedingTerms.find(function(e){return e.term==t}))}).catch(function(){o.find(".term-viewer-related-term-delete").css("display","block"),$(document).trigger("requestNotification","Error deleting succeeding term.")})},e.prototype.deleteRelatedTerm=function(e,t,n,o){var i=this;$(document).trigger("requestNotification","Deleting related term"),o.find(".term-viewer-related-term-delete").css("display","none"),tt.deleteRelatedTerm(e,t,n).then(function(){$(document).trigger("requestNotification","Success"),o.remove(),i.bookTermMap[e]&&L.a.removeItemFromArray(i.bookTermMap[e].relatedTerms,i.bookTermMap[e].relatedTerms.find(function(e){return e.term==t}))}).catch(function(){o.find(".term-viewer-related-term-delete").css("display","block"),$(document).trigger("requestNotification","Error deleting related term.")})},e.prototype.getBackArrowState=function(){return null==this.viewTermActions||this.viewTermActions.length<=1?null:this.viewTermActions[this.viewTermActions.length-2]},e}(),ot='\n<div class=\'term-viewer-root\'>\n    <div class="term-viewer-header">\n        <span class="term-viewer-term">{{term}}</span> in <span class="term-viewer-current-product">{{productTitle}}</span>\n        <i class="fa fa-close"></i>\n    </div>\n\n    <div class="term-viewer-scrollable-content">\n        <div class="readable-text">\n            <span class="placeholder"><span class="placeholder-animated-background">&nbsp;</span></span>\n        </div>\n        <div class="readable-text">\n            <span class="placeholder" style="margin-right: 30px"><span class="placeholder-animated-background">&nbsp;</span></span>\n        </div>\n        <div class="readable-text">\n            <span class="placeholder" style="margin-right: 10px"><span class="placeholder-animated-background">&nbsp;</span></span>\n        </div>\n        <div class="readable-text">\n            <span class="placeholder" style="margin-right: 70px"><span class="placeholder-animated-background">&nbsp;</span></span>\n        </div>\n        \n        <div class="loading-page-image-placeholder"></div>\n\n        <div class="readable-text">\n            <span class="placeholder" style="margin-right: 30px"><span class="placeholder-animated-background">&nbsp;</span></span>\n        </div>\n        <div class="readable-text">\n            <span class="placeholder" style="margin-right: 10px"><span class="placeholder-animated-background">&nbsp;</span></span>\n        </div>\n        <div class="readable-text">\n            <span class="placeholder" style="margin-right: 80px"><span class="placeholder-animated-background">&nbsp;</span></span>\n        </div>\n\n        <div class="loading-page-image-placeholder"></div>\n\n        <div class="readable-text">\n            <span class="placeholder" style="margin-right: 15px"><span class="placeholder-animated-background">&nbsp;</span></span>\n        </div>\n        <div class="readable-text">\n            <span class="placeholder" style="margin-right: 20px"><span class="placeholder-animated-background">&nbsp;</span></span>\n        </div>\n    </div>\n</div>',it='\n<div class=\'term-viewer-root\'>\n    <div class="term-viewer-header">\n        {{#backArrowState}}<i class="fa fa-arrow-left term-viewer-back-arrow" title="Back to {{term}} in {{title}}"/>{{/backArrowState}}\n        {{#isAdmin}}<i class="fa fa-trash term-viewer-delete-term" title="delete term from this product"/>{{/isAdmin}}\n        <span class="term-viewer-term">{{term}}</span> in <span class="term-viewer-current-product" data-external-id="{{productExternalId}}">{{productTitle}}</span>\n        <i class="fa fa-close"></i>\n    </div>\n    <div class="term-viewer-scrollable-content">\n        {{#content.length}}\n        <div class="term-viewer-section">\n            {{#content}}\n            <div class="term-viewer-html-content">\n                {{#isAdmin}}<div class="term-viewer-label term-viewer-label-definition">{{type}}</div>{{/isAdmin}}\n                \n                {{#range}}\n                    {{#html}}\n                    <div>{{{html}}}</div>\n                    <div class="term-viewer-commands-container">\n                        {{#isAdmin}}<a href="javascript:void(0)" data-range-location="{{location}}" class="term-viewer-delete-range">delete</a>{{/isAdmin}}\n                        {{#isLast}}<a class="term-viewer-see-more-link" href="{{productLink}}/{{location}}">&#8212; {{title}}</a>{{/isLast}}\n                    </div>\n                    {{/html}}\n                {{/range}}\n            </div>\n            {{/content}}\n            </div>\n        {{/content.length}}\n\n        {{#otherProducts.length}}\n        <div class="term-viewer-section">\n            <div class="term-viewer-section-header"><span class="term-viewer-term">{{term}}</span> in other products</div>\n            <div class="term-viewer-other-products">\n                {{#otherProducts}}\n                <div class="term-viewer-other-product" data-external-id="{{productExternalId}}" data-term="{{term}}">\n                    <img src="'+k.a.getLivebookCdn()+'assets/images/cover.png" image-src="{{productCover}}" alt="{{productTitle}}"/>\n                </div>\n                {{/otherProducts}}\n            </div>\n        </div>\n        {{/otherProducts.length}}\n\n        {{#relatedTerms.length}}\n        <div class="term-viewer-section">\n            <div class="term-viewer-section-header">related terms</div>\n            <div class="term-viewer-other-terms">\n            {{#relatedTerms}}\n                <span class="term-viewer-related-term" data-term="{{term}}">\n                    {{displayedTerm}}{{#isAdmin}}<sup>{{weight}}</sup><i class="fa fa-close term-viewer-related-term-delete"/>{{/isAdmin}}\n                </span>\n            {{/relatedTerms}}\n            </div>\n        </div>\n        {{/relatedTerms.length}}\n\n        {{#precedingTerms.length}}\n        <div class="term-viewer-section">\n            <div class="term-viewer-section-header">preceding terms</div>\n            <div class="term-viewer-other-terms">\n            {{#precedingTerms}}\n                <span class="term-viewer-related-term preceding-term" data-term="{{term}}">\n                {{displayedTerm}}{{#isAdmin}}<sup>{{weight}}</sup><i class="fa fa-close term-viewer-related-term-delete"/>{{/isAdmin}}\n                </span>\n            {{/precedingTerms}}\n            </div>\n        </div>\n        {{/precedingTerms.length}}\n\n        {{#succeedingTerms.length}}\n        <div class="term-viewer-section">\n            <div class="term-viewer-section-header">succeeding terms</div>\n            <div class="term-viewer-other-terms">\n            {{#succeedingTerms}}\n                <span class="term-viewer-related-term succeeding-term" data-term="{{term}}">\n                {{displayedTerm}}{{#isAdmin}}<sup>{{weight}}</sup><i class="fa fa-close term-viewer-related-term-delete"/>{{/isAdmin}}\n                </span>\n            {{/succeedingTerms}}\n            </div>\n        </div>\n        {{/succeedingTerms.length}}\n    </div>\n</div>',rt=new nt,at=n(673);n.d(t,"BookPage",function(){return ct});var st=$(document),lt=$(window),ct=new(function(){function e(){var e=this;this.pageClass="book-page",o.a.fillWithNecessaryHtmlElements(),this.$mainPageContent=$("#main-page-content"),this.$meapStickerContainer=$("#meap-sticker-container"),this.$meapStickerContainer.find("#meap-sticker").on("click",this.handleShowMeapClick.bind(this)),this.adjustSizeRelatedBehaviors=this.adjustSizeRelatedBehaviors.bind(this),p.b.loadDeviceInfo().then(function(t){e.currentPlatform=t.platform}),st.on("bookElementUnlocked",function(t,n,o,i){m.a.setTimeout(function(){return e.handlePurchaseSuccessful(i)},5)})}return e.prototype.initialize=function(e,t,n,o,i){this.isActive=!0;var r=b.a.getCurrentMainContentTranslateX();this.$mainPageContent.html(pe.a),b.a.translateMainContent(r),this.meapVersion=o,this.additional=i,this.adjustSizeRelatedBehaviors(),this.adaptUI(),ae.a.initialize(),Z.a.initialize(),this.loadBookContent(e,n),lt.on("orientationchange resizestop",this.adjustSizeRelatedBehaviors)},e.prototype.getBook=function(){return this.book},e.prototype.loadBookContent=function(e,t){var n=this;if(this.isActive){var o=e.book,i=e.bookElement;this.book=o,this.bookElement=i,be.a.book=o,be.a.bookElement=i,be.a.shouldImmediatelyPlayLiveaudio=-1!=document.location.href.indexOf("liveaudio=true"),this.trackContentBuildingProcess(this.additional),this.handleBookElementDataRecieved(e),this.processPointingLinkIfNecessary(this.book,this.bookElement,this.additional),o&&i&&(f.a.updateTitle((i.title||"")+" - "+(o.title||"")),f.a.updateMetaContent(this.getThisChapterCoversContent()),f.a.updateMetaImage(o.bookCoverPath),f.a.updateCanonicalLink(o.slug,i.shortName,i.meapVersion),this.fillBookElementStructurePricingInfoIfNecessary()),R.a.initialize(),Oe.a.initialize(o,i),te.a.initialize(o,i),o.hasAudio&&i.audioLocation&&i.subtitlesLocation&&(ge.initialize(),ge.loadBookContent(o,i)),o.userOwnsBook||i.isOpen||m.a.setTimeout(function(){fe.a.initialize(o,i,n.initialElement)},250),m.a.setTimeout(function(){return Xe.initialize(o,i)},10),m.a.setTimeout(function(){return ee.a.initialize(o,i)},10),m.a.setTimeout(function(){return X.a.initialize(o,i)},5),m.a.setTimeout(function(){return Q.a.initialize(o,i)},5),m.a.setTimeout(function(){return oe.a.initialize()},5),m.a.setTimeout(function(){return ie.a.initialize()},5),m.a.setTimeout(function(){return V.initialize(o,i)},10),m.a.setTimeout(function(){return se.a.initialize(o,i)},250),m.a.setTimeout(function(){return K.a.initialize(o,i)},250),m.a.setTimeout(function(){return D.initialize(o,i)},300),m.a.setTimeout(function(){return J.initialize(o,i)},300),m.a.setTimeout(function(){return ne.a.initialize(o,i)},300),m.a.setTimeout(function(){return N.a.initialize(o,i)},400),m.a.setTimeout(function(){return le.a.initialize(o,i)},500),m.a.setTimeout(function(){return re.a.initialize(o,i,!0)},500),m.a.setTimeout(function(){return H.a.initialize(o,i,t)},510),m.a.setTimeout(function(){return rt.initialize(o,i)},700),i.reviewVersion||(m.a.setTimeout(function(){return ze.initialize(o)},520),m.a.setTimeout(function(){return je.initialize(o,i)},260),m.a.setTimeout(function(){return Ae.initialize(o)},500),We.a.initialize(o,i),at.PromoManager.promote()),m.a.setTimeout(function(){return Le.a.initialize(o)},550),o.hasExercises&&ue.a.load(o,i),$(document).trigger("initializeRequested",[o,i,t]),o.isMeap&&this.$meapStickerContainer.removeClass("hidden"),o.isFreeEbook&&Ue.initialize(o),o.userIsEditor&&($(".settings-editor-section .edit-book-link").attr("href",g.a.formEditLinkFromBookSlugAndBookElementShortName(o.slug,i.shortName)),$(".settings-editor-section .back-to-regular-book-link").attr("href",g.a.formLinkFromBookSlugAndBookElementShortName(o.slug,i.shortName))),m.a.setTimeout(function(){de.a.load(t),ve.a.load(),De.a.isSpecialDiscussionPart(t)||De.a.isDiscussionErrata(t)?(M.a.showNotification("Opening discussion"),m.a.setTimeout(function(){de.a.requestOpen(),M.a.hideNotification()},2100)):De.a.isSpecialCommentPart(t)&&(M.a.showNotification("Opening discussion"),m.a.setTimeout(function(){0==t.indexOf("comment-")&&de.a.requestShowCommentWhenReady(t.replace("comment-",""))},2100))},2e3)}},e.prototype.clean=function(){$("#book-content-main-row").css("padding-top",""),Q.a.clean(),H.a.clean(),D.clean(),J.clean(),fe.a.clean(),R.a.clean(),Z.a.clean(),Le.a.clean(),Ue.clean(),We.a.clean(),je.clean(),Ae.clean(),Xe.clean(),at.PromoManager.clean(),S.a.isSideMenuOpened&&this.isActive&&st.trigger("slideMenuCloseRequested"),$("body").removeClass(this.pageClass),this.partialClean()},e.prototype.partialClean=function(){this.isActive=!1,this.initialElement=null,this.book=null,this.bookElement=null,be.a.book=null,be.a.bookElement=null,be.a.shouldImmediatelyPlayLiveaudio=!1,this.meapVersion="",this.additional="",$("#header-notification-container").addClass("hidden"),$("#meap-sticker-container").addClass("hidden");var e=$("#footer");e.find(".previous-element-link, .next-element-link").addClass("invisible"),e.find(".footer-book-title-label").addClass("hidden"),e.find(".copyright-label").removeClass("hidden"),$("body").removeClass("subtitles-loaded user-owns-book user-owns-audio user-doesnt-own-book book-meap user-is-editor free-ebook review-book book-edit"),$(".summary-wrapper").remove(),$("#track-point-column").removeClass("shown").addClass("hidden"),$("#audio-loader").removeClass("shown"),$(".second-row-top-bar-section").addClass("hidden"),S.a.isSideMenuOpened&&S.a.$openedMenu&&b.a.closeMenuIfTakesTooMuchSpace(S.a.$openedMenu),he.a.clean(),ge.clean(),N.a.clean(),le.a.clean(),re.a.clean(),te.a.clean(),ne.a.clean(),ae.a.clean(),ee.a.clean(),oe.a.clean(),ue.a.clean(),se.a.clean(),Z.a.clean(),g.a.clean(),K.a.clean(),V.clean(),H.a.partialClean(),fe.a.clean(),ze.clean(),be.a.isUnlockingWholeContentThroughPointingLink=!1,de.a.clean(),lt.off("orientationchange resizestop",this.adjustSizeRelatedBehaviors)},e.prototype.processAdditional=function(e){if(e){var t=e;if(0===t.indexOf("search-")){var n=t.substring(t.lastIndexOf("search-")+"search-".length),o=$(document.getElementById(n)).closest(".readable-text, .browsable-container");this.initialElement=o[0],o.addClass("paragraph-selected")}else if(0===t.indexOf("note-"));else{if(0===t.indexOf("section-"))return void(this.initialElement=b.a.getSectionHeading(t));if(0===t.indexOf("point-")){var i=t.substring("point-".length).split("-");2===i.length?e=i[0]:i.length>2&&(e=i[1])}}var r=document.getElementById(e);r&&(this.initialElement=$(r).closest(".readable-text, .browsable-container")[0])}},e.prototype.adaptUI=function(){$("body").addClass(this.pageClass).removeClass("landing-page"),$(".second-row-top-bar-section").removeClass("hidden"),this.changeLivebookButtonToBackButtonIfNecessary()},e.prototype.changeLivebookButtonToBackButtonIfNecessary=function(){if(!(history.length<=1||this.currentPlatform!==p.a.Cordova&&this.currentPlatform!==p.a.Electron)){var e=$("#livebook-button");e.addClass("history-back-button"),e.removeAttr("style"),e.find("i").removeClass().addClass("fa fa-arrow-left"),e.attr("title","go back")}},e.prototype.handleBookElementDataRecieved=function(e){var t=e.book,n=e.bookElement;$("#book-markup-container").html(e.bookElement.content),$("#track-point-column").removeClass("hidden").addClass("shown"),$("body").toggleClass("user-owns-book",t.userOwnsBook).toggleClass("user-doesnt-own-book",!t.userOwnsBook).toggleClass("user-owns-audio",t.userOwnsAudio).toggleClass("book-meap",t.isMeap).toggleClass("user-is-editor",t.userIsEditor).toggleClass("free-ebook",t.isFreeEbook).toggleClass("review-book",n.reviewVersion>0),this.updatePreviousNextBookElement(e.previousBookElement,e.nextBookElement),this.updatePageTitle(t.title),ce.a.insertNextChapterSummary(e.nextBookElement),m.a.triggerDocumentEventAsync("bookContentLoaded",[t,e,A.a.isCurrentlyLoggedIn()]),this.adjustContentStartPosition(),this.adjustZoomableImages(),this.loadHighQualityBookCoverIfNecessary(),b.a.loadPlaceholderImages();var o=null!=document.querySelector(".scrambled");st.trigger("openedChapter",{scrambled:o,loggedIn:A.a.isCurrentlyLoggedIn()})},e.prototype.fillBookElementStructurePricingInfoIfNecessary=function(){var e=this;this.book&&this.bookElement&&!this.bookElement.isOpen&&this.book.shortName&&this.bookElement.shortName&&h.a.bookContentService.then(function(t){e.book&&e.bookElement&&!e.bookElement.isOpen&&e.book.shortName&&e.bookElement.shortName&&t.getCompleteBookElementPriceInfo(e.book.shortName,e.bookElement.shortName,e.bookElement.meapVersion).then(function(t){null!=t&&0!=t.tokenPrice&&null!=e.bookElement&&(e.bookElement.bookElementPriceInfo=t,fe.a.initialize(e.book,e.bookElement,null))}).catch(function(e){console.log("Cannot get book element price info")})})},e.prototype.adjustSizeRelatedBehaviors=function(){var e=this;m.a.setTimeout(function(){e.adjustContentStartPosition(),p.b.isSmallScreenSize()?(q.a.enableHiding(),null==e.book||e.book.isFreeEbook||G.a.enableHiding()):(q.a.disableAndRevert(),G.a.disableAndRevert())},5)},e.prototype.adjustContentStartPosition=function(){var e=$("#book-content-main-row");if(0!==e.length){var t=b.a.getTopNavBarHeight(),n=e.offset().top;t>n?e.css("padding-top",1.2*(t-n)+"px"):e.css("padding-top","")}},e.prototype.adjustZoomableImages=function(){$(".figure-container[data-high-resolution-path]").each(function(e,t){var n=$(t);n.find("img").attr("data-action","zoom").attr("data-zoom-src",n.attr("data-high-resolution-path"))}),u('[data-action="zoom"]',{margin:10,background:"rgba(25, 18, 25, 0.9)"})},e.prototype.updatePreviousNextBookElement=function(e,t){var n=$("#footer");e&&this.updateLink(n.find(".previous-element-link"),e,!0),t&&this.updateLink(n.find(".next-element-link"),t)},e.prototype.updateLink=function(e,t,n){e.removeClass("invisible"),e.attr("title",t.title),e.attr("href",t.link.replace("#!",""));var o=n?"Prev ":"Next ",i=t.shortName.toLowerCase();0==i.indexOf("part")?o+="Part":0==i.indexOf("chapter")?o+="Chapter":0==i.indexOf("appendix")&&(o+="Appendix"),e.find(".book-element-label").text(o)},e.prototype.updatePageTitle=function(e){var t=f.a.cleanBookTitle(e);$("#footer .copyright-label").addClass("hidden"),$("#footer .footer-book-title-label").removeClass("hidden"),$("#footer .footer-book-title-label .book-title-label-text").attr("title",e).text(t),$(".title-section-container").find(".book-title-label-text").attr("title",e).text(t)},e.prototype.getBookTitleAndPotentialHeartHtml=function(e){var t="";return null==this.book||this.book.userOwnsBook||(t+="<i class='fa fa-heart-o wish-list-icon' title='wishlist'/>"),t+=f.a.cleanBookTitle(e)},e.prototype.trackContentBuildingProcess=function(e){var t=this;void 0===e&&(e="");var n=!this.book.hasExercises,o=!1,i=!1,r=!1,a=!1,s=document.location.href;""!=e&&"1"!=e&&M.a.showNotification('<div class="jumping-dots" title="scrolling to the exact position">\n                    <span class="dot"></span>\n                    <span class="dot"></span>\n                    <span class="dot"></span>\n                </div>'),!e&&null!=this.bookElement&&this.bookElement.location&&(e=this.bookElement.location+"");var l=function(){if(t.isActive){var l=!1,c=!1,d=!1,u=!1,h=!1,p=!1,g=!1;if(e&&(l=0===e.indexOf("search-"),c=0===e.indexOf("point-"),d=0===e.indexOf("section-"),h=0===e.indexOf("note-"),p=0===e.indexOf("comment-"),g=0===e.indexOf("discussion"),t.processAdditional(e)),t.initialElement&&!t.bookElement.isBookOverview||(t.initialElement=t.getFirstElement(),u=!0),$(t.initialElement).find("h1").length>0&&(u=!0),n&&o&&i&&r&&a){if(st.trigger("contentFullyConstructed",[t.book,t.bookElement,t.initialElement,s]),l&&st.trigger("searchHighlightRequested",[t.book,t.bookElement]),h){var f=e.substring("note-".length);return le.a.openNotes(f,function(){return st.trigger("initialElementInView")}),void M.a.hideNotification()}if(p)return de.a.requestShowCommentWhenReady(e.substring("comment-".length),0,function(){return st.trigger("initialElementInView")}),void M.a.hideNotification();if(g)return M.a.showNotification("Opening discussion"),void m.a.setTimeout(function(){de.a.requestOpen(),M.a.hideNotification()},2100);m.a.setTimeout(function(){return st.trigger("playingTextFragmentChange",t.initialElement)},100),t.initialElement?m.a.setTimeout(function(){M.a.hideNotification(),(ae.a.shouldAutomaticallyScroll||l||c||!u||d)&&ae.a.scrollToElement(t.initialElement,function(){var n=$(t.initialElement);if(st.trigger("initialElementInView"),l&&n.is(".scrambled"))fe.a.unlockFragments(t.book,t.bookElement,ke.a.Search,"",[n],s).then(function(){return st.trigger("searchHighlightRequested",[t.book,t.bookElement])}).catch(function(e){});else if(c){var o=e.substring("point-".length).split("-");fe.a.tryToUnlockPointedParagraph(t.book,t.bookElement,o,s)}})},400):(st.trigger("initialElementInView"),M.a.hideNotification())}}};st.one("initialExercisesCreated",function(){n=!0,l()}),st.one("initialTextAddendumsCreated",function(){a=!0,l()}),st.one("videoSectionsInserted",function(){o=!0,l()}),st.one("annotatedListingsLoaded",function(){i=!0,l()}),st.one("progressLoaded",function(){r=!0,l()})},e.prototype.processPointingLinkIfNecessary=function(e,t,n){if(e&&t&&n){var o=n.substring("point-".length).split("-"),i=ke.b.getDataFromPointingLink(e,t,o);i&&(be.a.isUnlockingWholeContentThroughPointingLink=ke.b.isEncompassingWholeContent(i.startParagraphId,i.endParagraphId))}},e.prototype.getFirstElement=function(){var e=$(".book-overview-cover-container");if(0!=e.length)return e[0];var t=$("#book-markup-container h1").parents(".readable-text");return t.length<=1?t[0]:void 0},e.prototype.handlePurchaseSuccessful=function(e){var t=this;null!=e&&null!=this.book&&-1!==e.indexOf(this.book.title)&&(M.a.showTemporaryNotification("Unlocking content and reloading book!"),m.a.setTimeout(function(){var e=t.book&&t.book.slug,n=t.bookElement&&t.bookElement.shortName;t.clean(),-1!=(document.location.hash||document.location.pathname).indexOf("/payment-confirmation")?document.location.href=k.a.getBookElementUrl(e,n):k.a.reloadPage()},6e3))},e.prototype.handleShowMeapClick=function(){he.a.renderMeapInfoModal(this.book,this.meapVersion)},e.prototype.getThisChapterCoversContent=function(){var e=$(".introduction-summary li"),t="";return e.each(function(e,n){t+=$(n).text().trim()+"; "}),t},e.prototype.loadHighQualityBookCoverIfNecessary=function(){var e=this.book.highResolutionCover;e=e?k.a.getMarketplaceHiqhQualityProductCoverUrl(e):this.book.bookCoverPath,$(".book-overview-cover-container img").attr("onload-image-src",e)},e}())}}]);
//# sourceMappingURL=bookPage.chunk.js.map?87b41c8ba9ac388ac880